(function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const q of document.querySelectorAll('link[rel="modulepreload"]'))F(q);new MutationObserver(q=>{for(const W of q)if(W.type==="childList")for(const U of W.addedNodes)U.tagName==="LINK"&&U.rel==="modulepreload"&&F(U)}).observe(document,{childList:!0,subtree:!0});function O(q){const W={};return q.integrity&&(W.integrity=q.integrity),q.referrerPolicy&&(W.referrerPolicy=q.referrerPolicy),q.crossOrigin==="use-credentials"?W.credentials="include":q.crossOrigin==="anonymous"?W.credentials="omit":W.credentials="same-origin",W}function F(q){if(q.ep)return;q.ep=!0;const W=O(q);fetch(q.href,W)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$4=globalThis,e$9=t$4.ShadowRoot&&(t$4.ShadyCSS===void 0||t$4.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s$2=Symbol(),o$7=new WeakMap;let n$6=class{constructor(w,O,F){if(this._$cssResult$=!0,F!==s$2)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=w,this.t=O}get styleSheet(){let w=this.o;const O=this.t;if(e$9&&w===void 0){const F=O!==void 0&&O.length===1;F&&(w=o$7.get(O)),w===void 0&&((this.o=w=new CSSStyleSheet).replaceSync(this.cssText),F&&o$7.set(O,w))}return w}toString(){return this.cssText}};const r$7=D=>new n$6(typeof D=="string"?D:D+"",void 0,s$2),i$8=(D,...w)=>{const O=D.length===1?D[0]:w.reduce((F,q,W)=>F+(U=>{if(U._$cssResult$===!0)return U.cssText;if(typeof U=="number")return U;throw Error("Value passed to 'css' function must be a 'css' function result: "+U+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(q)+D[W+1],D[0]);return new n$6(O,D,s$2)},S$1=(D,w)=>{if(e$9)D.adoptedStyleSheets=w.map(O=>O instanceof CSSStyleSheet?O:O.styleSheet);else for(const O of w){const F=document.createElement("style"),q=t$4.litNonce;q!==void 0&&F.setAttribute("nonce",q),F.textContent=O.cssText,D.appendChild(F)}},c$3=e$9?D=>D:D=>D instanceof CSSStyleSheet?(w=>{let O="";for(const F of w.cssRules)O+=F.cssText;return r$7(O)})(D):D;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:i$7,defineProperty:e$8,getOwnPropertyDescriptor:r$6,getOwnPropertyNames:h$3,getOwnPropertySymbols:o$6,getPrototypeOf:n$5}=Object,a$2=globalThis,c$2=a$2.trustedTypes,l$2=c$2?c$2.emptyScript:"",p$1=a$2.reactiveElementPolyfillSupport,d$1=(D,w)=>D,u$2={toAttribute(D,w){switch(w){case Boolean:D=D?l$2:null;break;case Object:case Array:D=D==null?D:JSON.stringify(D)}return D},fromAttribute(D,w){let O=D;switch(w){case Boolean:O=D!==null;break;case Number:O=D===null?null:Number(D);break;case Object:case Array:try{O=JSON.parse(D)}catch{O=null}}return O}},f$3=(D,w)=>!i$7(D,w),y$1={attribute:!0,type:String,converter:u$2,reflect:!1,hasChanged:f$3};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),a$2.litPropertyMetadata??(a$2.litPropertyMetadata=new WeakMap);class b extends HTMLElement{static addInitializer(w){this._$Ei(),(this.l??(this.l=[])).push(w)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(w,O=y$1){if(O.state&&(O.attribute=!1),this._$Ei(),this.elementProperties.set(w,O),!O.noAccessor){const F=Symbol(),q=this.getPropertyDescriptor(w,F,O);q!==void 0&&e$8(this.prototype,w,q)}}static getPropertyDescriptor(w,O,F){const{get:q,set:W}=r$6(this.prototype,w)??{get(){return this[O]},set(U){this[O]=U}};return{get(){return q==null?void 0:q.call(this)},set(U){const K=q==null?void 0:q.call(this);W.call(this,U),this.requestUpdate(w,K,F)},configurable:!0,enumerable:!0}}static getPropertyOptions(w){return this.elementProperties.get(w)??y$1}static _$Ei(){if(this.hasOwnProperty(d$1("elementProperties")))return;const w=n$5(this);w.finalize(),w.l!==void 0&&(this.l=[...w.l]),this.elementProperties=new Map(w.elementProperties)}static finalize(){if(this.hasOwnProperty(d$1("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(d$1("properties"))){const O=this.properties,F=[...h$3(O),...o$6(O)];for(const q of F)this.createProperty(q,O[q])}const w=this[Symbol.metadata];if(w!==null){const O=litPropertyMetadata.get(w);if(O!==void 0)for(const[F,q]of O)this.elementProperties.set(F,q)}this._$Eh=new Map;for(const[O,F]of this.elementProperties){const q=this._$Eu(O,F);q!==void 0&&this._$Eh.set(q,O)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(w){const O=[];if(Array.isArray(w)){const F=new Set(w.flat(1/0).reverse());for(const q of F)O.unshift(c$3(q))}else w!==void 0&&O.push(c$3(w));return O}static _$Eu(w,O){const F=O.attribute;return F===!1?void 0:typeof F=="string"?F:typeof w=="string"?w.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var w;this._$ES=new Promise(O=>this.enableUpdating=O),this._$AL=new Map,this._$E_(),this.requestUpdate(),(w=this.constructor.l)==null||w.forEach(O=>O(this))}addController(w){var O;(this._$EO??(this._$EO=new Set)).add(w),this.renderRoot!==void 0&&this.isConnected&&((O=w.hostConnected)==null||O.call(w))}removeController(w){var O;(O=this._$EO)==null||O.delete(w)}_$E_(){const w=new Map,O=this.constructor.elementProperties;for(const F of O.keys())this.hasOwnProperty(F)&&(w.set(F,this[F]),delete this[F]);w.size>0&&(this._$Ep=w)}createRenderRoot(){const w=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return S$1(w,this.constructor.elementStyles),w}connectedCallback(){var w;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(w=this._$EO)==null||w.forEach(O=>{var F;return(F=O.hostConnected)==null?void 0:F.call(O)})}enableUpdating(w){}disconnectedCallback(){var w;(w=this._$EO)==null||w.forEach(O=>{var F;return(F=O.hostDisconnected)==null?void 0:F.call(O)})}attributeChangedCallback(w,O,F){this._$AK(w,F)}_$EC(w,O){var W;const F=this.constructor.elementProperties.get(w),q=this.constructor._$Eu(w,F);if(q!==void 0&&F.reflect===!0){const U=(((W=F.converter)==null?void 0:W.toAttribute)!==void 0?F.converter:u$2).toAttribute(O,F.type);this._$Em=w,U==null?this.removeAttribute(q):this.setAttribute(q,U),this._$Em=null}}_$AK(w,O){var W;const F=this.constructor,q=F._$Eh.get(w);if(q!==void 0&&this._$Em!==q){const U=F.getPropertyOptions(q),K=typeof U.converter=="function"?{fromAttribute:U.converter}:((W=U.converter)==null?void 0:W.fromAttribute)!==void 0?U.converter:u$2;this._$Em=q,this[q]=K.fromAttribute(O,U.type),this._$Em=null}}requestUpdate(w,O,F){if(w!==void 0){if(F??(F=this.constructor.getPropertyOptions(w)),!(F.hasChanged??f$3)(this[w],O))return;this.P(w,O,F)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(w,O,F){this._$AL.has(w)||this._$AL.set(w,O),F.reflect===!0&&this._$Em!==w&&(this._$Ej??(this._$Ej=new Set)).add(w)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(O){Promise.reject(O)}const w=this.scheduleUpdate();return w!=null&&await w,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var F;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[W,U]of this._$Ep)this[W]=U;this._$Ep=void 0}const q=this.constructor.elementProperties;if(q.size>0)for(const[W,U]of q)U.wrapped!==!0||this._$AL.has(W)||this[W]===void 0||this.P(W,this[W],U)}let w=!1;const O=this._$AL;try{w=this.shouldUpdate(O),w?(this.willUpdate(O),(F=this._$EO)==null||F.forEach(q=>{var W;return(W=q.hostUpdate)==null?void 0:W.call(q)}),this.update(O)):this._$EU()}catch(q){throw w=!1,this._$EU(),q}w&&this._$AE(O)}willUpdate(w){}_$AE(w){var O;(O=this._$EO)==null||O.forEach(F=>{var q;return(q=F.hostUpdated)==null?void 0:q.call(F)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(w)),this.updated(w)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(w){return!0}update(w){this._$Ej&&(this._$Ej=this._$Ej.forEach(O=>this._$EC(O,this[O]))),this._$EU()}updated(w){}firstUpdated(w){}}b.elementStyles=[],b.shadowRootOptions={mode:"open"},b[d$1("elementProperties")]=new Map,b[d$1("finalized")]=new Map,p$1==null||p$1({ReactiveElement:b}),(a$2.reactiveElementVersions??(a$2.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$3=globalThis,i$6=t$3.trustedTypes,s$1=i$6?i$6.createPolicy("lit-html",{createHTML:D=>D}):void 0,e$7="$lit$",h$2=`lit$${Math.random().toFixed(9).slice(2)}$`,o$5="?"+h$2,n$4=`<${o$5}>`,r$5=document,l$1=()=>r$5.createComment(""),c$1=D=>D===null||typeof D!="object"&&typeof D!="function",a$1=Array.isArray,u$1=D=>a$1(D)||typeof(D==null?void 0:D[Symbol.iterator])=="function",d=`[ 	
\f\r]`,f$2=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,v=/-->/g,_=/>/g,m=RegExp(`>|${d}(?:([^\\s"'>=/]+)(${d}*=${d}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),p=/'/g,g=/"/g,$$2=/^(?:script|style|textarea|title)$/i,y=D=>(w,...O)=>({_$litType$:D,strings:w,values:O}),x=y(1),T=Symbol.for("lit-noChange"),E=Symbol.for("lit-nothing"),A=new WeakMap,C$1=r$5.createTreeWalker(r$5,129);function P(D,w){if(!a$1(D)||!D.hasOwnProperty("raw"))throw Error("invalid template strings array");return s$1!==void 0?s$1.createHTML(w):w}const V=(D,w)=>{const O=D.length-1,F=[];let q,W=w===2?"<svg>":w===3?"<math>":"",U=f$2;for(let K=0;K<O;K++){const G=D[K];let Y,Q,X=-1,J=0;for(;J<G.length&&(U.lastIndex=J,Q=U.exec(G),Q!==null);)J=U.lastIndex,U===f$2?Q[1]==="!--"?U=v:Q[1]!==void 0?U=_:Q[2]!==void 0?($$2.test(Q[2])&&(q=RegExp("</"+Q[2],"g")),U=m):Q[3]!==void 0&&(U=m):U===m?Q[0]===">"?(U=q??f$2,X=-1):Q[1]===void 0?X=-2:(X=U.lastIndex-Q[2].length,Y=Q[1],U=Q[3]===void 0?m:Q[3]==='"'?g:p):U===g||U===p?U=m:U===v||U===_?U=f$2:(U=m,q=void 0);const Z=U===m&&D[K+1].startsWith("/>")?" ":"";W+=U===f$2?G+n$4:X>=0?(F.push(Y),G.slice(0,X)+e$7+G.slice(X)+h$2+Z):G+h$2+(X===-2?K:Z)}return[P(D,W+(D[O]||"<?>")+(w===2?"</svg>":w===3?"</math>":"")),F]};class N{constructor({strings:w,_$litType$:O},F){let q;this.parts=[];let W=0,U=0;const K=w.length-1,G=this.parts,[Y,Q]=V(w,O);if(this.el=N.createElement(Y,F),C$1.currentNode=this.el.content,O===2||O===3){const X=this.el.content.firstChild;X.replaceWith(...X.childNodes)}for(;(q=C$1.nextNode())!==null&&G.length<K;){if(q.nodeType===1){if(q.hasAttributes())for(const X of q.getAttributeNames())if(X.endsWith(e$7)){const J=Q[U++],Z=q.getAttribute(X).split(h$2),ee=/([.?@])?(.*)/.exec(J);G.push({type:1,index:W,name:ee[2],strings:Z,ctor:ee[1]==="."?H:ee[1]==="?"?I:ee[1]==="@"?L:k}),q.removeAttribute(X)}else X.startsWith(h$2)&&(G.push({type:6,index:W}),q.removeAttribute(X));if($$2.test(q.tagName)){const X=q.textContent.split(h$2),J=X.length-1;if(J>0){q.textContent=i$6?i$6.emptyScript:"";for(let Z=0;Z<J;Z++)q.append(X[Z],l$1()),C$1.nextNode(),G.push({type:2,index:++W});q.append(X[J],l$1())}}}else if(q.nodeType===8)if(q.data===o$5)G.push({type:2,index:W});else{let X=-1;for(;(X=q.data.indexOf(h$2,X+1))!==-1;)G.push({type:7,index:W}),X+=h$2.length-1}W++}}static createElement(w,O){const F=r$5.createElement("template");return F.innerHTML=w,F}}function S(D,w,O=D,F){var U,K;if(w===T)return w;let q=F!==void 0?(U=O._$Co)==null?void 0:U[F]:O._$Cl;const W=c$1(w)?void 0:w._$litDirective$;return(q==null?void 0:q.constructor)!==W&&((K=q==null?void 0:q._$AO)==null||K.call(q,!1),W===void 0?q=void 0:(q=new W(D),q._$AT(D,O,F)),F!==void 0?(O._$Co??(O._$Co=[]))[F]=q:O._$Cl=q),q!==void 0&&(w=S(D,q._$AS(D,w.values),q,F)),w}class M{constructor(w,O){this._$AV=[],this._$AN=void 0,this._$AD=w,this._$AM=O}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(w){const{el:{content:O},parts:F}=this._$AD,q=((w==null?void 0:w.creationScope)??r$5).importNode(O,!0);C$1.currentNode=q;let W=C$1.nextNode(),U=0,K=0,G=F[0];for(;G!==void 0;){if(U===G.index){let Y;G.type===2?Y=new R(W,W.nextSibling,this,w):G.type===1?Y=new G.ctor(W,G.name,G.strings,this,w):G.type===6&&(Y=new z(W,this,w)),this._$AV.push(Y),G=F[++K]}U!==(G==null?void 0:G.index)&&(W=C$1.nextNode(),U++)}return C$1.currentNode=r$5,q}p(w){let O=0;for(const F of this._$AV)F!==void 0&&(F.strings!==void 0?(F._$AI(w,F,O),O+=F.strings.length-2):F._$AI(w[O])),O++}}class R{get _$AU(){var w;return((w=this._$AM)==null?void 0:w._$AU)??this._$Cv}constructor(w,O,F,q){this.type=2,this._$AH=E,this._$AN=void 0,this._$AA=w,this._$AB=O,this._$AM=F,this.options=q,this._$Cv=(q==null?void 0:q.isConnected)??!0}get parentNode(){let w=this._$AA.parentNode;const O=this._$AM;return O!==void 0&&(w==null?void 0:w.nodeType)===11&&(w=O.parentNode),w}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(w,O=this){w=S(this,w,O),c$1(w)?w===E||w==null||w===""?(this._$AH!==E&&this._$AR(),this._$AH=E):w!==this._$AH&&w!==T&&this._(w):w._$litType$!==void 0?this.$(w):w.nodeType!==void 0?this.T(w):u$1(w)?this.k(w):this._(w)}O(w){return this._$AA.parentNode.insertBefore(w,this._$AB)}T(w){this._$AH!==w&&(this._$AR(),this._$AH=this.O(w))}_(w){this._$AH!==E&&c$1(this._$AH)?this._$AA.nextSibling.data=w:this.T(r$5.createTextNode(w)),this._$AH=w}$(w){var W;const{values:O,_$litType$:F}=w,q=typeof F=="number"?this._$AC(w):(F.el===void 0&&(F.el=N.createElement(P(F.h,F.h[0]),this.options)),F);if(((W=this._$AH)==null?void 0:W._$AD)===q)this._$AH.p(O);else{const U=new M(q,this),K=U.u(this.options);U.p(O),this.T(K),this._$AH=U}}_$AC(w){let O=A.get(w.strings);return O===void 0&&A.set(w.strings,O=new N(w)),O}k(w){a$1(this._$AH)||(this._$AH=[],this._$AR());const O=this._$AH;let F,q=0;for(const W of w)q===O.length?O.push(F=new R(this.O(l$1()),this.O(l$1()),this,this.options)):F=O[q],F._$AI(W),q++;q<O.length&&(this._$AR(F&&F._$AB.nextSibling,q),O.length=q)}_$AR(w=this._$AA.nextSibling,O){var F;for((F=this._$AP)==null?void 0:F.call(this,!1,!0,O);w&&w!==this._$AB;){const q=w.nextSibling;w.remove(),w=q}}setConnected(w){var O;this._$AM===void 0&&(this._$Cv=w,(O=this._$AP)==null||O.call(this,w))}}class k{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(w,O,F,q,W){this.type=1,this._$AH=E,this._$AN=void 0,this.element=w,this.name=O,this._$AM=q,this.options=W,F.length>2||F[0]!==""||F[1]!==""?(this._$AH=Array(F.length-1).fill(new String),this.strings=F):this._$AH=E}_$AI(w,O=this,F,q){const W=this.strings;let U=!1;if(W===void 0)w=S(this,w,O,0),U=!c$1(w)||w!==this._$AH&&w!==T,U&&(this._$AH=w);else{const K=w;let G,Y;for(w=W[0],G=0;G<W.length-1;G++)Y=S(this,K[F+G],O,G),Y===T&&(Y=this._$AH[G]),U||(U=!c$1(Y)||Y!==this._$AH[G]),Y===E?w=E:w!==E&&(w+=(Y??"")+W[G+1]),this._$AH[G]=Y}U&&!q&&this.j(w)}j(w){w===E?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,w??"")}}class H extends k{constructor(){super(...arguments),this.type=3}j(w){this.element[this.name]=w===E?void 0:w}}class I extends k{constructor(){super(...arguments),this.type=4}j(w){this.element.toggleAttribute(this.name,!!w&&w!==E)}}class L extends k{constructor(w,O,F,q,W){super(w,O,F,q,W),this.type=5}_$AI(w,O=this){if((w=S(this,w,O,0)??E)===T)return;const F=this._$AH,q=w===E&&F!==E||w.capture!==F.capture||w.once!==F.once||w.passive!==F.passive,W=w!==E&&(F===E||q);q&&this.element.removeEventListener(this.name,this,F),W&&this.element.addEventListener(this.name,this,w),this._$AH=w}handleEvent(w){var O;typeof this._$AH=="function"?this._$AH.call(((O=this.options)==null?void 0:O.host)??this.element,w):this._$AH.handleEvent(w)}}class z{constructor(w,O,F){this.element=w,this.type=6,this._$AN=void 0,this._$AM=O,this.options=F}get _$AU(){return this._$AM._$AU}_$AI(w){S(this,w)}}const j=t$3.litHtmlPolyfillSupport;j==null||j(N,R),(t$3.litHtmlVersions??(t$3.litHtmlVersions=[])).push("3.2.1");const B=(D,w,O)=>{const F=(O==null?void 0:O.renderBefore)??w;let q=F._$litPart$;if(q===void 0){const W=(O==null?void 0:O.renderBefore)??null;F._$litPart$=q=new R(w.insertBefore(l$1(),W),W,void 0,O??{})}return q._$AI(D),q};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let r$4=class extends b{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var O;const w=super.createRenderRoot();return(O=this.renderOptions).renderBefore??(O.renderBefore=w.firstChild),w}update(w){const O=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(w),this._$Do=B(O,this.renderRoot,this.renderOptions)}connectedCallback(){var w;super.connectedCallback(),(w=this._$Do)==null||w.setConnected(!0)}disconnectedCallback(){var w;super.disconnectedCallback(),(w=this._$Do)==null||w.setConnected(!1)}render(){return T}};var Re;r$4._$litElement$=!0,r$4.finalized=!0,(Re=globalThis.litElementHydrateSupport)==null||Re.call(globalThis,{LitElement:r$4});const i$5=globalThis.litElementPolyfillSupport;i$5==null||i$5({LitElement:r$4});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.1.1");var spinner_styles_default=i$8`
  :host {
    --track-width: 2px;
    --track-color: rgb(128 128 128 / 25%);
    --indicator-color: var(--sl-color-primary-600);
    --speed: 2s;

    display: inline-flex;
    width: 1em;
    height: 1em;
    flex: none;
  }

  .spinner {
    flex: 1 1 auto;
    height: 100%;
    width: 100%;
  }

  .spinner__track,
  .spinner__indicator {
    fill: none;
    stroke-width: var(--track-width);
    r: calc(0.5em - var(--track-width) / 2);
    cx: 0.5em;
    cy: 0.5em;
    transform-origin: 50% 50%;
  }

  .spinner__track {
    stroke: var(--track-color);
    transform-origin: 0% 0%;
  }

  .spinner__indicator {
    stroke: var(--indicator-color);
    stroke-linecap: round;
    stroke-dasharray: 150% 75%;
    animation: spin var(--speed) linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
      stroke-dasharray: 0.05em, 3em;
    }

    50% {
      transform: rotate(450deg);
      stroke-dasharray: 1.375em, 1.375em;
    }

    100% {
      transform: rotate(1080deg);
      stroke-dasharray: 0.05em, 3em;
    }
  }
`;const connectedElements=new Set,translations=new Map;let fallback,documentDirection="ltr",documentLanguage="en";const isClient=typeof MutationObserver<"u"&&typeof document<"u"&&typeof document.documentElement<"u";if(isClient){const D=new MutationObserver(update);documentDirection=document.documentElement.dir||"ltr",documentLanguage=document.documentElement.lang||navigator.language,D.observe(document.documentElement,{attributes:!0,attributeFilter:["dir","lang"]})}function registerTranslation(...D){D.map(w=>{const O=w.$code.toLowerCase();translations.has(O)?translations.set(O,Object.assign(Object.assign({},translations.get(O)),w)):translations.set(O,w),fallback||(fallback=w)}),update()}function update(){isClient&&(documentDirection=document.documentElement.dir||"ltr",documentLanguage=document.documentElement.lang||navigator.language),[...connectedElements.keys()].map(D=>{typeof D.requestUpdate=="function"&&D.requestUpdate()})}let LocalizeController$1=class{constructor(w){this.host=w,this.host.addController(this)}hostConnected(){connectedElements.add(this.host)}hostDisconnected(){connectedElements.delete(this.host)}dir(){return`${this.host.dir||documentDirection}`.toLowerCase()}lang(){return`${this.host.lang||documentLanguage}`.toLowerCase()}getTranslationData(w){var O,F;const q=new Intl.Locale(w.replace(/_/g,"-")),W=q==null?void 0:q.language.toLowerCase(),U=(F=(O=q==null?void 0:q.region)===null||O===void 0?void 0:O.toLowerCase())!==null&&F!==void 0?F:"",K=translations.get(`${W}-${U}`),G=translations.get(W);return{locale:q,language:W,region:U,primary:K,secondary:G}}exists(w,O){var F;const{primary:q,secondary:W}=this.getTranslationData((F=O.lang)!==null&&F!==void 0?F:this.lang());return O=Object.assign({includeFallback:!1},O),!!(q&&q[w]||W&&W[w]||O.includeFallback&&fallback&&fallback[w])}term(w,...O){const{primary:F,secondary:q}=this.getTranslationData(this.lang());let W;if(F&&F[w])W=F[w];else if(q&&q[w])W=q[w];else if(fallback&&fallback[w])W=fallback[w];else return console.error(`No translation found for: ${String(w)}`),String(w);return typeof W=="function"?W(...O):W}date(w,O){return w=new Date(w),new Intl.DateTimeFormat(this.lang(),O).format(w)}number(w,O){return w=Number(w),isNaN(w)?"":new Intl.NumberFormat(this.lang(),O).format(w)}relativeTime(w,O,F){return new Intl.RelativeTimeFormat(this.lang(),F).format(w,O)}};var translation={$code:"en",$name:"English",$dir:"ltr",carousel:"Carousel",clearEntry:"Clear entry",close:"Close",copied:"Copied",copy:"Copy",currentValue:"Current value",error:"Error",goToSlide:(D,w)=>`Go to slide ${D} of ${w}`,hidePassword:"Hide password",loading:"Loading",nextSlide:"Next slide",numOptionsSelected:D=>D===0?"No options selected":D===1?"1 option selected":`${D} options selected`,previousSlide:"Previous slide",progress:"Progress",remove:"Remove",resize:"Resize",scrollToEnd:"Scroll to end",scrollToStart:"Scroll to start",selectAColorFromTheScreen:"Select a color from the screen",showPassword:"Show password",slideNum:D=>`Slide ${D}`,toggleColorFormat:"Toggle color format"};registerTranslation(translation);var en_default=translation,LocalizeController=class extends LocalizeController$1{};registerTranslation(en_default);var component_styles_default=i$8`
  :host {
    box-sizing: border-box;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  [hidden] {
    display: none !important;
  }
`,__defProp$3=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__typeError=D=>{throw TypeError(D)},__defNormalProp=(D,w,O)=>w in D?__defProp$3(D,w,{enumerable:!0,configurable:!0,writable:!0,value:O}):D[w]=O,__spreadValues=(D,w)=>{for(var O in w||(w={}))__hasOwnProp.call(w,O)&&__defNormalProp(D,O,w[O]);if(__getOwnPropSymbols)for(var O of __getOwnPropSymbols(w))__propIsEnum.call(w,O)&&__defNormalProp(D,O,w[O]);return D},__spreadProps=(D,w)=>__defProps(D,__getOwnPropDescs(w)),__decorateClass$3=(D,w,O,F)=>{for(var q=F>1?void 0:F?__getOwnPropDesc$3(w,O):w,W=D.length-1,U;W>=0;W--)(U=D[W])&&(q=(F?U(w,O,q):U(q))||q);return F&&q&&__defProp$3(w,O,q),q},__accessCheck=(D,w,O)=>w.has(D)||__typeError("Cannot "+O),__privateGet=(D,w,O)=>(__accessCheck(D,w,"read from private field"),w.get(D)),__privateAdd=(D,w,O)=>w.has(D)?__typeError("Cannot add the same private member more than once"):w instanceof WeakSet?w.add(D):w.set(D,O),__privateSet=(D,w,O,F)=>(__accessCheck(D,w,"write to private field"),w.set(D,O),O);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$2=D=>(w,O)=>{O!==void 0?O.addInitializer(()=>{customElements.define(D,w)}):customElements.define(D,w)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const o$4={attribute:!0,type:String,converter:u$2,reflect:!1,hasChanged:f$3},r$3=(D=o$4,w,O)=>{const{kind:F,metadata:q}=O;let W=globalThis.litPropertyMetadata.get(q);if(W===void 0&&globalThis.litPropertyMetadata.set(q,W=new Map),W.set(O.name,D),F==="accessor"){const{name:U}=O;return{set(K){const G=w.get.call(this);w.set.call(this,K),this.requestUpdate(U,G,D)},init(K){return K!==void 0&&this.P(U,void 0,D),K}}}if(F==="setter"){const{name:U}=O;return function(K){const G=this[U];w.call(this,K),this.requestUpdate(U,G,D)}}throw Error("Unsupported decorator location: "+F)};function n$3(D){return(w,O)=>typeof O=="object"?r$3(D,w,O):((F,q,W)=>{const U=q.hasOwnProperty(W);return q.constructor.createProperty(W,U?{...F,wrapped:!0}:F),U?Object.getOwnPropertyDescriptor(q,W):void 0})(D,w,O)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function r$2(D){return n$3({...D,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const e$6=(D,w,O)=>(O.configurable=!0,O.enumerable=!0,Reflect.decorate&&typeof w!="object"&&Object.defineProperty(D,w,O),O);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function e$5(D,w){return(O,F,q)=>{const W=U=>{var K;return((K=U.renderRoot)==null?void 0:K.querySelector(D))??null};return e$6(O,F,{get(){return W(this)}})}}var _hasRecordedInitialProperties,ShoelaceElement=class extends r$4{constructor(){super(),__privateAdd(this,_hasRecordedInitialProperties,!1),this.initialReflectedProperties=new Map,Object.entries(this.constructor.dependencies).forEach(([D,w])=>{this.constructor.define(D,w)})}emit(D,w){const O=new CustomEvent(D,__spreadValues({bubbles:!0,cancelable:!1,composed:!0,detail:{}},w));return this.dispatchEvent(O),O}static define(D,w=this,O={}){const F=customElements.get(D);if(!F){try{customElements.define(D,w,O)}catch{customElements.define(D,class extends w{},O)}return}let q=" (unknown version)",W=q;"version"in w&&w.version&&(q=" v"+w.version),"version"in F&&F.version&&(W=" v"+F.version),!(q&&W&&q===W)&&console.warn(`Attempted to register <${D}>${q}, but <${D}>${W} has already been registered.`)}attributeChangedCallback(D,w,O){__privateGet(this,_hasRecordedInitialProperties)||(this.constructor.elementProperties.forEach((F,q)=>{F.reflect&&this[q]!=null&&this.initialReflectedProperties.set(q,this[q])}),__privateSet(this,_hasRecordedInitialProperties,!0)),super.attributeChangedCallback(D,w,O)}willUpdate(D){super.willUpdate(D),this.initialReflectedProperties.forEach((w,O)=>{D.has(O)&&this[O]==null&&(this[O]=w)})}};_hasRecordedInitialProperties=new WeakMap;ShoelaceElement.version="2.20.0";ShoelaceElement.dependencies={};__decorateClass$3([n$3()],ShoelaceElement.prototype,"dir",2);__decorateClass$3([n$3()],ShoelaceElement.prototype,"lang",2);var SlSpinner=class extends ShoelaceElement{constructor(){super(...arguments),this.localize=new LocalizeController(this)}render(){return x`
      <svg part="base" class="spinner" role="progressbar" aria-label=${this.localize.term("loading")}>
        <circle class="spinner__track"></circle>
        <circle class="spinner__indicator"></circle>
      </svg>
    `}};SlSpinner.styles=[component_styles_default,spinner_styles_default];var formCollections=new WeakMap,reportValidityOverloads=new WeakMap,checkValidityOverloads=new WeakMap,userInteractedControls=new WeakSet,interactions=new WeakMap,FormControlController=class{constructor(D,w){this.handleFormData=O=>{const F=this.options.disabled(this.host),q=this.options.name(this.host),W=this.options.value(this.host),U=this.host.tagName.toLowerCase()==="sl-button";this.host.isConnected&&!F&&!U&&typeof q=="string"&&q.length>0&&typeof W<"u"&&(Array.isArray(W)?W.forEach(K=>{O.formData.append(q,K.toString())}):O.formData.append(q,W.toString()))},this.handleFormSubmit=O=>{var F;const q=this.options.disabled(this.host),W=this.options.reportValidity;this.form&&!this.form.noValidate&&((F=formCollections.get(this.form))==null||F.forEach(U=>{this.setUserInteracted(U,!0)})),this.form&&!this.form.noValidate&&!q&&!W(this.host)&&(O.preventDefault(),O.stopImmediatePropagation())},this.handleFormReset=()=>{this.options.setValue(this.host,this.options.defaultValue(this.host)),this.setUserInteracted(this.host,!1),interactions.set(this.host,[])},this.handleInteraction=O=>{const F=interactions.get(this.host);F.includes(O.type)||F.push(O.type),F.length===this.options.assumeInteractionOn.length&&this.setUserInteracted(this.host,!0)},this.checkFormValidity=()=>{if(this.form&&!this.form.noValidate){const O=this.form.querySelectorAll("*");for(const F of O)if(typeof F.checkValidity=="function"&&!F.checkValidity())return!1}return!0},this.reportFormValidity=()=>{if(this.form&&!this.form.noValidate){const O=this.form.querySelectorAll("*");for(const F of O)if(typeof F.reportValidity=="function"&&!F.reportValidity())return!1}return!0},(this.host=D).addController(this),this.options=__spreadValues({form:O=>{const F=O.form;if(F){const W=O.getRootNode().querySelector(`#${F}`);if(W)return W}return O.closest("form")},name:O=>O.name,value:O=>O.value,defaultValue:O=>O.defaultValue,disabled:O=>{var F;return(F=O.disabled)!=null?F:!1},reportValidity:O=>typeof O.reportValidity=="function"?O.reportValidity():!0,checkValidity:O=>typeof O.checkValidity=="function"?O.checkValidity():!0,setValue:(O,F)=>O.value=F,assumeInteractionOn:["sl-input"]},w)}hostConnected(){const D=this.options.form(this.host);D&&this.attachForm(D),interactions.set(this.host,[]),this.options.assumeInteractionOn.forEach(w=>{this.host.addEventListener(w,this.handleInteraction)})}hostDisconnected(){this.detachForm(),interactions.delete(this.host),this.options.assumeInteractionOn.forEach(D=>{this.host.removeEventListener(D,this.handleInteraction)})}hostUpdated(){const D=this.options.form(this.host);D||this.detachForm(),D&&this.form!==D&&(this.detachForm(),this.attachForm(D)),this.host.hasUpdated&&this.setValidity(this.host.validity.valid)}attachForm(D){D?(this.form=D,formCollections.has(this.form)?formCollections.get(this.form).add(this.host):formCollections.set(this.form,new Set([this.host])),this.form.addEventListener("formdata",this.handleFormData),this.form.addEventListener("submit",this.handleFormSubmit),this.form.addEventListener("reset",this.handleFormReset),reportValidityOverloads.has(this.form)||(reportValidityOverloads.set(this.form,this.form.reportValidity),this.form.reportValidity=()=>this.reportFormValidity()),checkValidityOverloads.has(this.form)||(checkValidityOverloads.set(this.form,this.form.checkValidity),this.form.checkValidity=()=>this.checkFormValidity())):this.form=void 0}detachForm(){if(!this.form)return;const D=formCollections.get(this.form);D&&(D.delete(this.host),D.size<=0&&(this.form.removeEventListener("formdata",this.handleFormData),this.form.removeEventListener("submit",this.handleFormSubmit),this.form.removeEventListener("reset",this.handleFormReset),reportValidityOverloads.has(this.form)&&(this.form.reportValidity=reportValidityOverloads.get(this.form),reportValidityOverloads.delete(this.form)),checkValidityOverloads.has(this.form)&&(this.form.checkValidity=checkValidityOverloads.get(this.form),checkValidityOverloads.delete(this.form)),this.form=void 0))}setUserInteracted(D,w){w?userInteractedControls.add(D):userInteractedControls.delete(D),D.requestUpdate()}doAction(D,w){if(this.form){const O=document.createElement("button");O.type=D,O.style.position="absolute",O.style.width="0",O.style.height="0",O.style.clipPath="inset(50%)",O.style.overflow="hidden",O.style.whiteSpace="nowrap",w&&(O.name=w.name,O.value=w.value,["formaction","formenctype","formmethod","formnovalidate","formtarget"].forEach(F=>{w.hasAttribute(F)&&O.setAttribute(F,w.getAttribute(F))})),this.form.append(O),O.click(),O.remove()}}getForm(){var D;return(D=this.form)!=null?D:null}reset(D){this.doAction("reset",D)}submit(D){this.doAction("submit",D)}setValidity(D){const w=this.host,O=!!userInteractedControls.has(w),F=!!w.required;w.toggleAttribute("data-required",F),w.toggleAttribute("data-optional",!F),w.toggleAttribute("data-invalid",!D),w.toggleAttribute("data-valid",D),w.toggleAttribute("data-user-invalid",!D&&O),w.toggleAttribute("data-user-valid",D&&O)}updateValidity(){const D=this.host;this.setValidity(D.validity.valid)}emitInvalidEvent(D){const w=new CustomEvent("sl-invalid",{bubbles:!1,composed:!1,cancelable:!0,detail:{}});D||w.preventDefault(),this.host.dispatchEvent(w)||D==null||D.preventDefault()}},validValidityState=Object.freeze({badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:!0,valueMissing:!1});Object.freeze(__spreadProps(__spreadValues({},validValidityState),{valid:!1,valueMissing:!0}));Object.freeze(__spreadProps(__spreadValues({},validValidityState),{valid:!1,customError:!0}));var button_styles_default=i$8`
  :host {
    display: inline-block;
    position: relative;
    width: auto;
    cursor: pointer;
  }

  .button {
    display: inline-flex;
    align-items: stretch;
    justify-content: center;
    width: 100%;
    border-style: solid;
    border-width: var(--sl-input-border-width);
    font-family: var(--sl-input-font-family);
    font-weight: var(--sl-font-weight-semibold);
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
    white-space: nowrap;
    vertical-align: middle;
    padding: 0;
    transition:
      var(--sl-transition-x-fast) background-color,
      var(--sl-transition-x-fast) color,
      var(--sl-transition-x-fast) border,
      var(--sl-transition-x-fast) box-shadow;
    cursor: inherit;
  }

  .button::-moz-focus-inner {
    border: 0;
  }

  .button:focus {
    outline: none;
  }

  .button:focus-visible {
    outline: var(--sl-focus-ring);
    outline-offset: var(--sl-focus-ring-offset);
  }

  .button--disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* When disabled, prevent mouse events from bubbling up from children */
  .button--disabled * {
    pointer-events: none;
  }

  .button__prefix,
  .button__suffix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    pointer-events: none;
  }

  .button__label {
    display: inline-block;
  }

  .button__label::slotted(sl-icon) {
    vertical-align: -2px;
  }

  /*
   * Standard buttons
   */

  /* Default */
  .button--standard.button--default {
    background-color: var(--sl-color-neutral-0);
    border-color: var(--sl-input-border-color);
    color: var(--sl-color-neutral-700);
  }

  .button--standard.button--default:hover:not(.button--disabled) {
    background-color: var(--sl-color-primary-50);
    border-color: var(--sl-color-primary-300);
    color: var(--sl-color-primary-700);
  }

  .button--standard.button--default:active:not(.button--disabled) {
    background-color: var(--sl-color-primary-100);
    border-color: var(--sl-color-primary-400);
    color: var(--sl-color-primary-700);
  }

  /* Primary */
  .button--standard.button--primary {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--primary:hover:not(.button--disabled) {
    background-color: var(--sl-color-primary-500);
    border-color: var(--sl-color-primary-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--primary:active:not(.button--disabled) {
    background-color: var(--sl-color-primary-600);
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  /* Success */
  .button--standard.button--success {
    background-color: var(--sl-color-success-600);
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--success:hover:not(.button--disabled) {
    background-color: var(--sl-color-success-500);
    border-color: var(--sl-color-success-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--success:active:not(.button--disabled) {
    background-color: var(--sl-color-success-600);
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  /* Neutral */
  .button--standard.button--neutral {
    background-color: var(--sl-color-neutral-600);
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--neutral:hover:not(.button--disabled) {
    background-color: var(--sl-color-neutral-500);
    border-color: var(--sl-color-neutral-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--neutral:active:not(.button--disabled) {
    background-color: var(--sl-color-neutral-600);
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  /* Warning */
  .button--standard.button--warning {
    background-color: var(--sl-color-warning-600);
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }
  .button--standard.button--warning:hover:not(.button--disabled) {
    background-color: var(--sl-color-warning-500);
    border-color: var(--sl-color-warning-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--warning:active:not(.button--disabled) {
    background-color: var(--sl-color-warning-600);
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  /* Danger */
  .button--standard.button--danger {
    background-color: var(--sl-color-danger-600);
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--danger:hover:not(.button--disabled) {
    background-color: var(--sl-color-danger-500);
    border-color: var(--sl-color-danger-500);
    color: var(--sl-color-neutral-0);
  }

  .button--standard.button--danger:active:not(.button--disabled) {
    background-color: var(--sl-color-danger-600);
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  /*
   * Outline buttons
   */

  .button--outline {
    background: none;
    border: solid 1px;
  }

  /* Default */
  .button--outline.button--default {
    border-color: var(--sl-input-border-color);
    color: var(--sl-color-neutral-700);
  }

  .button--outline.button--default:hover:not(.button--disabled),
  .button--outline.button--default.button--checked:not(.button--disabled) {
    border-color: var(--sl-color-primary-600);
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--default:active:not(.button--disabled) {
    border-color: var(--sl-color-primary-700);
    background-color: var(--sl-color-primary-700);
    color: var(--sl-color-neutral-0);
  }

  /* Primary */
  .button--outline.button--primary {
    border-color: var(--sl-color-primary-600);
    color: var(--sl-color-primary-600);
  }

  .button--outline.button--primary:hover:not(.button--disabled),
  .button--outline.button--primary.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--primary:active:not(.button--disabled) {
    border-color: var(--sl-color-primary-700);
    background-color: var(--sl-color-primary-700);
    color: var(--sl-color-neutral-0);
  }

  /* Success */
  .button--outline.button--success {
    border-color: var(--sl-color-success-600);
    color: var(--sl-color-success-600);
  }

  .button--outline.button--success:hover:not(.button--disabled),
  .button--outline.button--success.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-success-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--success:active:not(.button--disabled) {
    border-color: var(--sl-color-success-700);
    background-color: var(--sl-color-success-700);
    color: var(--sl-color-neutral-0);
  }

  /* Neutral */
  .button--outline.button--neutral {
    border-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-600);
  }

  .button--outline.button--neutral:hover:not(.button--disabled),
  .button--outline.button--neutral.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-neutral-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--neutral:active:not(.button--disabled) {
    border-color: var(--sl-color-neutral-700);
    background-color: var(--sl-color-neutral-700);
    color: var(--sl-color-neutral-0);
  }

  /* Warning */
  .button--outline.button--warning {
    border-color: var(--sl-color-warning-600);
    color: var(--sl-color-warning-600);
  }

  .button--outline.button--warning:hover:not(.button--disabled),
  .button--outline.button--warning.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-warning-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--warning:active:not(.button--disabled) {
    border-color: var(--sl-color-warning-700);
    background-color: var(--sl-color-warning-700);
    color: var(--sl-color-neutral-0);
  }

  /* Danger */
  .button--outline.button--danger {
    border-color: var(--sl-color-danger-600);
    color: var(--sl-color-danger-600);
  }

  .button--outline.button--danger:hover:not(.button--disabled),
  .button--outline.button--danger.button--checked:not(.button--disabled) {
    background-color: var(--sl-color-danger-600);
    color: var(--sl-color-neutral-0);
  }

  .button--outline.button--danger:active:not(.button--disabled) {
    border-color: var(--sl-color-danger-700);
    background-color: var(--sl-color-danger-700);
    color: var(--sl-color-neutral-0);
  }

  @media (forced-colors: active) {
    .button.button--outline.button--checked:not(.button--disabled) {
      outline: solid 2px transparent;
    }
  }

  /*
   * Text buttons
   */

  .button--text {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-600);
  }

  .button--text:hover:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-500);
  }

  .button--text:focus-visible:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-500);
  }

  .button--text:active:not(.button--disabled) {
    background-color: transparent;
    border-color: transparent;
    color: var(--sl-color-primary-700);
  }

  /*
   * Size modifiers
   */

  .button--small {
    height: auto;
    min-height: var(--sl-input-height-small);
    font-size: var(--sl-button-font-size-small);
    line-height: calc(var(--sl-input-height-small) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-small);
  }

  .button--medium {
    height: auto;
    min-height: var(--sl-input-height-medium);
    font-size: var(--sl-button-font-size-medium);
    line-height: calc(var(--sl-input-height-medium) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-medium);
  }

  .button--large {
    height: auto;
    min-height: var(--sl-input-height-large);
    font-size: var(--sl-button-font-size-large);
    line-height: calc(var(--sl-input-height-large) - var(--sl-input-border-width) * 2);
    border-radius: var(--sl-input-border-radius-large);
  }

  /*
   * Pill modifier
   */

  .button--pill.button--small {
    border-radius: var(--sl-input-height-small);
  }

  .button--pill.button--medium {
    border-radius: var(--sl-input-height-medium);
  }

  .button--pill.button--large {
    border-radius: var(--sl-input-height-large);
  }

  /*
   * Circle modifier
   */

  .button--circle {
    padding-left: 0;
    padding-right: 0;
  }

  .button--circle.button--small {
    width: var(--sl-input-height-small);
    border-radius: 50%;
  }

  .button--circle.button--medium {
    width: var(--sl-input-height-medium);
    border-radius: 50%;
  }

  .button--circle.button--large {
    width: var(--sl-input-height-large);
    border-radius: 50%;
  }

  .button--circle .button__prefix,
  .button--circle .button__suffix,
  .button--circle .button__caret {
    display: none;
  }

  /*
   * Caret modifier
   */

  .button--caret .button__suffix {
    display: none;
  }

  .button--caret .button__caret {
    height: auto;
  }

  /*
   * Loading modifier
   */

  .button--loading {
    position: relative;
    cursor: wait;
  }

  .button--loading .button__prefix,
  .button--loading .button__label,
  .button--loading .button__suffix,
  .button--loading .button__caret {
    visibility: hidden;
  }

  .button--loading sl-spinner {
    --indicator-color: currentColor;
    position: absolute;
    font-size: 1em;
    height: 1em;
    width: 1em;
    top: calc(50% - 0.5em);
    left: calc(50% - 0.5em);
  }

  /*
   * Badges
   */

  .button ::slotted(sl-badge) {
    position: absolute;
    top: 0;
    right: 0;
    translate: 50% -50%;
    pointer-events: none;
  }

  .button--rtl ::slotted(sl-badge) {
    right: auto;
    left: 0;
    translate: -50% -50%;
  }

  /*
   * Button spacing
   */

  .button--has-label.button--small .button__label {
    padding: 0 var(--sl-spacing-small);
  }

  .button--has-label.button--medium .button__label {
    padding: 0 var(--sl-spacing-medium);
  }

  .button--has-label.button--large .button__label {
    padding: 0 var(--sl-spacing-large);
  }

  .button--has-prefix.button--small {
    padding-inline-start: var(--sl-spacing-x-small);
  }

  .button--has-prefix.button--small .button__label {
    padding-inline-start: var(--sl-spacing-x-small);
  }

  .button--has-prefix.button--medium {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--medium .button__label {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--large {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-prefix.button--large .button__label {
    padding-inline-start: var(--sl-spacing-small);
  }

  .button--has-suffix.button--small,
  .button--caret.button--small {
    padding-inline-end: var(--sl-spacing-x-small);
  }

  .button--has-suffix.button--small .button__label,
  .button--caret.button--small .button__label {
    padding-inline-end: var(--sl-spacing-x-small);
  }

  .button--has-suffix.button--medium,
  .button--caret.button--medium {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--medium .button__label,
  .button--caret.button--medium .button__label {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--large,
  .button--caret.button--large {
    padding-inline-end: var(--sl-spacing-small);
  }

  .button--has-suffix.button--large .button__label,
  .button--caret.button--large .button__label {
    padding-inline-end: var(--sl-spacing-small);
  }

  /*
   * Button groups support a variety of button types (e.g. buttons with tooltips, buttons as dropdown triggers, etc.).
   * This means buttons aren't always direct descendants of the button group, thus we can't target them with the
   * ::slotted selector. To work around this, the button group component does some magic to add these special classes to
   * buttons and we style them here instead.
   */

  :host([data-sl-button-group__button--first]:not([data-sl-button-group__button--last])) .button {
    border-start-end-radius: 0;
    border-end-end-radius: 0;
  }

  :host([data-sl-button-group__button--inner]) .button {
    border-radius: 0;
  }

  :host([data-sl-button-group__button--last]:not([data-sl-button-group__button--first])) .button {
    border-start-start-radius: 0;
    border-end-start-radius: 0;
  }

  /* All except the first */
  :host([data-sl-button-group__button]:not([data-sl-button-group__button--first])) {
    margin-inline-start: calc(-1 * var(--sl-input-border-width));
  }

  /* Add a visual separator between solid buttons */
  :host(
      [data-sl-button-group__button]:not(
          [data-sl-button-group__button--first],
          [data-sl-button-group__button--radio],
          [variant='default']
        ):not(:hover)
    )
    .button:after {
    content: '';
    position: absolute;
    top: 0;
    inset-inline-start: 0;
    bottom: 0;
    border-left: solid 1px rgb(128 128 128 / 33%);
    mix-blend-mode: multiply;
  }

  /* Bump hovered, focused, and checked buttons up so their focus ring isn't clipped */
  :host([data-sl-button-group__button--hover]) {
    z-index: 1;
  }

  /* Focus and checked are always on top */
  :host([data-sl-button-group__button--focus]),
  :host([data-sl-button-group__button][checked]) {
    z-index: 2;
  }
`,HasSlotController=class{constructor(D,...w){this.slotNames=[],this.handleSlotChange=O=>{const F=O.target;(this.slotNames.includes("[default]")&&!F.name||F.name&&this.slotNames.includes(F.name))&&this.host.requestUpdate()},(this.host=D).addController(this),this.slotNames=w}hasDefaultSlot(){return[...this.host.childNodes].some(D=>{if(D.nodeType===D.TEXT_NODE&&D.textContent.trim()!=="")return!0;if(D.nodeType===D.ELEMENT_NODE){const w=D;if(w.tagName.toLowerCase()==="sl-visually-hidden")return!1;if(!w.hasAttribute("slot"))return!0}return!1})}hasNamedSlot(D){return this.host.querySelector(`:scope > [slot="${D}"]`)!==null}test(D){return D==="[default]"?this.hasDefaultSlot():this.hasNamedSlot(D)}hostConnected(){this.host.shadowRoot.addEventListener("slotchange",this.handleSlotChange)}hostDisconnected(){this.host.shadowRoot.removeEventListener("slotchange",this.handleSlotChange)}};function getTextContent(D){if(!D)return"";const w=D.assignedNodes({flatten:!0});let O="";return[...w].forEach(F=>{F.nodeType===Node.TEXT_NODE&&(O+=F.textContent)}),O}var basePath="";function setBasePath(D){basePath=D}function getBasePath(D=""){if(!basePath){const w=[...document.getElementsByTagName("script")],O=w.find(F=>F.hasAttribute("data-shoelace"));if(O)setBasePath(O.getAttribute("data-shoelace"));else{const F=w.find(W=>/shoelace(\.min)?\.js($|\?)/.test(W.src)||/shoelace-autoloader(\.min)?\.js($|\?)/.test(W.src));let q="";F&&(q=F.getAttribute("src")),setBasePath(q.split("/").slice(0,-1).join("/"))}}return basePath.replace(/\/$/,"")+(D?`/${D.replace(/^\//,"")}`:"")}var library={name:"default",resolver:D=>getBasePath(`assets/icons/${D}.svg`)},library_default_default=library,icons={caret:`
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  `,check:`
    <svg part="checked-icon" class="checkbox__icon" viewBox="0 0 16 16">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
        <g stroke="currentColor">
          <g transform="translate(3.428571, 3.428571)">
            <path d="M0,5.71428571 L3.42857143,9.14285714"></path>
            <path d="M9.14285714,0 L3.42857143,9.14285714"></path>
          </g>
        </g>
      </g>
    </svg>
  `,"chevron-down":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
    </svg>
  `,"chevron-left":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
    </svg>
  `,"chevron-right":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
    </svg>
  `,copy:`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2Zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6ZM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2Z"/>
    </svg>
  `,eye:`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
      <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
      <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
    </svg>
  `,"eye-slash":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-slash" viewBox="0 0 16 16">
      <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"/>
      <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"/>
      <path d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"/>
    </svg>
  `,eyedropper:`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eyedropper" viewBox="0 0 16 16">
      <path d="M13.354.646a1.207 1.207 0 0 0-1.708 0L8.5 3.793l-.646-.647a.5.5 0 1 0-.708.708L8.293 5l-7.147 7.146A.5.5 0 0 0 1 12.5v1.793l-.854.853a.5.5 0 1 0 .708.707L1.707 15H3.5a.5.5 0 0 0 .354-.146L11 7.707l1.146 1.147a.5.5 0 0 0 .708-.708l-.647-.646 3.147-3.146a1.207 1.207 0 0 0 0-1.708l-2-2zM2 12.707l7-7L10.293 7l-7 7H2v-1.293z"></path>
    </svg>
  `,"grip-vertical":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-grip-vertical" viewBox="0 0 16 16">
      <path d="M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path>
    </svg>
  `,indeterminate:`
    <svg part="indeterminate-icon" class="checkbox__icon" viewBox="0 0 16 16">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
        <g stroke="currentColor" stroke-width="2">
          <g transform="translate(2.285714, 6.857143)">
            <path d="M10.2857143,1.14285714 L1.14285714,1.14285714"></path>
          </g>
        </g>
      </g>
    </svg>
  `,"person-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
      <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
    </svg>
  `,"play-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
      <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"></path>
    </svg>
  `,"pause-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause-fill" viewBox="0 0 16 16">
      <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"></path>
    </svg>
  `,radio:`
    <svg part="checked-icon" class="radio__icon" viewBox="0 0 16 16">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g fill="currentColor">
          <circle cx="8" cy="8" r="3.42857143"></circle>
        </g>
      </g>
    </svg>
  `,"star-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star-fill" viewBox="0 0 16 16">
      <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
    </svg>
  `,"x-lg":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
      <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
    </svg>
  `,"x-circle-fill":`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
      <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path>
    </svg>
  `},systemLibrary={name:"system",resolver:D=>D in icons?`data:image/svg+xml,${encodeURIComponent(icons[D])}`:""},library_system_default=systemLibrary,registry=[library_default_default,library_system_default],watchedIcons=[];function watchIcon(D){watchedIcons.push(D)}function unwatchIcon(D){watchedIcons=watchedIcons.filter(w=>w!==D)}function getIconLibrary(D){return registry.find(w=>w.name===D)}var icon_styles_default=i$8`
  :host {
    display: inline-block;
    width: 1em;
    height: 1em;
    box-sizing: content-box !important;
  }

  svg {
    display: block;
    height: 100%;
    width: 100%;
  }
`;function watch(D,w){const O=__spreadValues({waitUntilFirstUpdate:!1},w);return(F,q)=>{const{update:W}=F,U=Array.isArray(D)?D:[D];F.update=function(K){U.forEach(G=>{const Y=G;if(K.has(Y)){const Q=K.get(Y),X=this[Y];Q!==X&&(!O.waitUntilFirstUpdate||this.hasUpdated)&&this[q](Q,X)}}),W.call(this,K)}}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const e$4=(D,w)=>(D==null?void 0:D._$litType$)!==void 0,f$1=D=>D.strings===void 0;var CACHEABLE_ERROR=Symbol(),RETRYABLE_ERROR=Symbol(),parser,iconCache=new Map,SlIcon=class extends ShoelaceElement{constructor(){super(...arguments),this.initialRender=!1,this.svg=null,this.label="",this.library="default"}async resolveIcon(D,w){var O;let F;if(w!=null&&w.spriteSheet)return this.svg=x`<svg part="svg">
        <use part="use" href="${D}"></use>
      </svg>`,this.svg;try{if(F=await fetch(D,{mode:"cors"}),!F.ok)return F.status===410?CACHEABLE_ERROR:RETRYABLE_ERROR}catch{return RETRYABLE_ERROR}try{const q=document.createElement("div");q.innerHTML=await F.text();const W=q.firstElementChild;if(((O=W==null?void 0:W.tagName)==null?void 0:O.toLowerCase())!=="svg")return CACHEABLE_ERROR;parser||(parser=new DOMParser);const K=parser.parseFromString(W.outerHTML,"text/html").body.querySelector("svg");return K?(K.part.add("svg"),document.adoptNode(K)):CACHEABLE_ERROR}catch{return CACHEABLE_ERROR}}connectedCallback(){super.connectedCallback(),watchIcon(this)}firstUpdated(){this.initialRender=!0,this.setIcon()}disconnectedCallback(){super.disconnectedCallback(),unwatchIcon(this)}getIconSource(){const D=getIconLibrary(this.library);return this.name&&D?{url:D.resolver(this.name),fromLibrary:!0}:{url:this.src,fromLibrary:!1}}handleLabelChange(){typeof this.label=="string"&&this.label.length>0?(this.setAttribute("role","img"),this.setAttribute("aria-label",this.label),this.removeAttribute("aria-hidden")):(this.removeAttribute("role"),this.removeAttribute("aria-label"),this.setAttribute("aria-hidden","true"))}async setIcon(){var D;const{url:w,fromLibrary:O}=this.getIconSource(),F=O?getIconLibrary(this.library):void 0;if(!w){this.svg=null;return}let q=iconCache.get(w);if(q||(q=this.resolveIcon(w,F),iconCache.set(w,q)),!this.initialRender)return;const W=await q;if(W===RETRYABLE_ERROR&&iconCache.delete(w),w===this.getIconSource().url){if(e$4(W)){if(this.svg=W,F){await this.updateComplete;const U=this.shadowRoot.querySelector("[part='svg']");typeof F.mutator=="function"&&U&&F.mutator(U)}return}switch(W){case RETRYABLE_ERROR:case CACHEABLE_ERROR:this.svg=null,this.emit("sl-error");break;default:this.svg=W.cloneNode(!0),(D=F==null?void 0:F.mutator)==null||D.call(F,this.svg),this.emit("sl-load")}}}render(){return this.svg}};SlIcon.styles=[component_styles_default,icon_styles_default];__decorateClass$3([r$2()],SlIcon.prototype,"svg",2);__decorateClass$3([n$3({reflect:!0})],SlIcon.prototype,"name",2);__decorateClass$3([n$3()],SlIcon.prototype,"src",2);__decorateClass$3([n$3()],SlIcon.prototype,"label",2);__decorateClass$3([n$3({reflect:!0})],SlIcon.prototype,"library",2);__decorateClass$3([watch("label")],SlIcon.prototype,"handleLabelChange",1);__decorateClass$3([watch(["name","src","library"])],SlIcon.prototype,"setIcon",1);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$1={ATTRIBUTE:1,CHILD:2},e$3=D=>(...w)=>({_$litDirective$:D,values:w});let i$4=class{constructor(w){}get _$AU(){return this._$AM._$AU}_$AT(w,O,F){this._$Ct=w,this._$AM=O,this._$Ci=F}_$AS(w,O){return this.update(w,O)}update(w,O){return this.render(...O)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const e$2=e$3(class extends i$4{constructor(D){var w;if(super(D),D.type!==t$1.ATTRIBUTE||D.name!=="class"||((w=D.strings)==null?void 0:w.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(D){return" "+Object.keys(D).filter(w=>D[w]).join(" ")+" "}update(D,[w]){var F,q;if(this.st===void 0){this.st=new Set,D.strings!==void 0&&(this.nt=new Set(D.strings.join(" ").split(/\s/).filter(W=>W!=="")));for(const W in w)w[W]&&!((F=this.nt)!=null&&F.has(W))&&this.st.add(W);return this.render(w)}const O=D.element.classList;for(const W of this.st)W in w||(O.remove(W),this.st.delete(W));for(const W in w){const U=!!w[W];U===this.st.has(W)||(q=this.nt)!=null&&q.has(W)||(U?(O.add(W),this.st.add(W)):(O.remove(W),this.st.delete(W)))}return T}});/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const a=Symbol.for(""),o$3=D=>{if((D==null?void 0:D.r)===a)return D==null?void 0:D._$litStatic$},i$3=(D,...w)=>({_$litStatic$:w.reduce((O,F,q)=>O+(W=>{if(W._$litStatic$!==void 0)return W._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${W}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(F)+D[q+1],D[0]),r:a}),l=new Map,n$2=D=>(w,...O)=>{const F=O.length;let q,W;const U=[],K=[];let G,Y=0,Q=!1;for(;Y<F;){for(G=w[Y];Y<F&&(W=O[Y],(q=o$3(W))!==void 0);)G+=q+w[++Y],Q=!0;Y!==F&&K.push(W),U.push(G),Y++}if(Y===F&&U.push(w[F]),Q){const X=U.join("$$lit$$");(w=l.get(X))===void 0&&(U.raw=U,l.set(X,w=U)),O=K}return D(w,...O)},u=n$2(x);/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const o$2=D=>D??E;var SlButton=class extends ShoelaceElement{constructor(){super(...arguments),this.formControlController=new FormControlController(this,{assumeInteractionOn:["click"]}),this.hasSlotController=new HasSlotController(this,"[default]","prefix","suffix"),this.localize=new LocalizeController(this),this.hasFocus=!1,this.invalid=!1,this.title="",this.variant="default",this.size="medium",this.caret=!1,this.disabled=!1,this.loading=!1,this.outline=!1,this.pill=!1,this.circle=!1,this.type="button",this.name="",this.value="",this.href="",this.rel="noreferrer noopener"}get validity(){return this.isButton()?this.button.validity:validValidityState}get validationMessage(){return this.isButton()?this.button.validationMessage:""}firstUpdated(){this.isButton()&&this.formControlController.updateValidity()}handleBlur(){this.hasFocus=!1,this.emit("sl-blur")}handleFocus(){this.hasFocus=!0,this.emit("sl-focus")}handleClick(){this.type==="submit"&&this.formControlController.submit(this),this.type==="reset"&&this.formControlController.reset(this)}handleInvalid(D){this.formControlController.setValidity(!1),this.formControlController.emitInvalidEvent(D)}isButton(){return!this.href}isLink(){return!!this.href}handleDisabledChange(){this.isButton()&&this.formControlController.setValidity(this.disabled)}click(){this.button.click()}focus(D){this.button.focus(D)}blur(){this.button.blur()}checkValidity(){return this.isButton()?this.button.checkValidity():!0}getForm(){return this.formControlController.getForm()}reportValidity(){return this.isButton()?this.button.reportValidity():!0}setCustomValidity(D){this.isButton()&&(this.button.setCustomValidity(D),this.formControlController.updateValidity())}render(){const D=this.isLink(),w=D?i$3`a`:i$3`button`;return u`
      <${w}
        part="base"
        class=${e$2({button:!0,"button--default":this.variant==="default","button--primary":this.variant==="primary","button--success":this.variant==="success","button--neutral":this.variant==="neutral","button--warning":this.variant==="warning","button--danger":this.variant==="danger","button--text":this.variant==="text","button--small":this.size==="small","button--medium":this.size==="medium","button--large":this.size==="large","button--caret":this.caret,"button--circle":this.circle,"button--disabled":this.disabled,"button--focused":this.hasFocus,"button--loading":this.loading,"button--standard":!this.outline,"button--outline":this.outline,"button--pill":this.pill,"button--rtl":this.localize.dir()==="rtl","button--has-label":this.hasSlotController.test("[default]"),"button--has-prefix":this.hasSlotController.test("prefix"),"button--has-suffix":this.hasSlotController.test("suffix")})}
        ?disabled=${o$2(D?void 0:this.disabled)}
        type=${o$2(D?void 0:this.type)}
        title=${this.title}
        name=${o$2(D?void 0:this.name)}
        value=${o$2(D?void 0:this.value)}
        href=${o$2(D&&!this.disabled?this.href:void 0)}
        target=${o$2(D?this.target:void 0)}
        download=${o$2(D?this.download:void 0)}
        rel=${o$2(D?this.rel:void 0)}
        role=${o$2(D?void 0:"button")}
        aria-disabled=${this.disabled?"true":"false"}
        tabindex=${this.disabled?"-1":"0"}
        @blur=${this.handleBlur}
        @focus=${this.handleFocus}
        @invalid=${this.isButton()?this.handleInvalid:null}
        @click=${this.handleClick}
      >
        <slot name="prefix" part="prefix" class="button__prefix"></slot>
        <slot part="label" class="button__label"></slot>
        <slot name="suffix" part="suffix" class="button__suffix"></slot>
        ${this.caret?u` <sl-icon part="caret" class="button__caret" library="system" name="caret"></sl-icon> `:""}
        ${this.loading?u`<sl-spinner part="spinner"></sl-spinner>`:""}
      </${w}>
    `}};SlButton.styles=[component_styles_default,button_styles_default];SlButton.dependencies={"sl-icon":SlIcon,"sl-spinner":SlSpinner};__decorateClass$3([e$5(".button")],SlButton.prototype,"button",2);__decorateClass$3([r$2()],SlButton.prototype,"hasFocus",2);__decorateClass$3([r$2()],SlButton.prototype,"invalid",2);__decorateClass$3([n$3()],SlButton.prototype,"title",2);__decorateClass$3([n$3({reflect:!0})],SlButton.prototype,"variant",2);__decorateClass$3([n$3({reflect:!0})],SlButton.prototype,"size",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlButton.prototype,"caret",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlButton.prototype,"disabled",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlButton.prototype,"loading",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlButton.prototype,"outline",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlButton.prototype,"pill",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlButton.prototype,"circle",2);__decorateClass$3([n$3()],SlButton.prototype,"type",2);__decorateClass$3([n$3()],SlButton.prototype,"name",2);__decorateClass$3([n$3()],SlButton.prototype,"value",2);__decorateClass$3([n$3()],SlButton.prototype,"href",2);__decorateClass$3([n$3()],SlButton.prototype,"target",2);__decorateClass$3([n$3()],SlButton.prototype,"rel",2);__decorateClass$3([n$3()],SlButton.prototype,"download",2);__decorateClass$3([n$3()],SlButton.prototype,"form",2);__decorateClass$3([n$3({attribute:"formaction"})],SlButton.prototype,"formAction",2);__decorateClass$3([n$3({attribute:"formenctype"})],SlButton.prototype,"formEnctype",2);__decorateClass$3([n$3({attribute:"formmethod"})],SlButton.prototype,"formMethod",2);__decorateClass$3([n$3({attribute:"formnovalidate",type:Boolean})],SlButton.prototype,"formNoValidate",2);__decorateClass$3([n$3({attribute:"formtarget"})],SlButton.prototype,"formTarget",2);__decorateClass$3([watch("disabled",{waitUntilFirstUpdate:!0})],SlButton.prototype,"handleDisabledChange",1);SlButton.define("sl-button");var dropdown_styles_default=i$8`
  :host {
    display: inline-block;
  }

  .dropdown::part(popup) {
    z-index: var(--sl-z-index-dropdown);
  }

  .dropdown[data-current-placement^='top']::part(popup) {
    transform-origin: bottom;
  }

  .dropdown[data-current-placement^='bottom']::part(popup) {
    transform-origin: top;
  }

  .dropdown[data-current-placement^='left']::part(popup) {
    transform-origin: right;
  }

  .dropdown[data-current-placement^='right']::part(popup) {
    transform-origin: left;
  }

  .dropdown__trigger {
    display: block;
  }

  .dropdown__panel {
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    box-shadow: var(--sl-shadow-large);
    border-radius: var(--sl-border-radius-medium);
    pointer-events: none;
  }

  .dropdown--open .dropdown__panel {
    display: block;
    pointer-events: all;
  }

  /* When users slot a menu, make sure it conforms to the popup's auto-size */
  ::slotted(sl-menu) {
    max-width: var(--auto-size-available-width) !important;
    max-height: var(--auto-size-available-height) !important;
  }
`,computedStyleMap=new WeakMap;function getCachedComputedStyle(D){let w=computedStyleMap.get(D);return w||(w=window.getComputedStyle(D,null),computedStyleMap.set(D,w)),w}function isVisible(D){if(typeof D.checkVisibility=="function")return D.checkVisibility({checkOpacity:!1,checkVisibilityCSS:!0});const w=getCachedComputedStyle(D);return w.visibility!=="hidden"&&w.display!=="none"}function isOverflowingAndTabbable(D){const w=getCachedComputedStyle(D),{overflowY:O,overflowX:F}=w;return O==="scroll"||F==="scroll"?!0:O!=="auto"||F!=="auto"?!1:D.scrollHeight>D.clientHeight&&O==="auto"||D.scrollWidth>D.clientWidth&&F==="auto"}function isTabbable(D){const w=D.tagName.toLowerCase(),O=Number(D.getAttribute("tabindex"));if(D.hasAttribute("tabindex")&&(isNaN(O)||O<=-1)||D.hasAttribute("disabled")||D.closest("[inert]"))return!1;if(w==="input"&&D.getAttribute("type")==="radio"){const W=D.getRootNode(),U=`input[type='radio'][name="${D.getAttribute("name")}"]`,K=W.querySelector(`${U}:checked`);return K?K===D:W.querySelector(U)===D}return isVisible(D)?(w==="audio"||w==="video")&&D.hasAttribute("controls")||D.hasAttribute("tabindex")||D.hasAttribute("contenteditable")&&D.getAttribute("contenteditable")!=="false"||["button","input","select","textarea","a","audio","video","summary","iframe"].includes(w)?!0:isOverflowingAndTabbable(D):!1}function getTabbableBoundary(D){var w,O;const F=getTabbableElements(D),q=(w=F[0])!=null?w:null,W=(O=F[F.length-1])!=null?O:null;return{start:q,end:W}}function getSlottedChildrenOutsideRootElement(D,w){var O;return((O=D.getRootNode({composed:!0}))==null?void 0:O.host)!==w}function getTabbableElements(D){const w=new WeakMap,O=[];function F(q){if(q instanceof Element){if(q.hasAttribute("inert")||q.closest("[inert]")||w.has(q))return;w.set(q,!0),!O.includes(q)&&isTabbable(q)&&O.push(q),q instanceof HTMLSlotElement&&getSlottedChildrenOutsideRootElement(q,D)&&q.assignedElements({flatten:!0}).forEach(W=>{F(W)}),q.shadowRoot!==null&&q.shadowRoot.mode==="open"&&F(q.shadowRoot)}for(const W of q.children)F(W)}return F(D),O.sort((q,W)=>{const U=Number(q.getAttribute("tabindex"))||0;return(Number(W.getAttribute("tabindex"))||0)-U})}var popup_styles_default=i$8`
  :host {
    --arrow-color: var(--sl-color-neutral-1000);
    --arrow-size: 6px;

    /*
     * These properties are computed to account for the arrow's dimensions after being rotated 45º. The constant
     * 0.7071 is derived from sin(45), which is the diagonal size of the arrow's container after rotating.
     */
    --arrow-size-diagonal: calc(var(--arrow-size) * 0.7071);
    --arrow-padding-offset: calc(var(--arrow-size-diagonal) - var(--arrow-size));

    display: contents;
  }

  .popup {
    position: absolute;
    isolation: isolate;
    max-width: var(--auto-size-available-width, none);
    max-height: var(--auto-size-available-height, none);
  }

  .popup--fixed {
    position: fixed;
  }

  .popup:not(.popup--active) {
    display: none;
  }

  .popup__arrow {
    position: absolute;
    width: calc(var(--arrow-size-diagonal) * 2);
    height: calc(var(--arrow-size-diagonal) * 2);
    rotate: 45deg;
    background: var(--arrow-color);
    z-index: -1;
  }

  /* Hover bridge */
  .popup-hover-bridge:not(.popup-hover-bridge--visible) {
    display: none;
  }

  .popup-hover-bridge {
    position: fixed;
    z-index: calc(var(--sl-z-index-dropdown) - 1);
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    clip-path: polygon(
      var(--hover-bridge-top-left-x, 0) var(--hover-bridge-top-left-y, 0),
      var(--hover-bridge-top-right-x, 0) var(--hover-bridge-top-right-y, 0),
      var(--hover-bridge-bottom-right-x, 0) var(--hover-bridge-bottom-right-y, 0),
      var(--hover-bridge-bottom-left-x, 0) var(--hover-bridge-bottom-left-y, 0)
    );
  }
`;const min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=D=>({x:D,y:D}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(D,w,O){return max(D,min(w,O))}function evaluate(D,w){return typeof D=="function"?D(w):D}function getSide(D){return D.split("-")[0]}function getAlignment(D){return D.split("-")[1]}function getOppositeAxis(D){return D==="x"?"y":"x"}function getAxisLength(D){return D==="y"?"height":"width"}function getSideAxis(D){return["top","bottom"].includes(getSide(D))?"y":"x"}function getAlignmentAxis(D){return getOppositeAxis(getSideAxis(D))}function getAlignmentSides(D,w,O){O===void 0&&(O=!1);const F=getAlignment(D),q=getAlignmentAxis(D),W=getAxisLength(q);let U=q==="x"?F===(O?"end":"start")?"right":"left":F==="start"?"bottom":"top";return w.reference[W]>w.floating[W]&&(U=getOppositePlacement(U)),[U,getOppositePlacement(U)]}function getExpandedPlacements(D){const w=getOppositePlacement(D);return[getOppositeAlignmentPlacement(D),w,getOppositeAlignmentPlacement(w)]}function getOppositeAlignmentPlacement(D){return D.replace(/start|end/g,w=>oppositeAlignmentMap[w])}function getSideList(D,w,O){const F=["left","right"],q=["right","left"],W=["top","bottom"],U=["bottom","top"];switch(D){case"top":case"bottom":return O?w?q:F:w?F:q;case"left":case"right":return w?W:U;default:return[]}}function getOppositeAxisPlacements(D,w,O,F){const q=getAlignment(D);let W=getSideList(getSide(D),O==="start",F);return q&&(W=W.map(U=>U+"-"+q),w&&(W=W.concat(W.map(getOppositeAlignmentPlacement)))),W}function getOppositePlacement(D){return D.replace(/left|right|bottom|top/g,w=>oppositeSideMap[w])}function expandPaddingObject(D){return{top:0,right:0,bottom:0,left:0,...D}}function getPaddingObject(D){return typeof D!="number"?expandPaddingObject(D):{top:D,right:D,bottom:D,left:D}}function rectToClientRect(D){const{x:w,y:O,width:F,height:q}=D;return{width:F,height:q,top:O,left:w,right:w+F,bottom:O+q,x:w,y:O}}function computeCoordsFromPlacement(D,w,O){let{reference:F,floating:q}=D;const W=getSideAxis(w),U=getAlignmentAxis(w),K=getAxisLength(U),G=getSide(w),Y=W==="y",Q=F.x+F.width/2-q.width/2,X=F.y+F.height/2-q.height/2,J=F[K]/2-q[K]/2;let Z;switch(G){case"top":Z={x:Q,y:F.y-q.height};break;case"bottom":Z={x:Q,y:F.y+F.height};break;case"right":Z={x:F.x+F.width,y:X};break;case"left":Z={x:F.x-q.width,y:X};break;default:Z={x:F.x,y:F.y}}switch(getAlignment(w)){case"start":Z[U]-=J*(O&&Y?-1:1);break;case"end":Z[U]+=J*(O&&Y?-1:1);break}return Z}const computePosition$1=async(D,w,O)=>{const{placement:F="bottom",strategy:q="absolute",middleware:W=[],platform:U}=O,K=W.filter(Boolean),G=await(U.isRTL==null?void 0:U.isRTL(w));let Y=await U.getElementRects({reference:D,floating:w,strategy:q}),{x:Q,y:X}=computeCoordsFromPlacement(Y,F,G),J=F,Z={},ee=0;for(let ne=0;ne<K.length;ne++){const{name:te,fn:re}=K[ne],{x:se,y:le,data:ue,reset:oe}=await re({x:Q,y:X,initialPlacement:F,placement:J,strategy:q,middlewareData:Z,rects:Y,platform:U,elements:{reference:D,floating:w}});Q=se??Q,X=le??X,Z={...Z,[te]:{...Z[te],...ue}},oe&&ee<=50&&(ee++,typeof oe=="object"&&(oe.placement&&(J=oe.placement),oe.rects&&(Y=oe.rects===!0?await U.getElementRects({reference:D,floating:w,strategy:q}):oe.rects),{x:Q,y:X}=computeCoordsFromPlacement(Y,J,G)),ne=-1)}return{x:Q,y:X,placement:J,strategy:q,middlewareData:Z}};async function detectOverflow(D,w){var O;w===void 0&&(w={});const{x:F,y:q,platform:W,rects:U,elements:K,strategy:G}=D,{boundary:Y="clippingAncestors",rootBoundary:Q="viewport",elementContext:X="floating",altBoundary:J=!1,padding:Z=0}=evaluate(w,D),ee=getPaddingObject(Z),te=K[J?X==="floating"?"reference":"floating":X],re=rectToClientRect(await W.getClippingRect({element:(O=await(W.isElement==null?void 0:W.isElement(te)))==null||O?te:te.contextElement||await(W.getDocumentElement==null?void 0:W.getDocumentElement(K.floating)),boundary:Y,rootBoundary:Q,strategy:G})),se=X==="floating"?{x:F,y:q,width:U.floating.width,height:U.floating.height}:U.reference,le=await(W.getOffsetParent==null?void 0:W.getOffsetParent(K.floating)),ue=await(W.isElement==null?void 0:W.isElement(le))?await(W.getScale==null?void 0:W.getScale(le))||{x:1,y:1}:{x:1,y:1},oe=rectToClientRect(W.convertOffsetParentRelativeRectToViewportRelativeRect?await W.convertOffsetParentRelativeRectToViewportRelativeRect({elements:K,rect:se,offsetParent:le,strategy:G}):se);return{top:(re.top-oe.top+ee.top)/ue.y,bottom:(oe.bottom-re.bottom+ee.bottom)/ue.y,left:(re.left-oe.left+ee.left)/ue.x,right:(oe.right-re.right+ee.right)/ue.x}}const arrow$1=D=>({name:"arrow",options:D,async fn(w){const{x:O,y:F,placement:q,rects:W,platform:U,elements:K,middlewareData:G}=w,{element:Y,padding:Q=0}=evaluate(D,w)||{};if(Y==null)return{};const X=getPaddingObject(Q),J={x:O,y:F},Z=getAlignmentAxis(q),ee=getAxisLength(Z),ne=await U.getDimensions(Y),te=Z==="y",re=te?"top":"left",se=te?"bottom":"right",le=te?"clientHeight":"clientWidth",ue=W.reference[ee]+W.reference[Z]-J[Z]-W.floating[ee],oe=J[Z]-W.reference[Z],ae=await(U.getOffsetParent==null?void 0:U.getOffsetParent(Y));let ce=ae?ae[le]:0;(!ce||!await(U.isElement==null?void 0:U.isElement(ae)))&&(ce=K.floating[le]||W.floating[ee]);const de=ue/2-oe/2,fe=ce/2-ne[ee]/2-1,ye=min(X[re],fe),pe=min(X[se],fe),he=ye,be=ce-ne[ee]-pe,me=ce/2-ne[ee]/2+de,ve=clamp(he,me,be),_e=!G.arrow&&getAlignment(q)!=null&&me!==ve&&W.reference[ee]/2-(me<he?ye:pe)-ne[ee]/2<0,ge=_e?me<he?me-he:me-be:0;return{[Z]:J[Z]+ge,data:{[Z]:ve,centerOffset:me-ve-ge,..._e&&{alignmentOffset:ge}},reset:_e}}}),flip$1=function(D){return D===void 0&&(D={}),{name:"flip",options:D,async fn(w){var O,F;const{placement:q,middlewareData:W,rects:U,initialPlacement:K,platform:G,elements:Y}=w,{mainAxis:Q=!0,crossAxis:X=!0,fallbackPlacements:J,fallbackStrategy:Z="bestFit",fallbackAxisSideDirection:ee="none",flipAlignment:ne=!0,...te}=evaluate(D,w);if((O=W.arrow)!=null&&O.alignmentOffset)return{};const re=getSide(q),se=getSideAxis(K),le=getSide(K)===K,ue=await(G.isRTL==null?void 0:G.isRTL(Y.floating)),oe=J||(le||!ne?[getOppositePlacement(K)]:getExpandedPlacements(K)),ae=ee!=="none";!J&&ae&&oe.push(...getOppositeAxisPlacements(K,ne,ee,ue));const ce=[K,...oe],de=await detectOverflow(w,te),fe=[];let ye=((F=W.flip)==null?void 0:F.overflows)||[];if(Q&&fe.push(de[re]),X){const me=getAlignmentSides(q,U,ue);fe.push(de[me[0]],de[me[1]])}if(ye=[...ye,{placement:q,overflows:fe}],!fe.every(me=>me<=0)){var pe,he;const me=(((pe=W.flip)==null?void 0:pe.index)||0)+1,ve=ce[me];if(ve)return{data:{index:me,overflows:ye},reset:{placement:ve}};let _e=(he=ye.filter(ge=>ge.overflows[0]<=0).sort((ge,Se)=>ge.overflows[1]-Se.overflows[1])[0])==null?void 0:he.placement;if(!_e)switch(Z){case"bestFit":{var be;const ge=(be=ye.filter(Se=>{if(ae){const we=getSideAxis(Se.placement);return we===se||we==="y"}return!0}).map(Se=>[Se.placement,Se.overflows.filter(we=>we>0).reduce((we,Ce)=>we+Ce,0)]).sort((Se,we)=>Se[1]-we[1])[0])==null?void 0:be[0];ge&&(_e=ge);break}case"initialPlacement":_e=K;break}if(q!==_e)return{reset:{placement:_e}}}return{}}}};async function convertValueToCoords(D,w){const{placement:O,platform:F,elements:q}=D,W=await(F.isRTL==null?void 0:F.isRTL(q.floating)),U=getSide(O),K=getAlignment(O),G=getSideAxis(O)==="y",Y=["left","top"].includes(U)?-1:1,Q=W&&G?-1:1,X=evaluate(w,D);let{mainAxis:J,crossAxis:Z,alignmentAxis:ee}=typeof X=="number"?{mainAxis:X,crossAxis:0,alignmentAxis:null}:{mainAxis:X.mainAxis||0,crossAxis:X.crossAxis||0,alignmentAxis:X.alignmentAxis};return K&&typeof ee=="number"&&(Z=K==="end"?ee*-1:ee),G?{x:Z*Q,y:J*Y}:{x:J*Y,y:Z*Q}}const offset$1=function(D){return D===void 0&&(D=0),{name:"offset",options:D,async fn(w){var O,F;const{x:q,y:W,placement:U,middlewareData:K}=w,G=await convertValueToCoords(w,D);return U===((O=K.offset)==null?void 0:O.placement)&&(F=K.arrow)!=null&&F.alignmentOffset?{}:{x:q+G.x,y:W+G.y,data:{...G,placement:U}}}}},shift$2=function(D){return D===void 0&&(D={}),{name:"shift",options:D,async fn(w){const{x:O,y:F,placement:q}=w,{mainAxis:W=!0,crossAxis:U=!1,limiter:K={fn:te=>{let{x:re,y:se}=te;return{x:re,y:se}}},...G}=evaluate(D,w),Y={x:O,y:F},Q=await detectOverflow(w,G),X=getSideAxis(getSide(q)),J=getOppositeAxis(X);let Z=Y[J],ee=Y[X];if(W){const te=J==="y"?"top":"left",re=J==="y"?"bottom":"right",se=Z+Q[te],le=Z-Q[re];Z=clamp(se,Z,le)}if(U){const te=X==="y"?"top":"left",re=X==="y"?"bottom":"right",se=ee+Q[te],le=ee-Q[re];ee=clamp(se,ee,le)}const ne=K.fn({...w,[J]:Z,[X]:ee});return{...ne,data:{x:ne.x-O,y:ne.y-F,enabled:{[J]:W,[X]:U}}}}}},size$1=function(D){return D===void 0&&(D={}),{name:"size",options:D,async fn(w){var O,F;const{placement:q,rects:W,platform:U,elements:K}=w,{apply:G=()=>{},...Y}=evaluate(D,w),Q=await detectOverflow(w,Y),X=getSide(q),J=getAlignment(q),Z=getSideAxis(q)==="y",{width:ee,height:ne}=W.floating;let te,re;X==="top"||X==="bottom"?(te=X,re=J===(await(U.isRTL==null?void 0:U.isRTL(K.floating))?"start":"end")?"left":"right"):(re=X,te=J==="end"?"top":"bottom");const se=ne-Q.top-Q.bottom,le=ee-Q.left-Q.right,ue=min(ne-Q[te],se),oe=min(ee-Q[re],le),ae=!w.middlewareData.shift;let ce=ue,de=oe;if((O=w.middlewareData.shift)!=null&&O.enabled.x&&(de=le),(F=w.middlewareData.shift)!=null&&F.enabled.y&&(ce=se),ae&&!J){const ye=max(Q.left,0),pe=max(Q.right,0),he=max(Q.top,0),be=max(Q.bottom,0);Z?de=ee-2*(ye!==0||pe!==0?ye+pe:max(Q.left,Q.right)):ce=ne-2*(he!==0||be!==0?he+be:max(Q.top,Q.bottom))}await G({...w,availableWidth:de,availableHeight:ce});const fe=await U.getDimensions(K.floating);return ee!==fe.width||ne!==fe.height?{reset:{rects:!0}}:{}}}};function hasWindow(){return typeof window<"u"}function getNodeName(D){return isNode(D)?(D.nodeName||"").toLowerCase():"#document"}function getWindow(D){var w;return(D==null||(w=D.ownerDocument)==null?void 0:w.defaultView)||window}function getDocumentElement(D){var w;return(w=(isNode(D)?D.ownerDocument:D.document)||window.document)==null?void 0:w.documentElement}function isNode(D){return hasWindow()?D instanceof Node||D instanceof getWindow(D).Node:!1}function isElement(D){return hasWindow()?D instanceof Element||D instanceof getWindow(D).Element:!1}function isHTMLElement(D){return hasWindow()?D instanceof HTMLElement||D instanceof getWindow(D).HTMLElement:!1}function isShadowRoot(D){return!hasWindow()||typeof ShadowRoot>"u"?!1:D instanceof ShadowRoot||D instanceof getWindow(D).ShadowRoot}function isOverflowElement(D){const{overflow:w,overflowX:O,overflowY:F,display:q}=getComputedStyle$1(D);return/auto|scroll|overlay|hidden|clip/.test(w+F+O)&&!["inline","contents"].includes(q)}function isTableElement(D){return["table","td","th"].includes(getNodeName(D))}function isTopLayer(D){return[":popover-open",":modal"].some(w=>{try{return D.matches(w)}catch{return!1}})}function isContainingBlock(D){const w=isWebKit(),O=isElement(D)?getComputedStyle$1(D):D;return["transform","translate","scale","rotate","perspective"].some(F=>O[F]?O[F]!=="none":!1)||(O.containerType?O.containerType!=="normal":!1)||!w&&(O.backdropFilter?O.backdropFilter!=="none":!1)||!w&&(O.filter?O.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(F=>(O.willChange||"").includes(F))||["paint","layout","strict","content"].some(F=>(O.contain||"").includes(F))}function getContainingBlock(D){let w=getParentNode(D);for(;isHTMLElement(w)&&!isLastTraversableNode(w);){if(isContainingBlock(w))return w;if(isTopLayer(w))return null;w=getParentNode(w)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(D){return["html","body","#document"].includes(getNodeName(D))}function getComputedStyle$1(D){return getWindow(D).getComputedStyle(D)}function getNodeScroll(D){return isElement(D)?{scrollLeft:D.scrollLeft,scrollTop:D.scrollTop}:{scrollLeft:D.scrollX,scrollTop:D.scrollY}}function getParentNode(D){if(getNodeName(D)==="html")return D;const w=D.assignedSlot||D.parentNode||isShadowRoot(D)&&D.host||getDocumentElement(D);return isShadowRoot(w)?w.host:w}function getNearestOverflowAncestor(D){const w=getParentNode(D);return isLastTraversableNode(w)?D.ownerDocument?D.ownerDocument.body:D.body:isHTMLElement(w)&&isOverflowElement(w)?w:getNearestOverflowAncestor(w)}function getOverflowAncestors(D,w,O){var F;w===void 0&&(w=[]),O===void 0&&(O=!0);const q=getNearestOverflowAncestor(D),W=q===((F=D.ownerDocument)==null?void 0:F.body),U=getWindow(q);if(W){const K=getFrameElement(U);return w.concat(U,U.visualViewport||[],isOverflowElement(q)?q:[],K&&O?getOverflowAncestors(K):[])}return w.concat(q,getOverflowAncestors(q,[],O))}function getFrameElement(D){return D.parent&&Object.getPrototypeOf(D.parent)?D.frameElement:null}function getCssDimensions(D){const w=getComputedStyle$1(D);let O=parseFloat(w.width)||0,F=parseFloat(w.height)||0;const q=isHTMLElement(D),W=q?D.offsetWidth:O,U=q?D.offsetHeight:F,K=round(O)!==W||round(F)!==U;return K&&(O=W,F=U),{width:O,height:F,$:K}}function unwrapElement(D){return isElement(D)?D:D.contextElement}function getScale$1(D){const w=unwrapElement(D);if(!isHTMLElement(w))return createCoords(1);const O=w.getBoundingClientRect(),{width:F,height:q,$:W}=getCssDimensions(w);let U=(W?round(O.width):O.width)/F,K=(W?round(O.height):O.height)/q;return(!U||!Number.isFinite(U))&&(U=1),(!K||!Number.isFinite(K))&&(K=1),{x:U,y:K}}const noOffsets=createCoords(0);function getVisualOffsets(D){const w=getWindow(D);return!isWebKit()||!w.visualViewport?noOffsets:{x:w.visualViewport.offsetLeft,y:w.visualViewport.offsetTop}}function shouldAddVisualOffsets(D,w,O){return w===void 0&&(w=!1),!O||w&&O!==getWindow(D)?!1:w}function getBoundingClientRect(D,w,O,F){w===void 0&&(w=!1),O===void 0&&(O=!1);const q=D.getBoundingClientRect(),W=unwrapElement(D);let U=createCoords(1);w&&(F?isElement(F)&&(U=getScale$1(F)):U=getScale$1(D));const K=shouldAddVisualOffsets(W,O,F)?getVisualOffsets(W):createCoords(0);let G=(q.left+K.x)/U.x,Y=(q.top+K.y)/U.y,Q=q.width/U.x,X=q.height/U.y;if(W){const J=getWindow(W),Z=F&&isElement(F)?getWindow(F):F;let ee=J,ne=getFrameElement(ee);for(;ne&&F&&Z!==ee;){const te=getScale$1(ne),re=ne.getBoundingClientRect(),se=getComputedStyle$1(ne),le=re.left+(ne.clientLeft+parseFloat(se.paddingLeft))*te.x,ue=re.top+(ne.clientTop+parseFloat(se.paddingTop))*te.y;G*=te.x,Y*=te.y,Q*=te.x,X*=te.y,G+=le,Y+=ue,ee=getWindow(ne),ne=getFrameElement(ee)}}return rectToClientRect({width:Q,height:X,x:G,y:Y})}function getWindowScrollBarX(D,w){const O=getNodeScroll(D).scrollLeft;return w?w.left+O:getBoundingClientRect(getDocumentElement(D)).left+O}function getHTMLOffset(D,w,O){O===void 0&&(O=!1);const F=D.getBoundingClientRect(),q=F.left+w.scrollLeft-(O?0:getWindowScrollBarX(D,F)),W=F.top+w.scrollTop;return{x:q,y:W}}function convertOffsetParentRelativeRectToViewportRelativeRect(D){let{elements:w,rect:O,offsetParent:F,strategy:q}=D;const W=q==="fixed",U=getDocumentElement(F),K=w?isTopLayer(w.floating):!1;if(F===U||K&&W)return O;let G={scrollLeft:0,scrollTop:0},Y=createCoords(1);const Q=createCoords(0),X=isHTMLElement(F);if((X||!X&&!W)&&((getNodeName(F)!=="body"||isOverflowElement(U))&&(G=getNodeScroll(F)),isHTMLElement(F))){const Z=getBoundingClientRect(F);Y=getScale$1(F),Q.x=Z.x+F.clientLeft,Q.y=Z.y+F.clientTop}const J=U&&!X&&!W?getHTMLOffset(U,G,!0):createCoords(0);return{width:O.width*Y.x,height:O.height*Y.y,x:O.x*Y.x-G.scrollLeft*Y.x+Q.x+J.x,y:O.y*Y.y-G.scrollTop*Y.y+Q.y+J.y}}function getClientRects(D){return Array.from(D.getClientRects())}function getDocumentRect(D){const w=getDocumentElement(D),O=getNodeScroll(D),F=D.ownerDocument.body,q=max(w.scrollWidth,w.clientWidth,F.scrollWidth,F.clientWidth),W=max(w.scrollHeight,w.clientHeight,F.scrollHeight,F.clientHeight);let U=-O.scrollLeft+getWindowScrollBarX(D);const K=-O.scrollTop;return getComputedStyle$1(F).direction==="rtl"&&(U+=max(w.clientWidth,F.clientWidth)-q),{width:q,height:W,x:U,y:K}}function getViewportRect(D,w){const O=getWindow(D),F=getDocumentElement(D),q=O.visualViewport;let W=F.clientWidth,U=F.clientHeight,K=0,G=0;if(q){W=q.width,U=q.height;const Y=isWebKit();(!Y||Y&&w==="fixed")&&(K=q.offsetLeft,G=q.offsetTop)}return{width:W,height:U,x:K,y:G}}function getInnerBoundingClientRect(D,w){const O=getBoundingClientRect(D,!0,w==="fixed"),F=O.top+D.clientTop,q=O.left+D.clientLeft,W=isHTMLElement(D)?getScale$1(D):createCoords(1),U=D.clientWidth*W.x,K=D.clientHeight*W.y,G=q*W.x,Y=F*W.y;return{width:U,height:K,x:G,y:Y}}function getClientRectFromClippingAncestor(D,w,O){let F;if(w==="viewport")F=getViewportRect(D,O);else if(w==="document")F=getDocumentRect(getDocumentElement(D));else if(isElement(w))F=getInnerBoundingClientRect(w,O);else{const q=getVisualOffsets(D);F={x:w.x-q.x,y:w.y-q.y,width:w.width,height:w.height}}return rectToClientRect(F)}function hasFixedPositionAncestor(D,w){const O=getParentNode(D);return O===w||!isElement(O)||isLastTraversableNode(O)?!1:getComputedStyle$1(O).position==="fixed"||hasFixedPositionAncestor(O,w)}function getClippingElementAncestors(D,w){const O=w.get(D);if(O)return O;let F=getOverflowAncestors(D,[],!1).filter(K=>isElement(K)&&getNodeName(K)!=="body"),q=null;const W=getComputedStyle$1(D).position==="fixed";let U=W?getParentNode(D):D;for(;isElement(U)&&!isLastTraversableNode(U);){const K=getComputedStyle$1(U),G=isContainingBlock(U);!G&&K.position==="fixed"&&(q=null),(W?!G&&!q:!G&&K.position==="static"&&!!q&&["absolute","fixed"].includes(q.position)||isOverflowElement(U)&&!G&&hasFixedPositionAncestor(D,U))?F=F.filter(Q=>Q!==U):q=K,U=getParentNode(U)}return w.set(D,F),F}function getClippingRect(D){let{element:w,boundary:O,rootBoundary:F,strategy:q}=D;const U=[...O==="clippingAncestors"?isTopLayer(w)?[]:getClippingElementAncestors(w,this._c):[].concat(O),F],K=U[0],G=U.reduce((Y,Q)=>{const X=getClientRectFromClippingAncestor(w,Q,q);return Y.top=max(X.top,Y.top),Y.right=min(X.right,Y.right),Y.bottom=min(X.bottom,Y.bottom),Y.left=max(X.left,Y.left),Y},getClientRectFromClippingAncestor(w,K,q));return{width:G.right-G.left,height:G.bottom-G.top,x:G.left,y:G.top}}function getDimensions(D){const{width:w,height:O}=getCssDimensions(D);return{width:w,height:O}}function getRectRelativeToOffsetParent(D,w,O){const F=isHTMLElement(w),q=getDocumentElement(w),W=O==="fixed",U=getBoundingClientRect(D,!0,W,w);let K={scrollLeft:0,scrollTop:0};const G=createCoords(0);if(F||!F&&!W)if((getNodeName(w)!=="body"||isOverflowElement(q))&&(K=getNodeScroll(w)),F){const J=getBoundingClientRect(w,!0,W,w);G.x=J.x+w.clientLeft,G.y=J.y+w.clientTop}else q&&(G.x=getWindowScrollBarX(q));const Y=q&&!F&&!W?getHTMLOffset(q,K):createCoords(0),Q=U.left+K.scrollLeft-G.x-Y.x,X=U.top+K.scrollTop-G.y-Y.y;return{x:Q,y:X,width:U.width,height:U.height}}function isStaticPositioned(D){return getComputedStyle$1(D).position==="static"}function getTrueOffsetParent(D,w){if(!isHTMLElement(D)||getComputedStyle$1(D).position==="fixed")return null;if(w)return w(D);let O=D.offsetParent;return getDocumentElement(D)===O&&(O=O.ownerDocument.body),O}function getOffsetParent(D,w){const O=getWindow(D);if(isTopLayer(D))return O;if(!isHTMLElement(D)){let q=getParentNode(D);for(;q&&!isLastTraversableNode(q);){if(isElement(q)&&!isStaticPositioned(q))return q;q=getParentNode(q)}return O}let F=getTrueOffsetParent(D,w);for(;F&&isTableElement(F)&&isStaticPositioned(F);)F=getTrueOffsetParent(F,w);return F&&isLastTraversableNode(F)&&isStaticPositioned(F)&&!isContainingBlock(F)?O:F||getContainingBlock(D)||O}const getElementRects=async function(D){const w=this.getOffsetParent||getOffsetParent,O=this.getDimensions,F=await O(D.floating);return{reference:getRectRelativeToOffsetParent(D.reference,await w(D.floating),D.strategy),floating:{x:0,y:0,width:F.width,height:F.height}}};function isRTL(D){return getComputedStyle$1(D).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale:getScale$1,isElement,isRTL};function rectsAreEqual(D,w){return D.x===w.x&&D.y===w.y&&D.width===w.width&&D.height===w.height}function observeMove(D,w){let O=null,F;const q=getDocumentElement(D);function W(){var K;clearTimeout(F),(K=O)==null||K.disconnect(),O=null}function U(K,G){K===void 0&&(K=!1),G===void 0&&(G=1),W();const Y=D.getBoundingClientRect(),{left:Q,top:X,width:J,height:Z}=Y;if(K||w(),!J||!Z)return;const ee=floor(X),ne=floor(q.clientWidth-(Q+J)),te=floor(q.clientHeight-(X+Z)),re=floor(Q),le={rootMargin:-ee+"px "+-ne+"px "+-te+"px "+-re+"px",threshold:max(0,min(1,G))||1};let ue=!0;function oe(ae){const ce=ae[0].intersectionRatio;if(ce!==G){if(!ue)return U();ce?U(!1,ce):F=setTimeout(()=>{U(!1,1e-7)},1e3)}ce===1&&!rectsAreEqual(Y,D.getBoundingClientRect())&&U(),ue=!1}try{O=new IntersectionObserver(oe,{...le,root:q.ownerDocument})}catch{O=new IntersectionObserver(oe,le)}O.observe(D)}return U(!0),W}function autoUpdate(D,w,O,F){F===void 0&&(F={});const{ancestorScroll:q=!0,ancestorResize:W=!0,elementResize:U=typeof ResizeObserver=="function",layoutShift:K=typeof IntersectionObserver=="function",animationFrame:G=!1}=F,Y=unwrapElement(D),Q=q||W?[...Y?getOverflowAncestors(Y):[],...getOverflowAncestors(w)]:[];Q.forEach(re=>{q&&re.addEventListener("scroll",O,{passive:!0}),W&&re.addEventListener("resize",O)});const X=Y&&K?observeMove(Y,O):null;let J=-1,Z=null;U&&(Z=new ResizeObserver(re=>{let[se]=re;se&&se.target===Y&&Z&&(Z.unobserve(w),cancelAnimationFrame(J),J=requestAnimationFrame(()=>{var le;(le=Z)==null||le.observe(w)})),O()}),Y&&!G&&Z.observe(Y),Z.observe(w));let ee,ne=G?getBoundingClientRect(D):null;G&&te();function te(){const re=getBoundingClientRect(D);ne&&!rectsAreEqual(ne,re)&&O(),ne=re,ee=requestAnimationFrame(te)}return O(),()=>{var re;Q.forEach(se=>{q&&se.removeEventListener("scroll",O),W&&se.removeEventListener("resize",O)}),X==null||X(),(re=Z)==null||re.disconnect(),Z=null,G&&cancelAnimationFrame(ee)}}const offset=offset$1,shift$1=shift$2,flip=flip$1,size=size$1,arrow=arrow$1,computePosition=(D,w,O)=>{const F=new Map,q={platform,...O},W={...q.platform,_c:F};return computePosition$1(D,w,{...q,platform:W})};function e$1(D){return i$2(D)}function r$1(D){return D.assignedSlot?D.assignedSlot:D.parentNode instanceof ShadowRoot?D.parentNode.host:D.parentNode}function i$2(D){for(let w=D;w;w=r$1(w))if(w instanceof Element&&getComputedStyle(w).display==="none")return null;for(let w=r$1(D);w;w=r$1(w)){if(!(w instanceof Element))continue;const O=getComputedStyle(w);if(O.display!=="contents"&&(O.position!=="static"||isContainingBlock(O)||w.tagName==="BODY"))return w}return null}function isVirtualElement(D){return D!==null&&typeof D=="object"&&"getBoundingClientRect"in D&&("contextElement"in D?D instanceof Element:!0)}var SlPopup=class extends ShoelaceElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.active=!1,this.placement="top",this.strategy="absolute",this.distance=0,this.skidding=0,this.arrow=!1,this.arrowPlacement="anchor",this.arrowPadding=10,this.flip=!1,this.flipFallbackPlacements="",this.flipFallbackStrategy="best-fit",this.flipPadding=0,this.shift=!1,this.shiftPadding=0,this.autoSizePadding=0,this.hoverBridge=!1,this.updateHoverBridge=()=>{if(this.hoverBridge&&this.anchorEl){const D=this.anchorEl.getBoundingClientRect(),w=this.popup.getBoundingClientRect(),O=this.placement.includes("top")||this.placement.includes("bottom");let F=0,q=0,W=0,U=0,K=0,G=0,Y=0,Q=0;O?D.top<w.top?(F=D.left,q=D.bottom,W=D.right,U=D.bottom,K=w.left,G=w.top,Y=w.right,Q=w.top):(F=w.left,q=w.bottom,W=w.right,U=w.bottom,K=D.left,G=D.top,Y=D.right,Q=D.top):D.left<w.left?(F=D.right,q=D.top,W=w.left,U=w.top,K=D.right,G=D.bottom,Y=w.left,Q=w.bottom):(F=w.right,q=w.top,W=D.left,U=D.top,K=w.right,G=w.bottom,Y=D.left,Q=D.bottom),this.style.setProperty("--hover-bridge-top-left-x",`${F}px`),this.style.setProperty("--hover-bridge-top-left-y",`${q}px`),this.style.setProperty("--hover-bridge-top-right-x",`${W}px`),this.style.setProperty("--hover-bridge-top-right-y",`${U}px`),this.style.setProperty("--hover-bridge-bottom-left-x",`${K}px`),this.style.setProperty("--hover-bridge-bottom-left-y",`${G}px`),this.style.setProperty("--hover-bridge-bottom-right-x",`${Y}px`),this.style.setProperty("--hover-bridge-bottom-right-y",`${Q}px`)}}}async connectedCallback(){super.connectedCallback(),await this.updateComplete,this.start()}disconnectedCallback(){super.disconnectedCallback(),this.stop()}async updated(D){super.updated(D),D.has("active")&&(this.active?this.start():this.stop()),D.has("anchor")&&this.handleAnchorChange(),this.active&&(await this.updateComplete,this.reposition())}async handleAnchorChange(){if(await this.stop(),this.anchor&&typeof this.anchor=="string"){const D=this.getRootNode();this.anchorEl=D.getElementById(this.anchor)}else this.anchor instanceof Element||isVirtualElement(this.anchor)?this.anchorEl=this.anchor:this.anchorEl=this.querySelector('[slot="anchor"]');this.anchorEl instanceof HTMLSlotElement&&(this.anchorEl=this.anchorEl.assignedElements({flatten:!0})[0]),this.anchorEl&&this.active&&this.start()}start(){!this.anchorEl||!this.active||(this.cleanup=autoUpdate(this.anchorEl,this.popup,()=>{this.reposition()}))}async stop(){return new Promise(D=>{this.cleanup?(this.cleanup(),this.cleanup=void 0,this.removeAttribute("data-current-placement"),this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height"),requestAnimationFrame(()=>D())):D()})}reposition(){if(!this.active||!this.anchorEl)return;const D=[offset({mainAxis:this.distance,crossAxis:this.skidding})];this.sync?D.push(size({apply:({rects:O})=>{const F=this.sync==="width"||this.sync==="both",q=this.sync==="height"||this.sync==="both";this.popup.style.width=F?`${O.reference.width}px`:"",this.popup.style.height=q?`${O.reference.height}px`:""}})):(this.popup.style.width="",this.popup.style.height=""),this.flip&&D.push(flip({boundary:this.flipBoundary,fallbackPlacements:this.flipFallbackPlacements,fallbackStrategy:this.flipFallbackStrategy==="best-fit"?"bestFit":"initialPlacement",padding:this.flipPadding})),this.shift&&D.push(shift$1({boundary:this.shiftBoundary,padding:this.shiftPadding})),this.autoSize?D.push(size({boundary:this.autoSizeBoundary,padding:this.autoSizePadding,apply:({availableWidth:O,availableHeight:F})=>{this.autoSize==="vertical"||this.autoSize==="both"?this.style.setProperty("--auto-size-available-height",`${F}px`):this.style.removeProperty("--auto-size-available-height"),this.autoSize==="horizontal"||this.autoSize==="both"?this.style.setProperty("--auto-size-available-width",`${O}px`):this.style.removeProperty("--auto-size-available-width")}})):(this.style.removeProperty("--auto-size-available-width"),this.style.removeProperty("--auto-size-available-height")),this.arrow&&D.push(arrow({element:this.arrowEl,padding:this.arrowPadding}));const w=this.strategy==="absolute"?O=>platform.getOffsetParent(O,e$1):platform.getOffsetParent;computePosition(this.anchorEl,this.popup,{placement:this.placement,middleware:D,strategy:this.strategy,platform:__spreadProps(__spreadValues({},platform),{getOffsetParent:w})}).then(({x:O,y:F,middlewareData:q,placement:W})=>{const U=this.localize.dir()==="rtl",K={top:"bottom",right:"left",bottom:"top",left:"right"}[W.split("-")[0]];if(this.setAttribute("data-current-placement",W),Object.assign(this.popup.style,{left:`${O}px`,top:`${F}px`}),this.arrow){const G=q.arrow.x,Y=q.arrow.y;let Q="",X="",J="",Z="";if(this.arrowPlacement==="start"){const ee=typeof G=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";Q=typeof Y=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"",X=U?ee:"",Z=U?"":ee}else if(this.arrowPlacement==="end"){const ee=typeof G=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:"";X=U?"":ee,Z=U?ee:"",J=typeof Y=="number"?`calc(${this.arrowPadding}px - var(--arrow-padding-offset))`:""}else this.arrowPlacement==="center"?(Z=typeof G=="number"?"calc(50% - var(--arrow-size-diagonal))":"",Q=typeof Y=="number"?"calc(50% - var(--arrow-size-diagonal))":""):(Z=typeof G=="number"?`${G}px`:"",Q=typeof Y=="number"?`${Y}px`:"");Object.assign(this.arrowEl.style,{top:Q,right:X,bottom:J,left:Z,[K]:"calc(var(--arrow-size-diagonal) * -1)"})}}),requestAnimationFrame(()=>this.updateHoverBridge()),this.emit("sl-reposition")}render(){return x`
      <slot name="anchor" @slotchange=${this.handleAnchorChange}></slot>

      <span
        part="hover-bridge"
        class=${e$2({"popup-hover-bridge":!0,"popup-hover-bridge--visible":this.hoverBridge&&this.active})}
      ></span>

      <div
        part="popup"
        class=${e$2({popup:!0,"popup--active":this.active,"popup--fixed":this.strategy==="fixed","popup--has-arrow":this.arrow})}
      >
        <slot></slot>
        ${this.arrow?x`<div part="arrow" class="popup__arrow" role="presentation"></div>`:""}
      </div>
    `}};SlPopup.styles=[component_styles_default,popup_styles_default];__decorateClass$3([e$5(".popup")],SlPopup.prototype,"popup",2);__decorateClass$3([e$5(".popup__arrow")],SlPopup.prototype,"arrowEl",2);__decorateClass$3([n$3()],SlPopup.prototype,"anchor",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlPopup.prototype,"active",2);__decorateClass$3([n$3({reflect:!0})],SlPopup.prototype,"placement",2);__decorateClass$3([n$3({reflect:!0})],SlPopup.prototype,"strategy",2);__decorateClass$3([n$3({type:Number})],SlPopup.prototype,"distance",2);__decorateClass$3([n$3({type:Number})],SlPopup.prototype,"skidding",2);__decorateClass$3([n$3({type:Boolean})],SlPopup.prototype,"arrow",2);__decorateClass$3([n$3({attribute:"arrow-placement"})],SlPopup.prototype,"arrowPlacement",2);__decorateClass$3([n$3({attribute:"arrow-padding",type:Number})],SlPopup.prototype,"arrowPadding",2);__decorateClass$3([n$3({type:Boolean})],SlPopup.prototype,"flip",2);__decorateClass$3([n$3({attribute:"flip-fallback-placements",converter:{fromAttribute:D=>D.split(" ").map(w=>w.trim()).filter(w=>w!==""),toAttribute:D=>D.join(" ")}})],SlPopup.prototype,"flipFallbackPlacements",2);__decorateClass$3([n$3({attribute:"flip-fallback-strategy"})],SlPopup.prototype,"flipFallbackStrategy",2);__decorateClass$3([n$3({type:Object})],SlPopup.prototype,"flipBoundary",2);__decorateClass$3([n$3({attribute:"flip-padding",type:Number})],SlPopup.prototype,"flipPadding",2);__decorateClass$3([n$3({type:Boolean})],SlPopup.prototype,"shift",2);__decorateClass$3([n$3({type:Object})],SlPopup.prototype,"shiftBoundary",2);__decorateClass$3([n$3({attribute:"shift-padding",type:Number})],SlPopup.prototype,"shiftPadding",2);__decorateClass$3([n$3({attribute:"auto-size"})],SlPopup.prototype,"autoSize",2);__decorateClass$3([n$3()],SlPopup.prototype,"sync",2);__decorateClass$3([n$3({type:Object})],SlPopup.prototype,"autoSizeBoundary",2);__decorateClass$3([n$3({attribute:"auto-size-padding",type:Number})],SlPopup.prototype,"autoSizePadding",2);__decorateClass$3([n$3({attribute:"hover-bridge",type:Boolean})],SlPopup.prototype,"hoverBridge",2);var defaultAnimationRegistry=new Map,customAnimationRegistry=new WeakMap;function ensureAnimation(D){return D??{keyframes:[],options:{duration:0}}}function getLogicalAnimation(D,w){return w.toLowerCase()==="rtl"?{keyframes:D.rtlKeyframes||D.keyframes,options:D.options}:D}function setDefaultAnimation(D,w){defaultAnimationRegistry.set(D,ensureAnimation(w))}function getAnimation(D,w,O){const F=customAnimationRegistry.get(D);if(F!=null&&F[w])return getLogicalAnimation(F[w],O.dir);const q=defaultAnimationRegistry.get(w);return q?getLogicalAnimation(q,O.dir):{keyframes:[],options:{duration:0}}}function waitForEvent(D,w){return new Promise(O=>{function F(q){q.target===D&&(D.removeEventListener(w,F),O())}D.addEventListener(w,F)})}function animateTo(D,w,O){return new Promise(F=>{if((O==null?void 0:O.duration)===1/0)throw new Error("Promise-based animations must be finite.");const q=D.animate(w,__spreadProps(__spreadValues({},O),{duration:prefersReducedMotion()?0:O.duration}));q.addEventListener("cancel",F,{once:!0}),q.addEventListener("finish",F,{once:!0})})}function prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}function stopAnimations(D){return Promise.all(D.getAnimations().map(w=>new Promise(O=>{w.cancel(),requestAnimationFrame(O)})))}var SlDropdown=class extends ShoelaceElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.open=!1,this.placement="bottom-start",this.disabled=!1,this.stayOpenOnSelect=!1,this.distance=0,this.skidding=0,this.hoist=!1,this.sync=void 0,this.handleKeyDown=D=>{this.open&&D.key==="Escape"&&(D.stopPropagation(),this.hide(),this.focusOnTrigger())},this.handleDocumentKeyDown=D=>{var w;if(D.key==="Escape"&&this.open&&!this.closeWatcher){D.stopPropagation(),this.focusOnTrigger(),this.hide();return}if(D.key==="Tab"){if(this.open&&((w=document.activeElement)==null?void 0:w.tagName.toLowerCase())==="sl-menu-item"){D.preventDefault(),this.hide(),this.focusOnTrigger();return}setTimeout(()=>{var O,F,q;const W=((O=this.containingElement)==null?void 0:O.getRootNode())instanceof ShadowRoot?(q=(F=document.activeElement)==null?void 0:F.shadowRoot)==null?void 0:q.activeElement:document.activeElement;(!this.containingElement||(W==null?void 0:W.closest(this.containingElement.tagName.toLowerCase()))!==this.containingElement)&&this.hide()})}},this.handleDocumentMouseDown=D=>{const w=D.composedPath();this.containingElement&&!w.includes(this.containingElement)&&this.hide()},this.handlePanelSelect=D=>{const w=D.target;!this.stayOpenOnSelect&&w.tagName.toLowerCase()==="sl-menu"&&(this.hide(),this.focusOnTrigger())}}connectedCallback(){super.connectedCallback(),this.containingElement||(this.containingElement=this)}firstUpdated(){this.panel.hidden=!this.open,this.open&&(this.addOpenListeners(),this.popup.active=!0)}disconnectedCallback(){super.disconnectedCallback(),this.removeOpenListeners(),this.hide()}focusOnTrigger(){const D=this.trigger.assignedElements({flatten:!0})[0];typeof(D==null?void 0:D.focus)=="function"&&D.focus()}getMenu(){return this.panel.assignedElements({flatten:!0}).find(D=>D.tagName.toLowerCase()==="sl-menu")}handleTriggerClick(){this.open?this.hide():(this.show(),this.focusOnTrigger())}async handleTriggerKeyDown(D){if([" ","Enter"].includes(D.key)){D.preventDefault(),this.handleTriggerClick();return}const w=this.getMenu();if(w){const O=w.getAllItems(),F=O[0],q=O[O.length-1];["ArrowDown","ArrowUp","Home","End"].includes(D.key)&&(D.preventDefault(),this.open||(this.show(),await this.updateComplete),O.length>0&&this.updateComplete.then(()=>{(D.key==="ArrowDown"||D.key==="Home")&&(w.setCurrentItem(F),F.focus()),(D.key==="ArrowUp"||D.key==="End")&&(w.setCurrentItem(q),q.focus())}))}}handleTriggerKeyUp(D){D.key===" "&&D.preventDefault()}handleTriggerSlotChange(){this.updateAccessibleTrigger()}updateAccessibleTrigger(){const w=this.trigger.assignedElements({flatten:!0}).find(F=>getTabbableBoundary(F).start);let O;if(w){switch(w.tagName.toLowerCase()){case"sl-button":case"sl-icon-button":O=w.button;break;default:O=w}O.setAttribute("aria-haspopup","true"),O.setAttribute("aria-expanded",this.open?"true":"false")}}async show(){if(!this.open)return this.open=!0,waitForEvent(this,"sl-after-show")}async hide(){if(this.open)return this.open=!1,waitForEvent(this,"sl-after-hide")}reposition(){this.popup.reposition()}addOpenListeners(){var D;this.panel.addEventListener("sl-select",this.handlePanelSelect),"CloseWatcher"in window?((D=this.closeWatcher)==null||D.destroy(),this.closeWatcher=new CloseWatcher,this.closeWatcher.onclose=()=>{this.hide(),this.focusOnTrigger()}):this.panel.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("mousedown",this.handleDocumentMouseDown)}removeOpenListeners(){var D;this.panel&&(this.panel.removeEventListener("sl-select",this.handlePanelSelect),this.panel.removeEventListener("keydown",this.handleKeyDown)),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("mousedown",this.handleDocumentMouseDown),(D=this.closeWatcher)==null||D.destroy()}async handleOpenChange(){if(this.disabled){this.open=!1;return}if(this.updateAccessibleTrigger(),this.open){this.emit("sl-show"),this.addOpenListeners(),await stopAnimations(this),this.panel.hidden=!1,this.popup.active=!0;const{keyframes:D,options:w}=getAnimation(this,"dropdown.show",{dir:this.localize.dir()});await animateTo(this.popup.popup,D,w),this.emit("sl-after-show")}else{this.emit("sl-hide"),this.removeOpenListeners(),await stopAnimations(this);const{keyframes:D,options:w}=getAnimation(this,"dropdown.hide",{dir:this.localize.dir()});await animateTo(this.popup.popup,D,w),this.panel.hidden=!0,this.popup.active=!1,this.emit("sl-after-hide")}}render(){return x`
      <sl-popup
        part="base"
        exportparts="popup:base__popup"
        id="dropdown"
        placement=${this.placement}
        distance=${this.distance}
        skidding=${this.skidding}
        strategy=${this.hoist?"fixed":"absolute"}
        flip
        shift
        auto-size="vertical"
        auto-size-padding="10"
        sync=${o$2(this.sync?this.sync:void 0)}
        class=${e$2({dropdown:!0,"dropdown--open":this.open})}
      >
        <slot
          name="trigger"
          slot="anchor"
          part="trigger"
          class="dropdown__trigger"
          @click=${this.handleTriggerClick}
          @keydown=${this.handleTriggerKeyDown}
          @keyup=${this.handleTriggerKeyUp}
          @slotchange=${this.handleTriggerSlotChange}
        ></slot>

        <div aria-hidden=${this.open?"false":"true"} aria-labelledby="dropdown">
          <slot part="panel" class="dropdown__panel"></slot>
        </div>
      </sl-popup>
    `}};SlDropdown.styles=[component_styles_default,dropdown_styles_default];SlDropdown.dependencies={"sl-popup":SlPopup};__decorateClass$3([e$5(".dropdown")],SlDropdown.prototype,"popup",2);__decorateClass$3([e$5(".dropdown__trigger")],SlDropdown.prototype,"trigger",2);__decorateClass$3([e$5(".dropdown__panel")],SlDropdown.prototype,"panel",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlDropdown.prototype,"open",2);__decorateClass$3([n$3({reflect:!0})],SlDropdown.prototype,"placement",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlDropdown.prototype,"disabled",2);__decorateClass$3([n$3({attribute:"stay-open-on-select",type:Boolean,reflect:!0})],SlDropdown.prototype,"stayOpenOnSelect",2);__decorateClass$3([n$3({attribute:!1})],SlDropdown.prototype,"containingElement",2);__decorateClass$3([n$3({type:Number})],SlDropdown.prototype,"distance",2);__decorateClass$3([n$3({type:Number})],SlDropdown.prototype,"skidding",2);__decorateClass$3([n$3({type:Boolean})],SlDropdown.prototype,"hoist",2);__decorateClass$3([n$3({reflect:!0})],SlDropdown.prototype,"sync",2);__decorateClass$3([watch("open",{waitUntilFirstUpdate:!0})],SlDropdown.prototype,"handleOpenChange",1);setDefaultAnimation("dropdown.show",{keyframes:[{opacity:0,scale:.9},{opacity:1,scale:1}],options:{duration:100,easing:"ease"}});setDefaultAnimation("dropdown.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.9}],options:{duration:100,easing:"ease"}});SlDropdown.define("sl-dropdown");var menu_styles_default=i$8`
  :host {
    display: block;
    position: relative;
    background: var(--sl-panel-background-color);
    border: solid var(--sl-panel-border-width) var(--sl-panel-border-color);
    border-radius: var(--sl-border-radius-medium);
    padding: var(--sl-spacing-x-small) 0;
    overflow: auto;
    overscroll-behavior: none;
  }

  ::slotted(sl-divider) {
    --spacing: var(--sl-spacing-x-small);
  }
`,SlMenu=class extends ShoelaceElement{connectedCallback(){super.connectedCallback(),this.setAttribute("role","menu")}handleClick(D){const w=["menuitem","menuitemcheckbox"],O=D.composedPath(),F=O.find(K=>{var G;return w.includes(((G=K==null?void 0:K.getAttribute)==null?void 0:G.call(K,"role"))||"")});if(!F||O.find(K=>{var G;return((G=K==null?void 0:K.getAttribute)==null?void 0:G.call(K,"role"))==="menu"})!==this)return;const U=F;U.type==="checkbox"&&(U.checked=!U.checked),this.emit("sl-select",{detail:{item:U}})}handleKeyDown(D){if(D.key==="Enter"||D.key===" "){const w=this.getCurrentItem();D.preventDefault(),D.stopPropagation(),w==null||w.click()}else if(["ArrowDown","ArrowUp","Home","End"].includes(D.key)){const w=this.getAllItems(),O=this.getCurrentItem();let F=O?w.indexOf(O):0;w.length>0&&(D.preventDefault(),D.stopPropagation(),D.key==="ArrowDown"?F++:D.key==="ArrowUp"?F--:D.key==="Home"?F=0:D.key==="End"&&(F=w.length-1),F<0&&(F=w.length-1),F>w.length-1&&(F=0),this.setCurrentItem(w[F]),w[F].focus())}}handleMouseDown(D){const w=D.target;this.isMenuItem(w)&&this.setCurrentItem(w)}handleSlotChange(){const D=this.getAllItems();D.length>0&&this.setCurrentItem(D[0])}isMenuItem(D){var w;return D.tagName.toLowerCase()==="sl-menu-item"||["menuitem","menuitemcheckbox","menuitemradio"].includes((w=D.getAttribute("role"))!=null?w:"")}getAllItems(){return[...this.defaultSlot.assignedElements({flatten:!0})].filter(D=>!(D.inert||!this.isMenuItem(D)))}getCurrentItem(){return this.getAllItems().find(D=>D.getAttribute("tabindex")==="0")}setCurrentItem(D){this.getAllItems().forEach(O=>{O.setAttribute("tabindex",O===D?"0":"-1")})}render(){return x`
      <slot
        @slotchange=${this.handleSlotChange}
        @click=${this.handleClick}
        @keydown=${this.handleKeyDown}
        @mousedown=${this.handleMouseDown}
      ></slot>
    `}};SlMenu.styles=[component_styles_default,menu_styles_default];__decorateClass$3([e$5("slot")],SlMenu.prototype,"defaultSlot",2);SlMenu.define("sl-menu");var menu_item_styles_default=i$8`
  :host {
    --submenu-offset: -2px;

    display: block;
  }

  :host([inert]) {
    display: none;
  }

  .menu-item {
    position: relative;
    display: flex;
    align-items: stretch;
    font-family: var(--sl-font-sans);
    font-size: var(--sl-font-size-medium);
    font-weight: var(--sl-font-weight-normal);
    line-height: var(--sl-line-height-normal);
    letter-spacing: var(--sl-letter-spacing-normal);
    color: var(--sl-color-neutral-700);
    padding: var(--sl-spacing-2x-small) var(--sl-spacing-2x-small);
    transition: var(--sl-transition-fast) fill;
    user-select: none;
    -webkit-user-select: none;
    white-space: nowrap;
    cursor: pointer;
  }

  .menu-item.menu-item--disabled {
    outline: none;
    opacity: 0.5;
    cursor: not-allowed;
  }

  .menu-item.menu-item--loading {
    outline: none;
    cursor: wait;
  }

  .menu-item.menu-item--loading *:not(sl-spinner) {
    opacity: 0.5;
  }

  .menu-item--loading sl-spinner {
    --indicator-color: currentColor;
    --track-width: 1px;
    position: absolute;
    font-size: 0.75em;
    top: calc(50% - 0.5em);
    left: 0.65rem;
    opacity: 1;
  }

  .menu-item .menu-item__label {
    flex: 1 1 auto;
    display: inline-block;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .menu-item .menu-item__prefix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
  }

  .menu-item .menu-item__prefix::slotted(*) {
    margin-inline-end: var(--sl-spacing-x-small);
  }

  .menu-item .menu-item__suffix {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
  }

  .menu-item .menu-item__suffix::slotted(*) {
    margin-inline-start: var(--sl-spacing-x-small);
  }

  /* Safe triangle */
  .menu-item--submenu-expanded::after {
    content: '';
    position: fixed;
    z-index: calc(var(--sl-z-index-dropdown) - 1);
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    clip-path: polygon(
      var(--safe-triangle-cursor-x, 0) var(--safe-triangle-cursor-y, 0),
      var(--safe-triangle-submenu-start-x, 0) var(--safe-triangle-submenu-start-y, 0),
      var(--safe-triangle-submenu-end-x, 0) var(--safe-triangle-submenu-end-y, 0)
    );
  }

  :host(:focus-visible) {
    outline: none;
  }

  :host(:hover:not([aria-disabled='true'], :focus-visible)) .menu-item,
  .menu-item--submenu-expanded {
    background-color: var(--sl-color-neutral-100);
    color: var(--sl-color-neutral-1000);
  }

  :host(:focus-visible) .menu-item {
    outline: none;
    background-color: var(--sl-color-primary-600);
    color: var(--sl-color-neutral-0);
    opacity: 1;
  }

  .menu-item .menu-item__check,
  .menu-item .menu-item__chevron {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.5em;
    visibility: hidden;
  }

  .menu-item--checked .menu-item__check,
  .menu-item--has-submenu .menu-item__chevron {
    visibility: visible;
  }

  /* Add elevation and z-index to submenus */
  sl-popup::part(popup) {
    box-shadow: var(--sl-shadow-large);
    z-index: var(--sl-z-index-dropdown);
    margin-left: var(--submenu-offset);
  }

  .menu-item--rtl sl-popup::part(popup) {
    margin-left: calc(-1 * var(--submenu-offset));
  }

  @media (forced-colors: active) {
    :host(:hover:not([aria-disabled='true'])) .menu-item,
    :host(:focus-visible) .menu-item {
      outline: dashed 1px SelectedItem;
      outline-offset: -1px;
    }
  }

  ::slotted(sl-menu) {
    max-width: var(--auto-size-available-width) !important;
    max-height: var(--auto-size-available-height) !important;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const s=(D,w)=>{var F;const O=D._$AN;if(O===void 0)return!1;for(const q of O)(F=q._$AO)==null||F.call(q,w,!1),s(q,w);return!0},o$1=D=>{let w,O;do{if((w=D._$AM)===void 0)break;O=w._$AN,O.delete(D),D=w}while((O==null?void 0:O.size)===0)},r=D=>{for(let w;w=D._$AM;D=w){let O=w._$AN;if(O===void 0)w._$AN=O=new Set;else if(O.has(D))break;O.add(D),c(w)}};function h$1(D){this._$AN!==void 0?(o$1(this),this._$AM=D,r(this)):this._$AM=D}function n$1(D,w=!1,O=0){const F=this._$AH,q=this._$AN;if(q!==void 0&&q.size!==0)if(w)if(Array.isArray(F))for(let W=O;W<F.length;W++)s(F[W],!1),o$1(F[W]);else F!=null&&(s(F,!1),o$1(F));else s(this,D)}const c=D=>{D.type==t$1.CHILD&&(D._$AP??(D._$AP=n$1),D._$AQ??(D._$AQ=h$1))};class f extends i$4{constructor(){super(...arguments),this._$AN=void 0}_$AT(w,O,F){super._$AT(w,O,F),r(this),this.isConnected=w._$AU}_$AO(w,O=!0){var F,q;w!==this.isConnected&&(this.isConnected=w,w?(F=this.reconnected)==null||F.call(this):(q=this.disconnected)==null||q.call(this)),O&&(s(this,w),o$1(this))}setValue(w){if(f$1(this._$Ct))this._$Ct._$AI(w,this);else{const O=[...this._$Ct._$AH];O[this._$Ci]=w,this._$Ct._$AI(O,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const e=()=>new h;class h{}const o=new WeakMap,n=e$3(class extends f{render(D){return E}update(D,[w]){var F;const O=w!==this.Y;return O&&this.Y!==void 0&&this.rt(void 0),(O||this.lt!==this.ct)&&(this.Y=w,this.ht=(F=D.options)==null?void 0:F.host,this.rt(this.ct=D.element)),E}rt(D){if(this.isConnected||(D=void 0),typeof this.Y=="function"){const w=this.ht??globalThis;let O=o.get(w);O===void 0&&(O=new WeakMap,o.set(w,O)),O.get(this.Y)!==void 0&&this.Y.call(this.ht,void 0),O.set(this.Y,D),D!==void 0&&this.Y.call(this.ht,D)}else this.Y.value=D}get lt(){var D,w;return typeof this.Y=="function"?(D=o.get(this.ht??globalThis))==null?void 0:D.get(this.Y):(w=this.Y)==null?void 0:w.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var SubmenuController=class{constructor(D,w){this.popupRef=e(),this.enableSubmenuTimer=-1,this.isConnected=!1,this.isPopupConnected=!1,this.skidding=0,this.submenuOpenDelay=100,this.handleMouseMove=O=>{this.host.style.setProperty("--safe-triangle-cursor-x",`${O.clientX}px`),this.host.style.setProperty("--safe-triangle-cursor-y",`${O.clientY}px`)},this.handleMouseOver=()=>{this.hasSlotController.test("submenu")&&this.enableSubmenu()},this.handleKeyDown=O=>{switch(O.key){case"Escape":case"Tab":this.disableSubmenu();break;case"ArrowLeft":O.target!==this.host&&(O.preventDefault(),O.stopPropagation(),this.host.focus(),this.disableSubmenu());break;case"ArrowRight":case"Enter":case" ":this.handleSubmenuEntry(O);break}},this.handleClick=O=>{var F;O.target===this.host?(O.preventDefault(),O.stopPropagation()):O.target instanceof Element&&(O.target.tagName==="sl-menu-item"||(F=O.target.role)!=null&&F.startsWith("menuitem"))&&this.disableSubmenu()},this.handleFocusOut=O=>{O.relatedTarget&&O.relatedTarget instanceof Element&&this.host.contains(O.relatedTarget)||this.disableSubmenu()},this.handlePopupMouseover=O=>{O.stopPropagation()},this.handlePopupReposition=()=>{const O=this.host.renderRoot.querySelector("slot[name='submenu']"),F=O==null?void 0:O.assignedElements({flatten:!0}).filter(Y=>Y.localName==="sl-menu")[0],q=getComputedStyle(this.host).direction==="rtl";if(!F)return;const{left:W,top:U,width:K,height:G}=F.getBoundingClientRect();this.host.style.setProperty("--safe-triangle-submenu-start-x",`${q?W+K:W}px`),this.host.style.setProperty("--safe-triangle-submenu-start-y",`${U}px`),this.host.style.setProperty("--safe-triangle-submenu-end-x",`${q?W+K:W}px`),this.host.style.setProperty("--safe-triangle-submenu-end-y",`${U+G}px`)},(this.host=D).addController(this),this.hasSlotController=w}hostConnected(){this.hasSlotController.test("submenu")&&!this.host.disabled&&this.addListeners()}hostDisconnected(){this.removeListeners()}hostUpdated(){this.hasSlotController.test("submenu")&&!this.host.disabled?(this.addListeners(),this.updateSkidding()):this.removeListeners()}addListeners(){this.isConnected||(this.host.addEventListener("mousemove",this.handleMouseMove),this.host.addEventListener("mouseover",this.handleMouseOver),this.host.addEventListener("keydown",this.handleKeyDown),this.host.addEventListener("click",this.handleClick),this.host.addEventListener("focusout",this.handleFocusOut),this.isConnected=!0),this.isPopupConnected||this.popupRef.value&&(this.popupRef.value.addEventListener("mouseover",this.handlePopupMouseover),this.popupRef.value.addEventListener("sl-reposition",this.handlePopupReposition),this.isPopupConnected=!0)}removeListeners(){this.isConnected&&(this.host.removeEventListener("mousemove",this.handleMouseMove),this.host.removeEventListener("mouseover",this.handleMouseOver),this.host.removeEventListener("keydown",this.handleKeyDown),this.host.removeEventListener("click",this.handleClick),this.host.removeEventListener("focusout",this.handleFocusOut),this.isConnected=!1),this.isPopupConnected&&this.popupRef.value&&(this.popupRef.value.removeEventListener("mouseover",this.handlePopupMouseover),this.popupRef.value.removeEventListener("sl-reposition",this.handlePopupReposition),this.isPopupConnected=!1)}handleSubmenuEntry(D){const w=this.host.renderRoot.querySelector("slot[name='submenu']");if(!w){console.error("Cannot activate a submenu if no corresponding menuitem can be found.",this);return}let O=null;for(const F of w.assignedElements())if(O=F.querySelectorAll("sl-menu-item, [role^='menuitem']"),O.length!==0)break;if(!(!O||O.length===0)){O[0].setAttribute("tabindex","0");for(let F=1;F!==O.length;++F)O[F].setAttribute("tabindex","-1");this.popupRef.value&&(D.preventDefault(),D.stopPropagation(),this.popupRef.value.active?O[0]instanceof HTMLElement&&O[0].focus():(this.enableSubmenu(!1),this.host.updateComplete.then(()=>{O[0]instanceof HTMLElement&&O[0].focus()}),this.host.requestUpdate()))}}setSubmenuState(D){this.popupRef.value&&this.popupRef.value.active!==D&&(this.popupRef.value.active=D,this.host.requestUpdate())}enableSubmenu(D=!0){D?(window.clearTimeout(this.enableSubmenuTimer),this.enableSubmenuTimer=window.setTimeout(()=>{this.setSubmenuState(!0)},this.submenuOpenDelay)):this.setSubmenuState(!0)}disableSubmenu(){window.clearTimeout(this.enableSubmenuTimer),this.setSubmenuState(!1)}updateSkidding(){var D;if(!((D=this.host.parentElement)!=null&&D.computedStyleMap))return;const w=this.host.parentElement.computedStyleMap(),F=["padding-top","border-top-width","margin-top"].reduce((q,W)=>{var U;const K=(U=w.get(W))!=null?U:new CSSUnitValue(0,"px"),Y=(K instanceof CSSUnitValue?K:new CSSUnitValue(0,"px")).to("px");return q-Y.value},0);this.skidding=F}isExpanded(){return this.popupRef.value?this.popupRef.value.active:!1}renderSubmenu(){const D=getComputedStyle(this.host).direction==="rtl";return this.isConnected?x`
      <sl-popup
        ${n(this.popupRef)}
        placement=${D?"left-start":"right-start"}
        anchor="anchor"
        flip
        flip-fallback-strategy="best-fit"
        skidding="${this.skidding}"
        strategy="fixed"
        auto-size="vertical"
        auto-size-padding="10"
      >
        <slot name="submenu"></slot>
      </sl-popup>
    `:x` <slot name="submenu" hidden></slot> `}},SlMenuItem=class extends ShoelaceElement{constructor(){super(...arguments),this.localize=new LocalizeController(this),this.type="normal",this.checked=!1,this.value="",this.loading=!1,this.disabled=!1,this.hasSlotController=new HasSlotController(this,"submenu"),this.submenuController=new SubmenuController(this,this.hasSlotController),this.handleHostClick=D=>{this.disabled&&(D.preventDefault(),D.stopImmediatePropagation())},this.handleMouseOver=D=>{this.focus(),D.stopPropagation()}}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.handleHostClick),this.addEventListener("mouseover",this.handleMouseOver)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.handleHostClick),this.removeEventListener("mouseover",this.handleMouseOver)}handleDefaultSlotChange(){const D=this.getTextLabel();if(typeof this.cachedTextLabel>"u"){this.cachedTextLabel=D;return}D!==this.cachedTextLabel&&(this.cachedTextLabel=D,this.emit("slotchange",{bubbles:!0,composed:!1,cancelable:!1}))}handleCheckedChange(){if(this.checked&&this.type!=="checkbox"){this.checked=!1,console.error('The checked attribute can only be used on menu items with type="checkbox"',this);return}this.type==="checkbox"?this.setAttribute("aria-checked",this.checked?"true":"false"):this.removeAttribute("aria-checked")}handleDisabledChange(){this.setAttribute("aria-disabled",this.disabled?"true":"false")}handleTypeChange(){this.type==="checkbox"?(this.setAttribute("role","menuitemcheckbox"),this.setAttribute("aria-checked",this.checked?"true":"false")):(this.setAttribute("role","menuitem"),this.removeAttribute("aria-checked"))}getTextLabel(){return getTextContent(this.defaultSlot)}isSubmenu(){return this.hasSlotController.test("submenu")}render(){const D=this.localize.dir()==="rtl",w=this.submenuController.isExpanded();return x`
      <div
        id="anchor"
        part="base"
        class=${e$2({"menu-item":!0,"menu-item--rtl":D,"menu-item--checked":this.checked,"menu-item--disabled":this.disabled,"menu-item--loading":this.loading,"menu-item--has-submenu":this.isSubmenu(),"menu-item--submenu-expanded":w})}
        ?aria-haspopup="${this.isSubmenu()}"
        ?aria-expanded="${!!w}"
      >
        <span part="checked-icon" class="menu-item__check">
          <sl-icon name="check" library="system" aria-hidden="true"></sl-icon>
        </span>

        <slot name="prefix" part="prefix" class="menu-item__prefix"></slot>

        <slot part="label" class="menu-item__label" @slotchange=${this.handleDefaultSlotChange}></slot>

        <slot name="suffix" part="suffix" class="menu-item__suffix"></slot>

        <span part="submenu-icon" class="menu-item__chevron">
          <sl-icon name=${D?"chevron-left":"chevron-right"} library="system" aria-hidden="true"></sl-icon>
        </span>

        ${this.submenuController.renderSubmenu()}
        ${this.loading?x` <sl-spinner part="spinner" exportparts="base:spinner__base"></sl-spinner> `:""}
      </div>
    `}};SlMenuItem.styles=[component_styles_default,menu_item_styles_default];SlMenuItem.dependencies={"sl-icon":SlIcon,"sl-popup":SlPopup,"sl-spinner":SlSpinner};__decorateClass$3([e$5("slot:not([name])")],SlMenuItem.prototype,"defaultSlot",2);__decorateClass$3([e$5(".menu-item")],SlMenuItem.prototype,"menuItem",2);__decorateClass$3([n$3()],SlMenuItem.prototype,"type",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlMenuItem.prototype,"checked",2);__decorateClass$3([n$3()],SlMenuItem.prototype,"value",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlMenuItem.prototype,"loading",2);__decorateClass$3([n$3({type:Boolean,reflect:!0})],SlMenuItem.prototype,"disabled",2);__decorateClass$3([watch("checked")],SlMenuItem.prototype,"handleCheckedChange",1);__decorateClass$3([watch("disabled")],SlMenuItem.prototype,"handleDisabledChange",1);__decorateClass$3([watch("type")],SlMenuItem.prototype,"handleTypeChange",1);SlMenuItem.define("sl-menu-item");const Te=class Te extends r$4{constructor(){super(),this.closureResult="",this.identityResult="",this.associativityResult="",this.inverseResult=""}checkClosure(){const w=this.renderRoot.querySelector("#closure-a"),O=this.renderRoot.querySelector("#closure-b");if(!w||!O){this.closureResult="Input elements not found.";return}const F=parseInt(w.value,10),q=parseInt(O.value,10);if(isNaN(F)||isNaN(q)){this.closureResult="Please enter valid integers for a and b.";return}const W=F+q;this.closureResult=`Result: ${F} + ${q} = ${W}. Closure holds because the sum is an integer.`}checkIdentity(){const w=this.renderRoot.querySelector("#identity-a");if(!w){this.identityResult="Input element not found.";return}const O=parseInt(w.value,10);if(isNaN(O)){this.identityResult="Please enter a valid integer for a.";return}const F=O+0;this.identityResult=`Result: ${O} + 0 = ${F}. The identity element is 0.`}checkAssociativity(){const w=this.renderRoot.querySelector("#assoc-a"),O=this.renderRoot.querySelector("#assoc-b"),F=this.renderRoot.querySelector("#assoc-c");if(!w||!O||!F){this.associativityResult="Input elements not found.";return}const q=parseInt(w.value,10),W=parseInt(O.value,10),U=parseInt(F.value,10);if(isNaN(q)||isNaN(W)||isNaN(U)){this.associativityResult="Please enter valid integers for a, b, and c.";return}const K=q+W+U,G=q+(W+U);let Y=`Result: (${q} + ${W}) + ${U} = ${K} and ${q} + (${W} + ${U}) = ${G}. `;Y+=K===G?"Associativity holds.":"Associativity does not hold!",this.associativityResult=Y}checkInverse(){const w=this.renderRoot.querySelector("#inverse-a");if(!w){this.inverseResult="Input element not found.";return}const O=parseInt(w.value,10);if(isNaN(O)){this.inverseResult="Please enter a valid integer for a.";return}const F=-O,q=O+F;this.inverseResult=`Result: ${O} + (${F}) = ${q}. Every integer has an inverse such that a + (-a) = 0.`}render(){return x`
      <!-- Closure Section -->
      <section id="closure">
        <h3>Closure</h3>
        <div class="row">
          <div>
            <label for="closure-a">a:</label>
            <input id="closure-a" type="number" data-test-id="closure-a-input" />
            <label for="closure-b">b:</label>
            <input id="closure-b" type="number" data-test-id="closure-b-input" />
          </div>
          <sl-button
            id="check-closure"
            data-test-id="check-closure-button"
            aria-label="Check Closure"
            variant="primary"
            @click=${this.checkClosure}
          >
            Check Closure
          </sl-button>
        </div>
        <div class="result" data-test-id="closure-result">
          ${this.closureResult}
        </div>
      </section>

      <!-- Identity Section -->
      <section id="identity">
        <h3>Identity</h3>
        <div class="row">
          <div>
            <label for="identity-a">a:</label>
            <input id="identity-a" type="number" data-test-id="identity-a-input" />
          </div>
          <sl-button
            id="check-identity"
            data-test-id="check-identity-button"
            aria-label="Check Identity"
            variant="primary"
            @click=${this.checkIdentity}
          >
            Check Identity
          </sl-button>
        </div>
        <div class="result" data-test-id="identity-result">
          ${this.identityResult}
        </div>
      </section>

      <!-- Associativity Section -->
      <section id="associativity">
        <h3>Associativity</h3>
        <div class="row">
          <div>
            <label for="assoc-a">a:</label>
            <input id="assoc-a" type="number" data-test-id="assoc-a-input" />
            <label for="assoc-b">b:</label>
            <input id="assoc-b" type="number" data-test-id="assoc-b-input" />
            <label for="assoc-c">c:</label>
            <input id="assoc-c" type="number" data-test-id="assoc-c-input" />
          </div>
          <sl-button
            id="check-associativity"
            data-test-id="check-associativity-button"
            aria-label="Check Associativity"
            variant="primary"
            @click=${this.checkAssociativity}
          >
            Check Associativity
          </sl-button>
        </div>
        <div class="result" data-test-id="associativity-result">
          ${this.associativityResult}
        </div>
      </section>

      <!-- Inverse Section -->
      <section id="inverse">
        <h3>Inverse</h3>
        <div class="row">
          <div>
            <label for="inverse-a">a:</label>
            <input id="inverse-a" type="number" data-test-id="inverse-a-input" />
          </div>
          <sl-button
            id="check-inverse"
            data-test-id="check-inverse-button"
            aria-label="Check Inverse"
            variant="primary"
            @click=${this.checkInverse}
          >
            Check Inverse
          </sl-button>
        </div>
        <div class="result" data-test-id="inverse-result">
          ${this.inverseResult}
        </div>
      </section>
    `}};Te.properties={closureResult:{type:String},identityResult:{type:String},associativityResult:{type:String},inverseResult:{type:String}},Te.styles=i$8`
    :host {
      display: block;
      font-family: Arial, sans-serif;
      background-color: #eef;
      padding: 20px;
    }
    section {
      margin-bottom: 20px;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
      background-color: #fff;
    }
    h3 {
      margin-top: 0;
    }
    label {
      margin-right: 5px;
    }
    input {
      margin: 5px;
      padding: 5px;
      width: 60px;
    }
    .result {
      margin-top: 10px;
      font-weight: bold;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
  `;let ZGroupDemo=Te;customElements.define("z-group-demo",ZGroupDemo);let rangeFrom=[],rangeTo=[];(()=>{let D="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(w=>w?parseInt(w,36):1);for(let w=0,O=0;w<D.length;w++)(w%2?rangeTo:rangeFrom).push(O=O+D[w])})();function isExtendingChar(D){if(D<768)return!1;for(let w=0,O=rangeFrom.length;;){let F=w+O>>1;if(D<rangeFrom[F])O=F;else if(D>=rangeTo[F])w=F+1;else return!0;if(w==O)return!1}}function isRegionalIndicator(D){return D>=127462&&D<=127487}const ZWJ=8205;function findClusterBreak$1(D,w,O=!0,F=!0){return(O?nextClusterBreak:prevClusterBreak)(D,w,F)}function nextClusterBreak(D,w,O){if(w==D.length)return w;w&&surrogateLow$1(D.charCodeAt(w))&&surrogateHigh$1(D.charCodeAt(w-1))&&w--;let F=codePointAt$1(D,w);for(w+=codePointSize$1(F);w<D.length;){let q=codePointAt$1(D,w);if(F==ZWJ||q==ZWJ||O&&isExtendingChar(q))w+=codePointSize$1(q),F=q;else if(isRegionalIndicator(q)){let W=0,U=w-2;for(;U>=0&&isRegionalIndicator(codePointAt$1(D,U));)W++,U-=2;if(W%2==0)break;w+=2}else break}return w}function prevClusterBreak(D,w,O){for(;w>0;){let F=nextClusterBreak(D,w-2,O);if(F<w)return F;w--}return 0}function codePointAt$1(D,w){let O=D.charCodeAt(w);if(!surrogateHigh$1(O)||w+1==D.length)return O;let F=D.charCodeAt(w+1);return surrogateLow$1(F)?(O-55296<<10)+(F-56320)+65536:O}function surrogateLow$1(D){return D>=56320&&D<57344}function surrogateHigh$1(D){return D>=55296&&D<56320}function codePointSize$1(D){return D<65536?1:2}class Text{lineAt(w){if(w<0||w>this.length)throw new RangeError(`Invalid position ${w} in document of length ${this.length}`);return this.lineInner(w,!1,1,0)}line(w){if(w<1||w>this.lines)throw new RangeError(`Invalid line number ${w} in ${this.lines}-line document`);return this.lineInner(w,!0,1,0)}replace(w,O,F){[w,O]=clip(this,w,O);let q=[];return this.decompose(0,w,q,2),F.length&&F.decompose(0,F.length,q,3),this.decompose(O,this.length,q,1),TextNode.from(q,this.length-(O-w)+F.length)}append(w){return this.replace(this.length,this.length,w)}slice(w,O=this.length){[w,O]=clip(this,w,O);let F=[];return this.decompose(w,O,F,0),TextNode.from(F,O-w)}eq(w){if(w==this)return!0;if(w.length!=this.length||w.lines!=this.lines)return!1;let O=this.scanIdentical(w,1),F=this.length-this.scanIdentical(w,-1),q=new RawTextCursor(this),W=new RawTextCursor(w);for(let U=O,K=O;;){if(q.next(U),W.next(U),U=0,q.lineBreak!=W.lineBreak||q.done!=W.done||q.value!=W.value)return!1;if(K+=q.value.length,q.done||K>=F)return!0}}iter(w=1){return new RawTextCursor(this,w)}iterRange(w,O=this.length){return new PartialTextCursor(this,w,O)}iterLines(w,O){let F;if(w==null)F=this.iter();else{O==null&&(O=this.lines+1);let q=this.line(w).from;F=this.iterRange(q,Math.max(q,O==this.lines+1?this.length:O<=1?0:this.line(O-1).to))}return new LineCursor(F)}toString(){return this.sliceString(0)}toJSON(){let w=[];return this.flatten(w),w}constructor(){}static of(w){if(w.length==0)throw new RangeError("A document must have at least one line");return w.length==1&&!w[0]?Text.empty:w.length<=32?new TextLeaf(w):TextNode.from(TextLeaf.split(w,[]))}}class TextLeaf extends Text{constructor(w,O=textLength(w)){super(),this.text=w,this.length=O}get lines(){return this.text.length}get children(){return null}lineInner(w,O,F,q){for(let W=0;;W++){let U=this.text[W],K=q+U.length;if((O?F:K)>=w)return new Line(q,K,F,U);q=K+1,F++}}decompose(w,O,F,q){let W=w<=0&&O>=this.length?this:new TextLeaf(sliceText(this.text,w,O),Math.min(O,this.length)-Math.max(0,w));if(q&1){let U=F.pop(),K=appendText(W.text,U.text.slice(),0,W.length);if(K.length<=32)F.push(new TextLeaf(K,U.length+W.length));else{let G=K.length>>1;F.push(new TextLeaf(K.slice(0,G)),new TextLeaf(K.slice(G)))}}else F.push(W)}replace(w,O,F){if(!(F instanceof TextLeaf))return super.replace(w,O,F);[w,O]=clip(this,w,O);let q=appendText(this.text,appendText(F.text,sliceText(this.text,0,w)),O),W=this.length+F.length-(O-w);return q.length<=32?new TextLeaf(q,W):TextNode.from(TextLeaf.split(q,[]),W)}sliceString(w,O=this.length,F=`
`){[w,O]=clip(this,w,O);let q="";for(let W=0,U=0;W<=O&&U<this.text.length;U++){let K=this.text[U],G=W+K.length;W>w&&U&&(q+=F),w<G&&O>W&&(q+=K.slice(Math.max(0,w-W),O-W)),W=G+1}return q}flatten(w){for(let O of this.text)w.push(O)}scanIdentical(){return 0}static split(w,O){let F=[],q=-1;for(let W of w)F.push(W),q+=W.length+1,F.length==32&&(O.push(new TextLeaf(F,q)),F=[],q=-1);return q>-1&&O.push(new TextLeaf(F,q)),O}}class TextNode extends Text{constructor(w,O){super(),this.children=w,this.length=O,this.lines=0;for(let F of w)this.lines+=F.lines}lineInner(w,O,F,q){for(let W=0;;W++){let U=this.children[W],K=q+U.length,G=F+U.lines-1;if((O?G:K)>=w)return U.lineInner(w,O,F,q);q=K+1,F=G+1}}decompose(w,O,F,q){for(let W=0,U=0;U<=O&&W<this.children.length;W++){let K=this.children[W],G=U+K.length;if(w<=G&&O>=U){let Y=q&((U<=w?1:0)|(G>=O?2:0));U>=w&&G<=O&&!Y?F.push(K):K.decompose(w-U,O-U,F,Y)}U=G+1}}replace(w,O,F){if([w,O]=clip(this,w,O),F.lines<this.lines)for(let q=0,W=0;q<this.children.length;q++){let U=this.children[q],K=W+U.length;if(w>=W&&O<=K){let G=U.replace(w-W,O-W,F),Y=this.lines-U.lines+G.lines;if(G.lines<Y>>4&&G.lines>Y>>6){let Q=this.children.slice();return Q[q]=G,new TextNode(Q,this.length-(O-w)+F.length)}return super.replace(W,K,G)}W=K+1}return super.replace(w,O,F)}sliceString(w,O=this.length,F=`
`){[w,O]=clip(this,w,O);let q="";for(let W=0,U=0;W<this.children.length&&U<=O;W++){let K=this.children[W],G=U+K.length;U>w&&W&&(q+=F),w<G&&O>U&&(q+=K.sliceString(w-U,O-U,F)),U=G+1}return q}flatten(w){for(let O of this.children)O.flatten(w)}scanIdentical(w,O){if(!(w instanceof TextNode))return 0;let F=0,[q,W,U,K]=O>0?[0,0,this.children.length,w.children.length]:[this.children.length-1,w.children.length-1,-1,-1];for(;;q+=O,W+=O){if(q==U||W==K)return F;let G=this.children[q],Y=w.children[W];if(G!=Y)return F+G.scanIdentical(Y,O);F+=G.length+1}}static from(w,O=w.reduce((F,q)=>F+q.length+1,-1)){let F=0;for(let Z of w)F+=Z.lines;if(F<32){let Z=[];for(let ee of w)ee.flatten(Z);return new TextLeaf(Z,O)}let q=Math.max(32,F>>5),W=q<<1,U=q>>1,K=[],G=0,Y=-1,Q=[];function X(Z){let ee;if(Z.lines>W&&Z instanceof TextNode)for(let ne of Z.children)X(ne);else Z.lines>U&&(G>U||!G)?(J(),K.push(Z)):Z instanceof TextLeaf&&G&&(ee=Q[Q.length-1])instanceof TextLeaf&&Z.lines+ee.lines<=32?(G+=Z.lines,Y+=Z.length+1,Q[Q.length-1]=new TextLeaf(ee.text.concat(Z.text),ee.length+1+Z.length)):(G+Z.lines>q&&J(),G+=Z.lines,Y+=Z.length+1,Q.push(Z))}function J(){G!=0&&(K.push(Q.length==1?Q[0]:TextNode.from(Q,Y)),Y=-1,G=Q.length=0)}for(let Z of w)X(Z);return J(),K.length==1?K[0]:new TextNode(K,O)}}Text.empty=new TextLeaf([""],0);function textLength(D){let w=-1;for(let O of D)w+=O.length+1;return w}function appendText(D,w,O=0,F=1e9){for(let q=0,W=0,U=!0;W<D.length&&q<=F;W++){let K=D[W],G=q+K.length;G>=O&&(G>F&&(K=K.slice(0,F-q)),q<O&&(K=K.slice(O-q)),U?(w[w.length-1]+=K,U=!1):w.push(K)),q=G+1}return w}function sliceText(D,w,O){return appendText(D,[""],w,O)}class RawTextCursor{constructor(w,O=1){this.dir=O,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[w],this.offsets=[O>0?1:(w instanceof TextLeaf?w.text.length:w.children.length)<<1]}nextInner(w,O){for(this.done=this.lineBreak=!1;;){let F=this.nodes.length-1,q=this.nodes[F],W=this.offsets[F],U=W>>1,K=q instanceof TextLeaf?q.text.length:q.children.length;if(U==(O>0?K:0)){if(F==0)return this.done=!0,this.value="",this;O>0&&this.offsets[F-1]++,this.nodes.pop(),this.offsets.pop()}else if((W&1)==(O>0?0:1)){if(this.offsets[F]+=O,w==0)return this.lineBreak=!0,this.value=`
`,this;w--}else if(q instanceof TextLeaf){let G=q.text[U+(O<0?-1:0)];if(this.offsets[F]+=O,G.length>Math.max(0,w))return this.value=w==0?G:O>0?G.slice(w):G.slice(0,G.length-w),this;w-=G.length}else{let G=q.children[U+(O<0?-1:0)];w>G.length?(w-=G.length,this.offsets[F]+=O):(O<0&&this.offsets[F]--,this.nodes.push(G),this.offsets.push(O>0?1:(G instanceof TextLeaf?G.text.length:G.children.length)<<1))}}}next(w=0){return w<0&&(this.nextInner(-w,-this.dir),w=this.value.length),this.nextInner(w,this.dir)}}class PartialTextCursor{constructor(w,O,F){this.value="",this.done=!1,this.cursor=new RawTextCursor(w,O>F?-1:1),this.pos=O>F?w.length:0,this.from=Math.min(O,F),this.to=Math.max(O,F)}nextInner(w,O){if(O<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;w+=Math.max(0,O<0?this.pos-this.to:this.from-this.pos);let F=O<0?this.pos-this.from:this.to-this.pos;w>F&&(w=F),F-=w;let{value:q}=this.cursor.next(w);return this.pos+=(q.length+w)*O,this.value=q.length<=F?q:O<0?q.slice(q.length-F):q.slice(0,F),this.done=!this.value,this}next(w=0){return w<0?w=Math.max(w,this.from-this.pos):w>0&&(w=Math.min(w,this.to-this.pos)),this.nextInner(w,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class LineCursor{constructor(w){this.inner=w,this.afterBreak=!0,this.value="",this.done=!1}next(w=0){let{done:O,lineBreak:F,value:q}=this.inner.next(w);return O&&this.afterBreak?(this.value="",this.afterBreak=!1):O?(this.done=!0,this.value=""):F?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=q,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(w,O,F,q){this.from=w,this.to=O,this.number=F,this.text=q}get length(){return this.to-this.from}}function clip(D,w,O){return w=Math.max(0,Math.min(D.length,w)),[w,Math.max(w,Math.min(D.length,O))]}function findClusterBreak(D,w,O=!0,F=!0){return findClusterBreak$1(D,w,O,F)}function surrogateLow(D){return D>=56320&&D<57344}function surrogateHigh(D){return D>=55296&&D<56320}function codePointAt(D,w){let O=D.charCodeAt(w);if(!surrogateHigh(O)||w+1==D.length)return O;let F=D.charCodeAt(w+1);return surrogateLow(F)?(O-55296<<10)+(F-56320)+65536:O}function fromCodePoint(D){return D<=65535?String.fromCharCode(D):(D-=65536,String.fromCharCode((D>>10)+55296,(D&1023)+56320))}function codePointSize(D){return D<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(D){return D[D.Simple=0]="Simple",D[D.TrackDel=1]="TrackDel",D[D.TrackBefore=2]="TrackBefore",D[D.TrackAfter=3]="TrackAfter",D}(MapMode||(MapMode={}));class ChangeDesc{constructor(w){this.sections=w}get length(){let w=0;for(let O=0;O<this.sections.length;O+=2)w+=this.sections[O];return w}get newLength(){let w=0;for(let O=0;O<this.sections.length;O+=2){let F=this.sections[O+1];w+=F<0?this.sections[O]:F}return w}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(w){for(let O=0,F=0,q=0;O<this.sections.length;){let W=this.sections[O++],U=this.sections[O++];U<0?(w(F,q,W),q+=W):q+=U,F+=W}}iterChangedRanges(w,O=!1){iterChanges(this,w,O)}get invertedDesc(){let w=[];for(let O=0;O<this.sections.length;){let F=this.sections[O++],q=this.sections[O++];q<0?w.push(F,q):w.push(q,F)}return new ChangeDesc(w)}composeDesc(w){return this.empty?w:w.empty?this:composeSets(this,w)}mapDesc(w,O=!1){return w.empty?this:mapSet(this,w,O)}mapPos(w,O=-1,F=MapMode.Simple){let q=0,W=0;for(let U=0;U<this.sections.length;){let K=this.sections[U++],G=this.sections[U++],Y=q+K;if(G<0){if(Y>w)return W+(w-q);W+=K}else{if(F!=MapMode.Simple&&Y>=w&&(F==MapMode.TrackDel&&q<w&&Y>w||F==MapMode.TrackBefore&&q<w||F==MapMode.TrackAfter&&Y>w))return null;if(Y>w||Y==w&&O<0&&!K)return w==q||O<0?W:W+G;W+=G}q=Y}if(w>q)throw new RangeError(`Position ${w} is out of range for changeset of length ${q}`);return W}touchesRange(w,O=w){for(let F=0,q=0;F<this.sections.length&&q<=O;){let W=this.sections[F++],U=this.sections[F++],K=q+W;if(U>=0&&q<=O&&K>=w)return q<w&&K>O?"cover":!0;q=K}return!1}toString(){let w="";for(let O=0;O<this.sections.length;){let F=this.sections[O++],q=this.sections[O++];w+=(w?" ":"")+F+(q>=0?":"+q:"")}return w}toJSON(){return this.sections}static fromJSON(w){if(!Array.isArray(w)||w.length%2||w.some(O=>typeof O!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(w)}static create(w){return new ChangeDesc(w)}}class ChangeSet extends ChangeDesc{constructor(w,O){super(w),this.inserted=O}apply(w){if(this.length!=w.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,(O,F,q,W,U)=>w=w.replace(q,q+(F-O),U),!1),w}mapDesc(w,O=!1){return mapSet(this,w,O,!0)}invert(w){let O=this.sections.slice(),F=[];for(let q=0,W=0;q<O.length;q+=2){let U=O[q],K=O[q+1];if(K>=0){O[q]=K,O[q+1]=U;let G=q>>1;for(;F.length<G;)F.push(Text.empty);F.push(U?w.slice(W,W+U):Text.empty)}W+=U}return new ChangeSet(O,F)}compose(w){return this.empty?w:w.empty?this:composeSets(this,w,!0)}map(w,O=!1){return w.empty?this:mapSet(this,w,O,!0)}iterChanges(w,O=!1){iterChanges(this,w,O)}get desc(){return ChangeDesc.create(this.sections)}filter(w){let O=[],F=[],q=[],W=new SectionIter(this);e:for(let U=0,K=0;;){let G=U==w.length?1e9:w[U++];for(;K<G||K==G&&W.len==0;){if(W.done)break e;let Q=Math.min(W.len,G-K);addSection(q,Q,-1);let X=W.ins==-1?-1:W.off==0?W.ins:0;addSection(O,Q,X),X>0&&addInsert(F,O,W.text),W.forward(Q),K+=Q}let Y=w[U++];for(;K<Y;){if(W.done)break e;let Q=Math.min(W.len,Y-K);addSection(O,Q,-1),addSection(q,Q,W.ins==-1?-1:W.off==0?W.ins:0),W.forward(Q),K+=Q}}return{changes:new ChangeSet(O,F),filtered:ChangeDesc.create(q)}}toJSON(){let w=[];for(let O=0;O<this.sections.length;O+=2){let F=this.sections[O],q=this.sections[O+1];q<0?w.push(F):q==0?w.push([F]):w.push([F].concat(this.inserted[O>>1].toJSON()))}return w}static of(w,O,F){let q=[],W=[],U=0,K=null;function G(Q=!1){if(!Q&&!q.length)return;U<O&&addSection(q,O-U,-1);let X=new ChangeSet(q,W);K=K?K.compose(X.map(K)):X,q=[],W=[],U=0}function Y(Q){if(Array.isArray(Q))for(let X of Q)Y(X);else if(Q instanceof ChangeSet){if(Q.length!=O)throw new RangeError(`Mismatched change set length (got ${Q.length}, expected ${O})`);G(),K=K?K.compose(Q.map(K)):Q}else{let{from:X,to:J=X,insert:Z}=Q;if(X>J||X<0||J>O)throw new RangeError(`Invalid change range ${X} to ${J} (in doc of length ${O})`);let ee=Z?typeof Z=="string"?Text.of(Z.split(F||DefaultSplit)):Z:Text.empty,ne=ee.length;if(X==J&&ne==0)return;X<U&&G(),X>U&&addSection(q,X-U,-1),addSection(q,J-X,ne),addInsert(W,q,ee),U=J}}return Y(w),G(!K),K}static empty(w){return new ChangeSet(w?[w,-1]:[],[])}static fromJSON(w){if(!Array.isArray(w))throw new RangeError("Invalid JSON representation of ChangeSet");let O=[],F=[];for(let q=0;q<w.length;q++){let W=w[q];if(typeof W=="number")O.push(W,-1);else{if(!Array.isArray(W)||typeof W[0]!="number"||W.some((U,K)=>K&&typeof U!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(W.length==1)O.push(W[0],0);else{for(;F.length<q;)F.push(Text.empty);F[q]=Text.of(W.slice(1)),O.push(W[0],F[q].length)}}}return new ChangeSet(O,F)}static createSet(w,O){return new ChangeSet(w,O)}}function addSection(D,w,O,F=!1){if(w==0&&O<=0)return;let q=D.length-2;q>=0&&O<=0&&O==D[q+1]?D[q]+=w:q>=0&&w==0&&D[q]==0?D[q+1]+=O:F?(D[q]+=w,D[q+1]+=O):D.push(w,O)}function addInsert(D,w,O){if(O.length==0)return;let F=w.length-2>>1;if(F<D.length)D[D.length-1]=D[D.length-1].append(O);else{for(;D.length<F;)D.push(Text.empty);D.push(O)}}function iterChanges(D,w,O){let F=D.inserted;for(let q=0,W=0,U=0;U<D.sections.length;){let K=D.sections[U++],G=D.sections[U++];if(G<0)q+=K,W+=K;else{let Y=q,Q=W,X=Text.empty;for(;Y+=K,Q+=G,G&&F&&(X=X.append(F[U-2>>1])),!(O||U==D.sections.length||D.sections[U+1]<0);)K=D.sections[U++],G=D.sections[U++];w(q,Y,W,Q,X),q=Y,W=Q}}}function mapSet(D,w,O,F=!1){let q=[],W=F?[]:null,U=new SectionIter(D),K=new SectionIter(w);for(let G=-1;;){if(U.done&&K.len||K.done&&U.len)throw new Error("Mismatched change set lengths");if(U.ins==-1&&K.ins==-1){let Y=Math.min(U.len,K.len);addSection(q,Y,-1),U.forward(Y),K.forward(Y)}else if(K.ins>=0&&(U.ins<0||G==U.i||U.off==0&&(K.len<U.len||K.len==U.len&&!O))){let Y=K.len;for(addSection(q,K.ins,-1);Y;){let Q=Math.min(U.len,Y);U.ins>=0&&G<U.i&&U.len<=Q&&(addSection(q,0,U.ins),W&&addInsert(W,q,U.text),G=U.i),U.forward(Q),Y-=Q}K.next()}else if(U.ins>=0){let Y=0,Q=U.len;for(;Q;)if(K.ins==-1){let X=Math.min(Q,K.len);Y+=X,Q-=X,K.forward(X)}else if(K.ins==0&&K.len<Q)Q-=K.len,K.next();else break;addSection(q,Y,G<U.i?U.ins:0),W&&G<U.i&&addInsert(W,q,U.text),G=U.i,U.forward(U.len-Q)}else{if(U.done&&K.done)return W?ChangeSet.createSet(q,W):ChangeDesc.create(q);throw new Error("Mismatched change set lengths")}}}function composeSets(D,w,O=!1){let F=[],q=O?[]:null,W=new SectionIter(D),U=new SectionIter(w);for(let K=!1;;){if(W.done&&U.done)return q?ChangeSet.createSet(F,q):ChangeDesc.create(F);if(W.ins==0)addSection(F,W.len,0,K),W.next();else if(U.len==0&&!U.done)addSection(F,0,U.ins,K),q&&addInsert(q,F,U.text),U.next();else{if(W.done||U.done)throw new Error("Mismatched change set lengths");{let G=Math.min(W.len2,U.len),Y=F.length;if(W.ins==-1){let Q=U.ins==-1?-1:U.off?0:U.ins;addSection(F,G,Q,K),q&&Q&&addInsert(q,F,U.text)}else U.ins==-1?(addSection(F,W.off?0:W.len,G,K),q&&addInsert(q,F,W.textBit(G))):(addSection(F,W.off?0:W.len,U.off?0:U.ins,K),q&&!U.off&&addInsert(q,F,U.text));K=(W.ins>G||U.ins>=0&&U.len>G)&&(K||F.length>Y),W.forward2(G),U.forward(G)}}}}class SectionIter{constructor(w){this.set=w,this.i=0,this.next()}next(){let{sections:w}=this.set;this.i<w.length?(this.len=w[this.i++],this.ins=w[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:w}=this.set,O=this.i-2>>1;return O>=w.length?Text.empty:w[O]}textBit(w){let{inserted:O}=this.set,F=this.i-2>>1;return F>=O.length&&!w?Text.empty:O[F].slice(this.off,w==null?void 0:this.off+w)}forward(w){w==this.len?this.next():(this.len-=w,this.off+=w)}forward2(w){this.ins==-1?this.forward(w):w==this.ins?this.next():(this.ins-=w,this.off+=w)}}class SelectionRange{constructor(w,O,F){this.from=w,this.to=O,this.flags=F}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let w=this.flags&7;return w==7?null:w}get goalColumn(){let w=this.flags>>6;return w==16777215?void 0:w}map(w,O=-1){let F,q;return this.empty?F=q=w.mapPos(this.from,O):(F=w.mapPos(this.from,1),q=w.mapPos(this.to,-1)),F==this.from&&q==this.to?this:new SelectionRange(F,q,this.flags)}extend(w,O=w){if(w<=this.anchor&&O>=this.anchor)return EditorSelection.range(w,O);let F=Math.abs(w-this.anchor)>Math.abs(O-this.anchor)?w:O;return EditorSelection.range(this.anchor,F)}eq(w,O=!1){return this.anchor==w.anchor&&this.head==w.head&&(!O||!this.empty||this.assoc==w.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(w){if(!w||typeof w.anchor!="number"||typeof w.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(w.anchor,w.head)}static create(w,O,F){return new SelectionRange(w,O,F)}}class EditorSelection{constructor(w,O){this.ranges=w,this.mainIndex=O}map(w,O=-1){return w.empty?this:EditorSelection.create(this.ranges.map(F=>F.map(w,O)),this.mainIndex)}eq(w,O=!1){if(this.ranges.length!=w.ranges.length||this.mainIndex!=w.mainIndex)return!1;for(let F=0;F<this.ranges.length;F++)if(!this.ranges[F].eq(w.ranges[F],O))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new EditorSelection([this.main],0)}addRange(w,O=!0){return EditorSelection.create([w].concat(this.ranges),O?0:this.mainIndex+1)}replaceRange(w,O=this.mainIndex){let F=this.ranges.slice();return F[O]=w,EditorSelection.create(F,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(w=>w.toJSON()),main:this.mainIndex}}static fromJSON(w){if(!w||!Array.isArray(w.ranges)||typeof w.main!="number"||w.main>=w.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(w.ranges.map(O=>SelectionRange.fromJSON(O)),w.main)}static single(w,O=w){return new EditorSelection([EditorSelection.range(w,O)],0)}static create(w,O=0){if(w.length==0)throw new RangeError("A selection needs at least one range");for(let F=0,q=0;q<w.length;q++){let W=w[q];if(W.empty?W.from<=F:W.from<F)return EditorSelection.normalized(w.slice(),O);F=W.to}return new EditorSelection(w,O)}static cursor(w,O=0,F,q){return SelectionRange.create(w,w,(O==0?0:O<0?8:16)|(F==null?7:Math.min(6,F))|(q??16777215)<<6)}static range(w,O,F,q){let W=(F??16777215)<<6|(q==null?7:Math.min(6,q));return O<w?SelectionRange.create(O,w,48|W):SelectionRange.create(w,O,(O>w?8:0)|W)}static normalized(w,O=0){let F=w[O];w.sort((q,W)=>q.from-W.from),O=w.indexOf(F);for(let q=1;q<w.length;q++){let W=w[q],U=w[q-1];if(W.empty?W.from<=U.to:W.from<U.to){let K=U.from,G=Math.max(W.to,U.to);q<=O&&O--,w.splice(--q,2,W.anchor>W.head?EditorSelection.range(G,K):EditorSelection.range(K,G))}}return new EditorSelection(w,O)}}function checkSelection(D,w){for(let O of D.ranges)if(O.to>w)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(w,O,F,q,W){this.combine=w,this.compareInput=O,this.compare=F,this.isStatic=q,this.id=nextID++,this.default=w([]),this.extensions=typeof W=="function"?W(this):W}get reader(){return this}static define(w={}){return new Facet(w.combine||(O=>O),w.compareInput||((O,F)=>O===F),w.compare||(w.combine?(O,F)=>O===F:sameArray$1),!!w.static,w.enables)}of(w){return new FacetProvider([],this,0,w)}compute(w,O){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(w,this,1,O)}computeN(w,O){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(w,this,2,O)}from(w,O){return O||(O=F=>F),this.compute([w],F=>O(F.field(w)))}}function sameArray$1(D,w){return D==w||D.length==w.length&&D.every((O,F)=>O===w[F])}class FacetProvider{constructor(w,O,F,q){this.dependencies=w,this.facet=O,this.type=F,this.value=q,this.id=nextID++}dynamicSlot(w){var O;let F=this.value,q=this.facet.compareInput,W=this.id,U=w[W]>>1,K=this.type==2,G=!1,Y=!1,Q=[];for(let X of this.dependencies)X=="doc"?G=!0:X=="selection"?Y=!0:((O=w[X.id])!==null&&O!==void 0?O:1)&1||Q.push(w[X.id]);return{create(X){return X.values[U]=F(X),1},update(X,J){if(G&&J.docChanged||Y&&(J.docChanged||J.selection)||ensureAll(X,Q)){let Z=F(X);if(K?!compareArray(Z,X.values[U],q):!q(Z,X.values[U]))return X.values[U]=Z,1}return 0},reconfigure:(X,J)=>{let Z,ee=J.config.address[W];if(ee!=null){let ne=getAddr(J,ee);if(this.dependencies.every(te=>te instanceof Facet?J.facet(te)===X.facet(te):te instanceof StateField?J.field(te,!1)==X.field(te,!1):!0)||(K?compareArray(Z=F(X),ne,q):q(Z=F(X),ne)))return X.values[U]=ne,0}else Z=F(X);return X.values[U]=Z,1}}}}function compareArray(D,w,O){if(D.length!=w.length)return!1;for(let F=0;F<D.length;F++)if(!O(D[F],w[F]))return!1;return!0}function ensureAll(D,w){let O=!1;for(let F of w)ensureAddr(D,F)&1&&(O=!0);return O}function dynamicFacetSlot(D,w,O){let F=O.map(G=>D[G.id]),q=O.map(G=>G.type),W=F.filter(G=>!(G&1)),U=D[w.id]>>1;function K(G){let Y=[];for(let Q=0;Q<F.length;Q++){let X=getAddr(G,F[Q]);if(q[Q]==2)for(let J of X)Y.push(J);else Y.push(X)}return w.combine(Y)}return{create(G){for(let Y of F)ensureAddr(G,Y);return G.values[U]=K(G),1},update(G,Y){if(!ensureAll(G,W))return 0;let Q=K(G);return w.compare(Q,G.values[U])?0:(G.values[U]=Q,1)},reconfigure(G,Y){let Q=ensureAll(G,F),X=Y.config.facets[w.id],J=Y.facet(w);if(X&&!Q&&sameArray$1(O,X))return G.values[U]=J,0;let Z=K(G);return w.compare(Z,J)?(G.values[U]=J,0):(G.values[U]=Z,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(w,O,F,q,W){this.id=w,this.createF=O,this.updateF=F,this.compareF=q,this.spec=W,this.provides=void 0}static define(w){let O=new StateField(nextID++,w.create,w.update,w.compare||((F,q)=>F===q),w);return w.provide&&(O.provides=w.provide(O)),O}create(w){let O=w.facet(initField).find(F=>F.field==this);return((O==null?void 0:O.create)||this.createF)(w)}slot(w){let O=w[this.id]>>1;return{create:F=>(F.values[O]=this.create(F),1),update:(F,q)=>{let W=F.values[O],U=this.updateF(W,q);return this.compareF(W,U)?0:(F.values[O]=U,1)},reconfigure:(F,q)=>{let W=F.facet(initField),U=q.facet(initField),K;return(K=W.find(G=>G.field==this))&&K!=U.find(G=>G.field==this)?(F.values[O]=K.create(F),1):q.config.address[this.id]!=null?(F.values[O]=q.field(this),0):(F.values[O]=this.create(F),1)}}}init(w){return[this,initField.of({field:this,create:w})]}get extension(){return this}}const Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(D){return w=>new PrecExtension(w,D)}const Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),default:prec(Prec_.default),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};class PrecExtension{constructor(w,O){this.inner=w,this.prec=O}}class Compartment{of(w){return new CompartmentInstance(this,w)}reconfigure(w){return Compartment.reconfigure.of({compartment:this,extension:w})}get(w){return w.config.compartments.get(this)}}class CompartmentInstance{constructor(w,O){this.compartment=w,this.inner=O}}class Configuration{constructor(w,O,F,q,W,U){for(this.base=w,this.compartments=O,this.dynamicSlots=F,this.address=q,this.staticValues=W,this.facets=U,this.statusTemplate=[];this.statusTemplate.length<F.length;)this.statusTemplate.push(0)}staticFacet(w){let O=this.address[w.id];return O==null?w.default:this.staticValues[O>>1]}static resolve(w,O,F){let q=[],W=Object.create(null),U=new Map;for(let J of flatten(w,O,U))J instanceof StateField?q.push(J):(W[J.facet.id]||(W[J.facet.id]=[])).push(J);let K=Object.create(null),G=[],Y=[];for(let J of q)K[J.id]=Y.length<<1,Y.push(Z=>J.slot(Z));let Q=F==null?void 0:F.config.facets;for(let J in W){let Z=W[J],ee=Z[0].facet,ne=Q&&Q[J]||[];if(Z.every(te=>te.type==0))if(K[ee.id]=G.length<<1|1,sameArray$1(ne,Z))G.push(F.facet(ee));else{let te=ee.combine(Z.map(re=>re.value));G.push(F&&ee.compare(te,F.facet(ee))?F.facet(ee):te)}else{for(let te of Z)te.type==0?(K[te.id]=G.length<<1|1,G.push(te.value)):(K[te.id]=Y.length<<1,Y.push(re=>te.dynamicSlot(re)));K[ee.id]=Y.length<<1,Y.push(te=>dynamicFacetSlot(te,ee,Z))}}let X=Y.map(J=>J(K));return new Configuration(w,U,X,K,G,W)}}function flatten(D,w,O){let F=[[],[],[],[],[]],q=new Map;function W(U,K){let G=q.get(U);if(G!=null){if(G<=K)return;let Y=F[G].indexOf(U);Y>-1&&F[G].splice(Y,1),U instanceof CompartmentInstance&&O.delete(U.compartment)}if(q.set(U,K),Array.isArray(U))for(let Y of U)W(Y,K);else if(U instanceof CompartmentInstance){if(O.has(U.compartment))throw new RangeError("Duplicate use of compartment in extensions");let Y=w.get(U.compartment)||U.inner;O.set(U.compartment,Y),W(Y,K)}else if(U instanceof PrecExtension)W(U.inner,U.prec);else if(U instanceof StateField)F[K].push(U),U.provides&&W(U.provides,K);else if(U instanceof FacetProvider)F[K].push(U),U.facet.extensions&&W(U.facet.extensions,Prec_.default);else{let Y=U.extension;if(!Y)throw new Error(`Unrecognized extension value in extension set (${U}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);W(Y,K)}}return W(D,Prec_.default),F.reduce((U,K)=>U.concat(K))}function ensureAddr(D,w){if(w&1)return 2;let O=w>>1,F=D.status[O];if(F==4)throw new Error("Cyclic dependency between fields and/or facets");if(F&2)return F;D.status[O]=4;let q=D.computeSlot(D,D.config.dynamicSlots[O]);return D.status[O]=2|q}function getAddr(D,w){return w&1?D.config.staticValues[w>>1]:D.values[w>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:D=>D.some(w=>w),static:!0}),lineSeparator=Facet.define({combine:D=>D.length?D[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:D=>D.length?D[0]:!1});class Annotation{constructor(w,O){this.type=w,this.value=O}static define(){return new AnnotationType}}class AnnotationType{of(w){return new Annotation(this,w)}}class StateEffectType{constructor(w){this.map=w}of(w){return new StateEffect(this,w)}}class StateEffect{constructor(w,O){this.type=w,this.value=O}map(w){let O=this.type.map(this.value,w);return O===void 0?void 0:O==this.value?this:new StateEffect(this.type,O)}is(w){return this.type==w}static define(w={}){return new StateEffectType(w.map||(O=>O))}static mapEffects(w,O){if(!w.length)return w;let F=[];for(let q of w){let W=q.map(O);W&&F.push(W)}return F}}StateEffect.reconfigure=StateEffect.define();StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(w,O,F,q,W,U){this.startState=w,this.changes=O,this.selection=F,this.effects=q,this.annotations=W,this.scrollIntoView=U,this._doc=null,this._state=null,F&&checkSelection(F,O.newLength),W.some(K=>K.type==Transaction.time)||(this.annotations=W.concat(Transaction.time.of(Date.now())))}static create(w,O,F,q,W,U){return new Transaction(w,O,F,q,W,U)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(w){for(let O of this.annotations)if(O.type==w)return O.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(w){let O=this.annotation(Transaction.userEvent);return!!(O&&(O==w||O.length>w.length&&O.slice(0,w.length)==w&&O[w.length]=="."))}}Transaction.time=Annotation.define();Transaction.userEvent=Annotation.define();Transaction.addToHistory=Annotation.define();Transaction.remote=Annotation.define();function joinRanges(D,w){let O=[];for(let F=0,q=0;;){let W,U;if(F<D.length&&(q==w.length||w[q]>=D[F]))W=D[F++],U=D[F++];else if(q<w.length)W=w[q++],U=w[q++];else return O;!O.length||O[O.length-1]<W?O.push(W,U):O[O.length-1]<U&&(O[O.length-1]=U)}}function mergeTransaction(D,w,O){var F;let q,W,U;return O?(q=w.changes,W=ChangeSet.empty(w.changes.length),U=D.changes.compose(w.changes)):(q=w.changes.map(D.changes),W=D.changes.mapDesc(w.changes,!0),U=D.changes.compose(q)),{changes:U,selection:w.selection?w.selection.map(W):(F=D.selection)===null||F===void 0?void 0:F.map(q),effects:StateEffect.mapEffects(D.effects,q).concat(StateEffect.mapEffects(w.effects,W)),annotations:D.annotations.length?D.annotations.concat(w.annotations):w.annotations,scrollIntoView:D.scrollIntoView||w.scrollIntoView}}function resolveTransactionInner(D,w,O){let F=w.selection,q=asArray$1(w.annotations);return w.userEvent&&(q=q.concat(Transaction.userEvent.of(w.userEvent))),{changes:w.changes instanceof ChangeSet?w.changes:ChangeSet.of(w.changes||[],O,D.facet(lineSeparator)),selection:F&&(F instanceof EditorSelection?F:EditorSelection.single(F.anchor,F.head)),effects:asArray$1(w.effects),annotations:q,scrollIntoView:!!w.scrollIntoView}}function resolveTransaction(D,w,O){let F=resolveTransactionInner(D,w.length?w[0]:{},D.doc.length);w.length&&w[0].filter===!1&&(O=!1);for(let W=1;W<w.length;W++){w[W].filter===!1&&(O=!1);let U=!!w[W].sequential;F=mergeTransaction(F,resolveTransactionInner(D,w[W],U?F.changes.newLength:D.doc.length),U)}let q=Transaction.create(D,F.changes,F.selection,F.effects,F.annotations,F.scrollIntoView);return extendTransaction(O?filterTransaction(q):q)}function filterTransaction(D){let w=D.startState,O=!0;for(let q of w.facet(changeFilter)){let W=q(D);if(W===!1){O=!1;break}Array.isArray(W)&&(O=O===!0?W:joinRanges(O,W))}if(O!==!0){let q,W;if(O===!1)W=D.changes.invertedDesc,q=ChangeSet.empty(w.doc.length);else{let U=D.changes.filter(O);q=U.changes,W=U.filtered.mapDesc(U.changes).invertedDesc}D=Transaction.create(w,q,D.selection&&D.selection.map(W),StateEffect.mapEffects(D.effects,W),D.annotations,D.scrollIntoView)}let F=w.facet(transactionFilter);for(let q=F.length-1;q>=0;q--){let W=F[q](D);W instanceof Transaction?D=W:Array.isArray(W)&&W.length==1&&W[0]instanceof Transaction?D=W[0]:D=resolveTransaction(w,asArray$1(W),!1)}return D}function extendTransaction(D){let w=D.startState,O=w.facet(transactionExtender),F=D;for(let q=O.length-1;q>=0;q--){let W=O[q](D);W&&Object.keys(W).length&&(F=mergeTransaction(F,resolveTransactionInner(w,W,D.changes.newLength),!0))}return F==D?D:Transaction.create(w,D.changes,D.selection,F.effects,F.annotations,F.scrollIntoView)}const none$2=[];function asArray$1(D){return D==null?none$2:Array.isArray(D)?D:[D]}var CharCategory=function(D){return D[D.Word=0]="Word",D[D.Space=1]="Space",D[D.Other=2]="Other",D}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function hasWordChar(D){if(wordChar)return wordChar.test(D);for(let w=0;w<D.length;w++){let O=D[w];if(/\w/.test(O)||O>""&&(O.toUpperCase()!=O.toLowerCase()||nonASCIISingleCaseWordChar.test(O)))return!0}return!1}function makeCategorizer(D){return w=>{if(!/\S/.test(w))return CharCategory.Space;if(hasWordChar(w))return CharCategory.Word;for(let O=0;O<D.length;O++)if(w.indexOf(D[O])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(w,O,F,q,W,U){this.config=w,this.doc=O,this.selection=F,this.values=q,this.status=w.statusTemplate.slice(),this.computeSlot=W,U&&(U._state=this);for(let K=0;K<this.config.dynamicSlots.length;K++)ensureAddr(this,K<<1);this.computeSlot=null}field(w,O=!0){let F=this.config.address[w.id];if(F==null){if(O)throw new RangeError("Field is not present in this state");return}return ensureAddr(this,F),getAddr(this,F)}update(...w){return resolveTransaction(this,w,!0)}applyTransaction(w){let O=this.config,{base:F,compartments:q}=O;for(let K of w.effects)K.is(Compartment.reconfigure)?(O&&(q=new Map,O.compartments.forEach((G,Y)=>q.set(Y,G)),O=null),q.set(K.value.compartment,K.value.extension)):K.is(StateEffect.reconfigure)?(O=null,F=K.value):K.is(StateEffect.appendConfig)&&(O=null,F=asArray$1(F).concat(K.value));let W;O?W=w.startState.values.slice():(O=Configuration.resolve(F,q,this),W=new EditorState(O,this.doc,this.selection,O.dynamicSlots.map(()=>null),(G,Y)=>Y.reconfigure(G,this),null).values);let U=w.startState.facet(allowMultipleSelections)?w.newSelection:w.newSelection.asSingle();new EditorState(O,w.newDoc,U,W,(K,G)=>G.update(K,w),w)}replaceSelection(w){return typeof w=="string"&&(w=this.toText(w)),this.changeByRange(O=>({changes:{from:O.from,to:O.to,insert:w},range:EditorSelection.cursor(O.from+w.length)}))}changeByRange(w){let O=this.selection,F=w(O.ranges[0]),q=this.changes(F.changes),W=[F.range],U=asArray$1(F.effects);for(let K=1;K<O.ranges.length;K++){let G=w(O.ranges[K]),Y=this.changes(G.changes),Q=Y.map(q);for(let J=0;J<K;J++)W[J]=W[J].map(Q);let X=q.mapDesc(Y,!0);W.push(G.range.map(X)),q=q.compose(Q),U=StateEffect.mapEffects(U,Q).concat(StateEffect.mapEffects(asArray$1(G.effects),X))}return{changes:q,selection:EditorSelection.create(W,O.mainIndex),effects:U}}changes(w=[]){return w instanceof ChangeSet?w:ChangeSet.of(w,this.doc.length,this.facet(EditorState.lineSeparator))}toText(w){return Text.of(w.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(w=0,O=this.doc.length){return this.doc.sliceString(w,O,this.lineBreak)}facet(w){let O=this.config.address[w.id];return O==null?w.default:(ensureAddr(this,O),getAddr(this,O))}toJSON(w){let O={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(w)for(let F in w){let q=w[F];q instanceof StateField&&this.config.address[q.id]!=null&&(O[F]=q.spec.toJSON(this.field(w[F]),this))}return O}static fromJSON(w,O={},F){if(!w||typeof w.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let q=[];if(F){for(let W in F)if(Object.prototype.hasOwnProperty.call(w,W)){let U=F[W],K=w[W];q.push(U.init(G=>U.spec.fromJSON(K,G)))}}return EditorState.create({doc:w.doc,selection:EditorSelection.fromJSON(w.selection),extensions:O.extensions?q.concat([O.extensions]):q})}static create(w={}){let O=Configuration.resolve(w.extensions||[],new Map),F=w.doc instanceof Text?w.doc:Text.of((w.doc||"").split(O.staticFacet(EditorState.lineSeparator)||DefaultSplit)),q=w.selection?w.selection instanceof EditorSelection?w.selection:EditorSelection.single(w.selection.anchor,w.selection.head):EditorSelection.single(0);return checkSelection(q,F.length),O.staticFacet(allowMultipleSelections)||(q=q.asSingle()),new EditorState(O,F,q,O.dynamicSlots.map(()=>null),(W,U)=>U.create(W),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||`
`}get readOnly(){return this.facet(readOnly)}phrase(w,...O){for(let F of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(F,w)){w=F[w];break}return O.length&&(w=w.replace(/\$(\$|\d*)/g,(F,q)=>{if(q=="$")return"$";let W=+(q||1);return!W||W>O.length?F:O[W-1]})),w}languageDataAt(w,O,F=-1){let q=[];for(let W of this.facet(languageData))for(let U of W(this,O,F))Object.prototype.hasOwnProperty.call(U,w)&&q.push(U[w]);return q}charCategorizer(w){return makeCategorizer(this.languageDataAt("wordChars",w).join(""))}wordAt(w){let{text:O,from:F,length:q}=this.doc.lineAt(w),W=this.charCategorizer(w),U=w-F,K=w-F;for(;U>0;){let G=findClusterBreak(O,U,!1);if(W(O.slice(G,U))!=CharCategory.Word)break;U=G}for(;K<q;){let G=findClusterBreak(O,K);if(W(O.slice(K,G))!=CharCategory.Word)break;K=G}return U==K?null:EditorSelection.range(U+F,K+F)}}EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=Facet.define({combine:D=>D.length?D[0]:4});EditorState.lineSeparator=lineSeparator;EditorState.readOnly=readOnly;EditorState.phrases=Facet.define({compare(D,w){let O=Object.keys(D),F=Object.keys(w);return O.length==F.length&&O.every(q=>D[q]==w[q])}});EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=StateEffect.define();function combineConfig(D,w,O={}){let F={};for(let q of D)for(let W of Object.keys(q)){let U=q[W],K=F[W];if(K===void 0)F[W]=U;else if(!(K===U||U===void 0))if(Object.hasOwnProperty.call(O,W))F[W]=O[W](K,U);else throw new Error("Config merge conflict for field "+W)}for(let q in w)F[q]===void 0&&(F[q]=w[q]);return F}class RangeValue{eq(w){return this==w}range(w,O=w){return Range$1.create(w,O,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=!1;RangeValue.prototype.mapMode=MapMode.TrackDel;let Range$1=class Oe{constructor(w,O,F){this.from=w,this.to=O,this.value=F}static create(w,O,F){return new Oe(w,O,F)}};function cmpRange(D,w){return D.from-w.from||D.value.startSide-w.value.startSide}class Chunk{constructor(w,O,F,q){this.from=w,this.to=O,this.value=F,this.maxPoint=q}get length(){return this.to[this.to.length-1]}findIndex(w,O,F,q=0){let W=F?this.to:this.from;for(let U=q,K=W.length;;){if(U==K)return U;let G=U+K>>1,Y=W[G]-w||(F?this.value[G].endSide:this.value[G].startSide)-O;if(G==U)return Y>=0?U:K;Y>=0?K=G:U=G+1}}between(w,O,F,q){for(let W=this.findIndex(O,-1e9,!0),U=this.findIndex(F,1e9,!1,W);W<U;W++)if(q(this.from[W]+w,this.to[W]+w,this.value[W])===!1)return!1}map(w,O){let F=[],q=[],W=[],U=-1,K=-1;for(let G=0;G<this.value.length;G++){let Y=this.value[G],Q=this.from[G]+w,X=this.to[G]+w,J,Z;if(Q==X){let ee=O.mapPos(Q,Y.startSide,Y.mapMode);if(ee==null||(J=Z=ee,Y.startSide!=Y.endSide&&(Z=O.mapPos(Q,Y.endSide),Z<J)))continue}else if(J=O.mapPos(Q,Y.startSide),Z=O.mapPos(X,Y.endSide),J>Z||J==Z&&Y.startSide>0&&Y.endSide<=0)continue;(Z-J||Y.endSide-Y.startSide)<0||(U<0&&(U=J),Y.point&&(K=Math.max(K,Z-J)),F.push(Y),q.push(J-U),W.push(Z-U))}return{mapped:F.length?new Chunk(q,W,F,K):null,pos:U}}}class RangeSet{constructor(w,O,F,q){this.chunkPos=w,this.chunk=O,this.nextLayer=F,this.maxPoint=q}static create(w,O,F,q){return new RangeSet(w,O,F,q)}get length(){let w=this.chunk.length-1;return w<0?0:Math.max(this.chunkEnd(w),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let w=this.nextLayer.size;for(let O of this.chunk)w+=O.value.length;return w}chunkEnd(w){return this.chunkPos[w]+this.chunk[w].length}update(w){let{add:O=[],sort:F=!1,filterFrom:q=0,filterTo:W=this.length}=w,U=w.filter;if(O.length==0&&!U)return this;if(F&&(O=O.slice().sort(cmpRange)),this.isEmpty)return O.length?RangeSet.of(O):this;let K=new LayerCursor(this,null,-1).goto(0),G=0,Y=[],Q=new RangeSetBuilder;for(;K.value||G<O.length;)if(G<O.length&&(K.from-O[G].from||K.startSide-O[G].value.startSide)>=0){let X=O[G++];Q.addInner(X.from,X.to,X.value)||Y.push(X)}else K.rangeIndex==1&&K.chunkIndex<this.chunk.length&&(G==O.length||this.chunkEnd(K.chunkIndex)<O[G].from)&&(!U||q>this.chunkEnd(K.chunkIndex)||W<this.chunkPos[K.chunkIndex])&&Q.addChunk(this.chunkPos[K.chunkIndex],this.chunk[K.chunkIndex])?K.nextChunk():((!U||q>K.to||W<K.from||U(K.from,K.to,K.value))&&(Q.addInner(K.from,K.to,K.value)||Y.push(Range$1.create(K.from,K.to,K.value))),K.next());return Q.finishInner(this.nextLayer.isEmpty&&!Y.length?RangeSet.empty:this.nextLayer.update({add:Y,filter:U,filterFrom:q,filterTo:W}))}map(w){if(w.empty||this.isEmpty)return this;let O=[],F=[],q=-1;for(let U=0;U<this.chunk.length;U++){let K=this.chunkPos[U],G=this.chunk[U],Y=w.touchesRange(K,K+G.length);if(Y===!1)q=Math.max(q,G.maxPoint),O.push(G),F.push(w.mapPos(K));else if(Y===!0){let{mapped:Q,pos:X}=G.map(K,w);Q&&(q=Math.max(q,Q.maxPoint),O.push(Q),F.push(X))}}let W=this.nextLayer.map(w);return O.length==0?W:new RangeSet(F,O,W||RangeSet.empty,q)}between(w,O,F){if(!this.isEmpty){for(let q=0;q<this.chunk.length;q++){let W=this.chunkPos[q],U=this.chunk[q];if(O>=W&&w<=W+U.length&&U.between(W,w-W,O-W,F)===!1)return}this.nextLayer.between(w,O,F)}}iter(w=0){return HeapCursor.from([this]).goto(w)}get isEmpty(){return this.nextLayer==this}static iter(w,O=0){return HeapCursor.from(w).goto(O)}static compare(w,O,F,q,W=-1){let U=w.filter(X=>X.maxPoint>0||!X.isEmpty&&X.maxPoint>=W),K=O.filter(X=>X.maxPoint>0||!X.isEmpty&&X.maxPoint>=W),G=findSharedChunks(U,K,F),Y=new SpanCursor(U,G,W),Q=new SpanCursor(K,G,W);F.iterGaps((X,J,Z)=>compare(Y,X,Q,J,Z,q)),F.empty&&F.length==0&&compare(Y,0,Q,0,0,q)}static eq(w,O,F=0,q){q==null&&(q=999999999);let W=w.filter(Q=>!Q.isEmpty&&O.indexOf(Q)<0),U=O.filter(Q=>!Q.isEmpty&&w.indexOf(Q)<0);if(W.length!=U.length)return!1;if(!W.length)return!0;let K=findSharedChunks(W,U),G=new SpanCursor(W,K,0).goto(F),Y=new SpanCursor(U,K,0).goto(F);for(;;){if(G.to!=Y.to||!sameValues(G.active,Y.active)||G.point&&(!Y.point||!G.point.eq(Y.point)))return!1;if(G.to>q)return!0;G.next(),Y.next()}}static spans(w,O,F,q,W=-1){let U=new SpanCursor(w,null,W).goto(O),K=O,G=U.openStart;for(;;){let Y=Math.min(U.to,F);if(U.point){let Q=U.activeForPoint(U.to),X=U.pointFrom<O?Q.length+1:U.point.startSide<0?Q.length:Math.min(Q.length,G);q.point(K,Y,U.point,Q,X,U.pointRank),G=Math.min(U.openEnd(Y),Q.length)}else Y>K&&(q.span(K,Y,U.active,G),G=U.openEnd(Y));if(U.to>F)return G+(U.point&&U.to>F?1:0);K=U.to,U.next()}}static of(w,O=!1){let F=new RangeSetBuilder;for(let q of w instanceof Range$1?[w]:O?lazySort(w):w)F.add(q.from,q.to,q.value);return F.finish()}static join(w){if(!w.length)return RangeSet.empty;let O=w[w.length-1];for(let F=w.length-2;F>=0;F--)for(let q=w[F];q!=RangeSet.empty;q=q.nextLayer)O=new RangeSet(q.chunkPos,q.chunk,O,Math.max(q.maxPoint,O.maxPoint));return O}}RangeSet.empty=new RangeSet([],[],null,-1);function lazySort(D){if(D.length>1)for(let w=D[0],O=1;O<D.length;O++){let F=D[O];if(cmpRange(w,F)>0)return D.slice().sort(cmpRange);w=F}return D}RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{finishChunk(w){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,w&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(w,O,F){this.addInner(w,O,F)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(w,O,F)}addInner(w,O,F){let q=w-this.lastTo||F.startSide-this.last.endSide;if(q<=0&&(w-this.lastFrom||F.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return q<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=w),this.from.push(w-this.chunkStart),this.to.push(O-this.chunkStart),this.last=F,this.lastFrom=w,this.lastTo=O,this.value.push(F),F.point&&(this.maxPoint=Math.max(this.maxPoint,O-w)),!0)}addChunk(w,O){if((w-this.lastTo||O.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,O.maxPoint),this.chunks.push(O),this.chunkPos.push(w);let F=O.value.length-1;return this.last=O.value[F],this.lastFrom=O.from[F]+w,this.lastTo=O.to[F]+w,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(w){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return w;let O=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(w):w,this.setMaxPoint);return this.from=null,O}}function findSharedChunks(D,w,O){let F=new Map;for(let W of D)for(let U=0;U<W.chunk.length;U++)W.chunk[U].maxPoint<=0&&F.set(W.chunk[U],W.chunkPos[U]);let q=new Set;for(let W of w)for(let U=0;U<W.chunk.length;U++){let K=F.get(W.chunk[U]);K!=null&&(O?O.mapPos(K):K)==W.chunkPos[U]&&!(O!=null&&O.touchesRange(K,K+W.chunk[U].length))&&q.add(W.chunk[U])}return q}class LayerCursor{constructor(w,O,F,q=0){this.layer=w,this.skip=O,this.minPoint=F,this.rank=q}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(w,O=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(w,O,!1),this}gotoInner(w,O,F){for(;this.chunkIndex<this.layer.chunk.length;){let q=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(q)||this.layer.chunkEnd(this.chunkIndex)<w||q.maxPoint<this.minPoint))break;this.chunkIndex++,F=!1}if(this.chunkIndex<this.layer.chunk.length){let q=this.layer.chunk[this.chunkIndex].findIndex(w-this.layer.chunkPos[this.chunkIndex],O,!0);(!F||this.rangeIndex<q)&&this.setRangeIndex(q)}this.next()}forward(w,O){(this.to-w||this.endSide-O)<0&&this.gotoInner(w,O,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let w=this.layer.chunkPos[this.chunkIndex],O=this.layer.chunk[this.chunkIndex],F=w+O.from[this.rangeIndex];if(this.from=F,this.to=w+O.to[this.rangeIndex],this.value=O.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(w){if(w==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=w}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(w){return this.from-w.from||this.startSide-w.startSide||this.rank-w.rank||this.to-w.to||this.endSide-w.endSide}}class HeapCursor{constructor(w){this.heap=w}static from(w,O=null,F=-1){let q=[];for(let W=0;W<w.length;W++)for(let U=w[W];!U.isEmpty;U=U.nextLayer)U.maxPoint>=F&&q.push(new LayerCursor(U,O,F,W));return q.length==1?q[0]:new HeapCursor(q)}get startSide(){return this.value?this.value.startSide:0}goto(w,O=-1e9){for(let F of this.heap)F.goto(w,O);for(let F=this.heap.length>>1;F>=0;F--)heapBubble(this.heap,F);return this.next(),this}forward(w,O){for(let F of this.heap)F.forward(w,O);for(let F=this.heap.length>>1;F>=0;F--)heapBubble(this.heap,F);(this.to-w||this.value.endSide-O)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let w=this.heap[0];this.from=w.from,this.to=w.to,this.value=w.value,this.rank=w.rank,w.value&&w.next(),heapBubble(this.heap,0)}}}function heapBubble(D,w){for(let O=D[w];;){let F=(w<<1)+1;if(F>=D.length)break;let q=D[F];if(F+1<D.length&&q.compare(D[F+1])>=0&&(q=D[F+1],F++),O.compare(q)<0)break;D[F]=O,D[w]=q,w=F}}class SpanCursor{constructor(w,O,F){this.minPoint=F,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(w,O,F)}goto(w,O=-1e9){return this.cursor.goto(w,O),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=w,this.endSide=O,this.openStart=-1,this.next(),this}forward(w,O){for(;this.minActive>-1&&(this.activeTo[this.minActive]-w||this.active[this.minActive].endSide-O)<0;)this.removeActive(this.minActive);this.cursor.forward(w,O)}removeActive(w){remove(this.active,w),remove(this.activeTo,w),remove(this.activeRank,w),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(w){let O=0,{value:F,to:q,rank:W}=this.cursor;for(;O<this.activeRank.length&&(W-this.activeRank[O]||q-this.activeTo[O])>0;)O++;insert(this.active,O,F),insert(this.activeTo,O,q),insert(this.activeRank,O,W),w&&insert(w,O,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let w=this.to,O=this.point;this.point=null;let F=this.openStart<0?[]:null;for(;;){let q=this.minActive;if(q>-1&&(this.activeTo[q]-this.cursor.from||this.active[q].endSide-this.cursor.startSide)<0){if(this.activeTo[q]>w){this.to=this.activeTo[q],this.endSide=this.active[q].endSide;break}this.removeActive(q),F&&remove(F,q)}else if(this.cursor.value)if(this.cursor.from>w){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let W=this.cursor.value;if(!W.point)this.addActive(F),this.cursor.next();else if(O&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=W,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=W.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(F){this.openStart=0;for(let q=F.length-1;q>=0&&F[q]<w;q--)this.openStart++}}activeForPoint(w){if(!this.active.length)return this.active;let O=[];for(let F=this.active.length-1;F>=0&&!(this.activeRank[F]<this.pointRank);F--)(this.activeTo[F]>w||this.activeTo[F]==w&&this.active[F].endSide>=this.point.endSide)&&O.push(this.active[F]);return O.reverse()}openEnd(w){let O=0;for(let F=this.activeTo.length-1;F>=0&&this.activeTo[F]>w;F--)O++;return O}}function compare(D,w,O,F,q,W){D.goto(w),O.goto(F);let U=F+q,K=F,G=F-w;for(;;){let Y=D.to+G-O.to,Q=Y||D.endSide-O.endSide,X=Q<0?D.to+G:O.to,J=Math.min(X,U);if(D.point||O.point?D.point&&O.point&&(D.point==O.point||D.point.eq(O.point))&&sameValues(D.activeForPoint(D.to),O.activeForPoint(O.to))||W.comparePoint(K,J,D.point,O.point):J>K&&!sameValues(D.active,O.active)&&W.compareRange(K,J,D.active,O.active),X>U)break;(Y||D.openEnd!=O.openEnd)&&W.boundChange&&W.boundChange(X),K=X,Q<=0&&D.next(),Q>=0&&O.next()}}function sameValues(D,w){if(D.length!=w.length)return!1;for(let O=0;O<D.length;O++)if(D[O]!=w[O]&&!D[O].eq(w[O]))return!1;return!0}function remove(D,w){for(let O=w,F=D.length-1;O<F;O++)D[O]=D[O+1];D.pop()}function insert(D,w,O){for(let F=D.length-1;F>=w;F--)D[F+1]=D[F];D[w]=O}function findMinIndex(D,w){let O=-1,F=1e9;for(let q=0;q<w.length;q++)(w[q]-F||D[q].endSide-D[O].endSide)<0&&(O=q,F=w[q]);return O}function countColumn(D,w,O=D.length){let F=0;for(let q=0;q<O&&q<D.length;)D.charCodeAt(q)==9?(F+=w-F%w,q++):(F++,q=findClusterBreak(D,q));return F}function findColumn(D,w,O,F){for(let q=0,W=0;;){if(W>=w)return q;if(q==D.length)break;W+=D.charCodeAt(q)==9?O-W%O:1,q=findClusterBreak(D,q)}return F===!0?-1:D.length}const C="ͼ",COUNT=typeof Symbol>"u"?"__"+C:Symbol.for(C),SET=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),top=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class StyleModule{constructor(w,O){this.rules=[];let{finish:F}=O||{};function q(U){return/^@/.test(U)?[U]:U.split(/,\s*/)}function W(U,K,G,Y){let Q=[],X=/^@(\w+)\b/.exec(U[0]),J=X&&X[1]=="keyframes";if(X&&K==null)return G.push(U[0]+";");for(let Z in K){let ee=K[Z];if(/&/.test(Z))W(Z.split(/,\s*/).map(ne=>U.map(te=>ne.replace(/&/,te))).reduce((ne,te)=>ne.concat(te)),ee,G);else if(ee&&typeof ee=="object"){if(!X)throw new RangeError("The value of a property ("+Z+") should be a primitive value.");W(q(Z),ee,Q,J)}else ee!=null&&Q.push(Z.replace(/_.*/,"").replace(/[A-Z]/g,ne=>"-"+ne.toLowerCase())+": "+ee+";")}(Q.length||J)&&G.push((F&&!X&&!Y?U.map(F):U).join(", ")+" {"+Q.join(" ")+"}")}for(let U in w)W(q(U),w[U],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let w=top[COUNT]||1;return top[COUNT]=w+1,C+w.toString(36)}static mount(w,O,F){let q=w[SET],W=F&&F.nonce;q?W&&q.setNonce(W):q=new StyleSet(w,W),q.mount(Array.isArray(O)?O:[O],w)}}let adoptedSet=new Map;class StyleSet{constructor(w,O){let F=w.ownerDocument||w,q=F.defaultView;if(!w.head&&w.adoptedStyleSheets&&q.CSSStyleSheet){let W=adoptedSet.get(F);if(W)return w[SET]=W;this.sheet=new q.CSSStyleSheet,adoptedSet.set(F,this)}else this.styleTag=F.createElement("style"),O&&this.styleTag.setAttribute("nonce",O);this.modules=[],w[SET]=this}mount(w,O){let F=this.sheet,q=0,W=0;for(let U=0;U<w.length;U++){let K=w[U],G=this.modules.indexOf(K);if(G<W&&G>-1&&(this.modules.splice(G,1),W--,G=-1),G==-1){if(this.modules.splice(W++,0,K),F)for(let Y=0;Y<K.rules.length;Y++)F.insertRule(K.rules[Y],q++)}else{for(;W<G;)q+=this.modules[W++].rules.length;q+=K.rules.length,W++}}if(F)O.adoptedStyleSheets.indexOf(this.sheet)<0&&(O.adoptedStyleSheets=[this.sheet,...O.adoptedStyleSheets]);else{let U="";for(let G=0;G<this.modules.length;G++)U+=this.modules[G].getRules()+`
`;this.styleTag.textContent=U;let K=O.head||O;this.styleTag.parentNode!=K&&K.insertBefore(this.styleTag,K.firstChild)}}setNonce(w){this.styleTag&&this.styleTag.getAttribute("nonce")!=w&&this.styleTag.setAttribute("nonce",w)}}var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac=typeof navigator<"u"&&/Mac/.test(navigator.platform),ie$1=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var i$1=0;i$1<10;i$1++)base[48+i$1]=base[96+i$1]=String(i$1);for(var i$1=1;i$1<=24;i$1++)base[i$1+111]="F"+i$1;for(var i$1=65;i$1<=90;i$1++)base[i$1]=String.fromCharCode(i$1+32),shift[i$1]=String.fromCharCode(i$1);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function keyName(D){var w=mac&&D.metaKey&&D.shiftKey&&!D.ctrlKey&&!D.altKey||ie$1&&D.shiftKey&&D.key&&D.key.length==1||D.key=="Unidentified",O=!w&&D.key||(D.shiftKey?shift:base)[D.keyCode]||D.key||"Unidentified";return O=="Esc"&&(O="Escape"),O=="Del"&&(O="Delete"),O=="Left"&&(O="ArrowLeft"),O=="Up"&&(O="ArrowUp"),O=="Right"&&(O="ArrowRight"),O=="Down"&&(O="ArrowDown"),O}function getSelection(D){let w;return D.nodeType==11?w=D.getSelection?D:D.ownerDocument:w=D,w.getSelection()}function contains(D,w){return w?D==w||D.contains(w.nodeType!=1?w.parentNode:w):!1}function hasSelection(D,w){if(!w.anchorNode)return!1;try{return contains(D,w.anchorNode)}catch{return!1}}function clientRectsFor(D){return D.nodeType==3?textRange(D,0,D.nodeValue.length).getClientRects():D.nodeType==1?D.getClientRects():[]}function isEquivalentPosition(D,w,O,F){return O?scanFor(D,w,O,F,-1)||scanFor(D,w,O,F,1):!1}function domIndex(D){for(var w=0;;w++)if(D=D.previousSibling,!D)return w}function isBlockElement(D){return D.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(D.nodeName)}function scanFor(D,w,O,F,q){for(;;){if(D==O&&w==F)return!0;if(w==(q<0?0:maxOffset(D))){if(D.nodeName=="DIV")return!1;let W=D.parentNode;if(!W||W.nodeType!=1)return!1;w=domIndex(D)+(q<0?0:1),D=W}else if(D.nodeType==1){if(D=D.childNodes[w+(q<0?-1:0)],D.nodeType==1&&D.contentEditable=="false")return!1;w=q<0?maxOffset(D):0}else return!1}}function maxOffset(D){return D.nodeType==3?D.nodeValue.length:D.childNodes.length}function flattenRect(D,w){let O=w?D.left:D.right;return{left:O,right:O,top:D.top,bottom:D.bottom}}function windowRect(D){let w=D.visualViewport;return w?{left:0,right:w.width,top:0,bottom:w.height}:{left:0,right:D.innerWidth,top:0,bottom:D.innerHeight}}function getScale(D,w){let O=w.width/D.offsetWidth,F=w.height/D.offsetHeight;return(O>.995&&O<1.005||!isFinite(O)||Math.abs(w.width-D.offsetWidth)<1)&&(O=1),(F>.995&&F<1.005||!isFinite(F)||Math.abs(w.height-D.offsetHeight)<1)&&(F=1),{scaleX:O,scaleY:F}}function scrollRectIntoView(D,w,O,F,q,W,U,K){let G=D.ownerDocument,Y=G.defaultView||window;for(let Q=D,X=!1;Q&&!X;)if(Q.nodeType==1){let J,Z=Q==G.body,ee=1,ne=1;if(Z)J=windowRect(Y);else{if(/^(fixed|sticky)$/.test(getComputedStyle(Q).position)&&(X=!0),Q.scrollHeight<=Q.clientHeight&&Q.scrollWidth<=Q.clientWidth){Q=Q.assignedSlot||Q.parentNode;continue}let se=Q.getBoundingClientRect();({scaleX:ee,scaleY:ne}=getScale(Q,se)),J={left:se.left,right:se.left+Q.clientWidth*ee,top:se.top,bottom:se.top+Q.clientHeight*ne}}let te=0,re=0;if(q=="nearest")w.top<J.top?(re=-(J.top-w.top+U),O>0&&w.bottom>J.bottom+re&&(re=w.bottom-J.bottom+re+U)):w.bottom>J.bottom&&(re=w.bottom-J.bottom+U,O<0&&w.top-re<J.top&&(re=-(J.top+re-w.top+U)));else{let se=w.bottom-w.top,le=J.bottom-J.top;re=(q=="center"&&se<=le?w.top+se/2-le/2:q=="start"||q=="center"&&O<0?w.top-U:w.bottom-le+U)-J.top}if(F=="nearest"?w.left<J.left?(te=-(J.left-w.left+W),O>0&&w.right>J.right+te&&(te=w.right-J.right+te+W)):w.right>J.right&&(te=w.right-J.right+W,O<0&&w.left<J.left+te&&(te=-(J.left+te-w.left+W))):te=(F=="center"?w.left+(w.right-w.left)/2-(J.right-J.left)/2:F=="start"==K?w.left-W:w.right-(J.right-J.left)+W)-J.left,te||re)if(Z)Y.scrollBy(te,re);else{let se=0,le=0;if(re){let ue=Q.scrollTop;Q.scrollTop+=re/ne,le=(Q.scrollTop-ue)*ne}if(te){let ue=Q.scrollLeft;Q.scrollLeft+=te/ee,se=(Q.scrollLeft-ue)*ee}w={left:w.left-se,top:w.top-le,right:w.right-se,bottom:w.bottom-le},se&&Math.abs(se-te)<1&&(F="nearest"),le&&Math.abs(le-re)<1&&(q="nearest")}if(Z)break;Q=Q.assignedSlot||Q.parentNode}else if(Q.nodeType==11)Q=Q.host;else break}function scrollableParents(D){let w=D.ownerDocument,O,F;for(let q=D.parentNode;q&&!(q==w.body||O&&F);)if(q.nodeType==1)!F&&q.scrollHeight>q.clientHeight&&(F=q),!O&&q.scrollWidth>q.clientWidth&&(O=q),q=q.assignedSlot||q.parentNode;else if(q.nodeType==11)q=q.host;else break;return{x:O,y:F}}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(w){return this.anchorNode==w.anchorNode&&this.anchorOffset==w.anchorOffset&&this.focusNode==w.focusNode&&this.focusOffset==w.focusOffset}setRange(w){let{anchorNode:O,focusNode:F}=w;this.set(O,Math.min(w.anchorOffset,O?maxOffset(O):0),F,Math.min(w.focusOffset,F?maxOffset(F):0))}set(w,O,F,q){this.anchorNode=w,this.anchorOffset=O,this.focusNode=F,this.focusOffset=q}}let preventScrollSupported=null;function focusPreventScroll(D){if(D.setActive)return D.setActive();if(preventScrollSupported)return D.focus(preventScrollSupported);let w=[];for(let O=D;O&&(w.push(O,O.scrollTop,O.scrollLeft),O!=O.ownerDocument);O=O.parentNode);if(D.focus(preventScrollSupported==null?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let O=0;O<w.length;){let F=w[O++],q=w[O++],W=w[O++];F.scrollTop!=q&&(F.scrollTop=q),F.scrollLeft!=W&&(F.scrollLeft=W)}}}let scratchRange;function textRange(D,w,O=w){let F=scratchRange||(scratchRange=document.createRange());return F.setEnd(D,O),F.setStart(D,w),F}function dispatchKey(D,w,O,F){let q={key:w,code:w,keyCode:O,which:O,cancelable:!0};F&&({altKey:q.altKey,ctrlKey:q.ctrlKey,shiftKey:q.shiftKey,metaKey:q.metaKey}=F);let W=new KeyboardEvent("keydown",q);W.synthetic=!0,D.dispatchEvent(W);let U=new KeyboardEvent("keyup",q);return U.synthetic=!0,D.dispatchEvent(U),W.defaultPrevented||U.defaultPrevented}function getRoot(D){for(;D;){if(D&&(D.nodeType==9||D.nodeType==11&&D.host))return D;D=D.assignedSlot||D.parentNode}return null}function clearAttributes(D){for(;D.attributes.length;)D.removeAttributeNode(D.attributes[0])}function atElementStart(D,w){let O=w.focusNode,F=w.focusOffset;if(!O||w.anchorNode!=O||w.anchorOffset!=F)return!1;for(F=Math.min(F,maxOffset(O));;)if(F){if(O.nodeType!=1)return!1;let q=O.childNodes[F-1];q.contentEditable=="false"?F--:(O=q,F=maxOffset(O))}else{if(O==D)return!0;F=domIndex(O),O=O.parentNode}}function isScrolledToBottom(D){return D.scrollTop>Math.max(1,D.scrollHeight-D.clientHeight-4)}function textNodeBefore(D,w){for(let O=D,F=w;;){if(O.nodeType==3&&F>0)return{node:O,offset:F};if(O.nodeType==1&&F>0){if(O.contentEditable=="false")return null;O=O.childNodes[F-1],F=maxOffset(O)}else if(O.parentNode&&!isBlockElement(O))F=domIndex(O),O=O.parentNode;else return null}}function textNodeAfter(D,w){for(let O=D,F=w;;){if(O.nodeType==3&&F<O.nodeValue.length)return{node:O,offset:F};if(O.nodeType==1&&F<O.childNodes.length){if(O.contentEditable=="false")return null;O=O.childNodes[F],F=0}else if(O.parentNode&&!isBlockElement(O))F=domIndex(O)+1,O=O.parentNode;else return null}}class DOMPos{constructor(w,O,F=!0){this.node=w,this.offset=O,this.precise=F}static before(w,O){return new DOMPos(w.parentNode,domIndex(w),O)}static after(w,O){return new DOMPos(w.parentNode,domIndex(w)+1,O)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(w){let O=this.posAtStart;for(let F of this.children){if(F==w)return O;O+=F.length+F.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(w){return this.posBefore(w)+w.length}sync(w,O){if(this.flags&2){let F=this.dom,q=null,W;for(let U of this.children){if(U.flags&7){if(!U.dom&&(W=q?q.nextSibling:F.firstChild)){let K=ContentView.get(W);(!K||!K.parent&&K.canReuseDOM(U))&&U.reuseDOM(W)}U.sync(w,O),U.flags&=-8}if(W=q?q.nextSibling:F.firstChild,O&&!O.written&&O.node==F&&W!=U.dom&&(O.written=!0),U.dom.parentNode==F)for(;W&&W!=U.dom;)W=rm$1(W);else F.insertBefore(U.dom,W);q=U.dom}for(W=q?q.nextSibling:F.firstChild,W&&O&&O.node==F&&(O.written=!0);W;)W=rm$1(W)}else if(this.flags&1)for(let F of this.children)F.flags&7&&(F.sync(w,O),F.flags&=-8)}reuseDOM(w){}localPosFromDOM(w,O){let F;if(w==this.dom)F=this.dom.childNodes[O];else{let q=maxOffset(w)==0?0:O==0?-1:1;for(;;){let W=w.parentNode;if(W==this.dom)break;q==0&&W.firstChild!=W.lastChild&&(w==W.firstChild?q=-1:q=1),w=W}q<0?F=w:F=w.nextSibling}if(F==this.dom.firstChild)return 0;for(;F&&!ContentView.get(F);)F=F.nextSibling;if(!F)return this.length;for(let q=0,W=0;;q++){let U=this.children[q];if(U.dom==F)return W;W+=U.length+U.breakAfter}}domBoundsAround(w,O,F=0){let q=-1,W=-1,U=-1,K=-1;for(let G=0,Y=F,Q=F;G<this.children.length;G++){let X=this.children[G],J=Y+X.length;if(Y<w&&J>O)return X.domBoundsAround(w,O,Y);if(J>=w&&q==-1&&(q=G,W=Y),Y>O&&X.dom.parentNode==this.dom){U=G,K=Q;break}Q=J,Y=J+X.breakAfter}return{from:W,to:K<0?F+this.length:K,startDOM:(q?this.children[q-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:U<this.children.length&&U>=0?this.children[U].dom:null}}markDirty(w=!1){this.flags|=2,this.markParentsDirty(w)}markParentsDirty(w){for(let O=this.parent;O;O=O.parent){if(w&&(O.flags|=2),O.flags&1)return;O.flags|=1,w=!1}}setParent(w){this.parent!=w&&(this.parent=w,this.flags&7&&this.markParentsDirty(!0))}setDOM(w){this.dom!=w&&(this.dom&&(this.dom.cmView=null),this.dom=w,w.cmView=this)}get rootView(){for(let w=this;;){let O=w.parent;if(!O)return w;w=O}}replaceChildren(w,O,F=noChildren){this.markDirty();for(let q=w;q<O;q++){let W=this.children[q];W.parent==this&&F.indexOf(W)<0&&W.destroy()}F.length<250?this.children.splice(w,O-w,...F):this.children=[].concat(this.children.slice(0,w),F,this.children.slice(O));for(let q=0;q<F.length;q++)F[q].setParent(this)}ignoreMutation(w){return!1}ignoreEvent(w){return!1}childCursor(w=this.length){return new ChildCursor(this.children,w,this.children.length)}childPos(w,O=1){return this.childCursor().findPos(w,O)}toString(){let w=this.constructor.name.replace("View","");return w+(this.children.length?"("+this.children.join()+")":this.length?"["+(w=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(w){return w.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(w,O,F,q,W,U){return!1}become(w){return!1}canReuseDOM(w){return w.constructor==this.constructor&&!((this.flags|w.flags)&8)}getSide(){return 0}destroy(){for(let w of this.children)w.parent==this&&w.destroy();this.parent=null}}ContentView.prototype.breakAfter=0;function rm$1(D){let w=D.nextSibling;return D.parentNode.removeChild(D),w}class ChildCursor{constructor(w,O,F){this.children=w,this.pos=O,this.i=F,this.off=0}findPos(w,O=1){for(;;){if(w>this.pos||w==this.pos&&(O>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=w-this.pos,this;let F=this.children[--this.i];this.pos-=F.length+F.breakAfter}}}function replaceRange(D,w,O,F,q,W,U,K,G){let{children:Y}=D,Q=Y.length?Y[w]:null,X=W.length?W[W.length-1]:null,J=X?X.breakAfter:U;if(!(w==F&&Q&&!U&&!J&&W.length<2&&Q.merge(O,q,W.length?X:null,O==0,K,G))){if(F<Y.length){let Z=Y[F];Z&&(q<Z.length||Z.breakAfter&&(X!=null&&X.breakAfter))?(w==F&&(Z=Z.split(q),q=0),!J&&X&&Z.merge(0,q,X,!0,0,G)?W[W.length-1]=Z:((q||Z.children.length&&!Z.children[0].length)&&Z.merge(0,q,null,!1,0,G),W.push(Z))):Z!=null&&Z.breakAfter&&(X?X.breakAfter=1:U=1),F++}for(Q&&(Q.breakAfter=U,O>0&&(!U&&W.length&&Q.merge(O,Q.length,W[0],!1,K,0)?Q.breakAfter=W.shift().breakAfter:(O<Q.length||Q.children.length&&Q.children[Q.children.length-1].length==0)&&Q.merge(O,Q.length,null,!1,K,0),w++));w<F&&W.length;)if(Y[F-1].become(W[W.length-1]))F--,W.pop(),G=W.length?0:K;else if(Y[w].become(W[0]))w++,W.shift(),K=W.length?0:G;else break;!W.length&&w&&F<Y.length&&!Y[w-1].breakAfter&&Y[F].merge(0,0,Y[w-1],!1,K,G)&&w--,(w<F||W.length)&&D.replaceChildren(w,F,W)}}function mergeChildrenInto(D,w,O,F,q,W){let U=D.childCursor(),{i:K,off:G}=U.findPos(O,1),{i:Y,off:Q}=U.findPos(w,-1),X=w-O;for(let J of F)X+=J.length;D.length+=X,replaceRange(D,Y,Q,K,G,F,0,q,W)}let nav=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},doc=typeof document<"u"?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit,safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const MaxJoinLen=256;class TextView extends ContentView{constructor(w){super(),this.text=w}get length(){return this.text.length}createDOM(w){this.setDOM(w||document.createTextNode(this.text))}sync(w,O){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(O&&O.node==this.dom&&(O.written=!0),this.dom.nodeValue=this.text)}reuseDOM(w){w.nodeType==3&&this.createDOM(w)}merge(w,O,F){return this.flags&8||F&&(!(F instanceof TextView)||this.length-(O-w)+F.length>MaxJoinLen||F.flags&8)?!1:(this.text=this.text.slice(0,w)+(F?F.text:"")+this.text.slice(O),this.markDirty(),!0)}split(w){let O=new TextView(this.text.slice(w));return this.text=this.text.slice(0,w),this.markDirty(),O.flags|=this.flags&8,O}localPosFromDOM(w,O){return w==this.dom?O:O?this.text.length:0}domAtPos(w){return new DOMPos(this.dom,w)}domBoundsAround(w,O,F){return{from:F,to:F+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(w,O){return textCoords(this.dom,w,O)}}class MarkView extends ContentView{constructor(w,O=[],F=0){super(),this.mark=w,this.children=O,this.length=F;for(let q of O)q.setParent(this)}setAttrs(w){if(clearAttributes(w),this.mark.class&&(w.className=this.mark.class),this.mark.attrs)for(let O in this.mark.attrs)w.setAttribute(O,this.mark.attrs[O]);return w}canReuseDOM(w){return super.canReuseDOM(w)&&!((this.flags|w.flags)&8)}reuseDOM(w){w.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(w),this.flags|=6)}sync(w,O){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(w,O)}merge(w,O,F,q,W,U){return F&&(!(F instanceof MarkView&&F.mark.eq(this.mark))||w&&W<=0||O<this.length&&U<=0)?!1:(mergeChildrenInto(this,w,O,F?F.children.slice():[],W-1,U-1),this.markDirty(),!0)}split(w){let O=[],F=0,q=-1,W=0;for(let K of this.children){let G=F+K.length;G>w&&O.push(F<w?K.split(w-F):K),q<0&&F>=w&&(q=W),F=G,W++}let U=this.length-w;return this.length=w,q>-1&&(this.children.length=q,this.markDirty()),new MarkView(this.mark,O,U)}domAtPos(w){return inlineDOMAtPos(this,w)}coordsAt(w,O){return coordsInChildren(this,w,O)}}function textCoords(D,w,O){let F=D.nodeValue.length;w>F&&(w=F);let q=w,W=w,U=0;w==0&&O<0||w==F&&O>=0?browser.chrome||browser.gecko||(w?(q--,U=1):W<F&&(W++,U=-1)):O<0?q--:W<F&&W++;let K=textRange(D,q,W).getClientRects();if(!K.length)return null;let G=K[(U?U<0:O>=0)?0:K.length-1];return browser.safari&&!U&&G.width==0&&(G=Array.prototype.find.call(K,Y=>Y.width)||G),U?flattenRect(G,U<0):G||null}class WidgetView extends ContentView{static create(w,O,F){return new WidgetView(w,O,F)}constructor(w,O,F){super(),this.widget=w,this.length=O,this.side=F,this.prevWidget=null}split(w){let O=WidgetView.create(this.widget,this.length-w,this.side);return this.length-=w,O}sync(w){(!this.dom||!this.widget.updateDOM(this.dom,w))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(w)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(w,O,F,q,W,U){return F&&(!(F instanceof WidgetView)||!this.widget.compare(F.widget)||w>0&&W<=0||O<this.length&&U<=0)?!1:(this.length=w+(F?F.length:0)+(this.length-O),!0)}become(w){return w instanceof WidgetView&&w.side==this.side&&this.widget.constructor==w.widget.constructor?(this.widget.compare(w.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=w.widget,this.length=w.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(w){return this.widget.ignoreEvent(w)}get overrideDOMText(){if(this.length==0)return Text.empty;let w=this;for(;w.parent;)w=w.parent;let{view:O}=w,F=O&&O.state.doc,q=this.posAtStart;return F?F.slice(q,q+this.length):Text.empty}domAtPos(w){return(this.length?w==0:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,w==this.length)}domBoundsAround(){return null}coordsAt(w,O){let F=this.widget.coordsAt(this.dom,w,O);if(F)return F;let q=this.dom.getClientRects(),W=null;if(!q.length)return null;let U=this.side?this.side<0:w>0;for(let K=U?q.length-1:0;W=q[K],!(w>0?K==0:K==q.length-1||W.top<W.bottom);K+=U?-1:1);return flattenRect(W,!U)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class WidgetBufferView extends ContentView{constructor(w){super(),this.side=w}get length(){return 0}merge(){return!1}become(w){return w instanceof WidgetBufferView&&w.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let w=document.createElement("img");w.className="cm-widgetBuffer",w.setAttribute("aria-hidden","true"),this.setDOM(w)}}getSide(){return this.side}domAtPos(w){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(w){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Text.empty}get isHidden(){return!0}}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;function inlineDOMAtPos(D,w){let O=D.dom,{children:F}=D,q=0;for(let W=0;q<F.length;q++){let U=F[q],K=W+U.length;if(!(K==W&&U.getSide()<=0)){if(w>W&&w<K&&U.dom.parentNode==O)return U.domAtPos(w-W);if(w<=W)break;W=K}}for(let W=q;W>0;W--){let U=F[W-1];if(U.dom.parentNode==O)return U.domAtPos(U.length)}for(let W=q;W<F.length;W++){let U=F[W];if(U.dom.parentNode==O)return U.domAtPos(0)}return new DOMPos(O,0)}function joinInlineInto(D,w,O){let F,{children:q}=D;O>0&&w instanceof MarkView&&q.length&&(F=q[q.length-1])instanceof MarkView&&F.mark.eq(w.mark)?joinInlineInto(F,w.children[0],O-1):(q.push(w),w.setParent(D)),D.length+=w.length}function coordsInChildren(D,w,O){let F=null,q=-1,W=null,U=-1;function K(Y,Q){for(let X=0,J=0;X<Y.children.length&&J<=Q;X++){let Z=Y.children[X],ee=J+Z.length;ee>=Q&&(Z.children.length?K(Z,Q-J):(!W||W.isHidden&&O>0)&&(ee>Q||J==ee&&Z.getSide()>0)?(W=Z,U=Q-J):(J<Q||J==ee&&Z.getSide()<0&&!Z.isHidden)&&(F=Z,q=Q-J)),J=ee}}K(D,w);let G=(O<0?F:W)||F||W;return G?G.coordsAt(Math.max(0,G==F?q:U),O):fallbackRect(D)}function fallbackRect(D){let w=D.dom.lastChild;if(!w)return D.dom.getBoundingClientRect();let O=clientRectsFor(w);return O[O.length-1]||null}function combineAttrs(D,w){for(let O in D)O=="class"&&w.class?w.class+=" "+D.class:O=="style"&&w.style?w.style+=";"+D.style:w[O]=D[O];return w}const noAttrs$1=Object.create(null);function attrsEq(D,w,O){if(D==w)return!0;D||(D=noAttrs$1),w||(w=noAttrs$1);let F=Object.keys(D),q=Object.keys(w);if(F.length-(O&&F.indexOf(O)>-1?1:0)!=q.length-(O&&q.indexOf(O)>-1?1:0))return!1;for(let W of F)if(W!=O&&(q.indexOf(W)==-1||D[W]!==w[W]))return!1;return!0}function updateAttrs(D,w,O){let F=!1;if(w)for(let q in w)O&&q in O||(F=!0,q=="style"?D.style.cssText="":D.removeAttribute(q));if(O)for(let q in O)w&&w[q]==O[q]||(F=!0,q=="style"?D.style.cssText=O[q]:D.setAttribute(q,O[q]));return F}function getAttrs(D){let w=Object.create(null);for(let O=0;O<D.attributes.length;O++){let F=D.attributes[O];w[F.name]=F.value}return w}class WidgetType{eq(w){return!1}updateDOM(w,O){return!1}compare(w){return this==w||this.constructor==w.constructor&&this.eq(w)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(w){return!0}coordsAt(w,O,F){return null}get isHidden(){return!1}get editable(){return!1}destroy(w){}}var BlockType=function(D){return D[D.Text=0]="Text",D[D.WidgetBefore=1]="WidgetBefore",D[D.WidgetAfter=2]="WidgetAfter",D[D.WidgetRange=3]="WidgetRange",D}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(w,O,F,q){super(),this.startSide=w,this.endSide=O,this.widget=F,this.spec=q}get heightRelevant(){return!1}static mark(w){return new MarkDecoration(w)}static widget(w){let O=Math.max(-1e4,Math.min(1e4,w.side||0)),F=!!w.block;return O+=F&&!w.inlineOrder?O>0?3e8:-4e8:O>0?1e8:-1e8,new PointDecoration(w,O,O,F,w.widget||null,!1)}static replace(w){let O=!!w.block,F,q;if(w.isBlockGap)F=-5e8,q=4e8;else{let{start:W,end:U}=getInclusive(w,O);F=(W?O?-3e8:-1:5e8)-1,q=(U?O?2e8:1:-6e8)+1}return new PointDecoration(w,F,q,O,w.widget||null,!0)}static line(w){return new LineDecoration(w)}static set(w,O=!1){return RangeSet.of(w,O)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Decoration.none=RangeSet.empty;class MarkDecoration extends Decoration{constructor(w){let{start:O,end:F}=getInclusive(w);super(O?-1:5e8,F?1:-6e8,null,w),this.tagName=w.tagName||"span",this.class=w.class||"",this.attrs=w.attributes||null}eq(w){var O,F;return this==w||w instanceof MarkDecoration&&this.tagName==w.tagName&&(this.class||((O=this.attrs)===null||O===void 0?void 0:O.class))==(w.class||((F=w.attrs)===null||F===void 0?void 0:F.class))&&attrsEq(this.attrs,w.attrs,"class")}range(w,O=w){if(w>=O)throw new RangeError("Mark decorations may not be empty");return super.range(w,O)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(w){super(-2e8,-2e8,null,w)}eq(w){return w instanceof LineDecoration&&this.spec.class==w.spec.class&&attrsEq(this.spec.attributes,w.spec.attributes)}range(w,O=w){if(O!=w)throw new RangeError("Line decoration ranges must be zero-length");return super.range(w,O)}}LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(w,O,F,q,W,U){super(O,F,W,w),this.block=q,this.isReplace=U,this.mapMode=q?O<=0?MapMode.TrackBefore:MapMode.TrackAfter:MapMode.TrackDel}get type(){return this.startSide!=this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(w){return w instanceof PointDecoration&&widgetsEq(this.widget,w.widget)&&this.block==w.block&&this.startSide==w.startSide&&this.endSide==w.endSide}range(w,O=w){if(this.isReplace&&(w>O||w==O&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&O!=w)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(w,O)}}PointDecoration.prototype.point=!0;function getInclusive(D,w=!1){let{inclusiveStart:O,inclusiveEnd:F}=D;return O==null&&(O=D.inclusive),F==null&&(F=D.inclusive),{start:O??w,end:F??w}}function widgetsEq(D,w){return D==w||!!(D&&w&&D.compare(w))}function addRange(D,w,O,F=0){let q=O.length-1;q>=0&&O[q]+F>=D?O[q]=Math.max(O[q],w):O.push(D,w)}class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(w,O,F,q,W,U){if(F){if(!(F instanceof LineView))return!1;this.dom||F.transferDOM(this)}return q&&this.setDeco(F?F.attrs:null),mergeChildrenInto(this,w,O,F?F.children.slice():[],W,U),!0}split(w){let O=new LineView;if(O.breakAfter=this.breakAfter,this.length==0)return O;let{i:F,off:q}=this.childPos(w);q&&(O.append(this.children[F].split(q),0),this.children[F].merge(q,this.children[F].length,null,!1,0,0),F++);for(let W=F;W<this.children.length;W++)O.append(this.children[W],0);for(;F>0&&this.children[F-1].length==0;)this.children[--F].destroy();return this.children.length=F,this.markDirty(),this.length=w,O}transferDOM(w){this.dom&&(this.markDirty(),w.setDOM(this.dom),w.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(w){attrsEq(this.attrs,w)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=w)}append(w,O){joinInlineInto(this,w,O)}addLineDeco(w){let O=w.spec.attributes,F=w.spec.class;O&&(this.attrs=combineAttrs(O,this.attrs||{})),F&&(this.attrs=combineAttrs({class:F},this.attrs||{}))}domAtPos(w){return inlineDOMAtPos(this,w)}reuseDOM(w){w.nodeName=="DIV"&&(this.setDOM(w),this.flags|=6)}sync(w,O){var F;this.dom?this.flags&4&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(w,O);let q=this.dom.lastChild;for(;q&&ContentView.get(q)instanceof MarkView;)q=q.lastChild;if(!q||!this.length||q.nodeName!="BR"&&((F=ContentView.get(q))===null||F===void 0?void 0:F.isEditable)==!1&&(!browser.ios||!this.children.some(W=>W instanceof TextView))){let W=document.createElement("BR");W.cmIgnore=!0,this.dom.appendChild(W)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let w=0,O;for(let F of this.children){if(!(F instanceof TextView)||/[^ -~]/.test(F.text))return null;let q=clientRectsFor(F.dom);if(q.length!=1)return null;w+=q[0].width,O=q[0].height}return w?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:w/this.length,textHeight:O}:null}coordsAt(w,O){let F=coordsInChildren(this,w,O);if(!this.children.length&&F&&this.parent){let{heightOracle:q}=this.parent.view.viewState,W=F.bottom-F.top;if(Math.abs(W-q.lineHeight)<2&&q.textHeight<W){let U=(W-q.textHeight)/2;return{top:F.top+U,bottom:F.bottom-U,left:F.left,right:F.left}}}return F}become(w){return w instanceof LineView&&this.children.length==0&&w.children.length==0&&attrsEq(this.attrs,w.attrs)&&this.breakAfter==w.breakAfter}covers(){return!0}static find(w,O){for(let F=0,q=0;F<w.children.length;F++){let W=w.children[F],U=q+W.length;if(U>=O){if(W instanceof LineView)return W;if(U>O)break}q=U+W.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(w,O,F){super(),this.widget=w,this.length=O,this.deco=F,this.breakAfter=0,this.prevWidget=null}merge(w,O,F,q,W,U){return F&&(!(F instanceof BlockWidgetView)||!this.widget.compare(F.widget)||w>0&&W<=0||O<this.length&&U<=0)?!1:(this.length=w+(F?F.length:0)+(this.length-O),!0)}domAtPos(w){return w==0?DOMPos.before(this.dom):DOMPos.after(this.dom,w==this.length)}split(w){let O=this.length-w;this.length=w;let F=new BlockWidgetView(this.widget,O,this.deco);return F.breakAfter=this.breakAfter,F}get children(){return noChildren}sync(w){(!this.dom||!this.widget.updateDOM(this.dom,w))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(w)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}domBoundsAround(){return null}become(w){return w instanceof BlockWidgetView&&w.widget.constructor==this.widget.constructor?(w.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=w.widget,this.length=w.length,this.deco=w.deco,this.breakAfter=w.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(w){return this.widget.ignoreEvent(w)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(w,O){let F=this.widget.coordsAt(this.dom,w,O);return F||(this.widget instanceof BlockGapWidget?null:flattenRect(this.dom.getBoundingClientRect(),this.length?w==0:O<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(w){let{startSide:O,endSide:F}=this.deco;return O==F?!1:w<0?O<0:F>0}}class BlockGapWidget extends WidgetType{constructor(w){super(),this.height=w}toDOM(){let w=document.createElement("div");return w.className="cm-gap",this.updateDOM(w),w}eq(w){return w.height==this.height}updateDOM(w){return w.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class ContentBuilder{constructor(w,O,F,q){this.doc=w,this.pos=O,this.end=F,this.disallowBlockEffectsFor=q,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=w.iter(),this.skip=O}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let w=this.content[this.content.length-1];return!(w.breakAfter||w instanceof BlockWidgetView&&w.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(w=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),w),w.length),this.pendingBuffer=0)}addBlockWidget(w){this.flushBuffer(),this.curLine=null,this.content.push(w)}finish(w){this.pendingBuffer&&w<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(w&&this.content.length&&this.content[this.content.length-1]instanceof BlockWidgetView)&&this.getLine()}buildText(w,O,F){for(;w>0;){if(this.textOff==this.text.length){let{value:W,lineBreak:U,done:K}=this.cursor.next(this.skip);if(this.skip=0,K)throw new Error("Ran out of text content when drawing inline views");if(U){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,w--;continue}else this.text=W,this.textOff=0}let q=Math.min(this.text.length-this.textOff,w,512);this.flushBuffer(O.slice(O.length-F)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+q)),O),F),this.atCursorPos=!0,this.textOff+=q,w-=q,F=0}}span(w,O,F,q){this.buildText(O-w,F,q),this.pos=O,this.openStart<0&&(this.openStart=q)}point(w,O,F,q,W,U){if(this.disallowBlockEffectsFor[U]&&F instanceof PointDecoration){if(F.block)throw new RangeError("Block decorations may not be specified via plugins");if(O>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let K=O-w;if(F instanceof PointDecoration)if(F.block)F.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(F.widget||NullWidget.block,K,F));else{let G=WidgetView.create(F.widget||NullWidget.inline,K,K?0:F.startSide),Y=this.atCursorPos&&!G.isEditable&&W<=q.length&&(w<O||F.startSide>0),Q=!G.isEditable&&(w<O||W>q.length||F.startSide<=0),X=this.getLine();this.pendingBuffer==2&&!Y&&!G.isEditable&&(this.pendingBuffer=0),this.flushBuffer(q),Y&&(X.append(wrapMarks(new WidgetBufferView(1),q),W),W=q.length+Math.max(0,W-q.length)),X.append(wrapMarks(G,q),W),this.atCursorPos=Q,this.pendingBuffer=Q?w<O||W>q.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=q.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(F);K&&(this.textOff+K<=this.text.length?this.textOff+=K:(this.skip+=K-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=O),this.openStart<0&&(this.openStart=W)}static build(w,O,F,q,W){let U=new ContentBuilder(w,O,F,W);return U.openEnd=RangeSet.spans(q,O,F,U),U.openStart<0&&(U.openStart=U.openEnd),U.finish(U.openEnd),U}}function wrapMarks(D,w){for(let O of w)D=new MarkView(O,[D],D.length);return D}class NullWidget extends WidgetType{constructor(w){super(),this.tag=w}eq(w){return w.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(w){return w.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}NullWidget.inline=new NullWidget("span");NullWidget.block=new NullWidget("div");var Direction=function(D){return D[D.LTR=0]="LTR",D[D.RTL=1]="RTL",D}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(D){let w=[];for(let O=0;O<D.length;O++)w.push(1<<+D[O]);return w}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let D of["()","[]","{}"]){let w=D.charCodeAt(0),O=D.charCodeAt(1);Brackets[w]=O,Brackets[O]=-w}function charType(D){return D<=247?LowTypes[D]:1424<=D&&D<=1524?2:1536<=D&&D<=1785?ArabicTypes[D-1536]:1774<=D&&D<=2220?4:8192<=D&&D<=8204?256:64336<=D&&D<=65023?4:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{get dir(){return this.level%2?RTL:LTR}constructor(w,O,F){this.from=w,this.to=O,this.level=F}side(w,O){return this.dir==O==w?this.to:this.from}forward(w,O){return w==(this.dir==O)}static find(w,O,F,q){let W=-1;for(let U=0;U<w.length;U++){let K=w[U];if(K.from<=O&&K.to>=O){if(K.level==F)return U;(W<0||(q!=0?q<0?K.from<O:K.to>O:w[W].level>K.level))&&(W=U)}}if(W<0)throw new RangeError("Index out of range");return W}}function isolatesEq(D,w){if(D.length!=w.length)return!1;for(let O=0;O<D.length;O++){let F=D[O],q=w[O];if(F.from!=q.from||F.to!=q.to||F.direction!=q.direction||!isolatesEq(F.inner,q.inner))return!1}return!0}const types=[];function computeCharTypes(D,w,O,F,q){for(let W=0;W<=F.length;W++){let U=W?F[W-1].to:w,K=W<F.length?F[W].from:O,G=W?256:q;for(let Y=U,Q=G,X=G;Y<K;Y++){let J=charType(D.charCodeAt(Y));J==512?J=Q:J==8&&X==4&&(J=16),types[Y]=J==4?2:J,J&7&&(X=J),Q=J}for(let Y=U,Q=G,X=G;Y<K;Y++){let J=types[Y];if(J==128)Y<K-1&&Q==types[Y+1]&&Q&24?J=types[Y]=Q:types[Y]=256;else if(J==64){let Z=Y+1;for(;Z<K&&types[Z]==64;)Z++;let ee=Y&&Q==8||Z<O&&types[Z]==8?X==1?1:8:256;for(let ne=Y;ne<Z;ne++)types[ne]=ee;Y=Z-1}else J==8&&X==1&&(types[Y]=1);Q=J,J&7&&(X=J)}}}function processBracketPairs(D,w,O,F,q){let W=q==1?2:1;for(let U=0,K=0,G=0;U<=F.length;U++){let Y=U?F[U-1].to:w,Q=U<F.length?F[U].from:O;for(let X=Y,J,Z,ee;X<Q;X++)if(Z=Brackets[J=D.charCodeAt(X)])if(Z<0){for(let ne=K-3;ne>=0;ne-=3)if(BracketStack[ne+1]==-Z){let te=BracketStack[ne+2],re=te&2?q:te&4?te&1?W:q:0;re&&(types[X]=types[BracketStack[ne]]=re),K=ne;break}}else{if(BracketStack.length==189)break;BracketStack[K++]=X,BracketStack[K++]=J,BracketStack[K++]=G}else if((ee=types[X])==2||ee==1){let ne=ee==q;G=ne?0:1;for(let te=K-3;te>=0;te-=3){let re=BracketStack[te+2];if(re&2)break;if(ne)BracketStack[te+2]|=2;else{if(re&4)break;BracketStack[te+2]|=4}}}}}function processNeutrals(D,w,O,F){for(let q=0,W=F;q<=O.length;q++){let U=q?O[q-1].to:D,K=q<O.length?O[q].from:w;for(let G=U;G<K;){let Y=types[G];if(Y==256){let Q=G+1;for(;;)if(Q==K){if(q==O.length)break;Q=O[q++].to,K=q<O.length?O[q].from:w}else if(types[Q]==256)Q++;else break;let X=W==1,J=(Q<w?types[Q]:F)==1,Z=X==J?X?1:2:F;for(let ee=Q,ne=q,te=ne?O[ne-1].to:D;ee>G;)ee==te&&(ee=O[--ne].from,te=ne?O[ne-1].to:D),types[--ee]=Z;G=Q}else W=Y,G++}}}function emitSpans(D,w,O,F,q,W,U){let K=F%2?2:1;if(F%2==q%2)for(let G=w,Y=0;G<O;){let Q=!0,X=!1;if(Y==W.length||G<W[Y].from){let ne=types[G];ne!=K&&(Q=!1,X=ne==16)}let J=!Q&&K==1?[]:null,Z=Q?F:F+1,ee=G;e:for(;;)if(Y<W.length&&ee==W[Y].from){if(X)break e;let ne=W[Y];if(!Q)for(let te=ne.to,re=Y+1;;){if(te==O)break e;if(re<W.length&&W[re].from==te)te=W[re++].to;else{if(types[te]==K)break e;break}}if(Y++,J)J.push(ne);else{ne.from>G&&U.push(new BidiSpan(G,ne.from,Z));let te=ne.direction==LTR!=!(Z%2);computeSectionOrder(D,te?F+1:F,q,ne.inner,ne.from,ne.to,U),G=ne.to}ee=ne.to}else{if(ee==O||(Q?types[ee]!=K:types[ee]==K))break;ee++}J?emitSpans(D,G,ee,F+1,q,J,U):G<ee&&U.push(new BidiSpan(G,ee,Z)),G=ee}else for(let G=O,Y=W.length;G>w;){let Q=!0,X=!1;if(!Y||G>W[Y-1].to){let ne=types[G-1];ne!=K&&(Q=!1,X=ne==16)}let J=!Q&&K==1?[]:null,Z=Q?F:F+1,ee=G;e:for(;;)if(Y&&ee==W[Y-1].to){if(X)break e;let ne=W[--Y];if(!Q)for(let te=ne.from,re=Y;;){if(te==w)break e;if(re&&W[re-1].to==te)te=W[--re].from;else{if(types[te-1]==K)break e;break}}if(J)J.push(ne);else{ne.to<G&&U.push(new BidiSpan(ne.to,G,Z));let te=ne.direction==LTR!=!(Z%2);computeSectionOrder(D,te?F+1:F,q,ne.inner,ne.from,ne.to,U),G=ne.from}ee=ne.from}else{if(ee==w||(Q?types[ee-1]!=K:types[ee-1]==K))break;ee--}J?emitSpans(D,ee,G,F+1,q,J,U):ee<G&&U.push(new BidiSpan(ee,G,Z)),G=ee}}function computeSectionOrder(D,w,O,F,q,W,U){let K=w%2?2:1;computeCharTypes(D,q,W,F,K),processBracketPairs(D,q,W,F,K),processNeutrals(q,W,F,K),emitSpans(D,q,W,w,O,F,U)}function computeOrder(D,w,O){if(!D)return[new BidiSpan(0,0,w==RTL?1:0)];if(w==LTR&&!O.length&&!BidiRE.test(D))return trivialOrder(D.length);if(O.length)for(;D.length>types.length;)types[types.length]=256;let F=[],q=w==LTR?0:1;return computeSectionOrder(D,q,q,O,0,D.length,F),F}function trivialOrder(D){return[new BidiSpan(0,D,0)]}let movedOver="";function moveVisually(D,w,O,F,q){var W;let U=F.head-D.from,K=BidiSpan.find(w,U,(W=F.bidiLevel)!==null&&W!==void 0?W:-1,F.assoc),G=w[K],Y=G.side(q,O);if(U==Y){let J=K+=q?1:-1;if(J<0||J>=w.length)return null;G=w[K=J],U=G.side(!q,O),Y=G.side(q,O)}let Q=findClusterBreak(D.text,U,G.forward(q,O));(Q<G.from||Q>G.to)&&(Q=Y),movedOver=D.text.slice(Math.min(U,Q),Math.max(U,Q));let X=K==(q?w.length-1:0)?null:w[K+(q?1:-1)];return X&&Q==Y&&X.level+(q?0:1)<G.level?EditorSelection.cursor(X.side(!q,O)+D.from,X.forward(q,O)?1:-1,X.level):EditorSelection.cursor(Q+D.from,G.forward(q,O)?-1:1,G.level)}function autoDirection(D,w,O){for(let F=w;F<O;F++){let q=charType(D.charCodeAt(F));if(q==1)return LTR;if(q==2||q==4)return RTL}return LTR}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler$1=Facet.define(),focusChangeEffect=Facet.define(),clipboardInputFilter=Facet.define(),clipboardOutputFilter=Facet.define(),perLineTextDirection=Facet.define({combine:D=>D.some(w=>w)}),nativeSelectionHidden=Facet.define({combine:D=>D.some(w=>w)}),scrollHandler=Facet.define();class ScrollTarget{constructor(w,O="nearest",F="nearest",q=5,W=5,U=!1){this.range=w,this.y=O,this.x=F,this.yMargin=q,this.xMargin=W,this.isSnapshot=U}map(w){return w.empty?this:new ScrollTarget(this.range.map(w),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(w){return this.range.to<=w.doc.length?this:new ScrollTarget(EditorSelection.cursor(w.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const scrollIntoView$1=StateEffect.define({map:(D,w)=>D.map(w)}),setEditContextFormatting=StateEffect.define();function logException(D,w,O){let F=D.facet(exceptionSink);F.length?F[0](w):window.onerror?window.onerror(String(w),O,void 0,void 0,w):O?console.error(O+":",w):console.error(w)}const editable=Facet.define({combine:D=>D.length?D[0]:!0});let nextPluginID=0;const viewPlugin=Facet.define();class ViewPlugin{constructor(w,O,F,q,W){this.id=w,this.create=O,this.domEventHandlers=F,this.domEventObservers=q,this.extension=W(this)}static define(w,O){const{eventHandlers:F,eventObservers:q,provide:W,decorations:U}=O||{};return new ViewPlugin(nextPluginID++,w,F,q,K=>{let G=[viewPlugin.of(K)];return U&&G.push(decorations.of(Y=>{let Q=Y.plugin(K);return Q?U(Q):Decoration.none})),W&&G.push(W(K)),G})}static fromClass(w,O){return ViewPlugin.define(F=>new w(F),O)}}class PluginInstance{constructor(w){this.spec=w,this.mustUpdate=null,this.value=null}update(w){if(this.value){if(this.mustUpdate){let O=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(O)}catch(F){if(logException(O.state,F,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(w)}catch(O){logException(w.state,O,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(w){var O;if(!((O=this.value)===null||O===void 0)&&O.destroy)try{this.value.destroy()}catch(F){logException(w.state,F,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),outerDecorations=Facet.define(),atomicRanges=Facet.define(),bidiIsolatedRanges=Facet.define();function getIsolatedRanges(D,w){let O=D.state.facet(bidiIsolatedRanges);if(!O.length)return O;let F=O.map(W=>W instanceof Function?W(D):W),q=[];return RangeSet.spans(F,w.from,w.to,{point(){},span(W,U,K,G){let Y=W-w.from,Q=U-w.from,X=q;for(let J=K.length-1;J>=0;J--,G--){let Z=K[J].spec.bidiIsolate,ee;if(Z==null&&(Z=autoDirection(w.text,Y,Q)),G>0&&X.length&&(ee=X[X.length-1]).to==Y&&ee.direction==Z)ee.to=Q,X=ee.inner;else{let ne={from:Y,to:Q,direction:Z,inner:[]};X.push(ne),X=ne.inner}}}}),q}const scrollMargins=Facet.define();function getScrollMargins(D){let w=0,O=0,F=0,q=0;for(let W of D.state.facet(scrollMargins)){let U=W(D);U&&(U.left!=null&&(w=Math.max(w,U.left)),U.right!=null&&(O=Math.max(O,U.right)),U.top!=null&&(F=Math.max(F,U.top)),U.bottom!=null&&(q=Math.max(q,U.bottom)))}return{left:w,right:O,top:F,bottom:q}}const styleModule=Facet.define();class ChangedRange{constructor(w,O,F,q){this.fromA=w,this.toA=O,this.fromB=F,this.toB=q}join(w){return new ChangedRange(Math.min(this.fromA,w.fromA),Math.max(this.toA,w.toA),Math.min(this.fromB,w.fromB),Math.max(this.toB,w.toB))}addToSet(w){let O=w.length,F=this;for(;O>0;O--){let q=w[O-1];if(!(q.fromA>F.toA)){if(q.toA<F.fromA)break;F=F.join(q),w.splice(O-1,1)}}return w.splice(O,0,F),w}static extendWithRanges(w,O){if(O.length==0)return w;let F=[];for(let q=0,W=0,U=0,K=0;;q++){let G=q==w.length?null:w[q],Y=U-K,Q=G?G.fromB:1e9;for(;W<O.length&&O[W]<Q;){let X=O[W],J=O[W+1],Z=Math.max(K,X),ee=Math.min(Q,J);if(Z<=ee&&new ChangedRange(Z+Y,ee+Y,Z,ee).addToSet(F),J>Q)break;W+=2}if(!G)return F;new ChangedRange(G.fromA,G.toA,G.fromB,G.toB).addToSet(F),U=G.toA,K=G.toB}}}class ViewUpdate{constructor(w,O,F){this.view=w,this.state=O,this.transactions=F,this.flags=0,this.startState=w.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let W of F)this.changes=this.changes.compose(W.changes);let q=[];this.changes.iterChangedRanges((W,U,K,G)=>q.push(new ChangedRange(W,U,K,G))),this.changedRanges=q}static create(w,O,F){return new ViewUpdate(w,O,F)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(w=>w.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class DocView extends ContentView{get length(){return this.view.state.doc.length}constructor(w){super(),this.view=w,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Decoration.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(w.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,w.state.doc.length)],0,null)}update(w){var O;let F=w.changedRanges;this.minWidth>0&&F.length&&(F.every(({fromA:Y,toA:Q})=>Q<this.minWidthFrom||Y>this.minWidthTo)?(this.minWidthFrom=w.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=w.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(w);let q=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((O=this.domChanged)===null||O===void 0)&&O.newSel?q=this.domChanged.newSel.head:!touchesComposition(w.changes,this.hasComposition)&&!w.selectionSet&&(q=w.state.selection.main.head));let W=q>-1?findCompositionRange(this.view,w.changes,q):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:Y,to:Q}=this.hasComposition;F=new ChangedRange(Y,Q,w.changes.mapPos(Y,-1),w.changes.mapPos(Q,1)).addToSet(F.slice())}this.hasComposition=W?{from:W.range.fromB,to:W.range.toB}:null,(browser.ie||browser.chrome)&&!W&&w&&w.state.doc.lines!=w.startState.doc.lines&&(this.forceSelection=!0);let U=this.decorations,K=this.updateDeco(),G=findChangedDeco(U,K,w.changes);return F=ChangedRange.extendWithRanges(F,G),!(this.flags&7)&&F.length==0?!1:(this.updateInner(F,w.startState.doc.length,W),w.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(w,O,F){this.view.viewState.mustMeasureContent=!0,this.updateChildren(w,O,F);let{observer:q}=this.view;q.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let U=browser.chrome||browser.ios?{node:q.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,U),this.flags&=-8,U&&(U.written||q.selectionRange.focusNode!=U.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(U=>U.flags&=-9);let W=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let U of this.children)U instanceof BlockWidgetView&&U.widget instanceof BlockGapWidget&&W.push(U.dom);q.updateGaps(W)}updateChildren(w,O,F){let q=F?F.range.addToSet(w.slice()):w,W=this.childCursor(O);for(let U=q.length-1;;U--){let K=U>=0?q[U]:null;if(!K)break;let{fromA:G,toA:Y,fromB:Q,toB:X}=K,J,Z,ee,ne;if(F&&F.range.fromB<X&&F.range.toB>Q){let ue=ContentBuilder.build(this.view.state.doc,Q,F.range.fromB,this.decorations,this.dynamicDecorationMap),oe=ContentBuilder.build(this.view.state.doc,F.range.toB,X,this.decorations,this.dynamicDecorationMap);Z=ue.breakAtStart,ee=ue.openStart,ne=oe.openEnd;let ae=this.compositionView(F);oe.breakAtStart?ae.breakAfter=1:oe.content.length&&ae.merge(ae.length,ae.length,oe.content[0],!1,oe.openStart,0)&&(ae.breakAfter=oe.content[0].breakAfter,oe.content.shift()),ue.content.length&&ae.merge(0,0,ue.content[ue.content.length-1],!0,0,ue.openEnd)&&ue.content.pop(),J=ue.content.concat(ae).concat(oe.content)}else({content:J,breakAtStart:Z,openStart:ee,openEnd:ne}=ContentBuilder.build(this.view.state.doc,Q,X,this.decorations,this.dynamicDecorationMap));let{i:te,off:re}=W.findPos(Y,1),{i:se,off:le}=W.findPos(G,-1);replaceRange(this,se,le,te,re,J,Z,ee,ne)}F&&this.fixCompositionDOM(F)}updateEditContextFormatting(w){this.editContextFormatting=this.editContextFormatting.map(w.changes);for(let O of w.transactions)for(let F of O.effects)F.is(setEditContextFormatting)&&(this.editContextFormatting=F.value)}compositionView(w){let O=new TextView(w.text.nodeValue);O.flags|=8;for(let{deco:q}of w.marks)O=new MarkView(q,[O],O.length);let F=new LineView;return F.append(O,0),F}fixCompositionDOM(w){let O=(W,U)=>{U.flags|=8|(U.children.some(G=>G.flags&7)?1:0),this.markedForComposition.add(U);let K=ContentView.get(W);K&&K!=U&&(K.dom=null),U.setDOM(W)},F=this.childPos(w.range.fromB,1),q=this.children[F.i];O(w.line,q);for(let W=w.marks.length-1;W>=-1;W--)F=q.childPos(F.off,1),q=q.children[F.i],O(W>=0?w.marks[W].node:w.text,q)}updateSelection(w=!1,O=!1){(w||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let F=this.view.root.activeElement,q=F==this.dom,W=!q&&!(this.view.state.facet(editable)||this.dom.tabIndex>-1)&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(F&&this.dom.contains(F));if(!(q||O||W))return;let U=this.forceSelection;this.forceSelection=!1;let K=this.view.state.selection.main,G=this.moveToLine(this.domAtPos(K.anchor)),Y=K.empty?G:this.moveToLine(this.domAtPos(K.head));if(browser.gecko&&K.empty&&!this.hasComposition&&betweenUneditable(G)){let X=document.createTextNode("");this.view.observer.ignore(()=>G.node.insertBefore(X,G.node.childNodes[G.offset]||null)),G=Y=new DOMPos(X,0),U=!0}let Q=this.view.observer.selectionRange;(U||!Q.focusNode||(!isEquivalentPosition(G.node,G.offset,Q.anchorNode,Q.anchorOffset)||!isEquivalentPosition(Y.node,Y.offset,Q.focusNode,Q.focusOffset))&&!this.suppressWidgetCursorChange(Q,K))&&(this.view.observer.ignore(()=>{browser.android&&browser.chrome&&this.dom.contains(Q.focusNode)&&inUneditable(Q.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let X=getSelection(this.view.root);if(X)if(K.empty){if(browser.gecko){let J=nextToUneditable(G.node,G.offset);if(J&&J!=3){let Z=(J==1?textNodeBefore:textNodeAfter)(G.node,G.offset);Z&&(G=new DOMPos(Z.node,Z.offset))}}X.collapse(G.node,G.offset),K.bidiLevel!=null&&X.caretBidiLevel!==void 0&&(X.caretBidiLevel=K.bidiLevel)}else if(X.extend){X.collapse(G.node,G.offset);try{X.extend(Y.node,Y.offset)}catch{}}else{let J=document.createRange();K.anchor>K.head&&([G,Y]=[Y,G]),J.setEnd(Y.node,Y.offset),J.setStart(G.node,G.offset),X.removeAllRanges(),X.addRange(J)}W&&this.view.root.activeElement==this.dom&&(this.dom.blur(),F&&F.focus())}),this.view.observer.setSelectionRange(G,Y)),this.impreciseAnchor=G.precise?null:new DOMPos(Q.anchorNode,Q.anchorOffset),this.impreciseHead=Y.precise?null:new DOMPos(Q.focusNode,Q.focusOffset)}suppressWidgetCursorChange(w,O){return this.hasComposition&&O.empty&&isEquivalentPosition(w.focusNode,w.focusOffset,w.anchorNode,w.anchorOffset)&&this.posFromDOM(w.focusNode,w.focusOffset)==O.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:w}=this,O=w.state.selection.main,F=getSelection(w.root),{anchorNode:q,anchorOffset:W}=w.observer.selectionRange;if(!F||!O.empty||!O.assoc||!F.modify)return;let U=LineView.find(this,O.head);if(!U)return;let K=U.posAtStart;if(O.head==K||O.head==K+U.length)return;let G=this.coordsAt(O.head,-1),Y=this.coordsAt(O.head,1);if(!G||!Y||G.bottom>Y.top)return;let Q=this.domAtPos(O.head+O.assoc);F.collapse(Q.node,Q.offset),F.modify("move",O.assoc<0?"forward":"backward","lineboundary"),w.observer.readSelectionRange();let X=w.observer.selectionRange;w.docView.posFromDOM(X.anchorNode,X.anchorOffset)!=O.from&&F.collapse(q,W)}moveToLine(w){let O=this.dom,F;if(w.node!=O)return w;for(let q=w.offset;!F&&q<O.childNodes.length;q++){let W=ContentView.get(O.childNodes[q]);W instanceof LineView&&(F=W.domAtPos(0))}for(let q=w.offset-1;!F&&q>=0;q--){let W=ContentView.get(O.childNodes[q]);W instanceof LineView&&(F=W.domAtPos(W.length))}return F?new DOMPos(F.node,F.offset,!0):w}nearest(w){for(let O=w;O;){let F=ContentView.get(O);if(F&&F.rootView==this)return F;O=O.parentNode}return null}posFromDOM(w,O){let F=this.nearest(w);if(!F)throw new RangeError("Trying to find position for a DOM position outside of the document");return F.localPosFromDOM(w,O)+F.posAtStart}domAtPos(w){let{i:O,off:F}=this.childCursor().findPos(w,-1);for(;O<this.children.length-1;){let q=this.children[O];if(F<q.length||q instanceof LineView)break;O++,F=0}return this.children[O].domAtPos(F)}coordsAt(w,O){let F=null,q=0;for(let W=this.length,U=this.children.length-1;U>=0;U--){let K=this.children[U],G=W-K.breakAfter,Y=G-K.length;if(G<w)break;if(Y<=w&&(Y<w||K.covers(-1))&&(G>w||K.covers(1))&&(!F||K instanceof LineView&&!(F instanceof LineView&&O>=0)))F=K,q=Y;else if(F&&Y==w&&G==w&&K instanceof BlockWidgetView&&Math.abs(O)<2){if(K.deco.startSide<0)break;U&&(F=null)}W=Y}return F?F.coordsAt(w-q,O):null}coordsForChar(w){let{i:O,off:F}=this.childPos(w,1),q=this.children[O];if(!(q instanceof LineView))return null;for(;q.children.length;){let{i:K,off:G}=q.childPos(F,1);for(;;K++){if(K==q.children.length)return null;if((q=q.children[K]).length)break}F=G}if(!(q instanceof TextView))return null;let W=findClusterBreak(q.text,F);if(W==F)return null;let U=textRange(q.dom,F,W).getClientRects();for(let K=0;K<U.length;K++){let G=U[K];if(K==U.length-1||G.top<G.bottom&&G.left<G.right)return G}return null}measureVisibleLineHeights(w){let O=[],{from:F,to:q}=w,W=this.view.contentDOM.clientWidth,U=W>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,K=-1,G=this.view.textDirection==Direction.LTR;for(let Y=0,Q=0;Q<this.children.length;Q++){let X=this.children[Q],J=Y+X.length;if(J>q)break;if(Y>=F){let Z=X.dom.getBoundingClientRect();if(O.push(Z.height),U){let ee=X.dom.lastChild,ne=ee?clientRectsFor(ee):[];if(ne.length){let te=ne[ne.length-1],re=G?te.right-Z.left:Z.right-te.left;re>K&&(K=re,this.minWidth=W,this.minWidthFrom=Y,this.minWidthTo=J)}}}Y=J+X.breakAfter}return O}textDirectionAt(w){let{i:O}=this.childPos(w,1);return getComputedStyle(this.children[O].dom).direction=="rtl"?Direction.RTL:Direction.LTR}measureTextSize(){for(let W of this.children)if(W instanceof LineView){let U=W.measureTextSize();if(U)return U}let w=document.createElement("div"),O,F,q;return w.className="cm-line",w.style.width="99999px",w.style.position="absolute",w.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(w);let W=clientRectsFor(w.firstChild)[0];O=w.getBoundingClientRect().height,F=W?W.width/27:7,q=W?W.height:O,w.remove()}),{lineHeight:O,charWidth:F,textHeight:q}}childCursor(w=this.length){let O=this.children.length;return O&&(w-=this.children[--O].length),new ChildCursor(this.children,w,O)}computeBlockGapDeco(){let w=[],O=this.view.viewState;for(let F=0,q=0;;q++){let W=q==O.viewports.length?null:O.viewports[q],U=W?W.from-1:this.length;if(U>F){let K=(O.lineBlockAt(U).bottom-O.lineBlockAt(F).top)/this.view.scaleY;w.push(Decoration.replace({widget:new BlockGapWidget(K),block:!0,inclusive:!0,isBlockGap:!0}).range(F,U))}if(!W)break;F=W.to+1}return Decoration.set(w)}updateDeco(){let w=1,O=this.view.state.facet(decorations).map(W=>(this.dynamicDecorationMap[w++]=typeof W=="function")?W(this.view):W),F=!1,q=this.view.state.facet(outerDecorations).map((W,U)=>{let K=typeof W=="function";return K&&(F=!0),K?W(this.view):W});for(q.length&&(this.dynamicDecorationMap[w++]=F,O.push(RangeSet.join(q))),this.decorations=[this.editContextFormatting,...O,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];w<this.decorations.length;)this.dynamicDecorationMap[w++]=!1;return this.decorations}scrollIntoView(w){if(w.isSnapshot){let Y=this.view.viewState.lineBlockAt(w.range.head);this.view.scrollDOM.scrollTop=Y.top-w.yMargin,this.view.scrollDOM.scrollLeft=w.xMargin;return}for(let Y of this.view.state.facet(scrollHandler))try{if(Y(this.view,w.range,w))return!0}catch(Q){logException(this.view.state,Q,"scroll handler")}let{range:O}=w,F=this.coordsAt(O.head,O.empty?O.assoc:O.head>O.anchor?-1:1),q;if(!F)return;!O.empty&&(q=this.coordsAt(O.anchor,O.anchor>O.head?-1:1))&&(F={left:Math.min(F.left,q.left),top:Math.min(F.top,q.top),right:Math.max(F.right,q.right),bottom:Math.max(F.bottom,q.bottom)});let W=getScrollMargins(this.view),U={left:F.left-W.left,top:F.top-W.top,right:F.right+W.right,bottom:F.bottom+W.bottom},{offsetWidth:K,offsetHeight:G}=this.view.scrollDOM;scrollRectIntoView(this.view.scrollDOM,U,O.head<O.anchor?-1:1,w.x,w.y,Math.max(Math.min(w.xMargin,K),-K),Math.max(Math.min(w.yMargin,G),-G),this.view.textDirection==Direction.LTR)}}function betweenUneditable(D){return D.node.nodeType==1&&D.node.firstChild&&(D.offset==0||D.node.childNodes[D.offset-1].contentEditable=="false")&&(D.offset==D.node.childNodes.length||D.node.childNodes[D.offset].contentEditable=="false")}function findCompositionNode(D,w){let O=D.observer.selectionRange;if(!O.focusNode)return null;let F=textNodeBefore(O.focusNode,O.focusOffset),q=textNodeAfter(O.focusNode,O.focusOffset),W=F||q;if(q&&F&&q.node!=F.node){let K=ContentView.get(q.node);if(!K||K instanceof TextView&&K.text!=q.node.nodeValue)W=q;else if(D.docView.lastCompositionAfterCursor){let G=ContentView.get(F.node);!G||G instanceof TextView&&G.text!=F.node.nodeValue||(W=q)}}if(D.docView.lastCompositionAfterCursor=W!=F,!W)return null;let U=w-W.offset;return{from:U,to:U+W.node.nodeValue.length,node:W.node}}function findCompositionRange(D,w,O){let F=findCompositionNode(D,O);if(!F)return null;let{node:q,from:W,to:U}=F,K=q.nodeValue;if(/[\n\r]/.test(K)||D.state.doc.sliceString(F.from,F.to)!=K)return null;let G=w.invertedDesc,Y=new ChangedRange(G.mapPos(W),G.mapPos(U),W,U),Q=[];for(let X=q.parentNode;;X=X.parentNode){let J=ContentView.get(X);if(J instanceof MarkView)Q.push({node:X,deco:J.mark});else{if(J instanceof LineView||X.nodeName=="DIV"&&X.parentNode==D.contentDOM)return{range:Y,text:q,marks:Q,line:X};if(X!=D.contentDOM)Q.push({node:X,deco:new MarkDecoration({inclusive:!0,attributes:getAttrs(X),tagName:X.tagName.toLowerCase()})});else return null}}}function nextToUneditable(D,w){return D.nodeType!=1?0:(w&&D.childNodes[w-1].contentEditable=="false"?1:0)|(w<D.childNodes.length&&D.childNodes[w].contentEditable=="false"?2:0)}let DecorationComparator$1=class{constructor(){this.changes=[]}compareRange(w,O){addRange(w,O,this.changes)}comparePoint(w,O){addRange(w,O,this.changes)}boundChange(w){addRange(w,w,this.changes)}};function findChangedDeco(D,w,O){let F=new DecorationComparator$1;return RangeSet.compare(D,w,O,F),F.changes}function inUneditable(D,w){for(let O=D;O&&O!=w;O=O.assignedSlot||O.parentNode)if(O.nodeType==1&&O.contentEditable=="false")return!0;return!1}function touchesComposition(D,w){let O=!1;return w&&D.iterChangedRanges((F,q)=>{F<w.to&&q>w.from&&(O=!0)}),O}function groupAt(D,w,O=1){let F=D.charCategorizer(w),q=D.doc.lineAt(w),W=w-q.from;if(q.length==0)return EditorSelection.cursor(w);W==0?O=1:W==q.length&&(O=-1);let U=W,K=W;O<0?U=findClusterBreak(q.text,W,!1):K=findClusterBreak(q.text,W);let G=F(q.text.slice(U,K));for(;U>0;){let Y=findClusterBreak(q.text,U,!1);if(F(q.text.slice(Y,U))!=G)break;U=Y}for(;K<q.length;){let Y=findClusterBreak(q.text,K);if(F(q.text.slice(K,Y))!=G)break;K=Y}return EditorSelection.range(U+q.from,K+q.from)}function getdx(D,w){return w.left>D?w.left-D:Math.max(0,D-w.right)}function getdy(D,w){return w.top>D?w.top-D:Math.max(0,D-w.bottom)}function yOverlap(D,w){return D.top<w.bottom-1&&D.bottom>w.top+1}function upTop(D,w){return w<D.top?{top:w,left:D.left,right:D.right,bottom:D.bottom}:D}function upBot(D,w){return w>D.bottom?{top:D.top,left:D.left,right:D.right,bottom:w}:D}function domPosAtCoords(D,w,O){let F,q,W,U,K=!1,G,Y,Q,X;for(let ee=D.firstChild;ee;ee=ee.nextSibling){let ne=clientRectsFor(ee);for(let te=0;te<ne.length;te++){let re=ne[te];q&&yOverlap(q,re)&&(re=upTop(upBot(re,q.bottom),q.top));let se=getdx(w,re),le=getdy(O,re);if(se==0&&le==0)return ee.nodeType==3?domPosInText(ee,w,O):domPosAtCoords(ee,w,O);if(!F||U>le||U==le&&W>se){F=ee,q=re,W=se,U=le;let ue=le?O<re.top?-1:1:se?w<re.left?-1:1:0;K=!ue||(ue>0?te<ne.length-1:te>0)}se==0?O>re.bottom&&(!Q||Q.bottom<re.bottom)?(G=ee,Q=re):O<re.top&&(!X||X.top>re.top)&&(Y=ee,X=re):Q&&yOverlap(Q,re)?Q=upBot(Q,re.bottom):X&&yOverlap(X,re)&&(X=upTop(X,re.top))}}if(Q&&Q.bottom>=O?(F=G,q=Q):X&&X.top<=O&&(F=Y,q=X),!F)return{node:D,offset:0};let J=Math.max(q.left,Math.min(q.right,w));if(F.nodeType==3)return domPosInText(F,J,O);if(K&&F.contentEditable!="false")return domPosAtCoords(F,J,O);let Z=Array.prototype.indexOf.call(D.childNodes,F)+(w>=(q.left+q.right)/2?1:0);return{node:D,offset:Z}}function domPosInText(D,w,O){let F=D.nodeValue.length,q=-1,W=1e9,U=0;for(let K=0;K<F;K++){let G=textRange(D,K,K+1).getClientRects();for(let Y=0;Y<G.length;Y++){let Q=G[Y];if(Q.top==Q.bottom)continue;U||(U=w-Q.left);let X=(Q.top>O?Q.top-O:O-Q.bottom)-1;if(Q.left-1<=w&&Q.right+1>=w&&X<W){let J=w>=(Q.left+Q.right)/2,Z=J;if((browser.chrome||browser.gecko)&&textRange(D,K).getBoundingClientRect().left==Q.right&&(Z=!J),X<=0)return{node:D,offset:K+(Z?1:0)};q=K+(Z?1:0),W=X}}}return{node:D,offset:q>-1?q:U>0?D.nodeValue.length:0}}function posAtCoords(D,w,O,F=-1){var q,W;let U=D.contentDOM.getBoundingClientRect(),K=U.top+D.viewState.paddingTop,G,{docHeight:Y}=D.viewState,{x:Q,y:X}=w,J=X-K;if(J<0)return 0;if(J>Y)return D.state.doc.length;for(let ue=D.viewState.heightOracle.textHeight/2,oe=!1;G=D.elementAtHeight(J),G.type!=BlockType.Text;)for(;J=F>0?G.bottom+ue:G.top-ue,!(J>=0&&J<=Y);){if(oe)return O?null:0;oe=!0,F=-F}X=K+J;let Z=G.from;if(Z<D.viewport.from)return D.viewport.from==0?0:O?null:posAtCoordsImprecise(D,U,G,Q,X);if(Z>D.viewport.to)return D.viewport.to==D.state.doc.length?D.state.doc.length:O?null:posAtCoordsImprecise(D,U,G,Q,X);let ee=D.dom.ownerDocument,ne=D.root.elementFromPoint?D.root:ee,te=ne.elementFromPoint(Q,X);te&&!D.contentDOM.contains(te)&&(te=null),te||(Q=Math.max(U.left+1,Math.min(U.right-1,Q)),te=ne.elementFromPoint(Q,X),te&&!D.contentDOM.contains(te)&&(te=null));let re,se=-1;if(te&&((q=D.docView.nearest(te))===null||q===void 0?void 0:q.isEditable)!=!1){if(ee.caretPositionFromPoint){let ue=ee.caretPositionFromPoint(Q,X);ue&&({offsetNode:re,offset:se}=ue)}else if(ee.caretRangeFromPoint){let ue=ee.caretRangeFromPoint(Q,X);ue&&({startContainer:re,startOffset:se}=ue,(!D.contentDOM.contains(re)||browser.safari&&isSuspiciousSafariCaretResult(re,se,Q)||browser.chrome&&isSuspiciousChromeCaretResult(re,se,Q))&&(re=void 0))}re&&(se=Math.min(maxOffset(re),se))}if(!re||!D.docView.dom.contains(re)){let ue=LineView.find(D.docView,Z);if(!ue)return J>G.top+G.height/2?G.to:G.from;({node:re,offset:se}=domPosAtCoords(ue.dom,Q,X))}let le=D.docView.nearest(re);if(!le)return null;if(le.isWidget&&((W=le.dom)===null||W===void 0?void 0:W.nodeType)==1){let ue=le.dom.getBoundingClientRect();return w.y<ue.top||w.y<=ue.bottom&&w.x<=(ue.left+ue.right)/2?le.posAtStart:le.posAtEnd}else return le.localPosFromDOM(re,se)+le.posAtStart}function posAtCoordsImprecise(D,w,O,F,q){let W=Math.round((F-w.left)*D.defaultCharacterWidth);if(D.lineWrapping&&O.height>D.defaultLineHeight*1.5){let K=D.viewState.heightOracle.textHeight,G=Math.floor((q-O.top-(D.defaultLineHeight-K)*.5)/K);W+=G*D.viewState.heightOracle.lineLength}let U=D.state.sliceDoc(O.from,O.to);return O.from+findColumn(U,W,D.state.tabSize)}function isSuspiciousSafariCaretResult(D,w,O){let F;if(D.nodeType!=3||w!=(F=D.nodeValue.length))return!1;for(let q=D.nextSibling;q;q=q.nextSibling)if(q.nodeType!=1||q.nodeName!="BR")return!1;return textRange(D,F-1,F).getBoundingClientRect().left>O}function isSuspiciousChromeCaretResult(D,w,O){if(w!=0)return!1;for(let q=D;;){let W=q.parentNode;if(!W||W.nodeType!=1||W.firstChild!=q)return!1;if(W.classList.contains("cm-line"))break;q=W}let F=D.nodeType==1?D.getBoundingClientRect():textRange(D,0,Math.max(D.nodeValue.length,1)).getBoundingClientRect();return O-F.left>5}function blockAt(D,w){let O=D.lineBlockAt(w);if(Array.isArray(O.type)){for(let F of O.type)if(F.to>w||F.to==w&&(F.to==O.to||F.type==BlockType.Text))return F}return O}function moveToLineBoundary(D,w,O,F){let q=blockAt(D,w.head),W=!F||q.type!=BlockType.Text||!(D.lineWrapping||q.widgetLineBreaks)?null:D.coordsAtPos(w.assoc<0&&w.head>q.from?w.head-1:w.head);if(W){let U=D.dom.getBoundingClientRect(),K=D.textDirectionAt(q.from),G=D.posAtCoords({x:O==(K==Direction.LTR)?U.right-1:U.left+1,y:(W.top+W.bottom)/2});if(G!=null)return EditorSelection.cursor(G,O?-1:1)}return EditorSelection.cursor(O?q.to:q.from,O?-1:1)}function moveByChar(D,w,O,F){let q=D.state.doc.lineAt(w.head),W=D.bidiSpans(q),U=D.textDirectionAt(q.from);for(let K=w,G=null;;){let Y=moveVisually(q,W,U,K,O),Q=movedOver;if(!Y){if(q.number==(O?D.state.doc.lines:1))return K;Q=`
`,q=D.state.doc.line(q.number+(O?1:-1)),W=D.bidiSpans(q),Y=D.visualLineSide(q,!O)}if(G){if(!G(Q))return K}else{if(!F)return Y;G=F(Q)}K=Y}}function byGroup(D,w,O){let F=D.state.charCategorizer(w),q=F(O);return W=>{let U=F(W);return q==CharCategory.Space&&(q=U),q==U}}function moveVertically(D,w,O,F){let q=w.head,W=O?1:-1;if(q==(O?D.state.doc.length:0))return EditorSelection.cursor(q,w.assoc);let U=w.goalColumn,K,G=D.contentDOM.getBoundingClientRect(),Y=D.coordsAtPos(q,w.assoc||-1),Q=D.documentTop;if(Y)U==null&&(U=Y.left-G.left),K=W<0?Y.top:Y.bottom;else{let Z=D.viewState.lineBlockAt(q);U==null&&(U=Math.min(G.right-G.left,D.defaultCharacterWidth*(q-Z.from))),K=(W<0?Z.top:Z.bottom)+Q}let X=G.left+U,J=F??D.viewState.heightOracle.textHeight>>1;for(let Z=0;;Z+=10){let ee=K+(J+Z)*W,ne=posAtCoords(D,{x:X,y:ee},!1,W);if(ee<G.top||ee>G.bottom||(W<0?ne<q:ne>q)){let te=D.docView.coordsForChar(ne),re=!te||ee<te.top?-1:1;return EditorSelection.cursor(ne,re,void 0,U)}}}function skipAtomicRanges(D,w,O){for(;;){let F=0;for(let q of D)q.between(w-1,w+1,(W,U,K)=>{if(w>W&&w<U){let G=F||O||(w-W<U-w?-1:1);w=G<0?W:U,F=G}});if(!F)return w}}function skipAtoms(D,w,O){let F=skipAtomicRanges(D.state.facet(atomicRanges).map(q=>q(D)),O.from,w.head>O.from?-1:1);return F==O.from?O:EditorSelection.cursor(F,F<O.from?1:-1)}const LineBreakPlaceholder="￿";class DOMReader{constructor(w,O){this.points=w,this.text="",this.lineSeparator=O.facet(EditorState.lineSeparator)}append(w){this.text+=w}lineBreak(){this.text+=LineBreakPlaceholder}readRange(w,O){if(!w)return this;let F=w.parentNode;for(let q=w;;){this.findPointBefore(F,q);let W=this.text.length;this.readNode(q);let U=q.nextSibling;if(U==O)break;let K=ContentView.get(q),G=ContentView.get(U);(K&&G?K.breakAfter:(K?K.breakAfter:isBlockElement(q))||isBlockElement(U)&&(q.nodeName!="BR"||q.cmIgnore)&&this.text.length>W)&&this.lineBreak(),q=U}return this.findPointBefore(F,O),this}readTextNode(w){let O=w.nodeValue;for(let F of this.points)F.node==w&&(F.pos=this.text.length+Math.min(F.offset,O.length));for(let F=0,q=this.lineSeparator?null:/\r\n?|\n/g;;){let W=-1,U=1,K;if(this.lineSeparator?(W=O.indexOf(this.lineSeparator,F),U=this.lineSeparator.length):(K=q.exec(O))&&(W=K.index,U=K[0].length),this.append(O.slice(F,W<0?O.length:W)),W<0)break;if(this.lineBreak(),U>1)for(let G of this.points)G.node==w&&G.pos>this.text.length&&(G.pos-=U-1);F=W+U}}readNode(w){if(w.cmIgnore)return;let O=ContentView.get(w),F=O&&O.overrideDOMText;if(F!=null){this.findPointInside(w,F.length);for(let q=F.iter();!q.next().done;)q.lineBreak?this.lineBreak():this.append(q.value)}else w.nodeType==3?this.readTextNode(w):w.nodeName=="BR"?w.nextSibling&&this.lineBreak():w.nodeType==1&&this.readRange(w.firstChild,null)}findPointBefore(w,O){for(let F of this.points)F.node==w&&w.childNodes[F.offset]==O&&(F.pos=this.text.length)}findPointInside(w,O){for(let F of this.points)(w.nodeType==3?F.node==w:w.contains(F.node))&&(F.pos=this.text.length+(isAtEnd(w,F.node,F.offset)?O:0))}}function isAtEnd(D,w,O){for(;;){if(!w||O<maxOffset(w))return!1;if(w==D)return!0;O=domIndex(w)+1,w=w.parentNode}}class DOMPoint{constructor(w,O){this.node=w,this.offset=O,this.pos=-1}}class DOMChange{constructor(w,O,F,q){this.typeOver=q,this.bounds=null,this.text="",this.domChanged=O>-1;let{impreciseHead:W,impreciseAnchor:U}=w.docView;if(w.state.readOnly&&O>-1)this.newSel=null;else if(O>-1&&(this.bounds=w.docView.domBoundsAround(O,F,0))){let K=W||U?[]:selectionPoints(w),G=new DOMReader(K,w.state);G.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=G.text,this.newSel=selectionFromPoints(K,this.bounds.from)}else{let K=w.observer.selectionRange,G=W&&W.node==K.focusNode&&W.offset==K.focusOffset||!contains(w.contentDOM,K.focusNode)?w.state.selection.main.head:w.docView.posFromDOM(K.focusNode,K.focusOffset),Y=U&&U.node==K.anchorNode&&U.offset==K.anchorOffset||!contains(w.contentDOM,K.anchorNode)?w.state.selection.main.anchor:w.docView.posFromDOM(K.anchorNode,K.anchorOffset),Q=w.viewport;if((browser.ios||browser.chrome)&&w.state.selection.main.empty&&G!=Y&&(Q.from>0||Q.to<w.state.doc.length)){let X=Math.min(G,Y),J=Math.max(G,Y),Z=Q.from-X,ee=Q.to-J;(Z==0||Z==1||X==0)&&(ee==0||ee==-1||J==w.state.doc.length)&&(G=0,Y=w.state.doc.length)}this.newSel=EditorSelection.single(Y,G)}}}function applyDOMChange(D,w){let O,{newSel:F}=w,q=D.state.selection.main,W=D.inputState.lastKeyTime>Date.now()-100?D.inputState.lastKeyCode:-1;if(w.bounds){let{from:U,to:K}=w.bounds,G=q.from,Y=null;(W===8||browser.android&&w.text.length<K-U)&&(G=q.to,Y="end");let Q=findDiff(D.state.doc.sliceString(U,K,LineBreakPlaceholder),w.text,G-U,Y);Q&&(browser.chrome&&W==13&&Q.toB==Q.from+2&&w.text.slice(Q.from,Q.toB)==LineBreakPlaceholder+LineBreakPlaceholder&&Q.toB--,O={from:U+Q.from,to:U+Q.toA,insert:Text.of(w.text.slice(Q.from,Q.toB).split(LineBreakPlaceholder))})}else F&&(!D.hasFocus&&D.state.facet(editable)||F.main.eq(q))&&(F=null);if(!O&&!F)return!1;if(!O&&w.typeOver&&!q.empty&&F&&F.main.empty?O={from:q.from,to:q.to,insert:D.state.doc.slice(q.from,q.to)}:(browser.mac||browser.android)&&O&&O.from==O.to&&O.from==q.head-1&&/^\. ?$/.test(O.insert.toString())&&D.contentDOM.getAttribute("autocorrect")=="off"?(F&&O.insert.length==2&&(F=EditorSelection.single(F.main.anchor-1,F.main.head-1)),O={from:O.from,to:O.to,insert:Text.of([O.insert.toString().replace("."," ")])}):O&&O.from>=q.from&&O.to<=q.to&&(O.from!=q.from||O.to!=q.to)&&q.to-q.from-(O.to-O.from)<=4?O={from:q.from,to:q.to,insert:D.state.doc.slice(q.from,O.from).append(O.insert).append(D.state.doc.slice(O.to,q.to))}:browser.chrome&&O&&O.from==O.to&&O.from==q.head&&O.insert.toString()==`
 `&&D.lineWrapping&&(F&&(F=EditorSelection.single(F.main.anchor-1,F.main.head-1)),O={from:q.from,to:q.to,insert:Text.of([" "])}),O)return applyDOMChangeInner(D,O,F,W);if(F&&!F.main.eq(q)){let U=!1,K="select";return D.inputState.lastSelectionTime>Date.now()-50&&(D.inputState.lastSelectionOrigin=="select"&&(U=!0),K=D.inputState.lastSelectionOrigin),D.dispatch({selection:F,scrollIntoView:U,userEvent:K}),!0}else return!1}function applyDOMChangeInner(D,w,O,F=-1){if(browser.ios&&D.inputState.flushIOSKey(w))return!0;let q=D.state.selection.main;if(browser.android&&(w.to==q.to&&(w.from==q.from||w.from==q.from-1&&D.state.sliceDoc(w.from,q.from)==" ")&&w.insert.length==1&&w.insert.lines==2&&dispatchKey(D.contentDOM,"Enter",13)||(w.from==q.from-1&&w.to==q.to&&w.insert.length==0||F==8&&w.insert.length<w.to-w.from&&w.to>q.head)&&dispatchKey(D.contentDOM,"Backspace",8)||w.from==q.from&&w.to==q.to+1&&w.insert.length==0&&dispatchKey(D.contentDOM,"Delete",46)))return!0;let W=w.insert.toString();D.inputState.composing>=0&&D.inputState.composing++;let U,K=()=>U||(U=applyDefaultInsert(D,w,O));return D.state.facet(inputHandler$1).some(G=>G(D,w.from,w.to,W,K))||D.dispatch(K()),!0}function applyDefaultInsert(D,w,O){let F,q=D.state,W=q.selection.main;if(w.from>=W.from&&w.to<=W.to&&w.to-w.from>=(W.to-W.from)/3&&(!O||O.main.empty&&O.main.from==w.from+w.insert.length)&&D.inputState.composing<0){let K=W.from<w.from?q.sliceDoc(W.from,w.from):"",G=W.to>w.to?q.sliceDoc(w.to,W.to):"";F=q.replaceSelection(D.state.toText(K+w.insert.sliceString(0,void 0,D.state.lineBreak)+G))}else{let K=q.changes(w),G=O&&O.main.to<=K.newLength?O.main:void 0;if(q.selection.ranges.length>1&&D.inputState.composing>=0&&w.to<=W.to&&w.to>=W.to-10){let Y=D.state.sliceDoc(w.from,w.to),Q,X=O&&findCompositionNode(D,O.main.head);if(X){let ee=w.insert.length-(w.to-w.from);Q={from:X.from,to:X.to-ee}}else Q=D.state.doc.lineAt(W.head);let J=W.to-w.to,Z=W.to-W.from;F=q.changeByRange(ee=>{if(ee.from==W.from&&ee.to==W.to)return{changes:K,range:G||ee.map(K)};let ne=ee.to-J,te=ne-Y.length;if(ee.to-ee.from!=Z||D.state.sliceDoc(te,ne)!=Y||ee.to>=Q.from&&ee.from<=Q.to)return{range:ee};let re=q.changes({from:te,to:ne,insert:w.insert}),se=ee.to-W.to;return{changes:re,range:G?EditorSelection.range(Math.max(0,G.anchor+se),Math.max(0,G.head+se)):ee.map(re)}})}else F={changes:K,selection:G&&q.selection.replaceRange(G)}}let U="input.type";return(D.composing||D.inputState.compositionPendingChange&&D.inputState.compositionEndedAt>Date.now()-50)&&(D.inputState.compositionPendingChange=!1,U+=".compose",D.inputState.compositionFirstChange&&(U+=".start",D.inputState.compositionFirstChange=!1)),q.update(F,{userEvent:U,scrollIntoView:!0})}function findDiff(D,w,O,F){let q=Math.min(D.length,w.length),W=0;for(;W<q&&D.charCodeAt(W)==w.charCodeAt(W);)W++;if(W==q&&D.length==w.length)return null;let U=D.length,K=w.length;for(;U>0&&K>0&&D.charCodeAt(U-1)==w.charCodeAt(K-1);)U--,K--;if(F=="end"){let G=Math.max(0,W-Math.min(U,K));O-=U+G-W}if(U<W&&D.length<w.length){let G=O<=W&&O>=U?W-O:0;W-=G,K=W+(K-U),U=W}else if(K<W){let G=O<=W&&O>=K?W-O:0;W-=G,U=W+(U-K),K=W}return{from:W,toA:U,toB:K}}function selectionPoints(D){let w=[];if(D.root.activeElement!=D.contentDOM)return w;let{anchorNode:O,anchorOffset:F,focusNode:q,focusOffset:W}=D.observer.selectionRange;return O&&(w.push(new DOMPoint(O,F)),(q!=O||W!=F)&&w.push(new DOMPoint(q,W))),w}function selectionFromPoints(D,w){if(D.length==0)return null;let O=D[0].pos,F=D.length==2?D[1].pos:O;return O>-1&&F>-1?EditorSelection.single(O+w,F+w):null}class InputState{setSelectionOrigin(w){this.lastSelectionOrigin=w,this.lastSelectionTime=Date.now()}constructor(w){this.view=w,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=w.hasFocus,browser.safari&&w.contentDOM.addEventListener("input",()=>null),browser.gecko&&firefoxCopyCutHack(w.contentDOM.ownerDocument)}handleEvent(w){!eventBelongsToEditor(this.view,w)||this.ignoreDuringComposition(w)||w.type=="keydown"&&this.keydown(w)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(w.type,w)):this.runHandlers(w.type,w))}runHandlers(w,O){let F=this.handlers[w];if(F){for(let q of F.observers)q(this.view,O);for(let q of F.handlers){if(O.defaultPrevented)break;if(q(this.view,O)){O.preventDefault();break}}}}ensureHandlers(w){let O=computeHandlers(w),F=this.handlers,q=this.view.contentDOM;for(let W in O)if(W!="scroll"){let U=!O[W].handlers.length,K=F[W];K&&U!=!K.handlers.length&&(q.removeEventListener(W,this.handleEvent),K=null),K||q.addEventListener(W,this.handleEvent,{passive:U})}for(let W in F)W!="scroll"&&!O[W]&&q.removeEventListener(W,this.handleEvent);this.handlers=O}keydown(w){if(this.lastKeyCode=w.keyCode,this.lastKeyTime=Date.now(),w.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&w.keyCode!=27&&modifierCodes.indexOf(w.keyCode)<0&&(this.tabFocusMode=-1),browser.android&&browser.chrome&&!w.synthetic&&(w.keyCode==13||w.keyCode==8))return this.view.observer.delayAndroidKey(w.key,w.keyCode),!0;let O;return browser.ios&&!w.synthetic&&!w.altKey&&!w.metaKey&&((O=PendingKeys.find(F=>F.keyCode==w.keyCode))&&!w.ctrlKey||EmacsyPendingKeys.indexOf(w.key)>-1&&w.ctrlKey&&!w.shiftKey)?(this.pendingIOSKey=O||w,setTimeout(()=>this.flushIOSKey(),250),!0):(w.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(w){let O=this.pendingIOSKey;return!O||O.key=="Enter"&&w&&w.from<w.to&&/^\S+$/.test(w.insert.toString())?!1:(this.pendingIOSKey=void 0,dispatchKey(this.view.contentDOM,O.key,O.keyCode,O instanceof KeyboardEvent?O:void 0))}ignoreDuringComposition(w){return/^key/.test(w.type)?this.composing>0?!0:browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(w){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=w}update(w){this.view.observer.update(w),this.mouseSelection&&this.mouseSelection.update(w),this.draggedContent&&w.docChanged&&(this.draggedContent=this.draggedContent.map(w.changes)),w.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function bindHandler(D,w){return(O,F)=>{try{return w.call(D,F,O)}catch(q){logException(O.state,q)}}}function computeHandlers(D){let w=Object.create(null);function O(F){return w[F]||(w[F]={observers:[],handlers:[]})}for(let F of D){let q=F.spec;if(q&&q.domEventHandlers)for(let W in q.domEventHandlers){let U=q.domEventHandlers[W];U&&O(W).handlers.push(bindHandler(F.value,U))}if(q&&q.domEventObservers)for(let W in q.domEventObservers){let U=q.domEventObservers[W];U&&O(W).observers.push(bindHandler(F.value,U))}}for(let F in handlers)O(F).handlers.push(handlers[F]);for(let F in observers)O(F).observers.push(observers[F]);return w}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225],dragScrollMargin=6;function dragScrollSpeed(D){return Math.max(0,D)*.7+8}function dist(D,w){return Math.max(Math.abs(D.clientX-w.clientX),Math.abs(D.clientY-w.clientY))}class MouseSelection{constructor(w,O,F,q){this.view=w,this.startEvent=O,this.style=F,this.mustSelect=q,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=O,this.scrollParents=scrollableParents(w.contentDOM),this.atoms=w.state.facet(atomicRanges).map(U=>U(w));let W=w.contentDOM.ownerDocument;W.addEventListener("mousemove",this.move=this.move.bind(this)),W.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=O.shiftKey,this.multiple=w.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(w,O),this.dragging=isInPrimarySelection(w,O)&&getClickType(O)==1?null:!1}start(w){this.dragging===!1&&this.select(w)}move(w){if(w.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&dist(this.startEvent,w)<10)return;this.select(this.lastEvent=w);let O=0,F=0,q=0,W=0,U=this.view.win.innerWidth,K=this.view.win.innerHeight;this.scrollParents.x&&({left:q,right:U}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:W,bottom:K}=this.scrollParents.y.getBoundingClientRect());let G=getScrollMargins(this.view);w.clientX-G.left<=q+dragScrollMargin?O=-dragScrollSpeed(q-w.clientX):w.clientX+G.right>=U-dragScrollMargin&&(O=dragScrollSpeed(w.clientX-U)),w.clientY-G.top<=W+dragScrollMargin?F=-dragScrollSpeed(W-w.clientY):w.clientY+G.bottom>=K-dragScrollMargin&&(F=dragScrollSpeed(w.clientY-K)),this.setScrollSpeed(O,F)}up(w){this.dragging==null&&this.select(this.lastEvent),this.dragging||w.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let w=this.view.contentDOM.ownerDocument;w.removeEventListener("mousemove",this.move),w.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(w,O){this.scrollSpeed={x:w,y:O},w||O?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:w,y:O}=this.scrollSpeed;w&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=w,w=0),O&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=O,O=0),(w||O)&&this.view.win.scrollBy(w,O),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(w){let O=null;for(let F=0;F<w.ranges.length;F++){let q=w.ranges[F],W=null;if(q.empty){let U=skipAtomicRanges(this.atoms,q.from,0);U!=q.from&&(W=EditorSelection.cursor(U,-1))}else{let U=skipAtomicRanges(this.atoms,q.from,-1),K=skipAtomicRanges(this.atoms,q.to,1);(U!=q.from||K!=q.to)&&(W=EditorSelection.range(q.from==q.anchor?U:K,q.from==q.head?U:K))}W&&(O||(O=w.ranges.slice()),O[F]=W)}return O?EditorSelection.create(O,w.mainIndex):w}select(w){let{view:O}=this,F=this.skipAtoms(this.style.get(w,this.extend,this.multiple));(this.mustSelect||!F.eq(O.state.selection,this.dragging===!1))&&this.view.dispatch({selection:F,userEvent:"select.pointer"}),this.mustSelect=!1}update(w){w.transactions.some(O=>O.isUserEvent("input.type"))?this.destroy():this.style.update(w)&&setTimeout(()=>this.select(this.lastEvent),20)}}function addsSelectionRange(D,w){let O=D.state.facet(clickAddsSelectionRange);return O.length?O[0](w):browser.mac?w.metaKey:w.ctrlKey}function dragMovesSelection(D,w){let O=D.state.facet(dragMovesSelection$1);return O.length?O[0](w):browser.mac?!w.altKey:!w.ctrlKey}function isInPrimarySelection(D,w){let{main:O}=D.state.selection;if(O.empty)return!1;let F=getSelection(D.root);if(!F||F.rangeCount==0)return!0;let q=F.getRangeAt(0).getClientRects();for(let W=0;W<q.length;W++){let U=q[W];if(U.left<=w.clientX&&U.right>=w.clientX&&U.top<=w.clientY&&U.bottom>=w.clientY)return!0}return!1}function eventBelongsToEditor(D,w){if(!w.bubbles)return!0;if(w.defaultPrevented)return!1;for(let O=w.target,F;O!=D.contentDOM;O=O.parentNode)if(!O||O.nodeType==11||(F=ContentView.get(O))&&F.ignoreEvent(w))return!1;return!0}const handlers=Object.create(null),observers=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(D){let w=D.dom.parentNode;if(!w)return;let O=w.appendChild(document.createElement("textarea"));O.style.cssText="position: fixed; left: -10000px; top: 10px",O.focus(),setTimeout(()=>{D.focus(),O.remove(),doPaste(D,O.value)},50)}function textFilter(D,w,O){for(let F of D.facet(w))O=F(O,D);return O}function doPaste(D,w){w=textFilter(D.state,clipboardInputFilter,w);let{state:O}=D,F,q=1,W=O.toText(w),U=W.lines==O.selection.ranges.length;if(lastLinewiseCopy!=null&&O.selection.ranges.every(G=>G.empty)&&lastLinewiseCopy==W.toString()){let G=-1;F=O.changeByRange(Y=>{let Q=O.doc.lineAt(Y.from);if(Q.from==G)return{range:Y};G=Q.from;let X=O.toText((U?W.line(q++).text:w)+O.lineBreak);return{changes:{from:Q.from,insert:X},range:EditorSelection.cursor(Y.from+X.length)}})}else U?F=O.changeByRange(G=>{let Y=W.line(q++);return{changes:{from:G.from,to:G.to,insert:Y.text},range:EditorSelection.cursor(G.from+Y.length)}}):F=O.replaceSelection(W);D.dispatch(F,{userEvent:"input.paste",scrollIntoView:!0})}observers.scroll=D=>{D.inputState.lastScrollTop=D.scrollDOM.scrollTop,D.inputState.lastScrollLeft=D.scrollDOM.scrollLeft};handlers.keydown=(D,w)=>(D.inputState.setSelectionOrigin("select"),w.keyCode==27&&D.inputState.tabFocusMode!=0&&(D.inputState.tabFocusMode=Date.now()+2e3),!1);observers.touchstart=(D,w)=>{D.inputState.lastTouchTime=Date.now(),D.inputState.setSelectionOrigin("select.pointer")};observers.touchmove=D=>{D.inputState.setSelectionOrigin("select.pointer")};handlers.mousedown=(D,w)=>{if(D.observer.flush(),D.inputState.lastTouchTime>Date.now()-2e3)return!1;let O=null;for(let F of D.state.facet(mouseSelectionStyle))if(O=F(D,w),O)break;if(!O&&w.button==0&&(O=basicMouseSelection(D,w)),O){let F=!D.hasFocus;D.inputState.startMouseSelection(new MouseSelection(D,w,O,F)),F&&D.observer.ignore(()=>{focusPreventScroll(D.contentDOM);let W=D.root.activeElement;W&&!W.contains(D.contentDOM)&&W.blur()});let q=D.inputState.mouseSelection;if(q)return q.start(w),q.dragging===!1}return!1};function rangeForClick(D,w,O,F){if(F==1)return EditorSelection.cursor(w,O);if(F==2)return groupAt(D.state,w,O);{let q=LineView.find(D.docView,w),W=D.state.doc.lineAt(q?q.posAtEnd:w),U=q?q.posAtStart:W.from,K=q?q.posAtEnd:W.to;return K<D.state.doc.length&&K==W.to&&K++,EditorSelection.range(U,K)}}let inside=(D,w,O)=>w>=O.top&&w<=O.bottom&&D>=O.left&&D<=O.right;function findPositionSide(D,w,O,F){let q=LineView.find(D.docView,w);if(!q)return 1;let W=w-q.posAtStart;if(W==0)return 1;if(W==q.length)return-1;let U=q.coordsAt(W,-1);if(U&&inside(O,F,U))return-1;let K=q.coordsAt(W,1);return K&&inside(O,F,K)?1:U&&U.bottom>=F?-1:1}function queryPos(D,w){let O=D.posAtCoords({x:w.clientX,y:w.clientY},!1);return{pos:O,bias:findPositionSide(D,O,w.clientX,w.clientY)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(D){if(!BadMouseDetail)return D.detail;let w=lastMouseDown,O=lastMouseDownTime;return lastMouseDown=D,lastMouseDownTime=Date.now(),lastMouseDownCount=!w||O>Date.now()-400&&Math.abs(w.clientX-D.clientX)<2&&Math.abs(w.clientY-D.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(D,w){let O=queryPos(D,w),F=getClickType(w),q=D.state.selection;return{update(W){W.docChanged&&(O.pos=W.changes.mapPos(O.pos),q=q.map(W.changes))},get(W,U,K){let G=queryPos(D,W),Y,Q=rangeForClick(D,G.pos,G.bias,F);if(O.pos!=G.pos&&!U){let X=rangeForClick(D,O.pos,O.bias,F),J=Math.min(X.from,Q.from),Z=Math.max(X.to,Q.to);Q=J<Q.from?EditorSelection.range(J,Z):EditorSelection.range(Z,J)}return U?q.replaceRange(q.main.extend(Q.from,Q.to)):K&&F==1&&q.ranges.length>1&&(Y=removeRangeAround(q,G.pos))?Y:K?q.addRange(Q):EditorSelection.create([Q])}}}function removeRangeAround(D,w){for(let O=0;O<D.ranges.length;O++){let{from:F,to:q}=D.ranges[O];if(F<=w&&q>=w)return EditorSelection.create(D.ranges.slice(0,O).concat(D.ranges.slice(O+1)),D.mainIndex==O?0:D.mainIndex-(D.mainIndex>O?1:0))}return null}handlers.dragstart=(D,w)=>{let{selection:{main:O}}=D.state;if(w.target.draggable){let q=D.docView.nearest(w.target);if(q&&q.isWidget){let W=q.posAtStart,U=W+q.length;(W>=O.to||U<=O.from)&&(O=EditorSelection.range(W,U))}}let{inputState:F}=D;return F.mouseSelection&&(F.mouseSelection.dragging=!0),F.draggedContent=O,w.dataTransfer&&(w.dataTransfer.setData("Text",textFilter(D.state,clipboardOutputFilter,D.state.sliceDoc(O.from,O.to))),w.dataTransfer.effectAllowed="copyMove"),!1};handlers.dragend=D=>(D.inputState.draggedContent=null,!1);function dropText(D,w,O,F){if(O=textFilter(D.state,clipboardInputFilter,O),!O)return;let q=D.posAtCoords({x:w.clientX,y:w.clientY},!1),{draggedContent:W}=D.inputState,U=F&&W&&dragMovesSelection(D,w)?{from:W.from,to:W.to}:null,K={from:q,insert:O},G=D.state.changes(U?[U,K]:K);D.focus(),D.dispatch({changes:G,selection:{anchor:G.mapPos(q,-1),head:G.mapPos(q,1)},userEvent:U?"move.drop":"input.drop"}),D.inputState.draggedContent=null}handlers.drop=(D,w)=>{if(!w.dataTransfer)return!1;if(D.state.readOnly)return!0;let O=w.dataTransfer.files;if(O&&O.length){let F=Array(O.length),q=0,W=()=>{++q==O.length&&dropText(D,w,F.filter(U=>U!=null).join(D.state.lineBreak),!1)};for(let U=0;U<O.length;U++){let K=new FileReader;K.onerror=W,K.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(K.result)||(F[U]=K.result),W()},K.readAsText(O[U])}return!0}else{let F=w.dataTransfer.getData("Text");if(F)return dropText(D,w,F,!0),!0}return!1};handlers.paste=(D,w)=>{if(D.state.readOnly)return!0;D.observer.flush();let O=brokenClipboardAPI?null:w.clipboardData;return O?(doPaste(D,O.getData("text/plain")||O.getData("text/uri-list")),!0):(capturePaste(D),!1)};function captureCopy(D,w){let O=D.dom.parentNode;if(!O)return;let F=O.appendChild(document.createElement("textarea"));F.style.cssText="position: fixed; left: -10000px; top: 10px",F.value=w,F.focus(),F.selectionEnd=w.length,F.selectionStart=0,setTimeout(()=>{F.remove(),D.focus()},50)}function copiedRange(D){let w=[],O=[],F=!1;for(let q of D.selection.ranges)q.empty||(w.push(D.sliceDoc(q.from,q.to)),O.push(q));if(!w.length){let q=-1;for(let{from:W}of D.selection.ranges){let U=D.doc.lineAt(W);U.number>q&&(w.push(U.text),O.push({from:U.from,to:Math.min(D.doc.length,U.to+1)})),q=U.number}F=!0}return{text:textFilter(D,clipboardOutputFilter,w.join(D.lineBreak)),ranges:O,linewise:F}}let lastLinewiseCopy=null;handlers.copy=handlers.cut=(D,w)=>{let{text:O,ranges:F,linewise:q}=copiedRange(D.state);if(!O&&!q)return!1;lastLinewiseCopy=q?O:null,w.type=="cut"&&!D.state.readOnly&&D.dispatch({changes:F,scrollIntoView:!0,userEvent:"delete.cut"});let W=brokenClipboardAPI?null:w.clipboardData;return W?(W.clearData(),W.setData("text/plain",O),!0):(captureCopy(D,O),!1)};const isFocusChange=Annotation.define();function focusChangeTransaction(D,w){let O=[];for(let F of D.facet(focusChangeEffect)){let q=F(D,w);q&&O.push(q)}return O?D.update({effects:O,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(D){setTimeout(()=>{let w=D.hasFocus;if(w!=D.inputState.notifiedFocused){let O=focusChangeTransaction(D.state,w);O?D.dispatch(O):D.update([])}},10)}observers.focus=D=>{D.inputState.lastFocusTime=Date.now(),!D.scrollDOM.scrollTop&&(D.inputState.lastScrollTop||D.inputState.lastScrollLeft)&&(D.scrollDOM.scrollTop=D.inputState.lastScrollTop,D.scrollDOM.scrollLeft=D.inputState.lastScrollLeft),updateForFocusChange(D)};observers.blur=D=>{D.observer.clearSelectionRange(),updateForFocusChange(D)};observers.compositionstart=observers.compositionupdate=D=>{D.observer.editContext||(D.inputState.compositionFirstChange==null&&(D.inputState.compositionFirstChange=!0),D.inputState.composing<0&&(D.inputState.composing=0))};observers.compositionend=D=>{D.observer.editContext||(D.inputState.composing=-1,D.inputState.compositionEndedAt=Date.now(),D.inputState.compositionPendingKey=!0,D.inputState.compositionPendingChange=D.observer.pendingRecords().length>0,D.inputState.compositionFirstChange=null,browser.chrome&&browser.android?D.observer.flushSoon():D.inputState.compositionPendingChange?Promise.resolve().then(()=>D.observer.flush()):setTimeout(()=>{D.inputState.composing<0&&D.docView.hasComposition&&D.update([])},50))};observers.contextmenu=D=>{D.inputState.lastContextMenu=Date.now()};handlers.beforeinput=(D,w)=>{var O,F;if(w.inputType=="insertReplacementText"&&D.observer.editContext){let W=(O=w.dataTransfer)===null||O===void 0?void 0:O.getData("text/plain"),U=w.getTargetRanges();if(W&&U.length){let K=U[0],G=D.posAtDOM(K.startContainer,K.startOffset),Y=D.posAtDOM(K.endContainer,K.endOffset);return applyDOMChangeInner(D,{from:G,to:Y,insert:D.state.toText(W)},null),!0}}let q;if(browser.chrome&&browser.android&&(q=PendingKeys.find(W=>W.inputType==w.inputType))&&(D.observer.delayAndroidKey(q.key,q.keyCode),q.key=="Backspace"||q.key=="Delete")){let W=((F=window.visualViewport)===null||F===void 0?void 0:F.height)||0;setTimeout(()=>{var U;(((U=window.visualViewport)===null||U===void 0?void 0:U.height)||0)>W+10&&D.hasFocus&&(D.contentDOM.blur(),D.focus())},100)}return browser.ios&&w.inputType=="deleteContentForward"&&D.observer.flushSoon(),browser.safari&&w.inputType=="insertText"&&D.inputState.composing>=0&&setTimeout(()=>observers.compositionend(D,w),20),!1};const appliedFirefoxHack=new Set;function firefoxCopyCutHack(D){appliedFirefoxHack.has(D)||(appliedFirefoxHack.add(D),D.addEventListener("copy",()=>{}),D.addEventListener("cut",()=>{}))}const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];let heightChangeFlag=!1;function clearHeightChangeFlag(){heightChangeFlag=!1}class HeightOracle{constructor(w){this.lineWrapping=w,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(w,O){let F=this.doc.lineAt(O).number-this.doc.lineAt(w).number+1;return this.lineWrapping&&(F+=Math.max(0,Math.ceil((O-w-F*this.lineLength*.5)/this.lineLength))),this.lineHeight*F}heightForLine(w){return this.lineWrapping?(1+Math.max(0,Math.ceil((w-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(w){return this.doc=w,this}mustRefreshForWrapping(w){return wrappingWhiteSpace.indexOf(w)>-1!=this.lineWrapping}mustRefreshForHeights(w){let O=!1;for(let F=0;F<w.length;F++){let q=w[F];q<0?F++:this.heightSamples[Math.floor(q*10)]||(O=!0,this.heightSamples[Math.floor(q*10)]=!0)}return O}refresh(w,O,F,q,W,U){let K=wrappingWhiteSpace.indexOf(w)>-1,G=Math.round(O)!=Math.round(this.lineHeight)||this.lineWrapping!=K;if(this.lineWrapping=K,this.lineHeight=O,this.charWidth=F,this.textHeight=q,this.lineLength=W,G){this.heightSamples={};for(let Y=0;Y<U.length;Y++){let Q=U[Y];Q<0?Y++:this.heightSamples[Math.floor(Q*10)]=!0}}return G}}class MeasuredHeights{constructor(w,O){this.from=w,this.heights=O,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(w,O,F,q,W){this.from=w,this.length=O,this.top=F,this.height=q,this._content=W}get type(){return typeof this._content=="number"?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof PointDecoration?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(w){let O=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(w._content)?w._content:[w]);return new BlockInfo(this.from,this.length+w.length,this.top,this.height+w.height,O)}}var QueryType$1=function(D){return D[D.ByPos=0]="ByPos",D[D.ByHeight=1]="ByHeight",D[D.ByPosNoHeight=2]="ByPosNoHeight",D}(QueryType$1||(QueryType$1={}));const Epsilon=.001;class HeightMap{constructor(w,O,F=2){this.length=w,this.height=O,this.flags=F}get outdated(){return(this.flags&2)>0}set outdated(w){this.flags=(w?2:0)|this.flags&-3}setHeight(w){this.height!=w&&(Math.abs(this.height-w)>Epsilon&&(heightChangeFlag=!0),this.height=w)}replace(w,O,F){return HeightMap.of(F)}decomposeLeft(w,O){O.push(this)}decomposeRight(w,O){O.push(this)}applyChanges(w,O,F,q){let W=this,U=F.doc;for(let K=q.length-1;K>=0;K--){let{fromA:G,toA:Y,fromB:Q,toB:X}=q[K],J=W.lineAt(G,QueryType$1.ByPosNoHeight,F.setDoc(O),0,0),Z=J.to>=Y?J:W.lineAt(Y,QueryType$1.ByPosNoHeight,F,0,0);for(X+=Z.to-Y,Y=Z.to;K>0&&J.from<=q[K-1].toA;)G=q[K-1].fromA,Q=q[K-1].fromB,K--,G<J.from&&(J=W.lineAt(G,QueryType$1.ByPosNoHeight,F,0,0));Q+=J.from-G,G=J.from;let ee=NodeBuilder.build(F.setDoc(U),w,Q,X);W=replace(W,W.replace(G,Y,ee))}return W.updateHeight(F,0)}static empty(){return new HeightMapText(0,0)}static of(w){if(w.length==1)return w[0];let O=0,F=w.length,q=0,W=0;for(;;)if(O==F)if(q>W*2){let K=w[O-1];K.break?w.splice(--O,1,K.left,null,K.right):w.splice(--O,1,K.left,K.right),F+=1+K.break,q-=K.size}else if(W>q*2){let K=w[F];K.break?w.splice(F,1,K.left,null,K.right):w.splice(F,1,K.left,K.right),F+=2+K.break,W-=K.size}else break;else if(q<W){let K=w[O++];K&&(q+=K.size)}else{let K=w[--F];K&&(W+=K.size)}let U=0;return w[O-1]==null?(U=1,O--):w[O]==null&&(U=1,F++),new HeightMapBranch(HeightMap.of(w.slice(0,O)),U,HeightMap.of(w.slice(F)))}}function replace(D,w){return D==w?D:(D.constructor!=w.constructor&&(heightChangeFlag=!0),w)}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(w,O,F){super(w,O),this.deco=F}blockAt(w,O,F,q){return new BlockInfo(q,this.length,F,this.height,this.deco||0)}lineAt(w,O,F,q,W){return this.blockAt(0,F,q,W)}forEachLine(w,O,F,q,W,U){w<=W+this.length&&O>=W&&U(this.blockAt(0,F,q,W))}updateHeight(w,O=0,F=!1,q){return q&&q.from<=O&&q.more&&this.setHeight(q.heights[q.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(w,O){super(w,O,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(w,O,F,q){return new BlockInfo(q,this.length,F,this.height,this.breaks)}replace(w,O,F){let q=F[0];return F.length==1&&(q instanceof HeightMapText||q instanceof HeightMapGap&&q.flags&4)&&Math.abs(this.length-q.length)<10?(q instanceof HeightMapGap?q=new HeightMapText(q.length,this.height):q.height=this.height,this.outdated||(q.outdated=!1),q):HeightMap.of(F)}updateHeight(w,O=0,F=!1,q){return q&&q.from<=O&&q.more?this.setHeight(q.heights[q.index++]):(F||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,w.heightForLine(this.length-this.collapsed))+this.breaks*w.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(w){super(w,0)}heightMetrics(w,O){let F=w.doc.lineAt(O).number,q=w.doc.lineAt(O+this.length).number,W=q-F+1,U,K=0;if(w.lineWrapping){let G=Math.min(this.height,w.lineHeight*W);U=G/W,this.length>W+1&&(K=(this.height-G)/(this.length-W-1))}else U=this.height/W;return{firstLine:F,lastLine:q,perLine:U,perChar:K}}blockAt(w,O,F,q){let{firstLine:W,lastLine:U,perLine:K,perChar:G}=this.heightMetrics(O,q);if(O.lineWrapping){let Y=q+(w<O.lineHeight?0:Math.round(Math.max(0,Math.min(1,(w-F)/this.height))*this.length)),Q=O.doc.lineAt(Y),X=K+Q.length*G,J=Math.max(F,w-X/2);return new BlockInfo(Q.from,Q.length,J,X,0)}else{let Y=Math.max(0,Math.min(U-W,Math.floor((w-F)/K))),{from:Q,length:X}=O.doc.line(W+Y);return new BlockInfo(Q,X,F+K*Y,K,0)}}lineAt(w,O,F,q,W){if(O==QueryType$1.ByHeight)return this.blockAt(w,F,q,W);if(O==QueryType$1.ByPosNoHeight){let{from:Z,to:ee}=F.doc.lineAt(w);return new BlockInfo(Z,ee-Z,0,0,0)}let{firstLine:U,perLine:K,perChar:G}=this.heightMetrics(F,W),Y=F.doc.lineAt(w),Q=K+Y.length*G,X=Y.number-U,J=q+K*X+G*(Y.from-W-X);return new BlockInfo(Y.from,Y.length,Math.max(q,Math.min(J,q+this.height-Q)),Q,0)}forEachLine(w,O,F,q,W,U){w=Math.max(w,W),O=Math.min(O,W+this.length);let{firstLine:K,perLine:G,perChar:Y}=this.heightMetrics(F,W);for(let Q=w,X=q;Q<=O;){let J=F.doc.lineAt(Q);if(Q==w){let ee=J.number-K;X+=G*ee+Y*(w-W-ee)}let Z=G+Y*J.length;U(new BlockInfo(J.from,J.length,X,Z,0)),X+=Z,Q=J.to+1}}replace(w,O,F){let q=this.length-O;if(q>0){let W=F[F.length-1];W instanceof HeightMapGap?F[F.length-1]=new HeightMapGap(W.length+q):F.push(null,new HeightMapGap(q-1))}if(w>0){let W=F[0];W instanceof HeightMapGap?F[0]=new HeightMapGap(w+W.length):F.unshift(new HeightMapGap(w-1),null)}return HeightMap.of(F)}decomposeLeft(w,O){O.push(new HeightMapGap(w-1),null)}decomposeRight(w,O){O.push(null,new HeightMapGap(this.length-w-1))}updateHeight(w,O=0,F=!1,q){let W=O+this.length;if(q&&q.from<=O+this.length&&q.more){let U=[],K=Math.max(O,q.from),G=-1;for(q.from>O&&U.push(new HeightMapGap(q.from-O-1).updateHeight(w,O));K<=W&&q.more;){let Q=w.doc.lineAt(K).length;U.length&&U.push(null);let X=q.heights[q.index++];G==-1?G=X:Math.abs(X-G)>=Epsilon&&(G=-2);let J=new HeightMapText(Q,X);J.outdated=!1,U.push(J),K+=Q+1}K<=W&&U.push(null,new HeightMapGap(W-K).updateHeight(w,K));let Y=HeightMap.of(U);return(G<0||Math.abs(Y.height-this.height)>=Epsilon||Math.abs(G-this.heightMetrics(w,O).perLine)>=Epsilon)&&(heightChangeFlag=!0),replace(this,Y)}else(F||this.outdated)&&(this.setHeight(w.heightForGap(O,O+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(w,O,F){super(w.length+O+F.length,w.height+F.height,O|(w.outdated||F.outdated?2:0)),this.left=w,this.right=F,this.size=w.size+F.size}get break(){return this.flags&1}blockAt(w,O,F,q){let W=F+this.left.height;return w<W?this.left.blockAt(w,O,F,q):this.right.blockAt(w,O,W,q+this.left.length+this.break)}lineAt(w,O,F,q,W){let U=q+this.left.height,K=W+this.left.length+this.break,G=O==QueryType$1.ByHeight?w<U:w<K,Y=G?this.left.lineAt(w,O,F,q,W):this.right.lineAt(w,O,F,U,K);if(this.break||(G?Y.to<K:Y.from>K))return Y;let Q=O==QueryType$1.ByPosNoHeight?QueryType$1.ByPosNoHeight:QueryType$1.ByPos;return G?Y.join(this.right.lineAt(K,Q,F,U,K)):this.left.lineAt(K,Q,F,q,W).join(Y)}forEachLine(w,O,F,q,W,U){let K=q+this.left.height,G=W+this.left.length+this.break;if(this.break)w<G&&this.left.forEachLine(w,O,F,q,W,U),O>=G&&this.right.forEachLine(w,O,F,K,G,U);else{let Y=this.lineAt(G,QueryType$1.ByPos,F,q,W);w<Y.from&&this.left.forEachLine(w,Y.from-1,F,q,W,U),Y.to>=w&&Y.from<=O&&U(Y),O>Y.to&&this.right.forEachLine(Y.to+1,O,F,K,G,U)}}replace(w,O,F){let q=this.left.length+this.break;if(O<q)return this.balanced(this.left.replace(w,O,F),this.right);if(w>this.left.length)return this.balanced(this.left,this.right.replace(w-q,O-q,F));let W=[];w>0&&this.decomposeLeft(w,W);let U=W.length;for(let K of F)W.push(K);if(w>0&&mergeGaps(W,U-1),O<this.length){let K=W.length;this.decomposeRight(O,W),mergeGaps(W,K)}return HeightMap.of(W)}decomposeLeft(w,O){let F=this.left.length;if(w<=F)return this.left.decomposeLeft(w,O);O.push(this.left),this.break&&(F++,w>=F&&O.push(null)),w>F&&this.right.decomposeLeft(w-F,O)}decomposeRight(w,O){let F=this.left.length,q=F+this.break;if(w>=q)return this.right.decomposeRight(w-q,O);w<F&&this.left.decomposeRight(w,O),this.break&&w<q&&O.push(null),O.push(this.right)}balanced(w,O){return w.size>2*O.size||O.size>2*w.size?HeightMap.of(this.break?[w,null,O]:[w,O]):(this.left=replace(this.left,w),this.right=replace(this.right,O),this.setHeight(w.height+O.height),this.outdated=w.outdated||O.outdated,this.size=w.size+O.size,this.length=w.length+this.break+O.length,this)}updateHeight(w,O=0,F=!1,q){let{left:W,right:U}=this,K=O+W.length+this.break,G=null;return q&&q.from<=O+W.length&&q.more?G=W=W.updateHeight(w,O,F,q):W.updateHeight(w,O,F),q&&q.from<=K+U.length&&q.more?G=U=U.updateHeight(w,K,F,q):U.updateHeight(w,K,F),G?this.balanced(W,U):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(D,w){let O,F;D[w]==null&&(O=D[w-1])instanceof HeightMapGap&&(F=D[w+1])instanceof HeightMapGap&&D.splice(w-1,3,new HeightMapGap(O.length+1+F.length))}const relevantWidgetHeight=5;class NodeBuilder{constructor(w,O){this.pos=w,this.oracle=O,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=w}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(w,O){if(this.lineStart>-1){let F=Math.min(O,this.lineEnd),q=this.nodes[this.nodes.length-1];q instanceof HeightMapText?q.length+=F-this.pos:(F>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(F-this.pos,-1)),this.writtenTo=F,O>F&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=O}point(w,O,F){if(w<O||F.heightRelevant){let q=F.widget?F.widget.estimatedHeight:0,W=F.widget?F.widget.lineBreaks:0;q<0&&(q=this.oracle.lineHeight);let U=O-w;F.block?this.addBlock(new HeightMapBlock(U,q,F)):(U||W||q>=relevantWidgetHeight)&&this.addLineDeco(q,W,U)}else O>w&&this.span(w,O);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:w,to:O}=this.oracle.doc.lineAt(this.pos);this.lineStart=w,this.lineEnd=O,this.writtenTo<w&&((this.writtenTo<w-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,w-1)),this.nodes.push(null)),this.pos>w&&this.nodes.push(new HeightMapText(this.pos-w,-1)),this.writtenTo=this.pos}blankContent(w,O){let F=new HeightMapGap(O-w);return this.oracle.doc.lineAt(w).to==O&&(F.flags|=4),F}ensureLine(){this.enterLine();let w=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(w instanceof HeightMapText)return w;let O=new HeightMapText(0,-1);return this.nodes.push(O),O}addBlock(w){this.enterLine();let O=w.deco;O&&O.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(w),this.writtenTo=this.pos=this.pos+w.length,O&&O.endSide>0&&(this.covering=w)}addLineDeco(w,O,F){let q=this.ensureLine();q.length+=F,q.collapsed+=F,q.widgetHeight=Math.max(q.widgetHeight,w),q.breaks+=O,this.writtenTo=this.pos=this.pos+F}finish(w){let O=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(O instanceof HeightMapText)&&!this.isCovered?this.nodes.push(new HeightMapText(0,-1)):(this.writtenTo<this.pos||O==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let F=w;for(let q of this.nodes)q instanceof HeightMapText&&q.updateHeight(this.oracle,F),F+=q?q.length:1;return this.nodes}static build(w,O,F,q){let W=new NodeBuilder(F,w);return RangeSet.spans(O,F,q,W,0),W.finish(F)}}function heightRelevantDecoChanges(D,w,O){let F=new DecorationComparator;return RangeSet.compare(D,w,O,F,0),F.changes}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(w,O,F,q){(w<O||F&&F.heightRelevant||q&&q.heightRelevant)&&addRange(w,O,this.changes,5)}}function visiblePixelRange(D,w){let O=D.getBoundingClientRect(),F=D.ownerDocument,q=F.defaultView||window,W=Math.max(0,O.left),U=Math.min(q.innerWidth,O.right),K=Math.max(0,O.top),G=Math.min(q.innerHeight,O.bottom);for(let Y=D.parentNode;Y&&Y!=F.body;)if(Y.nodeType==1){let Q=Y,X=window.getComputedStyle(Q);if((Q.scrollHeight>Q.clientHeight||Q.scrollWidth>Q.clientWidth)&&X.overflow!="visible"){let J=Q.getBoundingClientRect();W=Math.max(W,J.left),U=Math.min(U,J.right),K=Math.max(K,J.top),G=Math.min(Y==D.parentNode?q.innerHeight:G,J.bottom)}Y=X.position=="absolute"||X.position=="fixed"?Q.offsetParent:Q.parentNode}else if(Y.nodeType==11)Y=Y.host;else break;return{left:W-O.left,right:Math.max(W,U)-O.left,top:K-(O.top+w),bottom:Math.max(K,G)-(O.top+w)}}function inWindow(D){let w=D.getBoundingClientRect(),O=D.ownerDocument.defaultView||window;return w.left<O.innerWidth&&w.right>0&&w.top<O.innerHeight&&w.bottom>0}function fullPixelRange(D,w){let O=D.getBoundingClientRect();return{left:0,right:O.right-O.left,top:w,bottom:O.bottom-(O.top+w)}}class LineGap{constructor(w,O,F,q){this.from=w,this.to=O,this.size=F,this.displaySize=q}static same(w,O){if(w.length!=O.length)return!1;for(let F=0;F<w.length;F++){let q=w[F],W=O[F];if(q.from!=W.from||q.to!=W.to||q.size!=W.size)return!1}return!0}draw(w,O){return Decoration.replace({widget:new LineGapWidget(this.displaySize*(O?w.scaleY:w.scaleX),O)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(w,O){super(),this.size=w,this.vertical=O}eq(w){return w.size==this.size&&w.vertical==this.vertical}toDOM(){let w=document.createElement("div");return this.vertical?w.style.height=this.size+"px":(w.style.width=this.size+"px",w.style.height="2px",w.style.display="inline-block"),w}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(w){this.state=w,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let O=w.facet(contentAttributes).some(F=>typeof F!="function"&&F.class=="cm-lineWrapping");this.heightOracle=new HeightOracle(O),this.stateDeco=w.facet(decorations).filter(F=>typeof F!="function"),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(w.doc),[new ChangedRange(0,0,0,w.doc.length)]);for(let F=0;F<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());F++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map(F=>F.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let w=[this.viewport],{main:O}=this.state.selection;for(let F=0;F<=1;F++){let q=F?O.head:O.anchor;if(!w.some(({from:W,to:U})=>q>=W&&q<=U)){let{from:W,to:U}=this.lineBlockAt(q);w.push(new Viewport(W,U))}}return this.viewports=w.sort((F,q)=>F.from-q.from),this.updateScaler()}updateScaler(){let w=this.scaler;return this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports),w.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,w=>{this.viewportLines.push(scaleBlock(w,this.scaler))})}update(w,O=null){this.state=w.state;let F=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter(Q=>typeof Q!="function");let q=w.changedRanges,W=ChangedRange.extendWithRanges(q,heightRelevantDecoChanges(F,this.stateDeco,w?w.changes:ChangeSet.empty(this.state.doc.length))),U=this.heightMap.height,K=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);clearHeightChangeFlag(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,w.startState.doc,this.heightOracle.setDoc(this.state.doc),W),(this.heightMap.height!=U||heightChangeFlag)&&(w.flags|=2),K?(this.scrollAnchorPos=w.changes.mapPos(K.from,-1),this.scrollAnchorHeight=K.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let G=W.length?this.mapViewport(this.viewport,w.changes):this.viewport;(O&&(O.range.head<G.from||O.range.head>G.to)||!this.viewportIsAppropriate(G))&&(G=this.getViewport(0,O));let Y=G.from!=this.viewport.from||G.to!=this.viewport.to;this.viewport=G,w.flags|=this.updateForViewport(),(Y||!w.changes.empty||w.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,w.changes))),w.flags|=this.computeVisibleRanges(w.changes),O&&(this.scrollTarget=O),!this.mustEnforceCursorAssoc&&w.selectionSet&&w.view.lineWrapping&&w.state.selection.main.empty&&w.state.selection.main.assoc&&!w.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(w){let O=w.contentDOM,F=window.getComputedStyle(O),q=this.heightOracle,W=F.whiteSpace;this.defaultTextDirection=F.direction=="rtl"?Direction.RTL:Direction.LTR;let U=this.heightOracle.mustRefreshForWrapping(W),K=O.getBoundingClientRect(),G=U||this.mustMeasureContent||this.contentDOMHeight!=K.height;this.contentDOMHeight=K.height,this.mustMeasureContent=!1;let Y=0,Q=0;if(K.width&&K.height){let{scaleX:ue,scaleY:oe}=getScale(O,K);(ue>.005&&Math.abs(this.scaleX-ue)>.005||oe>.005&&Math.abs(this.scaleY-oe)>.005)&&(this.scaleX=ue,this.scaleY=oe,Y|=16,U=G=!0)}let X=(parseInt(F.paddingTop)||0)*this.scaleY,J=(parseInt(F.paddingBottom)||0)*this.scaleY;(this.paddingTop!=X||this.paddingBottom!=J)&&(this.paddingTop=X,this.paddingBottom=J,Y|=18),this.editorWidth!=w.scrollDOM.clientWidth&&(q.lineWrapping&&(G=!0),this.editorWidth=w.scrollDOM.clientWidth,Y|=16);let Z=w.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=Z&&(this.scrollAnchorHeight=-1,this.scrollTop=Z),this.scrolledToBottom=isScrolledToBottom(w.scrollDOM);let ee=(this.printing?fullPixelRange:visiblePixelRange)(O,this.paddingTop),ne=ee.top-this.pixelViewport.top,te=ee.bottom-this.pixelViewport.bottom;this.pixelViewport=ee;let re=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(re!=this.inView&&(this.inView=re,re&&(G=!0)),!this.inView&&!this.scrollTarget&&!inWindow(w.dom))return 0;let se=K.width;if((this.contentDOMWidth!=se||this.editorHeight!=w.scrollDOM.clientHeight)&&(this.contentDOMWidth=K.width,this.editorHeight=w.scrollDOM.clientHeight,Y|=16),G){let ue=w.docView.measureVisibleLineHeights(this.viewport);if(q.mustRefreshForHeights(ue)&&(U=!0),U||q.lineWrapping&&Math.abs(se-this.contentDOMWidth)>q.charWidth){let{lineHeight:oe,charWidth:ae,textHeight:ce}=w.docView.measureTextSize();U=oe>0&&q.refresh(W,oe,ae,ce,se/ae,ue),U&&(w.docView.minWidth=0,Y|=16)}ne>0&&te>0?Q=Math.max(ne,te):ne<0&&te<0&&(Q=Math.min(ne,te)),clearHeightChangeFlag();for(let oe of this.viewports){let ae=oe.from==this.viewport.from?ue:w.docView.measureVisibleLineHeights(oe);this.heightMap=(U?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,w.state.doc.length)]):this.heightMap).updateHeight(q,0,U,new MeasuredHeights(oe.from,ae))}heightChangeFlag&&(Y|=2)}let le=!this.viewportIsAppropriate(this.viewport,Q)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return le&&(Y&2&&(Y|=this.updateScaler()),this.viewport=this.getViewport(Q,this.scrollTarget),Y|=this.updateForViewport()),(Y&2||le)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(U?[]:this.lineGaps,w)),Y|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,w.docView.enforceCursorAssoc()),Y}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(w,O){let F=.5-Math.max(-.5,Math.min(.5,w/1e3/2)),q=this.heightMap,W=this.heightOracle,{visibleTop:U,visibleBottom:K}=this,G=new Viewport(q.lineAt(U-F*1e3,QueryType$1.ByHeight,W,0,0).from,q.lineAt(K+(1-F)*1e3,QueryType$1.ByHeight,W,0,0).to);if(O){let{head:Y}=O.range;if(Y<G.from||Y>G.to){let Q=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),X=q.lineAt(Y,QueryType$1.ByPos,W,0,0),J;O.y=="center"?J=(X.top+X.bottom)/2-Q/2:O.y=="start"||O.y=="nearest"&&Y<G.from?J=X.top:J=X.bottom-Q,G=new Viewport(q.lineAt(J-1e3/2,QueryType$1.ByHeight,W,0,0).from,q.lineAt(J+Q+1e3/2,QueryType$1.ByHeight,W,0,0).to)}}return G}mapViewport(w,O){let F=O.mapPos(w.from,-1),q=O.mapPos(w.to,1);return new Viewport(this.heightMap.lineAt(F,QueryType$1.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(q,QueryType$1.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:w,to:O},F=0){if(!this.inView)return!0;let{top:q}=this.heightMap.lineAt(w,QueryType$1.ByPos,this.heightOracle,0,0),{bottom:W}=this.heightMap.lineAt(O,QueryType$1.ByPos,this.heightOracle,0,0),{visibleTop:U,visibleBottom:K}=this;return(w==0||q<=U-Math.max(10,Math.min(-F,250)))&&(O==this.state.doc.length||W>=K+Math.max(10,Math.min(F,250)))&&q>U-2*1e3&&W<K+2*1e3}mapLineGaps(w,O){if(!w.length||O.empty)return w;let F=[];for(let q of w)O.touchesRange(q.from,q.to)||F.push(new LineGap(O.mapPos(q.from),O.mapPos(q.to),q.size,q.displaySize));return F}ensureLineGaps(w,O){let F=this.heightOracle.lineWrapping,q=F?1e4:2e3,W=q>>1,U=q<<1;if(this.defaultTextDirection!=Direction.LTR&&!F)return[];let K=[],G=(Q,X,J,Z)=>{if(X-Q<W)return;let ee=this.state.selection.main,ne=[ee.from];ee.empty||ne.push(ee.to);for(let re of ne)if(re>Q&&re<X){G(Q,re-10,J,Z),G(re+10,X,J,Z);return}let te=find(w,re=>re.from>=J.from&&re.to<=J.to&&Math.abs(re.from-Q)<W&&Math.abs(re.to-X)<W&&!ne.some(se=>re.from<se&&re.to>se));if(!te){if(X<J.to&&O&&F&&O.visibleRanges.some(le=>le.from<=X&&le.to>=X)){let le=O.moveToLineBoundary(EditorSelection.cursor(X),!1,!0).head;le>Q&&(X=le)}let re=this.gapSize(J,Q,X,Z),se=F||re<2e6?re:2e6;te=new LineGap(Q,X,re,se)}K.push(te)},Y=Q=>{if(Q.length<U||Q.type!=BlockType.Text)return;let X=lineStructure(Q.from,Q.to,this.stateDeco);if(X.total<U)return;let J=this.scrollTarget?this.scrollTarget.range.head:null,Z,ee;if(F){let ne=q/this.heightOracle.lineLength*this.heightOracle.lineHeight,te,re;if(J!=null){let se=findFraction(X,J),le=((this.visibleBottom-this.visibleTop)/2+ne)/Q.height;te=se-le,re=se+le}else te=(this.visibleTop-Q.top-ne)/Q.height,re=(this.visibleBottom-Q.top+ne)/Q.height;Z=findPosition(X,te),ee=findPosition(X,re)}else{let ne=X.total*this.heightOracle.charWidth,te=q*this.heightOracle.charWidth,re=0;if(ne>2e6)for(let ae of w)ae.from>=Q.from&&ae.from<Q.to&&ae.size!=ae.displaySize&&ae.from*this.heightOracle.charWidth+re<this.pixelViewport.left&&(re=ae.size-ae.displaySize);let se=this.pixelViewport.left+re,le=this.pixelViewport.right+re,ue,oe;if(J!=null){let ae=findFraction(X,J),ce=((le-se)/2+te)/ne;ue=ae-ce,oe=ae+ce}else ue=(se-te)/ne,oe=(le+te)/ne;Z=findPosition(X,ue),ee=findPosition(X,oe)}Z>Q.from&&G(Q.from,Z,Q,X),ee<Q.to&&G(ee,Q.to,Q,X)};for(let Q of this.viewportLines)Array.isArray(Q.type)?Q.type.forEach(Y):Y(Q);return K}gapSize(w,O,F,q){let W=findFraction(q,F)-findFraction(q,O);return this.heightOracle.lineWrapping?w.height*W:q.total*this.heightOracle.charWidth*W}updateLineGaps(w){LineGap.same(w,this.lineGaps)||(this.lineGaps=w,this.lineGapDeco=Decoration.set(w.map(O=>O.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(w){let O=this.stateDeco;this.lineGaps.length&&(O=O.concat(this.lineGapDeco));let F=[];RangeSet.spans(O,this.viewport.from,this.viewport.to,{span(W,U){F.push({from:W,to:U})},point(){}},20);let q=0;if(F.length!=this.visibleRanges.length)q=12;else for(let W=0;W<F.length&&!(q&8);W++){let U=this.visibleRanges[W],K=F[W];(U.from!=K.from||U.to!=K.to)&&(q|=4,w&&w.mapPos(U.from,-1)==K.from&&w.mapPos(U.to,1)==K.to||(q|=8))}return this.visibleRanges=F,q}lineBlockAt(w){return w>=this.viewport.from&&w<=this.viewport.to&&this.viewportLines.find(O=>O.from<=w&&O.to>=w)||scaleBlock(this.heightMap.lineAt(w,QueryType$1.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(w){return w>=this.viewportLines[0].top&&w<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(O=>O.top<=w&&O.bottom>=w)||scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(w),QueryType$1.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(w){let O=this.lineBlockAtHeight(w+8);return O.from>=this.viewport.from||this.viewportLines[0].top-w>200?O:this.viewportLines[0]}elementAtHeight(w){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(w),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(w,O){this.from=w,this.to=O}}function lineStructure(D,w,O){let F=[],q=D,W=0;return RangeSet.spans(O,D,w,{span(){},point(U,K){U>q&&(F.push({from:q,to:U}),W+=U-q),q=K}},20),q<w&&(F.push({from:q,to:w}),W+=w-q),{total:W,ranges:F}}function findPosition({total:D,ranges:w},O){if(O<=0)return w[0].from;if(O>=1)return w[w.length-1].to;let F=Math.floor(D*O);for(let q=0;;q++){let{from:W,to:U}=w[q],K=U-W;if(F<=K)return W+F;F-=K}}function findFraction(D,w){let O=0;for(let{from:F,to:q}of D.ranges){if(w<=q){O+=w-F;break}O+=q-F}return O/D.total}function find(D,w){for(let O of D)if(w(O))return O}const IdScaler={toDOM(D){return D},fromDOM(D){return D},scale:1,eq(D){return D==this}};class BigScaler{constructor(w,O,F){let q=0,W=0,U=0;this.viewports=F.map(({from:K,to:G})=>{let Y=O.lineAt(K,QueryType$1.ByPos,w,0,0).top,Q=O.lineAt(G,QueryType$1.ByPos,w,0,0).bottom;return q+=Q-Y,{from:K,to:G,top:Y,bottom:Q,domTop:0,domBottom:0}}),this.scale=(7e6-q)/(O.height-q);for(let K of this.viewports)K.domTop=U+(K.top-W)*this.scale,U=K.domBottom=K.domTop+(K.bottom-K.top),W=K.bottom}toDOM(w){for(let O=0,F=0,q=0;;O++){let W=O<this.viewports.length?this.viewports[O]:null;if(!W||w<W.top)return q+(w-F)*this.scale;if(w<=W.bottom)return W.domTop+(w-W.top);F=W.bottom,q=W.domBottom}}fromDOM(w){for(let O=0,F=0,q=0;;O++){let W=O<this.viewports.length?this.viewports[O]:null;if(!W||w<W.domTop)return F+(w-q)/this.scale;if(w<=W.domBottom)return W.top+(w-W.domTop);F=W.bottom,q=W.domBottom}}eq(w){return w instanceof BigScaler?this.scale==w.scale&&this.viewports.length==w.viewports.length&&this.viewports.every((O,F)=>O.from==w.viewports[F].from&&O.to==w.viewports[F].to):!1}}function scaleBlock(D,w){if(w.scale==1)return D;let O=w.toDOM(D.top),F=w.toDOM(D.bottom);return new BlockInfo(D.from,D.length,O,F-O,Array.isArray(D._content)?D._content.map(q=>scaleBlock(q,w)):D._content)}const theme=Facet.define({combine:D=>D.join(" ")}),darkTheme=Facet.define({combine:D=>D.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(D,w,O){return new StyleModule(w,{finish(F){return/&/.test(F)?F.replace(/&\w*/,q=>{if(q=="&")return D;if(!O||!O[q])throw new RangeError(`Unsupported selector: ${q}`);return O[q]}):D+" "+F}})}const baseTheme$1$3=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs),observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(w){this.view=w,this.active=!1,this.editContext=null,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=w.contentDOM,this.observer=new MutationObserver(O=>{for(let F of O)this.queue.push(F);(browser.ie&&browser.ie_version<=11||browser.ios&&w.composing)&&O.some(F=>F.type=="childList"&&F.removedNodes.length||F.type=="characterData"&&F.oldValue.length>F.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&w.constructor.EDIT_CONTEXT!==!1&&!(browser.chrome&&browser.chrome_version<126)&&(this.editContext=new EditContextManager(w),w.state.facet(editable)&&(w.contentDOM.editContext=this.editContext.editContext)),useCharData&&(this.onCharData=O=>{this.queue.push({target:O.target,type:"characterData",oldValue:O.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var O;((O=this.view.docView)===null||O===void 0?void 0:O.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(w.scrollDOM)),this.addWindowListeners(this.win=w.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(O=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),O.length>0&&O[O.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(O=>{O.length>0&&O[O.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(w){this.view.inputState.runHandlers("scroll",w),this.intersecting&&this.view.measure()}onScroll(w){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(w)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(w){(w.type=="change"||!w.type)&&!w.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(w){if(this.gapIntersection&&(w.length!=this.gaps.length||this.gaps.some((O,F)=>O!=w[F]))){this.gapIntersection.disconnect();for(let O of w)this.gapIntersection.observe(O);this.gaps=w}}onSelectionChange(w){let O=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:F}=this,q=this.selectionRange;if(F.state.facet(editable)?F.root.activeElement!=this.dom:!hasSelection(this.dom,q))return;let W=q.anchorNode&&F.docView.nearest(q.anchorNode);if(W&&W.ignoreEvent(w)){O||(this.selectionChanged=!1);return}(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!F.state.selection.main.empty&&q.focusNode&&isEquivalentPosition(q.focusNode,q.focusOffset,q.anchorNode,q.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:w}=this,O=getSelection(w.root);if(!O)return!1;let F=browser.safari&&w.root.nodeType==11&&w.root.activeElement==this.dom&&safariSelectionRangeHack(this.view,O)||O;if(!F||this.selectionRange.eq(F))return!1;let q=hasSelection(this.dom,F);return q&&!this.selectionChanged&&w.inputState.lastFocusTime>Date.now()-200&&w.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,F)?(this.view.inputState.lastFocusTime=0,w.docView.updateSelection(),!1):(this.selectionRange.setRange(F),q&&(this.selectionChanged=!0),!0)}setSelectionRange(w,O){this.selectionRange.set(w.node,w.offset,O.node,O.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let w=0,O=null;for(let F=this.dom;F;)if(F.nodeType==1)!O&&w<this.scrollTargets.length&&this.scrollTargets[w]==F?w++:O||(O=this.scrollTargets.slice(0,w)),O&&O.push(F),F=F.assignedSlot||F.parentNode;else if(F.nodeType==11)F=F.host;else break;if(w<this.scrollTargets.length&&!O&&(O=this.scrollTargets.slice(0,w)),O){for(let F of this.scrollTargets)F.removeEventListener("scroll",this.onScroll);for(let F of this.scrollTargets=O)F.addEventListener("scroll",this.onScroll)}}ignore(w){if(!this.active)return w();try{return this.stop(),w()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(w,O){var F;if(!this.delayedAndroidKey){let q=()=>{let W=this.delayedAndroidKey;W&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=W.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&W.force&&dispatchKey(this.dom,W.key,W.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(q)}(!this.delayedAndroidKey||w=="Enter")&&(this.delayedAndroidKey={key:w,keyCode:O,force:this.lastChange<Date.now()-50||!!(!((F=this.delayedAndroidKey)===null||F===void 0)&&F.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let w of this.observer.takeRecords())this.queue.push(w);return this.queue}processRecords(){let w=this.pendingRecords();w.length&&(this.queue=[]);let O=-1,F=-1,q=!1;for(let W of w){let U=this.readMutation(W);U&&(U.typeOver&&(q=!0),O==-1?{from:O,to:F}=U:(O=Math.min(U.from,O),F=Math.max(U.to,F)))}return{from:O,to:F,typeOver:q}}readChange(){let{from:w,to:O,typeOver:F}=this.processRecords(),q=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(w<0&&!q)return null;w>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let W=new DOMChange(this.view,w,O,F);return this.view.docView.domChanged={newSel:W.newSel?W.newSel.main:null},W}flush(w=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;w&&this.readSelectionRange();let O=this.readChange();if(!O)return this.view.requestMeasure(),!1;let F=this.view.state,q=applyDOMChange(this.view,O);return this.view.state==F&&(O.domChanged||O.newSel&&!O.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),q}readMutation(w){let O=this.view.docView.nearest(w.target);if(!O||O.ignoreMutation(w))return null;if(O.markDirty(w.type=="attributes"),w.type=="attributes"&&(O.flags|=4),w.type=="childList"){let F=findChild(O,w.previousSibling||w.target.previousSibling,-1),q=findChild(O,w.nextSibling||w.target.nextSibling,1);return{from:F?O.posAfter(F):O.posAtStart,to:q?O.posBefore(q):O.posAtEnd,typeOver:!1}}else return w.type=="characterData"?{from:O.posAtStart,to:O.posAtEnd,typeOver:w.target.nodeValue==w.oldValue}:null}setWindow(w){w!=this.win&&(this.removeWindowListeners(this.win),this.win=w,this.addWindowListeners(this.win))}addWindowListeners(w){w.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):w.addEventListener("beforeprint",this.onPrint),w.addEventListener("scroll",this.onScroll),w.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(w){w.removeEventListener("scroll",this.onScroll),w.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):w.removeEventListener("beforeprint",this.onPrint),w.document.removeEventListener("selectionchange",this.onSelectionChange)}update(w){this.editContext&&(this.editContext.update(w),w.startState.facet(editable)!=w.state.facet(editable)&&(w.view.contentDOM.editContext=w.state.facet(editable)?this.editContext.editContext:null))}destroy(){var w,O,F;this.stop(),(w=this.intersection)===null||w===void 0||w.disconnect(),(O=this.gapIntersection)===null||O===void 0||O.disconnect(),(F=this.resizeScroll)===null||F===void 0||F.disconnect();for(let q of this.scrollTargets)q.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function findChild(D,w,O){for(;w;){let F=ContentView.get(w);if(F&&F.parent==D)return F;let q=w.parentNode;w=q!=D.dom?q:O>0?w.nextSibling:w.previousSibling}return null}function buildSelectionRangeFromRange(D,w){let O=w.startContainer,F=w.startOffset,q=w.endContainer,W=w.endOffset,U=D.docView.domAtPos(D.state.selection.main.anchor);return isEquivalentPosition(U.node,U.offset,q,W)&&([O,F,q,W]=[q,W,O,F]),{anchorNode:O,anchorOffset:F,focusNode:q,focusOffset:W}}function safariSelectionRangeHack(D,w){if(w.getComposedRanges){let q=w.getComposedRanges(D.root)[0];if(q)return buildSelectionRangeFromRange(D,q)}let O=null;function F(q){q.preventDefault(),q.stopImmediatePropagation(),O=q.getTargetRanges()[0]}return D.contentDOM.addEventListener("beforeinput",F,!0),D.dom.ownerDocument.execCommand("indent"),D.contentDOM.removeEventListener("beforeinput",F,!0),O?buildSelectionRangeFromRange(D,O):null}class EditContextManager{constructor(w){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(w.state);let O=this.editContext=new window.EditContext({text:w.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,w.state.selection.main.anchor))),selectionEnd:this.toContextPos(w.state.selection.main.head)});this.handlers.textupdate=F=>{let q=w.state.selection.main,{anchor:W,head:U}=q,K=this.toEditorPos(F.updateRangeStart),G=this.toEditorPos(F.updateRangeEnd);w.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:F.updateRangeStart,editorBase:K,drifted:!1});let Y={from:K,to:G,insert:Text.of(F.text.split(`
`))};if(Y.from==this.from&&W<this.from?Y.from=W:Y.to==this.to&&W>this.to&&(Y.to=W),Y.from==Y.to&&!Y.insert.length){let Q=EditorSelection.single(this.toEditorPos(F.selectionStart),this.toEditorPos(F.selectionEnd));Q.main.eq(q)||w.dispatch({selection:Q,userEvent:"select"});return}if((browser.mac||browser.android)&&Y.from==U-1&&/^\. ?$/.test(F.text)&&w.contentDOM.getAttribute("autocorrect")=="off"&&(Y={from:K,to:G,insert:Text.of([F.text.replace("."," ")])}),this.pendingContextChange=Y,!w.state.readOnly){let Q=this.to-this.from+(Y.to-Y.from+Y.insert.length);applyDOMChangeInner(w,Y,EditorSelection.single(this.toEditorPos(F.selectionStart,Q),this.toEditorPos(F.selectionEnd,Q)))}this.pendingContextChange&&(this.revertPending(w.state),this.setSelection(w.state))},this.handlers.characterboundsupdate=F=>{let q=[],W=null;for(let U=this.toEditorPos(F.rangeStart),K=this.toEditorPos(F.rangeEnd);U<K;U++){let G=w.coordsForChar(U);W=G&&new DOMRect(G.left,G.top,G.right-G.left,G.bottom-G.top)||W||new DOMRect,q.push(W)}O.updateCharacterBounds(F.rangeStart,q)},this.handlers.textformatupdate=F=>{let q=[];for(let W of F.getTextFormats()){let U=W.underlineStyle,K=W.underlineThickness;if(U!="None"&&K!="None"){let G=this.toEditorPos(W.rangeStart),Y=this.toEditorPos(W.rangeEnd);if(G<Y){let Q=`text-decoration: underline ${U=="Dashed"?"dashed ":U=="Squiggle"?"wavy ":""}${K=="Thin"?1:2}px`;q.push(Decoration.mark({attributes:{style:Q}}).range(G,Y))}}}w.dispatch({effects:setEditContextFormatting.of(Decoration.set(q))})},this.handlers.compositionstart=()=>{w.inputState.composing<0&&(w.inputState.composing=0,w.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(w.inputState.composing=-1,w.inputState.compositionFirstChange=null,this.composing){let{drifted:F}=this.composing;this.composing=null,F&&this.reset(w.state)}};for(let F in this.handlers)O.addEventListener(F,this.handlers[F]);this.measureReq={read:F=>{this.editContext.updateControlBounds(F.contentDOM.getBoundingClientRect());let q=getSelection(F.root);q&&q.rangeCount&&this.editContext.updateSelectionBounds(q.getRangeAt(0).getBoundingClientRect())}}}applyEdits(w){let O=0,F=!1,q=this.pendingContextChange;return w.changes.iterChanges((W,U,K,G,Y)=>{if(F)return;let Q=Y.length-(U-W);if(q&&U>=q.to)if(q.from==W&&q.to==U&&q.insert.eq(Y)){q=this.pendingContextChange=null,O+=Q,this.to+=Q;return}else q=null,this.revertPending(w.state);if(W+=O,U+=O,U<=this.from)this.from+=Q,this.to+=Q;else if(W<this.to){if(W<this.from||U>this.to||this.to-this.from+Y.length>3e4){F=!0;return}this.editContext.updateText(this.toContextPos(W),this.toContextPos(U),Y.toString()),this.to+=Q}O+=Q}),q&&!F&&this.revertPending(w.state),!F}update(w){let O=this.pendingContextChange,F=w.startState.selection.main;this.composing&&(this.composing.drifted||!w.changes.touchesRange(F.from,F.to)&&w.transactions.some(q=>!q.isUserEvent("input.type")&&q.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=w.changes.mapPos(this.composing.editorBase)):!this.applyEdits(w)||!this.rangeIsValid(w.state)?(this.pendingContextChange=null,this.reset(w.state)):(w.docChanged||w.selectionSet||O)&&this.setSelection(w.state),(w.geometryChanged||w.docChanged||w.selectionSet)&&w.view.requestMeasure(this.measureReq)}resetRange(w){let{head:O}=w.selection.main;this.from=Math.max(0,O-1e4),this.to=Math.min(w.doc.length,O+1e4)}reset(w){this.resetRange(w),this.editContext.updateText(0,this.editContext.text.length,w.doc.sliceString(this.from,this.to)),this.setSelection(w)}revertPending(w){let O=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(O.from),this.toContextPos(O.from+O.insert.length),w.doc.sliceString(O.from,O.to))}setSelection(w){let{main:O}=w.selection,F=this.toContextPos(Math.max(this.from,Math.min(this.to,O.anchor))),q=this.toContextPos(O.head);(this.editContext.selectionStart!=F||this.editContext.selectionEnd!=q)&&this.editContext.updateSelection(F,q)}rangeIsValid(w){let{head:O}=w.selection.main;return!(this.from>0&&O-this.from<500||this.to<w.doc.length&&this.to-O<500||this.to-this.from>1e4*3)}toEditorPos(w,O=this.to-this.from){w=Math.min(w,O);let F=this.composing;return F&&F.drifted?F.editorBase+(w-F.contextBase):w+this.from}toContextPos(w){let O=this.composing;return O&&O.drifted?O.contextBase+(w-O.editorBase):w-this.from}destroy(){for(let w in this.handlers)this.editContext.removeEventListener(w,this.handlers[w])}}class EditorView{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(w={}){var O;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),w.parent&&w.parent.appendChild(this.dom);let{dispatch:F}=w;this.dispatchTransactions=w.dispatchTransactions||F&&(q=>q.forEach(W=>F(W,this)))||(q=>this.update(q)),this.dispatch=this.dispatch.bind(this),this._root=w.root||getRoot(w.parent)||document,this.viewState=new ViewState(w.state||EditorState.create(w)),w.scrollTo&&w.scrollTo.is(scrollIntoView$1)&&(this.viewState.scrollTarget=w.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(viewPlugin).map(q=>new PluginInstance(q));for(let q of this.plugins)q.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((O=document.fonts)===null||O===void 0)&&O.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...w){let O=w.length==1&&w[0]instanceof Transaction?w:w.length==1&&Array.isArray(w[0])?w[0]:[this.state.update(...w)];this.dispatchTransactions(O,this)}update(w){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let O=!1,F=!1,q,W=this.state;for(let J of w){if(J.startState!=W)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");W=J.state}if(this.destroyed){this.viewState.state=W;return}let U=this.hasFocus,K=0,G=null;w.some(J=>J.annotation(isFocusChange))?(this.inputState.notifiedFocused=U,K=1):U!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=U,G=focusChangeTransaction(W,U),G||(K=1));let Y=this.observer.delayedAndroidKey,Q=null;if(Y?(this.observer.clearDelayedAndroidKey(),Q=this.observer.readChange(),(Q&&!this.state.doc.eq(W.doc)||!this.state.selection.eq(W.selection))&&(Q=null)):this.observer.clear(),W.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(W);q=ViewUpdate.create(this,W,w),q.flags|=K;let X=this.viewState.scrollTarget;try{this.updateState=2;for(let J of w){if(X&&(X=X.map(J.changes)),J.scrollIntoView){let{main:Z}=J.state.selection;X=new ScrollTarget(Z.empty?Z:EditorSelection.cursor(Z.head,Z.head>Z.anchor?-1:1))}for(let Z of J.effects)Z.is(scrollIntoView$1)&&(X=Z.value.clip(this.state))}this.viewState.update(q,X),this.bidiCache=CachedOrder.update(this.bidiCache,q.changes),q.empty||(this.updatePlugins(q),this.inputState.update(q)),O=this.docView.update(q),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),F=this.updateAttrs(),this.showAnnouncements(w),this.docView.updateSelection(O,w.some(J=>J.isUserEvent("select.pointer")))}finally{this.updateState=0}if(q.startState.facet(theme)!=q.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(O||F||X||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),O&&this.docViewUpdate(),!q.empty)for(let J of this.state.facet(updateListener))try{J(q)}catch(Z){logException(this.state,Z,"update listener")}(G||Q)&&Promise.resolve().then(()=>{G&&this.state==G.startState&&this.dispatch(G),Q&&!applyDOMChange(this,Q)&&Y.force&&dispatchKey(this.contentDOM,Y.key,Y.keyCode)})}setState(w){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=w;return}this.updateState=2;let O=this.hasFocus;try{for(let F of this.plugins)F.destroy(this);this.viewState=new ViewState(w),this.plugins=w.facet(viewPlugin).map(F=>new PluginInstance(F)),this.pluginMap.clear();for(let F of this.plugins)F.update(this);this.docView.destroy(),this.docView=new DocView(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}O&&this.focus(),this.requestMeasure()}updatePlugins(w){let O=w.startState.facet(viewPlugin),F=w.state.facet(viewPlugin);if(O!=F){let q=[];for(let W of F){let U=O.indexOf(W);if(U<0)q.push(new PluginInstance(W));else{let K=this.plugins[U];K.mustUpdate=w,q.push(K)}}for(let W of this.plugins)W.mustUpdate!=w&&W.destroy(this);this.plugins=q,this.pluginMap.clear()}else for(let q of this.plugins)q.mustUpdate=w;for(let q=0;q<this.plugins.length;q++)this.plugins[q].update(this);O!=F&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let w of this.plugins){let O=w.value;if(O&&O.docViewUpdate)try{O.docViewUpdate(this)}catch(F){logException(this.state,F,"doc view update listener")}}}measure(w=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,w&&this.observer.forceFlush();let O=null,F=this.scrollDOM,q=F.scrollTop*this.scaleY,{scrollAnchorPos:W,scrollAnchorHeight:U}=this.viewState;Math.abs(q-this.viewState.scrollTop)>1&&(U=-1),this.viewState.scrollAnchorHeight=-1;try{for(let K=0;;K++){if(U<0)if(isScrolledToBottom(F))W=-1,U=this.viewState.heightMap.height;else{let Z=this.viewState.scrollAnchorAt(q);W=Z.from,U=Z.top}this.updateState=1;let G=this.viewState.measure(this);if(!G&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(K>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let Y=[];G&4||([this.measureRequests,Y]=[Y,this.measureRequests]);let Q=Y.map(Z=>{try{return Z.read(this)}catch(ee){return logException(this.state,ee),BadMeasure}}),X=ViewUpdate.create(this,this.state,[]),J=!1;X.flags|=G,O?O.flags|=G:O=X,this.updateState=2,X.empty||(this.updatePlugins(X),this.inputState.update(X),this.updateAttrs(),J=this.docView.update(X),J&&this.docViewUpdate());for(let Z=0;Z<Y.length;Z++)if(Q[Z]!=BadMeasure)try{let ee=Y[Z];ee.write&&ee.write(Q[Z],this)}catch(ee){logException(this.state,ee)}if(J&&this.docView.updateSelection(!0),!X.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,U=-1;continue}else{let ee=(W<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(W).top)-U;if(ee>1||ee<-1){q=q+ee,F.scrollTop=q/this.scaleY,U=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(O&&!O.empty)for(let K of this.state.facet(updateListener))K(O)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let w=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),O={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(O["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,O);let F=this.observer.ignore(()=>{let q=updateAttrs(this.contentDOM,this.contentAttrs,O),W=updateAttrs(this.dom,this.editorAttrs,w);return q||W});return this.editorAttrs=w,this.contentAttrs=O,F}showAnnouncements(w){let O=!0;for(let F of w)for(let q of F.effects)if(q.is(EditorView.announce)){O&&(this.announceDOM.textContent=""),O=!1;let W=this.announceDOM.appendChild(document.createElement("div"));W.textContent=q.value}}mountStyles(){this.styleModules=this.state.facet(styleModule);let w=this.state.facet(EditorView.cspNonce);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1$3).reverse(),w?{nonce:w}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(w){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),w){if(this.measureRequests.indexOf(w)>-1)return;if(w.key!=null){for(let O=0;O<this.measureRequests.length;O++)if(this.measureRequests[O].key===w.key){this.measureRequests[O]=w;return}}this.measureRequests.push(w)}}plugin(w){let O=this.pluginMap.get(w);return(O===void 0||O&&O.spec!=w)&&this.pluginMap.set(w,O=this.plugins.find(F=>F.spec==w)||null),O&&O.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(w){return this.readMeasured(),this.viewState.elementAtHeight(w)}lineBlockAtHeight(w){return this.readMeasured(),this.viewState.lineBlockAtHeight(w)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(w){return this.viewState.lineBlockAt(w)}get contentHeight(){return this.viewState.contentHeight}moveByChar(w,O,F){return skipAtoms(this,w,moveByChar(this,w,O,F))}moveByGroup(w,O){return skipAtoms(this,w,moveByChar(this,w,O,F=>byGroup(this,w.head,F)))}visualLineSide(w,O){let F=this.bidiSpans(w),q=this.textDirectionAt(w.from),W=F[O?F.length-1:0];return EditorSelection.cursor(W.side(O,q)+w.from,W.forward(!O,q)?1:-1)}moveToLineBoundary(w,O,F=!0){return moveToLineBoundary(this,w,O,F)}moveVertically(w,O,F){return skipAtoms(this,w,moveVertically(this,w,O,F))}domAtPos(w){return this.docView.domAtPos(w)}posAtDOM(w,O=0){return this.docView.posFromDOM(w,O)}posAtCoords(w,O=!0){return this.readMeasured(),posAtCoords(this,w,O)}coordsAtPos(w,O=1){this.readMeasured();let F=this.docView.coordsAt(w,O);if(!F||F.left==F.right)return F;let q=this.state.doc.lineAt(w),W=this.bidiSpans(q),U=W[BidiSpan.find(W,w-q.from,-1,O)];return flattenRect(F,U.dir==Direction.LTR==O>0)}coordsForChar(w){return this.readMeasured(),this.docView.coordsForChar(w)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(w){return!this.state.facet(perLineTextDirection)||w<this.viewport.from||w>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(w))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(w){if(w.length>MaxBidiLine)return trivialOrder(w.length);let O=this.textDirectionAt(w.from),F;for(let W of this.bidiCache)if(W.from==w.from&&W.dir==O&&(W.fresh||isolatesEq(W.isolates,F=getIsolatedRanges(this,w))))return W.order;F||(F=getIsolatedRanges(this,w));let q=computeOrder(w.text,O,F);return this.bidiCache.push(new CachedOrder(w.from,w.to,O,F,!0,q)),q}get hasFocus(){var w;return(this.dom.ownerDocument.hasFocus()||browser.safari&&((w=this.inputState)===null||w===void 0?void 0:w.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()})}setRoot(w){this._root!=w&&(this._root=w,this.observer.setWindow((w.nodeType==9?w:w.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let w of this.plugins)w.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(w,O={}){return scrollIntoView$1.of(new ScrollTarget(typeof w=="number"?EditorSelection.cursor(w):w,O.y,O.x,O.yMargin,O.xMargin))}scrollSnapshot(){let{scrollTop:w,scrollLeft:O}=this.scrollDOM,F=this.viewState.scrollAnchorAt(w);return scrollIntoView$1.of(new ScrollTarget(EditorSelection.cursor(F.from),"start","start",F.top-w,O,!0))}setTabFocusMode(w){w==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof w=="boolean"?this.inputState.tabFocusMode=w?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+w)}static domEventHandlers(w){return ViewPlugin.define(()=>({}),{eventHandlers:w})}static domEventObservers(w){return ViewPlugin.define(()=>({}),{eventObservers:w})}static theme(w,O){let F=StyleModule.newName(),q=[theme.of(F),styleModule.of(buildTheme(`.${F}`,w))];return O&&O.dark&&q.push(darkTheme.of(!0)),q}static baseTheme(w){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,w,lightDarkIDs)))}static findFromDOM(w){var O;let F=w.querySelector(".cm-content"),q=F&&ContentView.get(F)||ContentView.get(w);return((O=q==null?void 0:q.rootView)===null||O===void 0?void 0:O.view)||null}}EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler$1;EditorView.clipboardInputFilter=clipboardInputFilter;EditorView.clipboardOutputFilter=clipboardOutputFilter;EditorView.scrollHandler=scrollHandler;EditorView.focusChangeEffect=focusChangeEffect;EditorView.perLineTextDirection=perLineTextDirection;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.outerDecorations=outerDecorations;EditorView.atomicRanges=atomicRanges;EditorView.bidiIsolatedRanges=bidiIsolatedRanges;EditorView.scrollMargins=scrollMargins;EditorView.darkTheme=darkTheme;EditorView.cspNonce=Facet.define({combine:D=>D.length?D[0]:""});EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"});EditorView.announce=StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(w,O,F,q,W,U){this.from=w,this.to=O,this.dir=F,this.isolates=q,this.fresh=W,this.order=U}static update(w,O){if(O.empty&&!w.some(W=>W.fresh))return w;let F=[],q=w.length?w[w.length-1].dir:Direction.LTR;for(let W=Math.max(0,w.length-10);W<w.length;W++){let U=w[W];U.dir==q&&!O.touchesRange(U.from,U.to)&&F.push(new CachedOrder(O.mapPos(U.from,1),O.mapPos(U.to,-1),U.dir,U.isolates,!1,U.order))}return F}}function attrsFromFacet(D,w,O){for(let F=D.state.facet(w),q=F.length-1;q>=0;q--){let W=F[q],U=typeof W=="function"?W(D):W;U&&combineAttrs(U,O)}return O}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(D,w){const O=D.split(/-(?!$)/);let F=O[O.length-1];F=="Space"&&(F=" ");let q,W,U,K;for(let G=0;G<O.length-1;++G){const Y=O[G];if(/^(cmd|meta|m)$/i.test(Y))K=!0;else if(/^a(lt)?$/i.test(Y))q=!0;else if(/^(c|ctrl|control)$/i.test(Y))W=!0;else if(/^s(hift)?$/i.test(Y))U=!0;else if(/^mod$/i.test(Y))w=="mac"?K=!0:W=!0;else throw new Error("Unrecognized modifier name: "+Y)}return q&&(F="Alt-"+F),W&&(F="Ctrl-"+F),K&&(F="Meta-"+F),U&&(F="Shift-"+F),F}function modifiers(D,w,O){return w.altKey&&(D="Alt-"+D),w.ctrlKey&&(D="Ctrl-"+D),w.metaKey&&(D="Meta-"+D),O!==!1&&w.shiftKey&&(D="Shift-"+D),D}const handleKeyEvents=Prec.default(EditorView.domEventHandlers({keydown(D,w){return runHandlers(getKeymap(w.state),D,w,"editor")}})),keymap=Facet.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(D){let w=D.facet(keymap),O=Keymaps.get(w);return O||Keymaps.set(w,O=buildKeymap(w.reduce((F,q)=>F.concat(q),[]))),O}function runScopeHandlers(D,w,O){return runHandlers(getKeymap(D.state),w,D,O)}let storedPrefix=null;const PrefixTimeout=4e3;function buildKeymap(D,w=currentPlatform){let O=Object.create(null),F=Object.create(null),q=(U,K)=>{let G=F[U];if(G==null)F[U]=K;else if(G!=K)throw new Error("Key binding "+U+" is used both as a regular binding and as a multi-stroke prefix")},W=(U,K,G,Y,Q)=>{var X,J;let Z=O[U]||(O[U]=Object.create(null)),ee=K.split(/ (?!$)/).map(re=>normalizeKeyName(re,w));for(let re=1;re<ee.length;re++){let se=ee.slice(0,re).join(" ");q(se,!0),Z[se]||(Z[se]={preventDefault:!0,stopPropagation:!1,run:[le=>{let ue=storedPrefix={view:le,prefix:se,scope:U};return setTimeout(()=>{storedPrefix==ue&&(storedPrefix=null)},PrefixTimeout),!0}]})}let ne=ee.join(" ");q(ne,!1);let te=Z[ne]||(Z[ne]={preventDefault:!1,stopPropagation:!1,run:((J=(X=Z._any)===null||X===void 0?void 0:X.run)===null||J===void 0?void 0:J.slice())||[]});G&&te.run.push(G),Y&&(te.preventDefault=!0),Q&&(te.stopPropagation=!0)};for(let U of D){let K=U.scope?U.scope.split(" "):["editor"];if(U.any)for(let Y of K){let Q=O[Y]||(O[Y]=Object.create(null));Q._any||(Q._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:X}=U;for(let J in Q)Q[J].run.push(Z=>X(Z,currentKeyEvent))}let G=U[w]||U.key;if(G)for(let Y of K)W(Y,G,U.run,U.preventDefault,U.stopPropagation),U.shift&&W(Y,"Shift-"+G,U.shift,U.preventDefault,U.stopPropagation)}return O}let currentKeyEvent=null;function runHandlers(D,w,O,F){currentKeyEvent=w;let q=keyName(w),W=codePointAt(q,0),U=codePointSize(W)==q.length&&q!=" ",K="",G=!1,Y=!1,Q=!1;storedPrefix&&storedPrefix.view==O&&storedPrefix.scope==F&&(K=storedPrefix.prefix+" ",modifierCodes.indexOf(w.keyCode)<0&&(Y=!0,storedPrefix=null));let X=new Set,J=te=>{if(te){for(let re of te.run)if(!X.has(re)&&(X.add(re),re(O)))return te.stopPropagation&&(Q=!0),!0;te.preventDefault&&(te.stopPropagation&&(Q=!0),Y=!0)}return!1},Z=D[F],ee,ne;return Z&&(J(Z[K+modifiers(q,w,!U)])?G=!0:U&&(w.altKey||w.metaKey||w.ctrlKey)&&!(browser.windows&&w.ctrlKey&&w.altKey)&&(ee=base[w.keyCode])&&ee!=q?(J(Z[K+modifiers(ee,w,!0)])||w.shiftKey&&(ne=shift[w.keyCode])!=q&&ne!=ee&&J(Z[K+modifiers(ne,w,!1)]))&&(G=!0):U&&w.shiftKey&&J(Z[K+modifiers(q,w,!0)])&&(G=!0),!G&&J(Z._any)&&(G=!0)),Y&&(G=!0),G&&Q&&w.stopPropagation(),currentKeyEvent=null,G}class RectangleMarker{constructor(w,O,F,q,W){this.className=w,this.left=O,this.top=F,this.width=q,this.height=W}draw(){let w=document.createElement("div");return w.className=this.className,this.adjust(w),w}update(w,O){return O.className!=this.className?!1:(this.adjust(w),!0)}adjust(w){w.style.left=this.left+"px",w.style.top=this.top+"px",this.width!=null&&(w.style.width=this.width+"px"),w.style.height=this.height+"px"}eq(w){return this.left==w.left&&this.top==w.top&&this.width==w.width&&this.height==w.height&&this.className==w.className}static forRange(w,O,F){if(F.empty){let q=w.coordsAtPos(F.head,F.assoc||1);if(!q)return[];let W=getBase(w);return[new RectangleMarker(O,q.left-W.left,q.top-W.top,null,q.bottom-q.top)]}else return rectanglesForRange(w,O,F)}}function getBase(D){let w=D.scrollDOM.getBoundingClientRect();return{left:(D.textDirection==Direction.LTR?w.left:w.right-D.scrollDOM.clientWidth*D.scaleX)-D.scrollDOM.scrollLeft*D.scaleX,top:w.top-D.scrollDOM.scrollTop*D.scaleY}}function wrappedLine(D,w,O,F){let q=D.coordsAtPos(w,O*2);if(!q)return F;let W=D.dom.getBoundingClientRect(),U=(q.top+q.bottom)/2,K=D.posAtCoords({x:W.left+1,y:U}),G=D.posAtCoords({x:W.right-1,y:U});return K==null||G==null?F:{from:Math.max(F.from,Math.min(K,G)),to:Math.min(F.to,Math.max(K,G))}}function rectanglesForRange(D,w,O){if(O.to<=D.viewport.from||O.from>=D.viewport.to)return[];let F=Math.max(O.from,D.viewport.from),q=Math.min(O.to,D.viewport.to),W=D.textDirection==Direction.LTR,U=D.contentDOM,K=U.getBoundingClientRect(),G=getBase(D),Y=U.querySelector(".cm-line"),Q=Y&&window.getComputedStyle(Y),X=K.left+(Q?parseInt(Q.paddingLeft)+Math.min(0,parseInt(Q.textIndent)):0),J=K.right-(Q?parseInt(Q.paddingRight):0),Z=blockAt(D,F),ee=blockAt(D,q),ne=Z.type==BlockType.Text?Z:null,te=ee.type==BlockType.Text?ee:null;if(ne&&(D.lineWrapping||Z.widgetLineBreaks)&&(ne=wrappedLine(D,F,1,ne)),te&&(D.lineWrapping||ee.widgetLineBreaks)&&(te=wrappedLine(D,q,-1,te)),ne&&te&&ne.from==te.from&&ne.to==te.to)return se(le(O.from,O.to,ne));{let oe=ne?le(O.from,null,ne):ue(Z,!1),ae=te?le(null,O.to,te):ue(ee,!0),ce=[];return(ne||Z).to<(te||ee).from-(ne&&te?1:0)||Z.widgetLineBreaks>1&&oe.bottom+D.defaultLineHeight/2<ae.top?ce.push(re(X,oe.bottom,J,ae.top)):oe.bottom<ae.top&&D.elementAtHeight((oe.bottom+ae.top)/2).type==BlockType.Text&&(oe.bottom=ae.top=(oe.bottom+ae.top)/2),se(oe).concat(ce).concat(se(ae))}function re(oe,ae,ce,de){return new RectangleMarker(w,oe-G.left,ae-G.top,ce-oe,de-ae)}function se({top:oe,bottom:ae,horizontal:ce}){let de=[];for(let fe=0;fe<ce.length;fe+=2)de.push(re(ce[fe],oe,ce[fe+1],ae));return de}function le(oe,ae,ce){let de=1e9,fe=-1e9,ye=[];function pe(me,ve,_e,ge,Se){let we=D.coordsAtPos(me,me==ce.to?-2:2),Ce=D.coordsAtPos(_e,_e==ce.from?2:-2);!we||!Ce||(de=Math.min(we.top,Ce.top,de),fe=Math.max(we.bottom,Ce.bottom,fe),Se==Direction.LTR?ye.push(W&&ve?X:we.left,W&&ge?J:Ce.right):ye.push(!W&&ge?X:Ce.left,!W&&ve?J:we.right))}let he=oe??ce.from,be=ae??ce.to;for(let me of D.visibleRanges)if(me.to>he&&me.from<be)for(let ve=Math.max(me.from,he),_e=Math.min(me.to,be);;){let ge=D.state.doc.lineAt(ve);for(let Se of D.bidiSpans(ge)){let we=Se.from+ge.from,Ce=Se.to+ge.from;if(we>=_e)break;Ce>ve&&pe(Math.max(we,ve),oe==null&&we<=he,Math.min(Ce,_e),ae==null&&Ce>=be,Se.dir)}if(ve=ge.to+1,ve>=_e)break}return ye.length==0&&pe(he,oe==null,be,ae==null,D.textDirection),{top:de,bottom:fe,horizontal:ye}}function ue(oe,ae){let ce=K.top+(ae?oe.top:oe.bottom);return{top:ce,bottom:ce,horizontal:[]}}}function sameMarker(D,w){return D.constructor==w.constructor&&D.eq(w)}class LayerView{constructor(w,O){this.view=w,this.layer=O,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=w.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),O.above&&this.dom.classList.add("cm-layer-above"),O.class&&this.dom.classList.add(O.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(w.state),w.requestMeasure(this.measureReq),O.mount&&O.mount(this.dom,w)}update(w){w.startState.facet(layerOrder)!=w.state.facet(layerOrder)&&this.setOrder(w.state),(this.layer.update(w,this.dom)||w.geometryChanged)&&(this.scale(),w.view.requestMeasure(this.measureReq))}docViewUpdate(w){this.layer.updateOnDocViewUpdate!==!1&&w.requestMeasure(this.measureReq)}setOrder(w){let O=0,F=w.facet(layerOrder);for(;O<F.length&&F[O]!=this.layer;)O++;this.dom.style.zIndex=String((this.layer.above?150:-1)-O)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:w,scaleY:O}=this.view;(w!=this.scaleX||O!=this.scaleY)&&(this.scaleX=w,this.scaleY=O,this.dom.style.transform=`scale(${1/w}, ${1/O})`)}draw(w){if(w.length!=this.drawn.length||w.some((O,F)=>!sameMarker(O,this.drawn[F]))){let O=this.dom.firstChild,F=0;for(let q of w)q.update&&O&&q.constructor&&this.drawn[F].constructor&&q.update(O,this.drawn[F])?(O=O.nextSibling,F++):this.dom.insertBefore(q.draw(),O);for(;O;){let q=O.nextSibling;O.remove(),O=q}this.drawn=w}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const layerOrder=Facet.define();function layer(D){return[ViewPlugin.define(w=>new LayerView(w,D)),layerOrder.of(D)]}const CanHidePrimary=!(browser.ios&&browser.webkit&&browser.webkit_version<534),selectionConfig=Facet.define({combine(D){return combineConfig(D,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(w,O)=>Math.min(w,O),drawRangeCursor:(w,O)=>w||O})}});function drawSelection(D={}){return[selectionConfig.of(D),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(!0)]}function configChanged(D){return D.startState.facet(selectionConfig)!=D.state.facet(selectionConfig)}const cursorLayer=layer({above:!0,markers(D){let{state:w}=D,O=w.facet(selectionConfig),F=[];for(let q of w.selection.ranges){let W=q==w.selection.main;if(q.empty?!W||CanHidePrimary:O.drawRangeCursor){let U=W?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",K=q.empty?q:EditorSelection.cursor(q.head,q.head>q.anchor?-1:1);for(let G of RectangleMarker.forRange(D,U,K))F.push(G)}}return F},update(D,w){D.transactions.some(F=>F.selection)&&(w.style.animationName=w.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let O=configChanged(D);return O&&setBlinkRate(D.state,w),D.docChanged||D.selectionSet||O},mount(D,w){setBlinkRate(w.state,D)},class:"cm-cursorLayer"});function setBlinkRate(D,w){w.style.animationDuration=D.facet(selectionConfig).cursorBlinkRate+"ms"}const selectionLayer=layer({above:!1,markers(D){return D.state.selection.ranges.map(w=>w.empty?[]:RectangleMarker.forRange(D,"cm-selectionBackground",w)).reduce((w,O)=>w.concat(O))},update(D,w){return D.docChanged||D.selectionSet||D.viewportChanged||configChanged(D)},class:"cm-selectionLayer"}),themeSpec={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor=themeSpec[".cm-content"].caretColor="transparent !important");const hideNativeSelection=Prec.highest(EditorView.theme(themeSpec)),setDropCursorPos=StateEffect.define({map(D,w){return D==null?null:w.mapPos(D)}}),dropCursorPos=StateField.define({create(){return null},update(D,w){return D!=null&&(D=w.changes.mapPos(D)),w.effects.reduce((O,F)=>F.is(setDropCursorPos)?F.value:O,D)}}),drawDropCursor=ViewPlugin.fromClass(class{constructor(D){this.view=D,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(D){var w;let O=D.state.field(dropCursorPos);O==null?this.cursor!=null&&((w=this.cursor)===null||w===void 0||w.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(D.startState.field(dropCursorPos)!=O||D.docChanged||D.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:D}=this,w=D.state.field(dropCursorPos),O=w!=null&&D.coordsAtPos(w);if(!O)return null;let F=D.scrollDOM.getBoundingClientRect();return{left:O.left-F.left+D.scrollDOM.scrollLeft*D.scaleX,top:O.top-F.top+D.scrollDOM.scrollTop*D.scaleY,height:O.bottom-O.top}}drawCursor(D){if(this.cursor){let{scaleX:w,scaleY:O}=this.view;D?(this.cursor.style.left=D.left/w+"px",this.cursor.style.top=D.top/O+"px",this.cursor.style.height=D.height/O+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(D){this.view.state.field(dropCursorPos)!=D&&this.view.dispatch({effects:setDropCursorPos.of(D)})}},{eventObservers:{dragover(D){this.setDropPos(this.view.posAtCoords({x:D.clientX,y:D.clientY}))},dragleave(D){(D.target==this.view.contentDOM||!this.view.contentDOM.contains(D.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function dropCursor(){return[dropCursorPos,drawDropCursor]}function iterMatches(D,w,O,F,q){w.lastIndex=0;for(let W=D.iterRange(O,F),U=O,K;!W.next().done;U+=W.value.length)if(!W.lineBreak)for(;K=w.exec(W.value);)q(U+K.index,K)}function matchRanges(D,w){let O=D.visibleRanges;if(O.length==1&&O[0].from==D.viewport.from&&O[0].to==D.viewport.to)return O;let F=[];for(let{from:q,to:W}of O)q=Math.max(D.state.doc.lineAt(q).from,q-w),W=Math.min(D.state.doc.lineAt(W).to,W+w),F.length&&F[F.length-1].to>=q?F[F.length-1].to=W:F.push({from:q,to:W});return F}class MatchDecorator{constructor(w){const{regexp:O,decoration:F,decorate:q,boundary:W,maxLength:U=1e3}=w;if(!O.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=O,q)this.addMatch=(K,G,Y,Q)=>q(Q,Y,Y+K[0].length,K,G);else if(typeof F=="function")this.addMatch=(K,G,Y,Q)=>{let X=F(K,G,Y);X&&Q(Y,Y+K[0].length,X)};else if(F)this.addMatch=(K,G,Y,Q)=>Q(Y,Y+K[0].length,F);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=W,this.maxLength=U}createDeco(w){let O=new RangeSetBuilder,F=O.add.bind(O);for(let{from:q,to:W}of matchRanges(w,this.maxLength))iterMatches(w.state.doc,this.regexp,q,W,(U,K)=>this.addMatch(K,w,U,F));return O.finish()}updateDeco(w,O){let F=1e9,q=-1;return w.docChanged&&w.changes.iterChanges((W,U,K,G)=>{G>=w.view.viewport.from&&K<=w.view.viewport.to&&(F=Math.min(K,F),q=Math.max(G,q))}),w.viewportMoved||q-F>1e3?this.createDeco(w.view):q>-1?this.updateRange(w.view,O.map(w.changes),F,q):O}updateRange(w,O,F,q){for(let W of w.visibleRanges){let U=Math.max(W.from,F),K=Math.min(W.to,q);if(K>U){let G=w.state.doc.lineAt(U),Y=G.to<K?w.state.doc.lineAt(K):G,Q=Math.max(W.from,G.from),X=Math.min(W.to,Y.to);if(this.boundary){for(;U>G.from;U--)if(this.boundary.test(G.text[U-1-G.from])){Q=U;break}for(;K<Y.to;K++)if(this.boundary.test(Y.text[K-Y.from])){X=K;break}}let J=[],Z,ee=(ne,te,re)=>J.push(re.range(ne,te));if(G==Y)for(this.regexp.lastIndex=Q-G.from;(Z=this.regexp.exec(G.text))&&Z.index<X-G.from;)this.addMatch(Z,w,Z.index+G.from,ee);else iterMatches(w.state.doc,this.regexp,Q,X,(ne,te)=>this.addMatch(te,w,ne,ee));O=O.update({filterFrom:Q,filterTo:X,filter:(ne,te)=>ne<Q||te>X,add:J})}}return O}}const UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g",Specials=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\uFEFF￹-￼]`,UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;function supportsTabSize(){var D;if(_supportsTabSize==null&&typeof document<"u"&&document.body){let w=document.body.style;_supportsTabSize=((D=w.tabSize)!==null&&D!==void 0?D:w.MozTabSize)!=null}return _supportsTabSize||!1}const specialCharConfig=Facet.define({combine(D){let w=combineConfig(D,{render:null,specialChars:Specials,addSpecialChars:null});return(w.replaceTabs=!supportsTabSize())&&(w.specialChars=new RegExp("	|"+w.specialChars.source,UnicodeRegexpSupport)),w.addSpecialChars&&(w.specialChars=new RegExp(w.specialChars.source+"|"+w.addSpecialChars.source,UnicodeRegexpSupport)),w}});function highlightSpecialChars(D={}){return[specialCharConfig.of(D),specialCharPlugin()]}let _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(class{constructor(D){this.view=D,this.decorations=Decoration.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(D.state.facet(specialCharConfig)),this.decorations=this.decorator.createDeco(D)}makeDecorator(D){return new MatchDecorator({regexp:D.specialChars,decoration:(w,O,F)=>{let{doc:q}=O.state,W=codePointAt(w[0],0);if(W==9){let U=q.lineAt(F),K=O.state.tabSize,G=countColumn(U.text,K,F-U.from);return Decoration.replace({widget:new TabWidget((K-G%K)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[W]||(this.decorationCache[W]=Decoration.replace({widget:new SpecialCharWidget(D,W)}))},boundary:D.replaceTabs?void 0:/[^]/})}update(D){let w=D.state.facet(specialCharConfig);D.startState.facet(specialCharConfig)!=w?(this.decorator=this.makeDecorator(w),this.decorations=this.decorator.createDeco(D.view)):this.decorations=this.decorator.updateDeco(D,this.decorations)}},{decorations:D=>D.decorations}))}const DefaultPlaceholder="•";function placeholder$1(D){return D>=32?DefaultPlaceholder:D==10?"␤":String.fromCharCode(9216+D)}class SpecialCharWidget extends WidgetType{constructor(w,O){super(),this.options=w,this.code=O}eq(w){return w.code==this.code}toDOM(w){let O=placeholder$1(this.code),F=w.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16)),q=this.options.render&&this.options.render(this.code,F,O);if(q)return q;let W=document.createElement("span");return W.textContent=O,W.title=F,W.setAttribute("aria-label",F),W.className="cm-specialChar",W}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(w){super(),this.width=w}eq(w){return w.width==this.width}toDOM(){let w=document.createElement("span");return w.textContent="	",w.className="cm-tab",w.style.width=this.width+"px",w}ignoreEvent(){return!1}}function highlightActiveLine(){return activeLineHighlighter}const lineDeco=Decoration.line({class:"cm-activeLine"}),activeLineHighlighter=ViewPlugin.fromClass(class{constructor(D){this.decorations=this.getDeco(D)}update(D){(D.docChanged||D.selectionSet)&&(this.decorations=this.getDeco(D.view))}getDeco(D){let w=-1,O=[];for(let F of D.state.selection.ranges){let q=D.lineBlockAt(F.head);q.from>w&&(O.push(lineDeco.range(q.from)),w=q.from)}return Decoration.set(O)}},{decorations:D=>D.decorations}),MaxOff=2e3;function rectangleFor(D,w,O){let F=Math.min(w.line,O.line),q=Math.max(w.line,O.line),W=[];if(w.off>MaxOff||O.off>MaxOff||w.col<0||O.col<0){let U=Math.min(w.off,O.off),K=Math.max(w.off,O.off);for(let G=F;G<=q;G++){let Y=D.doc.line(G);Y.length<=K&&W.push(EditorSelection.range(Y.from+U,Y.to+K))}}else{let U=Math.min(w.col,O.col),K=Math.max(w.col,O.col);for(let G=F;G<=q;G++){let Y=D.doc.line(G),Q=findColumn(Y.text,U,D.tabSize,!0);if(Q<0)W.push(EditorSelection.cursor(Y.to));else{let X=findColumn(Y.text,K,D.tabSize);W.push(EditorSelection.range(Y.from+Q,Y.from+X))}}}return W}function absoluteColumn(D,w){let O=D.coordsAtPos(D.viewport.from);return O?Math.round(Math.abs((O.left-w)/D.defaultCharacterWidth)):-1}function getPos(D,w){let O=D.posAtCoords({x:w.clientX,y:w.clientY},!1),F=D.state.doc.lineAt(O),q=O-F.from,W=q>MaxOff?-1:q==F.length?absoluteColumn(D,w.clientX):countColumn(F.text,D.state.tabSize,O-F.from);return{line:F.number,col:W,off:q}}function rectangleSelectionStyle(D,w){let O=getPos(D,w),F=D.state.selection;return O?{update(q){if(q.docChanged){let W=q.changes.mapPos(q.startState.doc.line(O.line).from),U=q.state.doc.lineAt(W);O={line:U.number,col:O.col,off:Math.min(O.off,U.length)},F=F.map(q.changes)}},get(q,W,U){let K=getPos(D,q);if(!K)return F;let G=rectangleFor(D.state,O,K);return G.length?U?EditorSelection.create(G.concat(F.ranges)):EditorSelection.create(G):F}}:null}function rectangularSelection(D){let w=O=>O.altKey&&O.button==0;return EditorView.mouseSelectionStyle.of((O,F)=>w(F)?rectangleSelectionStyle(O,F):null)}const keys={Alt:[18,D=>!!D.altKey],Control:[17,D=>!!D.ctrlKey],Shift:[16,D=>!!D.shiftKey],Meta:[91,D=>!!D.metaKey]},showCrosshair={style:"cursor: crosshair"};function crosshairCursor(D={}){let[w,O]=keys[D.key||"Alt"],F=ViewPlugin.fromClass(class{constructor(q){this.view=q,this.isDown=!1}set(q){this.isDown!=q&&(this.isDown=q,this.view.update([]))}},{eventObservers:{keydown(q){this.set(q.keyCode==w||O(q))},keyup(q){(q.keyCode==w||!O(q))&&this.set(!1)},mousemove(q){this.set(O(q))}}});return[F,EditorView.contentAttributes.of(q=>{var W;return!((W=q.plugin(F))===null||W===void 0)&&W.isDown?showCrosshair:null})]}const Outside="-10000px";class TooltipViewManager{constructor(w,O,F,q){this.facet=O,this.createTooltipView=F,this.removeTooltipView=q,this.input=w.state.facet(O),this.tooltips=this.input.filter(U=>U);let W=null;this.tooltipViews=this.tooltips.map(U=>W=F(U,W))}update(w,O){var F;let q=w.state.facet(this.facet),W=q.filter(G=>G);if(q===this.input){for(let G of this.tooltipViews)G.update&&G.update(w);return!1}let U=[],K=O?[]:null;for(let G=0;G<W.length;G++){let Y=W[G],Q=-1;if(Y){for(let X=0;X<this.tooltips.length;X++){let J=this.tooltips[X];J&&J.create==Y.create&&(Q=X)}if(Q<0)U[G]=this.createTooltipView(Y,G?U[G-1]:null),K&&(K[G]=!!Y.above);else{let X=U[G]=this.tooltipViews[Q];K&&(K[G]=O[Q]),X.update&&X.update(w)}}}for(let G of this.tooltipViews)U.indexOf(G)<0&&(this.removeTooltipView(G),(F=G.destroy)===null||F===void 0||F.call(G));return O&&(K.forEach((G,Y)=>O[Y]=G),O.length=K.length),this.input=q,this.tooltips=W,this.tooltipViews=U,!0}}function windowSpace(D){let w=D.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:w.clientHeight,right:w.clientWidth}}const tooltipConfig=Facet.define({combine:D=>{var w,O,F;return{position:browser.ios?"absolute":((w=D.find(q=>q.position))===null||w===void 0?void 0:w.position)||"fixed",parent:((O=D.find(q=>q.parent))===null||O===void 0?void 0:O.parent)||null,tooltipSpace:((F=D.find(q=>q.tooltipSpace))===null||F===void 0?void 0:F.tooltipSpace)||windowSpace}}}),knownHeight=new WeakMap,tooltipPlugin=ViewPlugin.fromClass(class{constructor(D){this.view=D,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let w=D.state.facet(tooltipConfig);this.position=w.position,this.parent=w.parent,this.classes=D.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new TooltipViewManager(D,showTooltip,(O,F)=>this.createTooltip(O,F),O=>{this.resizeObserver&&this.resizeObserver.unobserve(O.dom),O.dom.remove()}),this.above=this.manager.tooltips.map(O=>!!O.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(O=>{Date.now()>this.lastTransaction-50&&O.length>0&&O[O.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),D.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let D of this.manager.tooltipViews)this.intersectionObserver.observe(D.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(D){D.transactions.length&&(this.lastTransaction=Date.now());let w=this.manager.update(D,this.above);w&&this.observeIntersection();let O=w||D.geometryChanged,F=D.state.facet(tooltipConfig);if(F.position!=this.position&&!this.madeAbsolute){this.position=F.position;for(let q of this.manager.tooltipViews)q.dom.style.position=this.position;O=!0}if(F.parent!=this.parent){this.parent&&this.container.remove(),this.parent=F.parent,this.createContainer();for(let q of this.manager.tooltipViews)this.container.appendChild(q.dom);O=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);O&&this.maybeMeasure()}createTooltip(D,w){let O=D.create(this.view),F=w?w.dom:null;if(O.dom.classList.add("cm-tooltip"),D.arrow&&!O.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let q=document.createElement("div");q.className="cm-tooltip-arrow",O.dom.appendChild(q)}return O.dom.style.position=this.position,O.dom.style.top=Outside,O.dom.style.left="0px",this.container.insertBefore(O.dom,F),O.mount&&O.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(O.dom),O}destroy(){var D,w,O;this.view.win.removeEventListener("resize",this.measureSoon);for(let F of this.manager.tooltipViews)F.dom.remove(),(D=F.destroy)===null||D===void 0||D.call(F);this.parent&&this.container.remove(),(w=this.resizeObserver)===null||w===void 0||w.disconnect(),(O=this.intersectionObserver)===null||O===void 0||O.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let D=1,w=1,O=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:W}=this.manager.tooltipViews[0];if(browser.gecko)O=W.offsetParent!=this.container.ownerDocument.body;else if(W.style.top==Outside&&W.style.left=="0px"){let U=W.getBoundingClientRect();O=Math.abs(U.top+1e4)>1||Math.abs(U.left)>1}}if(O||this.position=="absolute")if(this.parent){let W=this.parent.getBoundingClientRect();W.width&&W.height&&(D=W.width/this.parent.offsetWidth,w=W.height/this.parent.offsetHeight)}else({scaleX:D,scaleY:w}=this.view.viewState);let F=this.view.scrollDOM.getBoundingClientRect(),q=getScrollMargins(this.view);return{visible:{left:F.left+q.left,top:F.top+q.top,right:F.right-q.right,bottom:F.bottom-q.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((W,U)=>{let K=this.manager.tooltipViews[U];return K.getCoords?K.getCoords(W.pos):this.view.coordsAtPos(W.pos)}),size:this.manager.tooltipViews.map(({dom:W})=>W.getBoundingClientRect()),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view),scaleX:D,scaleY:w,makeAbsolute:O}}writeMeasure(D){var w;if(D.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let K of this.manager.tooltipViews)K.dom.style.position="absolute"}let{visible:O,space:F,scaleX:q,scaleY:W}=D,U=[];for(let K=0;K<this.manager.tooltips.length;K++){let G=this.manager.tooltips[K],Y=this.manager.tooltipViews[K],{dom:Q}=Y,X=D.pos[K],J=D.size[K];if(!X||G.clip!==!1&&(X.bottom<=Math.max(O.top,F.top)||X.top>=Math.min(O.bottom,F.bottom)||X.right<Math.max(O.left,F.left)-.1||X.left>Math.min(O.right,F.right)+.1)){Q.style.top=Outside;continue}let Z=G.arrow?Y.dom.querySelector(".cm-tooltip-arrow"):null,ee=Z?7:0,ne=J.right-J.left,te=(w=knownHeight.get(Y))!==null&&w!==void 0?w:J.bottom-J.top,re=Y.offset||noOffset,se=this.view.textDirection==Direction.LTR,le=J.width>F.right-F.left?se?F.left:F.right-J.width:se?Math.max(F.left,Math.min(X.left-(Z?14:0)+re.x,F.right-ne)):Math.min(Math.max(F.left,X.left-ne+(Z?14:0)-re.x),F.right-ne),ue=this.above[K];!G.strictSide&&(ue?X.top-te-ee-re.y<F.top:X.bottom+te+ee+re.y>F.bottom)&&ue==F.bottom-X.bottom>X.top-F.top&&(ue=this.above[K]=!ue);let oe=(ue?X.top-F.top:F.bottom-X.bottom)-ee;if(oe<te&&Y.resize!==!1){if(oe<this.view.defaultLineHeight){Q.style.top=Outside;continue}knownHeight.set(Y,te),Q.style.height=(te=oe)/W+"px"}else Q.style.height&&(Q.style.height="");let ae=ue?X.top-te-ee-re.y:X.bottom+ee+re.y,ce=le+ne;if(Y.overlap!==!0)for(let de of U)de.left<ce&&de.right>le&&de.top<ae+te&&de.bottom>ae&&(ae=ue?de.top-te-2-ee:de.bottom+ee+2);if(this.position=="absolute"?(Q.style.top=(ae-D.parent.top)/W+"px",setLeftStyle(Q,(le-D.parent.left)/q)):(Q.style.top=ae/W+"px",setLeftStyle(Q,le/q)),Z){let de=X.left+(se?re.x:-re.x)-(le+14-7);Z.style.left=de/q+"px"}Y.overlap!==!0&&U.push({left:le,top:ae,right:ce,bottom:ae+te}),Q.classList.toggle("cm-tooltip-above",ue),Q.classList.toggle("cm-tooltip-below",!ue),Y.positioned&&Y.positioned(D.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let D of this.manager.tooltipViews)D.dom.style.top=Outside}},{eventObservers:{scroll(){this.maybeMeasure()}}});function setLeftStyle(D,w){let O=parseInt(D.style.left,10);(isNaN(O)||Math.abs(w-O)>1)&&(D.style.left=w+"px")}const baseTheme$4=EditorView.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),noOffset={x:0,y:0},showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$4]}),showHoverTooltip=Facet.define({combine:D=>D.reduce((w,O)=>w.concat(O),[])});class HoverTooltipHost{static create(w){return new HoverTooltipHost(w)}constructor(w){this.view=w,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new TooltipViewManager(w,showHoverTooltip,(O,F)=>this.createHostedView(O,F),O=>O.dom.remove())}createHostedView(w,O){let F=w.create(this.view);return F.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(F.dom,O?O.dom.nextSibling:this.dom.firstChild),this.mounted&&F.mount&&F.mount(this.view),F}mount(w){for(let O of this.manager.tooltipViews)O.mount&&O.mount(w);this.mounted=!0}positioned(w){for(let O of this.manager.tooltipViews)O.positioned&&O.positioned(w)}update(w){this.manager.update(w)}destroy(){var w;for(let O of this.manager.tooltipViews)(w=O.destroy)===null||w===void 0||w.call(O)}passProp(w){let O;for(let F of this.manager.tooltipViews){let q=F[w];if(q!==void 0){if(O===void 0)O=q;else if(O!==q)return}}return O}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const showHoverTooltipHost=showTooltip.compute([showHoverTooltip],D=>{let w=D.facet(showHoverTooltip);return w.length===0?null:{pos:Math.min(...w.map(O=>O.pos)),end:Math.max(...w.map(O=>{var F;return(F=O.end)!==null&&F!==void 0?F:O.pos})),create:HoverTooltipHost.create,above:w[0].above,arrow:w.some(O=>O.arrow)}});class HoverPlugin{constructor(w,O,F,q,W){this.view=w,this.source=O,this.field=F,this.setHover=q,this.hoverTime=W,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:w.dom,time:0},this.checkHover=this.checkHover.bind(this),w.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),w.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let w=Date.now()-this.lastMove.time;w<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-w):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:w,lastMove:O}=this,F=w.docView.nearest(O.target);if(!F)return;let q,W=1;if(F instanceof WidgetView)q=F.posAtStart;else{if(q=w.posAtCoords(O),q==null)return;let K=w.coordsAtPos(q);if(!K||O.y<K.top||O.y>K.bottom||O.x<K.left-w.defaultCharacterWidth||O.x>K.right+w.defaultCharacterWidth)return;let G=w.bidiSpans(w.state.doc.lineAt(q)).find(Q=>Q.from<=q&&Q.to>=q),Y=G&&G.dir==Direction.RTL?-1:1;W=O.x<K.left?-Y:Y}let U=this.source(w,q,W);if(U!=null&&U.then){let K=this.pending={pos:q};U.then(G=>{this.pending==K&&(this.pending=null,G&&!(Array.isArray(G)&&!G.length)&&w.dispatch({effects:this.setHover.of(Array.isArray(G)?G:[G])}))},G=>logException(w.state,G,"hover tooltip"))}else U&&!(Array.isArray(U)&&!U.length)&&w.dispatch({effects:this.setHover.of(Array.isArray(U)?U:[U])})}get tooltip(){let w=this.view.plugin(tooltipPlugin),O=w?w.manager.tooltips.findIndex(F=>F.create==HoverTooltipHost.create):-1;return O>-1?w.manager.tooltipViews[O]:null}mousemove(w){var O,F;this.lastMove={x:w.clientX,y:w.clientY,target:w.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:q,tooltip:W}=this;if(q.length&&W&&!isInTooltip(W.dom,w)||this.pending){let{pos:U}=q[0]||this.pending,K=(F=(O=q[0])===null||O===void 0?void 0:O.end)!==null&&F!==void 0?F:U;(U==K?this.view.posAtCoords(this.lastMove)!=U:!isOverRange(this.view,U,K,w.clientX,w.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(w){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:O}=this;if(O.length){let{tooltip:F}=this;F&&F.dom.contains(w.relatedTarget)?this.watchTooltipLeave(F.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(w){let O=F=>{w.removeEventListener("mouseleave",O),this.active.length&&!this.view.dom.contains(F.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};w.addEventListener("mouseleave",O)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const tooltipMargin=4;function isInTooltip(D,w){let{left:O,right:F,top:q,bottom:W}=D.getBoundingClientRect(),U;if(U=D.querySelector(".cm-tooltip-arrow")){let K=U.getBoundingClientRect();q=Math.min(K.top,q),W=Math.max(K.bottom,W)}return w.clientX>=O-tooltipMargin&&w.clientX<=F+tooltipMargin&&w.clientY>=q-tooltipMargin&&w.clientY<=W+tooltipMargin}function isOverRange(D,w,O,F,q,W){let U=D.scrollDOM.getBoundingClientRect(),K=D.documentTop+D.documentPadding.top+D.contentHeight;if(U.left>F||U.right<F||U.top>q||Math.min(U.bottom,K)<q)return!1;let G=D.posAtCoords({x:F,y:q},!1);return G>=w&&G<=O}function hoverTooltip(D,w={}){let O=StateEffect.define(),F=StateField.define({create(){return[]},update(q,W){if(q.length&&(w.hideOnChange&&(W.docChanged||W.selection)?q=[]:w.hideOn&&(q=q.filter(U=>!w.hideOn(W,U))),W.docChanged)){let U=[];for(let K of q){let G=W.changes.mapPos(K.pos,-1,MapMode.TrackDel);if(G!=null){let Y=Object.assign(Object.create(null),K);Y.pos=G,Y.end!=null&&(Y.end=W.changes.mapPos(Y.end)),U.push(Y)}}q=U}for(let U of W.effects)U.is(O)&&(q=U.value),U.is(closeHoverTooltipEffect)&&(q=[]);return q},provide:q=>showHoverTooltip.from(q)});return{active:F,extension:[F,ViewPlugin.define(q=>new HoverPlugin(q,D,F,O,w.hoverTime||300)),showHoverTooltipHost]}}function getTooltip(D,w){let O=D.plugin(tooltipPlugin);if(!O)return null;let F=O.manager.tooltips.indexOf(w);return F<0?null:O.manager.tooltipViews[F]}const closeHoverTooltipEffect=StateEffect.define(),panelConfig=Facet.define({combine(D){let w,O;for(let F of D)w=w||F.topContainer,O=O||F.bottomContainer;return{topContainer:w,bottomContainer:O}}});function getPanel(D,w){let O=D.plugin(panelPlugin),F=O?O.specs.indexOf(w):-1;return F>-1?O.panels[F]:null}const panelPlugin=ViewPlugin.fromClass(class{constructor(D){this.input=D.state.facet(showPanel),this.specs=this.input.filter(O=>O),this.panels=this.specs.map(O=>O(D));let w=D.state.facet(panelConfig);this.top=new PanelGroup(D,!0,w.topContainer),this.bottom=new PanelGroup(D,!1,w.bottomContainer),this.top.sync(this.panels.filter(O=>O.top)),this.bottom.sync(this.panels.filter(O=>!O.top));for(let O of this.panels)O.dom.classList.add("cm-panel"),O.mount&&O.mount()}update(D){let w=D.state.facet(panelConfig);this.top.container!=w.topContainer&&(this.top.sync([]),this.top=new PanelGroup(D.view,!0,w.topContainer)),this.bottom.container!=w.bottomContainer&&(this.bottom.sync([]),this.bottom=new PanelGroup(D.view,!1,w.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let O=D.state.facet(showPanel);if(O!=this.input){let F=O.filter(G=>G),q=[],W=[],U=[],K=[];for(let G of F){let Y=this.specs.indexOf(G),Q;Y<0?(Q=G(D.view),K.push(Q)):(Q=this.panels[Y],Q.update&&Q.update(D)),q.push(Q),(Q.top?W:U).push(Q)}this.specs=F,this.panels=q,this.top.sync(W),this.bottom.sync(U);for(let G of K)G.dom.classList.add("cm-panel"),G.mount&&G.mount()}else for(let F of this.panels)F.update&&F.update(D)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:D=>EditorView.scrollMargins.of(w=>{let O=w.plugin(D);return O&&{top:O.top.scrollMargin(),bottom:O.bottom.scrollMargin()}})});class PanelGroup{constructor(w,O,F){this.view=w,this.top=O,this.container=F,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(w){for(let O of this.panels)O.destroy&&w.indexOf(O)<0&&O.destroy();this.panels=w,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let O=this.container||this.view.dom;O.insertBefore(this.dom,this.top?O.firstChild:null)}let w=this.dom.firstChild;for(let O of this.panels)if(O.dom.parentNode==this.dom){for(;w!=O.dom;)w=rm(w);w=w.nextSibling}else this.dom.insertBefore(O.dom,w);for(;w;)w=rm(w)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let w of this.classes.split(" "))w&&this.container.classList.remove(w);for(let w of(this.classes=this.view.themeClasses).split(" "))w&&this.container.classList.add(w)}}}function rm(D){let w=D.nextSibling;return D.remove(),w}const showPanel=Facet.define({enables:panelPlugin});class GutterMarker extends RangeValue{compare(w){return this==w||this.constructor==w.constructor&&this.eq(w)}eq(w){return!1}destroy(w){}}GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=void 0;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=!0;const gutterLineClass=Facet.define(),gutterWidgetClass=Facet.define(),defaults$1={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>RangeSet.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},activeGutters=Facet.define();function gutter(D){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults$1),D))]}const unfixGutters=Facet.define({combine:D=>D.some(w=>w)});function gutters(D){return[gutterView]}const gutterView=ViewPlugin.fromClass(class{constructor(D){this.view=D,this.prevViewport=D.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=D.state.facet(activeGutters).map(w=>new SingleGutterView(D,w));for(let w of this.gutters)this.dom.appendChild(w.dom);this.fixed=!D.state.facet(unfixGutters),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),D.scrollDOM.insertBefore(this.dom,D.contentDOM)}update(D){if(this.updateGutters(D)){let w=this.prevViewport,O=D.view.viewport,F=Math.min(w.to,O.to)-Math.max(w.from,O.from);this.syncGutters(F<(O.to-O.from)*.8)}D.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=D.view.viewport}syncGutters(D){let w=this.dom.nextSibling;D&&this.dom.remove();let O=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from),F=[],q=this.gutters.map(W=>new UpdateContext(W,this.view.viewport,-this.view.documentPadding.top));for(let W of this.view.viewportLineBlocks)if(F.length&&(F=[]),Array.isArray(W.type)){let U=!0;for(let K of W.type)if(K.type==BlockType.Text&&U){advanceCursor(O,F,K.from);for(let G of q)G.line(this.view,K,F);U=!1}else if(K.widget)for(let G of q)G.widget(this.view,K)}else if(W.type==BlockType.Text){advanceCursor(O,F,W.from);for(let U of q)U.line(this.view,W,F)}else if(W.widget)for(let U of q)U.widget(this.view,W);for(let W of q)W.finish();D&&this.view.scrollDOM.insertBefore(this.dom,w)}updateGutters(D){let w=D.startState.facet(activeGutters),O=D.state.facet(activeGutters),F=D.docChanged||D.heightChanged||D.viewportChanged||!RangeSet.eq(D.startState.facet(gutterLineClass),D.state.facet(gutterLineClass),D.view.viewport.from,D.view.viewport.to);if(w==O)for(let q of this.gutters)q.update(D)&&(F=!0);else{F=!0;let q=[];for(let W of O){let U=w.indexOf(W);U<0?q.push(new SingleGutterView(this.view,W)):(this.gutters[U].update(D),q.push(this.gutters[U]))}for(let W of this.gutters)W.dom.remove(),q.indexOf(W)<0&&W.destroy();for(let W of q)this.dom.appendChild(W.dom);this.gutters=q}return F}destroy(){for(let D of this.gutters)D.destroy();this.dom.remove()}},{provide:D=>EditorView.scrollMargins.of(w=>{let O=w.plugin(D);return!O||O.gutters.length==0||!O.fixed?null:w.textDirection==Direction.LTR?{left:O.dom.offsetWidth*w.scaleX}:{right:O.dom.offsetWidth*w.scaleX}})});function asArray(D){return Array.isArray(D)?D:[D]}function advanceCursor(D,w,O){for(;D.value&&D.from<=O;)D.from==O&&w.push(D.value),D.next()}class UpdateContext{constructor(w,O,F){this.gutter=w,this.height=F,this.i=0,this.cursor=RangeSet.iter(w.markers,O.from)}addElement(w,O,F){let{gutter:q}=this,W=(O.top-this.height)/w.scaleY,U=O.height/w.scaleY;if(this.i==q.elements.length){let K=new GutterElement(w,U,W,F);q.elements.push(K),q.dom.appendChild(K.dom)}else q.elements[this.i].update(w,U,W,F);this.height=O.bottom,this.i++}line(w,O,F){let q=[];advanceCursor(this.cursor,q,O.from),F.length&&(q=q.concat(F));let W=this.gutter.config.lineMarker(w,O,q);W&&q.unshift(W);let U=this.gutter;q.length==0&&!U.config.renderEmptyElements||this.addElement(w,O,q)}widget(w,O){let F=this.gutter.config.widgetMarker(w,O.widget,O),q=F?[F]:null;for(let W of w.state.facet(gutterWidgetClass)){let U=W(w,O.widget,O);U&&(q||(q=[])).push(U)}q&&this.addElement(w,O,q)}finish(){let w=this.gutter;for(;w.elements.length>this.i;){let O=w.elements.pop();w.dom.removeChild(O.dom),O.destroy()}}}class SingleGutterView{constructor(w,O){this.view=w,this.config=O,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let F in O.domEventHandlers)this.dom.addEventListener(F,q=>{let W=q.target,U;if(W!=this.dom&&this.dom.contains(W)){for(;W.parentNode!=this.dom;)W=W.parentNode;let G=W.getBoundingClientRect();U=(G.top+G.bottom)/2}else U=q.clientY;let K=w.lineBlockAtHeight(U-w.documentTop);O.domEventHandlers[F](w,K,q)&&q.preventDefault()});this.markers=asArray(O.markers(w)),O.initialSpacer&&(this.spacer=new GutterElement(w,0,0,[O.initialSpacer(w)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(w){let O=this.markers;if(this.markers=asArray(this.config.markers(w.view)),this.spacer&&this.config.updateSpacer){let q=this.config.updateSpacer(this.spacer.markers[0],w);q!=this.spacer.markers[0]&&this.spacer.update(w.view,0,0,[q])}let F=w.view.viewport;return!RangeSet.eq(this.markers,O,F.from,F.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(w):!1)}destroy(){for(let w of this.elements)w.destroy()}}class GutterElement{constructor(w,O,F,q){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(w,O,F,q)}update(w,O,F,q){this.height!=O&&(this.height=O,this.dom.style.height=O+"px"),this.above!=F&&(this.dom.style.marginTop=(this.above=F)?F+"px":""),sameMarkers(this.markers,q)||this.setMarkers(w,q)}setMarkers(w,O){let F="cm-gutterElement",q=this.dom.firstChild;for(let W=0,U=0;;){let K=U,G=W<O.length?O[W++]:null,Y=!1;if(G){let Q=G.elementClass;Q&&(F+=" "+Q);for(let X=U;X<this.markers.length;X++)if(this.markers[X].compare(G)){K=X,Y=!0;break}}else K=this.markers.length;for(;U<K;){let Q=this.markers[U++];if(Q.toDOM){Q.destroy(q);let X=q.nextSibling;q.remove(),q=X}}if(!G)break;G.toDOM&&(Y?q=q.nextSibling:this.dom.insertBefore(G.toDOM(w),q)),Y&&U++}this.dom.className=F,this.markers=O}destroy(){this.setMarkers(null,[])}}function sameMarkers(D,w){if(D.length!=w.length)return!1;for(let O=0;O<D.length;O++)if(!D[O].compare(w[O]))return!1;return!0}const lineNumberMarkers=Facet.define(),lineNumberWidgetMarker=Facet.define(),lineNumberConfig=Facet.define({combine(D){return combineConfig(D,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(w,O){let F=Object.assign({},w);for(let q in O){let W=F[q],U=O[q];F[q]=W?(K,G,Y)=>W(K,G,Y)||U(K,G,Y):U}return F}})}});class NumberMarker extends GutterMarker{constructor(w){super(),this.number=w}eq(w){return this.number==w.number}toDOM(){return document.createTextNode(this.number)}}function formatNumber(D,w){return D.state.facet(lineNumberConfig).formatNumber(w,D.state)}const lineNumberGutter=activeGutters.compute([lineNumberConfig],D=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(w){return w.state.facet(lineNumberMarkers)},lineMarker(w,O,F){return F.some(q=>q.toDOM)?null:new NumberMarker(formatNumber(w,w.state.doc.lineAt(O.from).number))},widgetMarker:(w,O,F)=>{for(let q of w.state.facet(lineNumberWidgetMarker)){let W=q(w,O,F);if(W)return W}return null},lineMarkerChange:w=>w.startState.facet(lineNumberConfig)!=w.state.facet(lineNumberConfig),initialSpacer(w){return new NumberMarker(formatNumber(w,maxLineNumber(w.state.doc.lines)))},updateSpacer(w,O){let F=formatNumber(O.view,maxLineNumber(O.view.state.doc.lines));return F==w.number?w:new NumberMarker(F)},domEventHandlers:D.facet(lineNumberConfig).domEventHandlers}));function lineNumbers(D={}){return[lineNumberConfig.of(D),gutters(),lineNumberGutter]}function maxLineNumber(D){let w=9;for(;w<D;)w=w*10+9;return w}const activeLineGutterMarker=new class extends GutterMarker{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},activeLineGutterHighlighter=gutterLineClass.compute(["selection"],D=>{let w=[],O=-1;for(let F of D.selection.ranges){let q=D.doc.lineAt(F.head).from;q>O&&(O=q,w.push(activeLineGutterMarker.range(q)))}return RangeSet.of(w)});function highlightActiveLineGutter(){return activeLineGutterHighlighter}const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(w,O){this.from=w,this.to=O}}class NodeProp{constructor(w={}){this.id=nextPropID++,this.perNode=!!w.perNode,this.deserialize=w.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(w){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof w!="function"&&(w=NodeType.match(w)),O=>{let F=w(O);return F===void 0?null:[this,F]}}}NodeProp.closedBy=new NodeProp({deserialize:D=>D.split(" ")});NodeProp.openedBy=new NodeProp({deserialize:D=>D.split(" ")});NodeProp.group=new NodeProp({deserialize:D=>D.split(" ")});NodeProp.isolate=new NodeProp({deserialize:D=>{if(D&&D!="rtl"&&D!="ltr"&&D!="auto")throw new RangeError("Invalid value for isolate: "+D);return D||"auto"}});NodeProp.contextHash=new NodeProp({perNode:!0});NodeProp.lookAhead=new NodeProp({perNode:!0});NodeProp.mounted=new NodeProp({perNode:!0});class MountedTree{constructor(w,O,F){this.tree=w,this.overlay=O,this.parser=F}static get(w){return w&&w.props&&w.props[NodeProp.mounted.id]}}const noProps=Object.create(null);class NodeType{constructor(w,O,F,q=0){this.name=w,this.props=O,this.id=F,this.flags=q}static define(w){let O=w.props&&w.props.length?Object.create(null):noProps,F=(w.top?1:0)|(w.skipped?2:0)|(w.error?4:0)|(w.name==null?8:0),q=new NodeType(w.name||"",O,w.id,F);if(w.props){for(let W of w.props)if(Array.isArray(W)||(W=W(q)),W){if(W[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");O[W[0].id]=W[1]}}return q}prop(w){return this.props[w.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(w){if(typeof w=="string"){if(this.name==w)return!0;let O=this.prop(NodeProp.group);return O?O.indexOf(w)>-1:!1}return this.id==w}static match(w){let O=Object.create(null);for(let F in w)for(let q of F.split(" "))O[q]=w[F];return F=>{for(let q=F.prop(NodeProp.group),W=-1;W<(q?q.length:0);W++){let U=O[W<0?F.name:q[W]];if(U)return U}}}}NodeType.none=new NodeType("",Object.create(null),0,8);class NodeSet{constructor(w){this.types=w;for(let O=0;O<w.length;O++)if(w[O].id!=O)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...w){let O=[];for(let F of this.types){let q=null;for(let W of w){let U=W(F);U&&(q||(q=Object.assign({},F.props)),q[U[0].id]=U[1])}O.push(q?new NodeType(F.name,q,F.id,F.flags):F)}return new NodeSet(O)}}const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode;(function(D){D[D.ExcludeBuffers=1]="ExcludeBuffers",D[D.IncludeAnonymous=2]="IncludeAnonymous",D[D.IgnoreMounts=4]="IgnoreMounts",D[D.IgnoreOverlays=8]="IgnoreOverlays"})(IterMode||(IterMode={}));class Tree{constructor(w,O,F,q,W){if(this.type=w,this.children=O,this.positions=F,this.length=q,this.props=null,W&&W.length){this.props=Object.create(null);for(let[U,K]of W)this.props[typeof U=="number"?U:U.id]=K}}toString(){let w=MountedTree.get(this);if(w&&!w.overlay)return w.tree.toString();let O="";for(let F of this.children){let q=F.toString();q&&(O&&(O+=","),O+=q)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(O.length?"("+O+")":""):O}cursor(w=0){return new TreeCursor(this.topNode,w)}cursorAt(w,O=0,F=0){let q=CachedNode.get(this)||this.topNode,W=new TreeCursor(q);return W.moveTo(w,O),CachedNode.set(this,W._tree),W}get topNode(){return new TreeNode(this,0,0,null)}resolve(w,O=0){let F=resolveNode(CachedNode.get(this)||this.topNode,w,O,!1);return CachedNode.set(this,F),F}resolveInner(w,O=0){let F=resolveNode(CachedInnerNode.get(this)||this.topNode,w,O,!0);return CachedInnerNode.set(this,F),F}resolveStack(w,O=0){return stackIterator(this,w,O)}iterate(w){let{enter:O,leave:F,from:q=0,to:W=this.length}=w,U=w.mode||0,K=(U&IterMode.IncludeAnonymous)>0;for(let G=this.cursor(U|IterMode.IncludeAnonymous);;){let Y=!1;if(G.from<=W&&G.to>=q&&(!K&&G.type.isAnonymous||O(G)!==!1)){if(G.firstChild())continue;Y=!0}for(;Y&&F&&(K||!G.type.isAnonymous)&&F(G),!G.nextSibling();){if(!G.parent())return;Y=!0}}}prop(w){return w.perNode?this.props?this.props[w.id]:void 0:this.type.prop(w)}get propValues(){let w=[];if(this.props)for(let O in this.props)w.push([+O,this.props[O]]);return w}balance(w={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(O,F,q)=>new Tree(this.type,O,F,q,this.propValues),w.makeTree||((O,F,q)=>new Tree(NodeType.none,O,F,q)))}static build(w){return buildTree(w)}}Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(w,O){this.buffer=w,this.index=O}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(w,O,F){this.buffer=w,this.length=O,this.set=F}get type(){return NodeType.none}toString(){let w=[];for(let O=0;O<this.buffer.length;)w.push(this.childString(O)),O=this.buffer[O+3];return w.join(",")}childString(w){let O=this.buffer[w],F=this.buffer[w+3],q=this.set.types[O],W=q.name;if(/\W/.test(W)&&!q.isError&&(W=JSON.stringify(W)),w+=4,F==w)return W;let U=[];for(;w<F;)U.push(this.childString(w)),w=this.buffer[w+3];return W+"("+U.join(",")+")"}findChild(w,O,F,q,W){let{buffer:U}=this,K=-1;for(let G=w;G!=O&&!(checkSide(W,q,U[G+1],U[G+2])&&(K=G,F>0));G=U[G+3]);return K}slice(w,O,F){let q=this.buffer,W=new Uint16Array(O-w),U=0;for(let K=w,G=0;K<O;){W[G++]=q[K++],W[G++]=q[K++]-F;let Y=W[G++]=q[K++]-F;W[G++]=q[K++]-w,U=Math.max(U,Y)}return new TreeBuffer(W,U,this.set)}}function checkSide(D,w,O,F){switch(D){case-2:return O<w;case-1:return F>=w&&O<w;case 0:return O<w&&F>w;case 1:return O<=w&&F>w;case 2:return F>w;case 4:return!0}}function resolveNode(D,w,O,F){for(var q;D.from==D.to||(O<1?D.from>=w:D.from>w)||(O>-1?D.to<=w:D.to<w);){let U=!F&&D instanceof TreeNode&&D.index<0?null:D.parent;if(!U)return D;D=U}let W=F?0:IterMode.IgnoreOverlays;if(F)for(let U=D,K=U.parent;K;U=K,K=U.parent)U instanceof TreeNode&&U.index<0&&((q=K.enter(w,O,W))===null||q===void 0?void 0:q.from)!=U.from&&(D=K);for(;;){let U=D.enter(w,O,W);if(!U)return D;D=U}}class BaseNode{cursor(w=0){return new TreeCursor(this,w)}getChild(w,O=null,F=null){let q=getChildren(this,w,O,F);return q.length?q[0]:null}getChildren(w,O=null,F=null){return getChildren(this,w,O,F)}resolve(w,O=0){return resolveNode(this,w,O,!1)}resolveInner(w,O=0){return resolveNode(this,w,O,!0)}matchContext(w){return matchNodeContext(this.parent,w)}enterUnfinishedNodesBefore(w){let O=this.childBefore(w),F=this;for(;O;){let q=O.lastChild;if(!q||q.to!=O.to)break;q.type.isError&&q.from==q.to?(F=O,O=q.prevSibling):O=q}return F}get node(){return this}get next(){return this.parent}}class TreeNode extends BaseNode{constructor(w,O,F,q){super(),this._tree=w,this.from=O,this.index=F,this._parent=q}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(w,O,F,q,W=0){for(let U=this;;){for(let{children:K,positions:G}=U._tree,Y=O>0?K.length:-1;w!=Y;w+=O){let Q=K[w],X=G[w]+U.from;if(checkSide(q,F,X,X+Q.length)){if(Q instanceof TreeBuffer){if(W&IterMode.ExcludeBuffers)continue;let J=Q.findChild(0,Q.buffer.length,O,F-X,q);if(J>-1)return new BufferNode(new BufferContext(U,Q,w,X),null,J)}else if(W&IterMode.IncludeAnonymous||!Q.type.isAnonymous||hasChild(Q)){let J;if(!(W&IterMode.IgnoreMounts)&&(J=MountedTree.get(Q))&&!J.overlay)return new TreeNode(J.tree,X,w,U);let Z=new TreeNode(Q,X,w,U);return W&IterMode.IncludeAnonymous||!Z.type.isAnonymous?Z:Z.nextChild(O<0?Q.children.length-1:0,O,F,q)}}}if(W&IterMode.IncludeAnonymous||!U.type.isAnonymous||(U.index>=0?w=U.index+O:w=O<0?-1:U._parent._tree.children.length,U=U._parent,!U))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(w){return this.nextChild(0,1,w,2)}childBefore(w){return this.nextChild(this._tree.children.length-1,-1,w,-2)}enter(w,O,F=0){let q;if(!(F&IterMode.IgnoreOverlays)&&(q=MountedTree.get(this._tree))&&q.overlay){let W=w-this.from;for(let{from:U,to:K}of q.overlay)if((O>0?U<=W:U<W)&&(O<0?K>=W:K>W))return new TreeNode(q.tree,q.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,w,O,F)}nextSignificantParent(){let w=this;for(;w.type.isAnonymous&&w._parent;)w=w._parent;return w}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function getChildren(D,w,O,F){let q=D.cursor(),W=[];if(!q.firstChild())return W;if(O!=null){for(let U=!1;!U;)if(U=q.type.is(O),!q.nextSibling())return W}for(;;){if(F!=null&&q.type.is(F))return W;if(q.type.is(w)&&W.push(q.node),!q.nextSibling())return F==null?W:[]}}function matchNodeContext(D,w,O=w.length-1){for(let F=D;O>=0;F=F.parent){if(!F)return!1;if(!F.type.isAnonymous){if(w[O]&&w[O]!=F.name)return!1;O--}}return!0}class BufferContext{constructor(w,O,F,q){this.parent=w,this.buffer=O,this.index=F,this.start=q}}class BufferNode extends BaseNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(w,O,F){super(),this.context=w,this._parent=O,this.index=F,this.type=w.buffer.set.types[w.buffer.buffer[F]]}child(w,O,F){let{buffer:q}=this.context,W=q.findChild(this.index+4,q.buffer[this.index+3],w,O-this.context.start,F);return W<0?null:new BufferNode(this.context,this,W)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(w){return this.child(1,w,2)}childBefore(w){return this.child(-1,w,-2)}enter(w,O,F=0){if(F&IterMode.ExcludeBuffers)return null;let{buffer:q}=this.context,W=q.findChild(this.index+4,q.buffer[this.index+3],O>0?1:-1,w-this.context.start,O);return W<0?null:new BufferNode(this.context,this,W)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(w){return this._parent?null:this.context.parent.nextChild(this.context.index+w,w,0,4)}get nextSibling(){let{buffer:w}=this.context,O=w.buffer[this.index+3];return O<(this._parent?w.buffer[this._parent.index+3]:w.buffer.length)?new BufferNode(this.context,this._parent,O):this.externalSibling(1)}get prevSibling(){let{buffer:w}=this.context,O=this._parent?this._parent.index+4:0;return this.index==O?this.externalSibling(-1):new BufferNode(this.context,this._parent,w.findChild(O,this.index,-1,0,4))}get tree(){return null}toTree(){let w=[],O=[],{buffer:F}=this.context,q=this.index+4,W=F.buffer[this.index+3];if(W>q){let U=F.buffer[this.index+1];w.push(F.slice(q,W,U)),O.push(0)}return new Tree(this.type,w,O,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function iterStack(D){if(!D.length)return null;let w=0,O=D[0];for(let W=1;W<D.length;W++){let U=D[W];(U.from>O.from||U.to<O.to)&&(O=U,w=W)}let F=O instanceof TreeNode&&O.index<0?null:O.parent,q=D.slice();return F?q[w]=F:q.splice(w,1),new StackIterator(q,O)}class StackIterator{constructor(w,O){this.heads=w,this.node=O}get next(){return iterStack(this.heads)}}function stackIterator(D,w,O){let F=D.resolveInner(w,O),q=null;for(let W=F instanceof TreeNode?F:F.context.parent;W;W=W.parent)if(W.index<0){let U=W.parent;(q||(q=[F])).push(U.resolve(w,O)),W=U}else{let U=MountedTree.get(W.tree);if(U&&U.overlay&&U.overlay[0].from<=w&&U.overlay[U.overlay.length-1].to>=w){let K=new TreeNode(U.tree,U.overlay[0].from+W.from,-1,W);(q||(q=[F])).push(resolveNode(K,w,O,!1))}}return q?iterStack(q):F}class TreeCursor{get name(){return this.type.name}constructor(w,O=0){if(this.mode=O,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,w instanceof TreeNode)this.yieldNode(w);else{this._tree=w.context.parent,this.buffer=w.context;for(let F=w._parent;F;F=F._parent)this.stack.unshift(F.index);this.bufferNode=w,this.yieldBuf(w.index)}}yieldNode(w){return w?(this._tree=w,this.type=w.type,this.from=w.from,this.to=w.to,!0):!1}yieldBuf(w,O){this.index=w;let{start:F,buffer:q}=this.buffer;return this.type=O||q.set.types[q.buffer[w]],this.from=F+q.buffer[w+1],this.to=F+q.buffer[w+2],!0}yield(w){return w?w instanceof TreeNode?(this.buffer=null,this.yieldNode(w)):(this.buffer=w.context,this.yieldBuf(w.index,w.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(w,O,F){if(!this.buffer)return this.yield(this._tree.nextChild(w<0?this._tree._tree.children.length-1:0,w,O,F,this.mode));let{buffer:q}=this.buffer,W=q.findChild(this.index+4,q.buffer[this.index+3],w,O-this.buffer.start,F);return W<0?!1:(this.stack.push(this.index),this.yieldBuf(W))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(w){return this.enterChild(1,w,2)}childBefore(w){return this.enterChild(-1,w,-2)}enter(w,O,F=this.mode){return this.buffer?F&IterMode.ExcludeBuffers?!1:this.enterChild(1,w,O):this.yield(this._tree.enter(w,O,F))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let w=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(w)}sibling(w){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+w,w,0,4,this.mode)):!1;let{buffer:O}=this.buffer,F=this.stack.length-1;if(w<0){let q=F<0?0:this.stack[F]+4;if(this.index!=q)return this.yieldBuf(O.findChild(q,this.index,-1,0,4))}else{let q=O.buffer[this.index+3];if(q<(F<0?O.buffer.length:O.buffer[this.stack[F]+3]))return this.yieldBuf(q)}return F<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+w,w,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(w){let O,F,{buffer:q}=this;if(q){if(w>0){if(this.index<q.buffer.buffer.length)return!1}else for(let W=0;W<this.index;W++)if(q.buffer.buffer[W+3]<this.index)return!1;({index:O,parent:F}=q)}else({index:O,_parent:F}=this._tree);for(;F;{index:O,_parent:F}=F)if(O>-1)for(let W=O+w,U=w<0?-1:F._tree.children.length;W!=U;W+=w){let K=F._tree.children[W];if(this.mode&IterMode.IncludeAnonymous||K instanceof TreeBuffer||!K.type.isAnonymous||hasChild(K))return!1}return!0}move(w,O){if(O&&this.enterChild(w,0,4))return!0;for(;;){if(this.sibling(w))return!0;if(this.atLastNode(w)||!this.parent())return!1}}next(w=!0){return this.move(1,w)}prev(w=!0){return this.move(-1,w)}moveTo(w,O=0){for(;(this.from==this.to||(O<1?this.from>=w:this.from>w)||(O>-1?this.to<=w:this.to<w))&&this.parent(););for(;this.enterChild(1,w,O););return this}get node(){if(!this.buffer)return this._tree;let w=this.bufferNode,O=null,F=0;if(w&&w.context==this.buffer)e:for(let q=this.index,W=this.stack.length;W>=0;){for(let U=w;U;U=U._parent)if(U.index==q){if(q==this.index)return U;O=U,F=W+1;break e}q=this.stack[--W]}for(let q=F;q<this.stack.length;q++)O=new BufferNode(this.buffer,O,this.stack[q]);return this.bufferNode=new BufferNode(this.buffer,O,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(w,O){for(let F=0;;){let q=!1;if(this.type.isAnonymous||w(this)!==!1){if(this.firstChild()){F++;continue}this.type.isAnonymous||(q=!0)}for(;;){if(q&&O&&O(this),q=this.type.isAnonymous,!F)return;if(this.nextSibling())break;this.parent(),F--,q=!0}}}matchContext(w){if(!this.buffer)return matchNodeContext(this.node.parent,w);let{buffer:O}=this.buffer,{types:F}=O.set;for(let q=w.length-1,W=this.stack.length-1;q>=0;W--){if(W<0)return matchNodeContext(this._tree,w,q);let U=F[O.buffer[this.stack[W]]];if(!U.isAnonymous){if(w[q]&&w[q]!=U.name)return!1;q--}}return!0}}function hasChild(D){return D.children.some(w=>w instanceof TreeBuffer||!w.type.isAnonymous||hasChild(w))}function buildTree(D){var w;let{buffer:O,nodeSet:F,maxBufferLength:q=DefaultBufferLength,reused:W=[],minRepeatType:U=F.types.length}=D,K=Array.isArray(O)?new FlatBufferCursor(O,O.length):O,G=F.types,Y=0,Q=0;function X(oe,ae,ce,de,fe,ye){let{id:pe,start:he,end:be,size:me}=K,ve=Q,_e=Y;for(;me<0;)if(K.next(),me==-1){let Ee=W[pe];ce.push(Ee),de.push(he-oe);return}else if(me==-3){Y=pe;return}else if(me==-4){Q=pe;return}else throw new RangeError(`Unrecognized record size: ${me}`);let ge=G[pe],Se,we,Ce=he-oe;if(be-he<=q&&(we=te(K.pos-ae,fe))){let Ee=new Uint16Array(we.size-we.skip),xe=K.pos-we.size,ke=Ee.length;for(;K.pos>xe;)ke=re(we.start,Ee,ke);Se=new TreeBuffer(Ee,be-we.start,F),Ce=we.start-oe}else{let Ee=K.pos-me;K.next();let xe=[],ke=[],Ae=pe>=U?pe:-1,Pe=0,Me=be;for(;K.pos>Ee;)Ae>=0&&K.id==Ae&&K.size>=0?(K.end<=Me-q&&(ee(xe,ke,he,Pe,K.end,Me,Ae,ve,_e),Pe=xe.length,Me=K.end),K.next()):ye>2500?J(he,Ee,xe,ke):X(he,Ee,xe,ke,Ae,ye+1);if(Ae>=0&&Pe>0&&Pe<xe.length&&ee(xe,ke,he,Pe,he,Me,Ae,ve,_e),xe.reverse(),ke.reverse(),Ae>-1&&Pe>0){let Be=Z(ge,_e);Se=balanceRange(ge,xe,ke,0,xe.length,0,be-he,Be,Be)}else Se=ne(ge,xe,ke,be-he,ve-be,_e)}ce.push(Se),de.push(Ce)}function J(oe,ae,ce,de){let fe=[],ye=0,pe=-1;for(;K.pos>ae;){let{id:he,start:be,end:me,size:ve}=K;if(ve>4)K.next();else{if(pe>-1&&be<pe)break;pe<0&&(pe=me-q),fe.push(he,be,me),ye++,K.next()}}if(ye){let he=new Uint16Array(ye*4),be=fe[fe.length-2];for(let me=fe.length-3,ve=0;me>=0;me-=3)he[ve++]=fe[me],he[ve++]=fe[me+1]-be,he[ve++]=fe[me+2]-be,he[ve++]=ve;ce.push(new TreeBuffer(he,fe[2]-be,F)),de.push(be-oe)}}function Z(oe,ae){return(ce,de,fe)=>{let ye=0,pe=ce.length-1,he,be;if(pe>=0&&(he=ce[pe])instanceof Tree){if(!pe&&he.type==oe&&he.length==fe)return he;(be=he.prop(NodeProp.lookAhead))&&(ye=de[pe]+he.length+be)}return ne(oe,ce,de,fe,ye,ae)}}function ee(oe,ae,ce,de,fe,ye,pe,he,be){let me=[],ve=[];for(;oe.length>de;)me.push(oe.pop()),ve.push(ae.pop()+ce-fe);oe.push(ne(F.types[pe],me,ve,ye-fe,he-ye,be)),ae.push(fe-ce)}function ne(oe,ae,ce,de,fe,ye,pe){if(ye){let he=[NodeProp.contextHash,ye];pe=pe?[he].concat(pe):[he]}if(fe>25){let he=[NodeProp.lookAhead,fe];pe=pe?[he].concat(pe):[he]}return new Tree(oe,ae,ce,de,pe)}function te(oe,ae){let ce=K.fork(),de=0,fe=0,ye=0,pe=ce.end-q,he={size:0,start:0,skip:0};e:for(let be=ce.pos-oe;ce.pos>be;){let me=ce.size;if(ce.id==ae&&me>=0){he.size=de,he.start=fe,he.skip=ye,ye+=4,de+=4,ce.next();continue}let ve=ce.pos-me;if(me<0||ve<be||ce.start<pe)break;let _e=ce.id>=U?4:0,ge=ce.start;for(ce.next();ce.pos>ve;){if(ce.size<0)if(ce.size==-3)_e+=4;else break e;else ce.id>=U&&(_e+=4);ce.next()}fe=ge,de+=me,ye+=_e}return(ae<0||de==oe)&&(he.size=de,he.start=fe,he.skip=ye),he.size>4?he:void 0}function re(oe,ae,ce){let{id:de,start:fe,end:ye,size:pe}=K;if(K.next(),pe>=0&&de<U){let he=ce;if(pe>4){let be=K.pos-(pe-4);for(;K.pos>be;)ce=re(oe,ae,ce)}ae[--ce]=he,ae[--ce]=ye-oe,ae[--ce]=fe-oe,ae[--ce]=de}else pe==-3?Y=de:pe==-4&&(Q=de);return ce}let se=[],le=[];for(;K.pos>0;)X(D.start||0,D.bufferStart||0,se,le,-1,0);let ue=(w=D.length)!==null&&w!==void 0?w:se.length?le[0]+se[0].length:0;return new Tree(G[D.topID],se.reverse(),le.reverse(),ue)}const nodeSizeCache=new WeakMap;function nodeSize(D,w){if(!D.isAnonymous||w instanceof TreeBuffer||w.type!=D)return 1;let O=nodeSizeCache.get(w);if(O==null){O=1;for(let F of w.children){if(F.type!=D||!(F instanceof Tree)){O=1;break}O+=nodeSize(D,F)}nodeSizeCache.set(w,O)}return O}function balanceRange(D,w,O,F,q,W,U,K,G){let Y=0;for(let ee=F;ee<q;ee++)Y+=nodeSize(D,w[ee]);let Q=Math.ceil(Y*1.5/8),X=[],J=[];function Z(ee,ne,te,re,se){for(let le=te;le<re;){let ue=le,oe=ne[le],ae=nodeSize(D,ee[le]);for(le++;le<re;le++){let ce=nodeSize(D,ee[le]);if(ae+ce>=Q)break;ae+=ce}if(le==ue+1){if(ae>Q){let ce=ee[ue];Z(ce.children,ce.positions,0,ce.children.length,ne[ue]+se);continue}X.push(ee[ue])}else{let ce=ne[le-1]+ee[le-1].length-oe;X.push(balanceRange(D,ee,ne,ue,le,oe,ce,null,G))}J.push(oe+se-W)}}return Z(w,O,F,q,0),(K||G)(X,J,U)}class TreeFragment{constructor(w,O,F,q,W=!1,U=!1){this.from=w,this.to=O,this.tree=F,this.offset=q,this.open=(W?1:0)|(U?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(w,O=[],F=!1){let q=[new TreeFragment(0,w.length,w,0,!1,F)];for(let W of O)W.to>w.length&&q.push(W);return q}static applyChanges(w,O,F=128){if(!O.length)return w;let q=[],W=1,U=w.length?w[0]:null;for(let K=0,G=0,Y=0;;K++){let Q=K<O.length?O[K]:null,X=Q?Q.fromA:1e9;if(X-G>=F)for(;U&&U.from<X;){let J=U;if(G>=J.from||X<=J.to||Y){let Z=Math.max(J.from,G)-Y,ee=Math.min(J.to,X)-Y;J=Z>=ee?null:new TreeFragment(Z,ee,J.tree,J.offset+Y,K>0,!!Q)}if(J&&q.push(J),U.to>X)break;U=W<w.length?w[W++]:null}if(!Q)break;G=Q.toA,Y=Q.toA-Q.toB}return q}}let Parser$1=class{startParse(w,O,F){return typeof w=="string"&&(w=new StringInput(w)),F=F?F.length?F.map(q=>new Range(q.from,q.to)):[new Range(0,0)]:[new Range(0,w.length)],this.createParse(w,O||[],F)}parse(w,O,F){let q=this.startParse(w,O,F);for(;;){let W=q.advance();if(W)return W}}};class StringInput{constructor(w){this.string=w}get length(){return this.string.length}chunk(w){return this.string.slice(w)}get lineChunks(){return!1}read(w,O){return this.string.slice(w,O)}}new NodeProp({perNode:!0});let nextTagID=0;class Tag{constructor(w,O,F,q){this.name=w,this.set=O,this.base=F,this.modified=q,this.id=nextTagID++}toString(){let{name:w}=this;for(let O of this.modified)O.name&&(w=`${O.name}(${w})`);return w}static define(w,O){let F=typeof w=="string"?w:"?";if(w instanceof Tag&&(O=w),O!=null&&O.base)throw new Error("Can not derive from a modified tag");let q=new Tag(F,[],null,[]);if(q.set.push(q),O)for(let W of O.set)q.set.push(W);return q}static defineModifier(w){let O=new Modifier(w);return F=>F.modified.indexOf(O)>-1?F:Modifier.get(F.base||F,F.modified.concat(O).sort((q,W)=>q.id-W.id))}}let nextModifierID=0;class Modifier{constructor(w){this.name=w,this.instances=[],this.id=nextModifierID++}static get(w,O){if(!O.length)return w;let F=O[0].instances.find(K=>K.base==w&&sameArray(O,K.modified));if(F)return F;let q=[],W=new Tag(w.name,q,w,O);for(let K of O)K.instances.push(W);let U=powerSet(O);for(let K of w.set)if(!K.modified.length)for(let G of U)q.push(Modifier.get(K,G));return W}}function sameArray(D,w){return D.length==w.length&&D.every((O,F)=>O==w[F])}function powerSet(D){let w=[[]];for(let O=0;O<D.length;O++)for(let F=0,q=w.length;F<q;F++)w.push(w[F].concat(D[O]));return w.sort((O,F)=>F.length-O.length)}function styleTags(D){let w=Object.create(null);for(let O in D){let F=D[O];Array.isArray(F)||(F=[F]);for(let q of O.split(" "))if(q){let W=[],U=2,K=q;for(let X=0;;){if(K=="..."&&X>0&&X+3==q.length){U=1;break}let J=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(K);if(!J)throw new RangeError("Invalid path: "+q);if(W.push(J[0]=="*"?"":J[0][0]=='"'?JSON.parse(J[0]):J[0]),X+=J[0].length,X==q.length)break;let Z=q[X++];if(X==q.length&&Z=="!"){U=0;break}if(Z!="/")throw new RangeError("Invalid path: "+q);K=q.slice(X)}let G=W.length-1,Y=W[G];if(!Y)throw new RangeError("Invalid path: "+q);let Q=new Rule(F,U,G>0?W.slice(0,G):null);w[Y]=Q.sort(w[Y])}}return ruleNodeProp.add(w)}const ruleNodeProp=new NodeProp;class Rule{constructor(w,O,F,q){this.tags=w,this.mode=O,this.context=F,this.next=q}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(w){return!w||w.depth<this.depth?(this.next=w,this):(w.next=this.sort(w.next),w)}get depth(){return this.context?this.context.length:0}}Rule.empty=new Rule([],2,null);function tagHighlighter(D,w){let O=Object.create(null);for(let W of D)if(!Array.isArray(W.tag))O[W.tag.id]=W.class;else for(let U of W.tag)O[U.id]=W.class;let{scope:F,all:q=null}=w||{};return{style:W=>{let U=q;for(let K of W)for(let G of K.set){let Y=O[G.id];if(Y){U=U?U+" "+Y:Y;break}}return U},scope:F}}function highlightTags(D,w){let O=null;for(let F of D){let q=F.style(w);q&&(O=O?O+" "+q:q)}return O}function highlightTree(D,w,O,F=0,q=D.length){let W=new HighlightBuilder(F,Array.isArray(w)?w:[w],O);W.highlightRange(D.cursor(),F,q,"",W.highlighters),W.flush(q)}class HighlightBuilder{constructor(w,O,F){this.at=w,this.highlighters=O,this.span=F,this.class=""}startSpan(w,O){O!=this.class&&(this.flush(w),w>this.at&&(this.at=w),this.class=O)}flush(w){w>this.at&&this.class&&this.span(this.at,w,this.class)}highlightRange(w,O,F,q,W){let{type:U,from:K,to:G}=w;if(K>=F||G<=O)return;U.isTop&&(W=this.highlighters.filter(Z=>!Z.scope||Z.scope(U)));let Y=q,Q=getStyleTags(w)||Rule.empty,X=highlightTags(W,Q.tags);if(X&&(Y&&(Y+=" "),Y+=X,Q.mode==1&&(q+=(q?" ":"")+X)),this.startSpan(Math.max(O,K),Y),Q.opaque)return;let J=w.tree&&w.tree.prop(NodeProp.mounted);if(J&&J.overlay){let Z=w.node.enter(J.overlay[0].from+K,1),ee=this.highlighters.filter(te=>!te.scope||te.scope(J.tree.type)),ne=w.firstChild();for(let te=0,re=K;;te++){let se=te<J.overlay.length?J.overlay[te]:null,le=se?se.from+K:G,ue=Math.max(O,re),oe=Math.min(F,le);if(ue<oe&&ne)for(;w.from<oe&&(this.highlightRange(w,ue,oe,q,W),this.startSpan(Math.min(oe,w.to),Y),!(w.to>=le||!w.nextSibling())););if(!se||le>F)break;re=se.to+K,re>O&&(this.highlightRange(Z.cursor(),Math.max(O,se.from+K),Math.min(F,re),"",ee),this.startSpan(Math.min(F,re),Y))}ne&&w.parent()}else if(w.firstChild()){J&&(q="");do if(!(w.to<=O)){if(w.from>=F)break;this.highlightRange(w,O,F,q,W),this.startSpan(Math.min(F,w.to),Y)}while(w.nextSibling());w.parent()}}}function getStyleTags(D){let w=D.type.prop(ruleNodeProp);for(;w&&w.context&&!D.matchContext(w.context);)w=w.next;return w||null}const t=Tag.define,comment=t(),name$1=t(),typeName=t(name$1),propertyName=t(name$1),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t(),tags={comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name:name$1,variableName:t(name$1),typeName,tagName:t(typeName),propertyName,attributeName:t(propertyName),className:t(name$1),labelName:t(name$1),namespace:t(name$1),macroName:t(name$1),literal,string,docString:t(string),character:t(string),attributeValue:t(string),number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation,separator:t(punctuation),bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content,heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier("definition"),constant:Tag.defineModifier("constant"),function:Tag.defineModifier("function"),standard:Tag.defineModifier("standard"),local:Tag.defineModifier("local"),special:Tag.defineModifier("special")};for(let D in tags){let w=tags[D];w instanceof Tag&&(w.name=D)}tagHighlighter([{tag:tags.link,class:"tok-link"},{tag:tags.heading,class:"tok-heading"},{tag:tags.emphasis,class:"tok-emphasis"},{tag:tags.strong,class:"tok-strong"},{tag:tags.keyword,class:"tok-keyword"},{tag:tags.atom,class:"tok-atom"},{tag:tags.bool,class:"tok-bool"},{tag:tags.url,class:"tok-url"},{tag:tags.labelName,class:"tok-labelName"},{tag:tags.inserted,class:"tok-inserted"},{tag:tags.deleted,class:"tok-deleted"},{tag:tags.literal,class:"tok-literal"},{tag:tags.string,class:"tok-string"},{tag:tags.number,class:"tok-number"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],class:"tok-string2"},{tag:tags.variableName,class:"tok-variableName"},{tag:tags.local(tags.variableName),class:"tok-variableName tok-local"},{tag:tags.definition(tags.variableName),class:"tok-variableName tok-definition"},{tag:tags.special(tags.variableName),class:"tok-variableName2"},{tag:tags.definition(tags.propertyName),class:"tok-propertyName tok-definition"},{tag:tags.typeName,class:"tok-typeName"},{tag:tags.namespace,class:"tok-namespace"},{tag:tags.className,class:"tok-className"},{tag:tags.macroName,class:"tok-macroName"},{tag:tags.propertyName,class:"tok-propertyName"},{tag:tags.operator,class:"tok-operator"},{tag:tags.comment,class:"tok-comment"},{tag:tags.meta,class:"tok-meta"},{tag:tags.invalid,class:"tok-invalid"},{tag:tags.punctuation,class:"tok-punctuation"}]);var _a;const languageDataProp=new NodeProp;function defineLanguageFacet(D){return Facet.define({combine:D?w=>w.concat(D):void 0})}const sublanguageProp=new NodeProp;class Language{constructor(w,O,F=[],q=""){this.data=w,this.name=q,EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(EditorState.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=O,this.extension=[language.of(this),EditorState.languageData.of((W,U,K)=>{let G=topNodeAt(W,U,K),Y=G.type.prop(languageDataProp);if(!Y)return[];let Q=W.facet(Y),X=G.type.prop(sublanguageProp);if(X){let J=G.resolve(U-G.from,K);for(let Z of X)if(Z.test(J,W)){let ee=W.facet(Z.facet);return Z.type=="replace"?ee:ee.concat(Q)}}return Q})].concat(F)}isActiveAt(w,O,F=-1){return topNodeAt(w,O,F).type.prop(languageDataProp)==this.data}findRegions(w){let O=w.facet(language);if((O==null?void 0:O.data)==this.data)return[{from:0,to:w.doc.length}];if(!O||!O.allowsNesting)return[];let F=[],q=(W,U)=>{if(W.prop(languageDataProp)==this.data){F.push({from:U,to:U+W.length});return}let K=W.prop(NodeProp.mounted);if(K){if(K.tree.prop(languageDataProp)==this.data){if(K.overlay)for(let G of K.overlay)F.push({from:G.from+U,to:G.to+U});else F.push({from:U,to:U+W.length});return}else if(K.overlay){let G=F.length;if(q(K.tree,K.overlay[0].from+U),F.length>G)return}}for(let G=0;G<W.children.length;G++){let Y=W.children[G];Y instanceof Tree&&q(Y,W.positions[G]+U)}};return q(syntaxTree(w),0),F}get allowsNesting(){return!0}}Language.setState=StateEffect.define();function topNodeAt(D,w,O){let F=D.facet(language),q=syntaxTree(D).topNode;if(!F||F.allowsNesting)for(let W=q;W;W=W.enter(w,O,IterMode.ExcludeBuffers))W.type.isTop&&(q=W);return q}function syntaxTree(D){let w=D.field(Language.state,!1);return w?w.tree:Tree.empty}class DocInput{constructor(w){this.doc=w,this.cursorPos=0,this.string="",this.cursor=w.iter()}get length(){return this.doc.length}syncTo(w){return this.string=this.cursor.next(w-this.cursorPos).value,this.cursorPos=w+this.string.length,this.cursorPos-this.string.length}chunk(w){return this.syncTo(w),this.string}get lineChunks(){return!0}read(w,O){let F=this.cursorPos-this.string.length;return w<F||O>=this.cursorPos?this.doc.sliceString(w,O):this.string.slice(w-F,O-F)}}let currentContext=null;class ParseContext{constructor(w,O,F=[],q,W,U,K,G){this.parser=w,this.state=O,this.fragments=F,this.tree=q,this.treeLen=W,this.viewport=U,this.skipped=K,this.scheduleOn=G,this.parse=null,this.tempSkipped=[]}static create(w,O,F){return new ParseContext(w,O,[],Tree.empty,0,F,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(w,O){return O!=null&&O>=this.state.doc.length&&(O=void 0),this.tree!=Tree.empty&&this.isDone(O??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var F;if(typeof w=="number"){let q=Date.now()+w;w=()=>Date.now()>q}for(this.parse||(this.parse=this.startParse()),O!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>O)&&O<this.state.doc.length&&this.parse.stopAt(O);;){let q=this.parse.advance();if(q)if(this.fragments=this.withoutTempSkipped(TreeFragment.addTree(q,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(F=this.parse.stoppedAt)!==null&&F!==void 0?F:this.state.doc.length,this.tree=q,this.parse=null,this.treeLen<(O??this.state.doc.length))this.parse=this.startParse();else return!0;if(w())return!1}})}takeTree(){let w,O;this.parse&&(w=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>w)&&this.parse.stopAt(w),this.withContext(()=>{for(;!(O=this.parse.advance()););}),this.treeLen=w,this.tree=O,this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(w){let O=currentContext;currentContext=this;try{return w()}finally{currentContext=O}}withoutTempSkipped(w){for(let O;O=this.tempSkipped.pop();)w=cutFragments(w,O.from,O.to);return w}changes(w,O){let{fragments:F,tree:q,treeLen:W,viewport:U,skipped:K}=this;if(this.takeTree(),!w.empty){let G=[];if(w.iterChangedRanges((Y,Q,X,J)=>G.push({fromA:Y,toA:Q,fromB:X,toB:J})),F=TreeFragment.applyChanges(F,G),q=Tree.empty,W=0,U={from:w.mapPos(U.from,-1),to:w.mapPos(U.to,1)},this.skipped.length){K=[];for(let Y of this.skipped){let Q=w.mapPos(Y.from,1),X=w.mapPos(Y.to,-1);Q<X&&K.push({from:Q,to:X})}}}return new ParseContext(this.parser,O,F,q,W,U,K,this.scheduleOn)}updateViewport(w){if(this.viewport.from==w.from&&this.viewport.to==w.to)return!1;this.viewport=w;let O=this.skipped.length;for(let F=0;F<this.skipped.length;F++){let{from:q,to:W}=this.skipped[F];q<w.to&&W>w.from&&(this.fragments=cutFragments(this.fragments,q,W),this.skipped.splice(F--,1))}return this.skipped.length>=O?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(w,O){this.skipped.push({from:w,to:O})}static getSkippingParser(w){return new class extends Parser$1{createParse(O,F,q){let W=q[0].from,U=q[q.length-1].to;return{parsedPos:W,advance(){let G=currentContext;if(G){for(let Y of q)G.tempSkipped.push(Y);w&&(G.scheduleOn=G.scheduleOn?Promise.all([G.scheduleOn,w]):w)}return this.parsedPos=U,new Tree(NodeType.none,[],[],U-W)},stoppedAt:null,stopAt(){}}}}}isDone(w){w=Math.min(w,this.state.doc.length);let O=this.fragments;return this.treeLen>=w&&O.length&&O[0].from==0&&O[0].to>=w}static get(){return currentContext}}function cutFragments(D,w,O){return TreeFragment.applyChanges(D,[{fromA:w,toA:O,fromB:w,toB:O}])}class LanguageState{constructor(w){this.context=w,this.tree=w.tree}apply(w){if(!w.docChanged&&this.tree==this.context.tree)return this;let O=this.context.changes(w.changes,w.state),F=this.context.treeLen==w.startState.doc.length?void 0:Math.max(w.changes.mapPos(this.context.treeLen),O.viewport.to);return O.work(20,F)||O.takeTree(),new LanguageState(O)}static init(w){let O=Math.min(3e3,w.doc.length),F=ParseContext.create(w.facet(language).parser,w,{from:0,to:O});return F.work(20,O)||F.takeTree(),new LanguageState(F)}}Language.state=StateField.define({create:LanguageState.init,update(D,w){for(let O of w.effects)if(O.is(Language.setState))return O.value;return w.startState.facet(language)!=w.state.facet(language)?LanguageState.init(w.state):D.apply(w)}});let requestIdle=D=>{let w=setTimeout(()=>D(),500);return()=>clearTimeout(w)};typeof requestIdleCallback<"u"&&(requestIdle=D=>{let w=-1,O=setTimeout(()=>{w=requestIdleCallback(D,{timeout:400})},100);return()=>w<0?clearTimeout(O):cancelIdleCallback(w)});const isInputPending=typeof navigator<"u"&&(!((_a=navigator.scheduling)===null||_a===void 0)&&_a.isInputPending)?()=>navigator.scheduling.isInputPending():null,parseWorker=ViewPlugin.fromClass(class{constructor(w){this.view=w,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(w){let O=this.view.state.field(Language.state).context;(O.updateViewport(w.view.viewport)||this.view.viewport.to>O.treeLen)&&this.scheduleWork(),(w.docChanged||w.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(O)}scheduleWork(){if(this.working)return;let{state:w}=this.view,O=w.field(Language.state);(O.tree!=O.context.tree||!O.context.isDone(w.doc.length))&&(this.working=requestIdle(this.work))}work(w){this.working=null;let O=Date.now();if(this.chunkEnd<O&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=O+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:F,viewport:{to:q}}=this.view,W=F.field(Language.state);if(W.tree==W.context.tree&&W.context.isDone(q+1e5))return;let U=Date.now()+Math.min(this.chunkBudget,100,w&&!isInputPending?Math.max(25,w.timeRemaining()-5):1e9),K=W.context.treeLen<q&&F.doc.length>q+1e3,G=W.context.work(()=>isInputPending&&isInputPending()||Date.now()>U,q+(K?0:1e5));this.chunkBudget-=Date.now()-O,(G||this.chunkBudget<=0)&&(W.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(W.context))})),this.chunkBudget>0&&!(G&&!K)&&this.scheduleWork(),this.checkAsyncSchedule(W.context)}checkAsyncSchedule(w){w.scheduleOn&&(this.workScheduled++,w.scheduleOn.then(()=>this.scheduleWork()).catch(O=>logException(this.view.state,O)).then(()=>this.workScheduled--),w.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=Facet.define({combine(D){return D.length?D[0]:null},enables:D=>[Language.state,parseWorker,EditorView.contentAttributes.compute([D],w=>{let O=w.facet(D);return O&&O.name?{"data-language":O.name}:{}})]}),indentService=Facet.define(),indentUnit=Facet.define({combine:D=>{if(!D.length)return"  ";let w=D[0];if(!w||/\S/.test(w)||Array.from(w).some(O=>O!=w[0]))throw new Error("Invalid indent unit: "+JSON.stringify(D[0]));return w}});function getIndentUnit(D){let w=D.facet(indentUnit);return w.charCodeAt(0)==9?D.tabSize*w.length:w.length}function indentString(D,w){let O="",F=D.tabSize,q=D.facet(indentUnit)[0];if(q=="	"){for(;w>=F;)O+="	",w-=F;q=" "}for(let W=0;W<w;W++)O+=q;return O}function getIndentation(D,w){D instanceof EditorState&&(D=new IndentContext(D));for(let F of D.state.facet(indentService)){let q=F(D,w);if(q!==void 0)return q}let O=syntaxTree(D.state);return O.length>=w?syntaxIndentation(D,O,w):null}class IndentContext{constructor(w,O={}){this.state=w,this.options=O,this.unit=getIndentUnit(w)}lineAt(w,O=1){let F=this.state.doc.lineAt(w),{simulateBreak:q,simulateDoubleBreak:W}=this.options;return q!=null&&q>=F.from&&q<=F.to?W&&q==w?{text:"",from:w}:(O<0?q<w:q<=w)?{text:F.text.slice(q-F.from),from:q}:{text:F.text.slice(0,q-F.from),from:F.from}:F}textAfterPos(w,O=1){if(this.options.simulateDoubleBreak&&w==this.options.simulateBreak)return"";let{text:F,from:q}=this.lineAt(w,O);return F.slice(w-q,Math.min(F.length,w+100-q))}column(w,O=1){let{text:F,from:q}=this.lineAt(w,O),W=this.countColumn(F,w-q),U=this.options.overrideIndentation?this.options.overrideIndentation(q):-1;return U>-1&&(W+=U-this.countColumn(F,F.search(/\S|$/))),W}countColumn(w,O=w.length){return countColumn(w,this.state.tabSize,O)}lineIndent(w,O=1){let{text:F,from:q}=this.lineAt(w,O),W=this.options.overrideIndentation;if(W){let U=W(q);if(U>-1)return U}return this.countColumn(F,F.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const indentNodeProp=new NodeProp;function syntaxIndentation(D,w,O){let F=w.resolveStack(O),q=w.resolveInner(O,-1).resolve(O,0).enterUnfinishedNodesBefore(O);if(q!=F.node){let W=[];for(let U=q;U&&!(U.from==F.node.from&&U.type==F.node.type);U=U.parent)W.push(U);for(let U=W.length-1;U>=0;U--)F={node:W[U],next:F}}return indentFor(F,D,O)}function indentFor(D,w,O){for(let F=D;F;F=F.next){let q=indentStrategy(F.node);if(q)return q(TreeIndentContext.create(w,O,F))}return 0}function ignoreClosed(D){return D.pos==D.options.simulateBreak&&D.options.simulateDoubleBreak}function indentStrategy(D){let w=D.type.prop(indentNodeProp);if(w)return w;let O=D.firstChild,F;if(O&&(F=O.type.prop(NodeProp.closedBy))){let q=D.lastChild,W=q&&F.indexOf(q.name)>-1;return U=>delimitedStrategy(U,!0,1,void 0,W&&!ignoreClosed(U)?q.from:void 0)}return D.parent==null?topIndent:null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(w,O,F){super(w.state,w.options),this.base=w,this.pos=O,this.context=F}get node(){return this.context.node}static create(w,O,F){return new TreeIndentContext(w,O,F)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(w){let O=this.state.doc.lineAt(w.from);for(;;){let F=w.resolve(O.from);for(;F.parent&&F.parent.from==F.from;)F=F.parent;if(isParent(F,w))break;O=this.state.doc.lineAt(F.from)}return this.lineIndent(O.from)}continue(){return indentFor(this.context.next,this.base,this.pos)}}function isParent(D,w){for(let O=w;O;O=O.parent)if(D==O)return!0;return!1}function bracketedAligned(D){let w=D.node,O=w.childAfter(w.from),F=w.lastChild;if(!O)return null;let q=D.options.simulateBreak,W=D.state.doc.lineAt(O.from),U=q==null||q<=W.from?W.to:Math.min(W.to,q);for(let K=O.to;;){let G=w.childAfter(K);if(!G||G==F)return null;if(!G.type.isSkipped){if(G.from>=U)return null;let Y=/^ */.exec(W.text.slice(O.to-W.from))[0].length;return{from:O.from,to:O.to+Y}}K=G.to}}function delimitedStrategy(D,w,O,F,q){let W=D.textAfter,U=W.match(/^\s*/)[0].length,K=F&&W.slice(U,U+F.length)==F||q==D.pos+U,G=bracketedAligned(D);return G?K?D.column(G.from):D.column(G.to):D.baseIndent+(K?0:D.unit*O)}const DontIndentBeyond=200;function indentOnInput(){return EditorState.transactionFilter.of(D=>{if(!D.docChanged||!D.isUserEvent("input.type")&&!D.isUserEvent("input.complete"))return D;let w=D.startState.languageDataAt("indentOnInput",D.startState.selection.main.head);if(!w.length)return D;let O=D.newDoc,{head:F}=D.newSelection.main,q=O.lineAt(F);if(F>q.from+DontIndentBeyond)return D;let W=O.sliceString(q.from,F);if(!w.some(Y=>Y.test(W)))return D;let{state:U}=D,K=-1,G=[];for(let{head:Y}of U.selection.ranges){let Q=U.doc.lineAt(Y);if(Q.from==K)continue;K=Q.from;let X=getIndentation(U,Q.from);if(X==null)continue;let J=/^\s*/.exec(Q.text)[0],Z=indentString(U,X);J!=Z&&G.push({from:Q.from,to:Q.from+J.length,insert:Z})}return G.length?[D,{changes:G,sequential:!0}]:D})}const foldService=Facet.define(),foldNodeProp=new NodeProp;function syntaxFolding(D,w,O){let F=syntaxTree(D);if(F.length<O)return null;let q=F.resolveStack(O,1),W=null;for(let U=q;U;U=U.next){let K=U.node;if(K.to<=O||K.from>O)continue;if(W&&K.from<w)break;let G=K.type.prop(foldNodeProp);if(G&&(K.to<F.length-50||F.length==D.doc.length||!isUnfinished(K))){let Y=G(K,D);Y&&Y.from<=O&&Y.from>=w&&Y.to>O&&(W=Y)}}return W}function isUnfinished(D){let w=D.lastChild;return w&&w.to==D.to&&w.type.isError}function foldable(D,w,O){for(let F of D.facet(foldService)){let q=F(D,w,O);if(q)return q}return syntaxFolding(D,w,O)}function mapRange(D,w){let O=w.mapPos(D.from,1),F=w.mapPos(D.to,-1);return O>=F?void 0:{from:O,to:F}}const foldEffect=StateEffect.define({map:mapRange}),unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(D){let w=[];for(let{head:O}of D.state.selection.ranges)w.some(F=>F.from<=O&&F.to>=O)||w.push(D.lineBlockAt(O));return w}const foldState=StateField.define({create(){return Decoration.none},update(D,w){D=D.map(w.changes);for(let O of w.effects)if(O.is(foldEffect)&&!foldExists(D,O.value.from,O.value.to)){let{preparePlaceholder:F}=w.state.facet(foldConfig),q=F?Decoration.replace({widget:new PreparedFoldWidget(F(w.state,O.value))}):foldWidget;D=D.update({add:[q.range(O.value.from,O.value.to)]})}else O.is(unfoldEffect)&&(D=D.update({filter:(F,q)=>O.value.from!=F||O.value.to!=q,filterFrom:O.value.from,filterTo:O.value.to}));if(w.selection){let O=!1,{head:F}=w.selection.main;D.between(F,F,(q,W)=>{q<F&&W>F&&(O=!0)}),O&&(D=D.update({filterFrom:F,filterTo:F,filter:(q,W)=>W<=F||q>=F}))}return D},provide:D=>EditorView.decorations.from(D),toJSON(D,w){let O=[];return D.between(0,w.doc.length,(F,q)=>{O.push(F,q)}),O},fromJSON(D){if(!Array.isArray(D)||D.length%2)throw new RangeError("Invalid JSON for fold state");let w=[];for(let O=0;O<D.length;){let F=D[O++],q=D[O++];if(typeof F!="number"||typeof q!="number")throw new RangeError("Invalid JSON for fold state");w.push(foldWidget.range(F,q))}return Decoration.set(w,!0)}});function findFold(D,w,O){var F;let q=null;return(F=D.field(foldState,!1))===null||F===void 0||F.between(w,O,(W,U)=>{(!q||q.from>W)&&(q={from:W,to:U})}),q}function foldExists(D,w,O){let F=!1;return D.between(w,w,(q,W)=>{q==w&&W==O&&(F=!0)}),F}function maybeEnable(D,w){return D.field(foldState,!1)?w:w.concat(StateEffect.appendConfig.of(codeFolding()))}const foldCode=D=>{for(let w of selectedLines(D)){let O=foldable(D.state,w.from,w.to);if(O)return D.dispatch({effects:maybeEnable(D.state,[foldEffect.of(O),announceFold(D,O)])}),!0}return!1},unfoldCode=D=>{if(!D.state.field(foldState,!1))return!1;let w=[];for(let O of selectedLines(D)){let F=findFold(D.state,O.from,O.to);F&&w.push(unfoldEffect.of(F),announceFold(D,F,!1))}return w.length&&D.dispatch({effects:w}),w.length>0};function announceFold(D,w,O=!0){let F=D.state.doc.lineAt(w.from).number,q=D.state.doc.lineAt(w.to).number;return EditorView.announce.of(`${D.state.phrase(O?"Folded lines":"Unfolded lines")} ${F} ${D.state.phrase("to")} ${q}.`)}const foldAll=D=>{let{state:w}=D,O=[];for(let F=0;F<w.doc.length;){let q=D.lineBlockAt(F),W=foldable(w,q.from,q.to);W&&O.push(foldEffect.of(W)),F=(W?D.lineBlockAt(W.to):q).to+1}return O.length&&D.dispatch({effects:maybeEnable(D.state,O)}),!!O.length},unfoldAll=D=>{let w=D.state.field(foldState,!1);if(!w||!w.size)return!1;let O=[];return w.between(0,D.state.doc.length,(F,q)=>{O.push(unfoldEffect.of({from:F,to:q}))}),D.dispatch({effects:O}),!0},foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}],defaultConfig={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},foldConfig=Facet.define({combine(D){return combineConfig(D,defaultConfig)}});function codeFolding(D){return[foldState,baseTheme$1$2]}function widgetToDOM(D,w){let{state:O}=D,F=O.facet(foldConfig),q=U=>{let K=D.lineBlockAt(D.posAtDOM(U.target)),G=findFold(D.state,K.from,K.to);G&&D.dispatch({effects:unfoldEffect.of(G)}),U.preventDefault()};if(F.placeholderDOM)return F.placeholderDOM(D,q,w);let W=document.createElement("span");return W.textContent=F.placeholderText,W.setAttribute("aria-label",O.phrase("folded code")),W.title=O.phrase("unfold"),W.className="cm-foldPlaceholder",W.onclick=q,W}const foldWidget=Decoration.replace({widget:new class extends WidgetType{toDOM(D){return widgetToDOM(D,null)}}});class PreparedFoldWidget extends WidgetType{constructor(w){super(),this.value=w}eq(w){return this.value==w.value}toDOM(w){return widgetToDOM(w,this.value)}}const foldGutterDefaults={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class FoldMarker extends GutterMarker{constructor(w,O){super(),this.config=w,this.open=O}eq(w){return this.config==w.config&&this.open==w.open}toDOM(w){if(this.config.markerDOM)return this.config.markerDOM(this.open);let O=document.createElement("span");return O.textContent=this.open?this.config.openText:this.config.closedText,O.title=w.state.phrase(this.open?"Fold line":"Unfold line"),O}}function foldGutter(D={}){let w=Object.assign(Object.assign({},foldGutterDefaults),D),O=new FoldMarker(w,!0),F=new FoldMarker(w,!1),q=ViewPlugin.fromClass(class{constructor(U){this.from=U.viewport.from,this.markers=this.buildMarkers(U)}update(U){(U.docChanged||U.viewportChanged||U.startState.facet(language)!=U.state.facet(language)||U.startState.field(foldState,!1)!=U.state.field(foldState,!1)||syntaxTree(U.startState)!=syntaxTree(U.state)||w.foldingChanged(U))&&(this.markers=this.buildMarkers(U.view))}buildMarkers(U){let K=new RangeSetBuilder;for(let G of U.viewportLineBlocks){let Y=findFold(U.state,G.from,G.to)?F:foldable(U.state,G.from,G.to)?O:null;Y&&K.add(G.from,G.from,Y)}return K.finish()}}),{domEventHandlers:W}=w;return[q,gutter({class:"cm-foldGutter",markers(U){var K;return((K=U.plugin(q))===null||K===void 0?void 0:K.markers)||RangeSet.empty},initialSpacer(){return new FoldMarker(w,!1)},domEventHandlers:Object.assign(Object.assign({},W),{click:(U,K,G)=>{if(W.click&&W.click(U,K,G))return!0;let Y=findFold(U.state,K.from,K.to);if(Y)return U.dispatch({effects:unfoldEffect.of(Y)}),!0;let Q=foldable(U.state,K.from,K.to);return Q?(U.dispatch({effects:foldEffect.of(Q)}),!0):!1}})}),codeFolding()]}const baseTheme$1$2=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class HighlightStyle{constructor(w,O){this.specs=w;let F;function q(K){let G=StyleModule.newName();return(F||(F=Object.create(null)))["."+G]=K,G}const W=typeof O.all=="string"?O.all:O.all?q(O.all):void 0,U=O.scope;this.scope=U instanceof Language?K=>K.prop(languageDataProp)==U.data:U?K=>K==U:void 0,this.style=tagHighlighter(w.map(K=>({tag:K.tag,class:K.class||q(Object.assign({},K,{tag:null}))})),{all:W}).style,this.module=F?new StyleModule(F):null,this.themeType=O.themeType}static define(w,O){return new HighlightStyle(w,O||{})}}const highlighterFacet=Facet.define(),fallbackHighlighter=Facet.define({combine(D){return D.length?[D[0]]:null}});function getHighlighters(D){let w=D.facet(highlighterFacet);return w.length?w:D.facet(fallbackHighlighter)}function syntaxHighlighting(D,w){let O=[treeHighlighter],F;return D instanceof HighlightStyle&&(D.module&&O.push(EditorView.styleModule.of(D.module)),F=D.themeType),w!=null&&w.fallback?O.push(fallbackHighlighter.of(D)):F?O.push(highlighterFacet.computeN([EditorView.darkTheme],q=>q.facet(EditorView.darkTheme)==(F=="dark")?[D]:[])):O.push(highlighterFacet.of(D)),O}class TreeHighlighter{constructor(w){this.markCache=Object.create(null),this.tree=syntaxTree(w.state),this.decorations=this.buildDeco(w,getHighlighters(w.state)),this.decoratedTo=w.viewport.to}update(w){let O=syntaxTree(w.state),F=getHighlighters(w.state),q=F!=getHighlighters(w.startState),{viewport:W}=w.view,U=w.changes.mapPos(this.decoratedTo,1);O.length<W.to&&!q&&O.type==this.tree.type&&U>=W.to?(this.decorations=this.decorations.map(w.changes),this.decoratedTo=U):(O!=this.tree||w.viewportChanged||q)&&(this.tree=O,this.decorations=this.buildDeco(w.view,F),this.decoratedTo=W.to)}buildDeco(w,O){if(!O||!this.tree.length)return Decoration.none;let F=new RangeSetBuilder;for(let{from:q,to:W}of w.visibleRanges)highlightTree(this.tree,O,(U,K,G)=>{F.add(U,K,this.markCache[G]||(this.markCache[G]=Decoration.mark({class:G})))},q,W);return F.finish()}}const treeHighlighter=Prec.high(ViewPlugin.fromClass(TreeHighlighter,{decorations:D=>D.decorations})),defaultHighlightStyle=HighlightStyle.define([{tag:tags.meta,color:"#404740"},{tag:tags.link,textDecoration:"underline"},{tag:tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strong,fontWeight:"bold"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.keyword,color:"#708"},{tag:[tags.atom,tags.bool,tags.url,tags.contentSeparator,tags.labelName],color:"#219"},{tag:[tags.literal,tags.inserted],color:"#164"},{tag:[tags.string,tags.deleted],color:"#a11"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],color:"#e40"},{tag:tags.definition(tags.variableName),color:"#00f"},{tag:tags.local(tags.variableName),color:"#30a"},{tag:[tags.typeName,tags.namespace],color:"#085"},{tag:tags.className,color:"#167"},{tag:[tags.special(tags.variableName),tags.macroName],color:"#256"},{tag:tags.definition(tags.propertyName),color:"#00c"},{tag:tags.comment,color:"#940"},{tag:tags.invalid,color:"#f00"}]),baseTheme$3=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),DefaultScanDist=1e4,DefaultBrackets="()[]{}",bracketMatchingConfig=Facet.define({combine(D){return combineConfig(D,{afterCursor:!0,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}}),matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});function defaultRenderMatch(D){let w=[],O=D.matched?matchingMark:nonmatchingMark;return w.push(O.range(D.start.from,D.start.to)),D.end&&w.push(O.range(D.end.from,D.end.to)),w}const bracketMatchingState=StateField.define({create(){return Decoration.none},update(D,w){if(!w.docChanged&&!w.selection)return D;let O=[],F=w.state.facet(bracketMatchingConfig);for(let q of w.state.selection.ranges){if(!q.empty)continue;let W=matchBrackets(w.state,q.head,-1,F)||q.head>0&&matchBrackets(w.state,q.head-1,1,F)||F.afterCursor&&(matchBrackets(w.state,q.head,1,F)||q.head<w.state.doc.length&&matchBrackets(w.state,q.head+1,-1,F));W&&(O=O.concat(F.renderMatch(W,w.state)))}return Decoration.set(O,!0)},provide:D=>EditorView.decorations.from(D)}),bracketMatchingUnique=[bracketMatchingState,baseTheme$3];function bracketMatching(D={}){return[bracketMatchingConfig.of(D),bracketMatchingUnique]}const bracketMatchingHandle=new NodeProp;function matchingNodes(D,w,O){let F=D.prop(w<0?NodeProp.openedBy:NodeProp.closedBy);if(F)return F;if(D.name.length==1){let q=O.indexOf(D.name);if(q>-1&&q%2==(w<0?1:0))return[O[q+w]]}return null}function findHandle(D){let w=D.type.prop(bracketMatchingHandle);return w?w(D.node):D}function matchBrackets(D,w,O,F={}){let q=F.maxScanDistance||DefaultScanDist,W=F.brackets||DefaultBrackets,U=syntaxTree(D),K=U.resolveInner(w,O);for(let G=K;G;G=G.parent){let Y=matchingNodes(G.type,O,W);if(Y&&G.from<G.to){let Q=findHandle(G);if(Q&&(O>0?w>=Q.from&&w<Q.to:w>Q.from&&w<=Q.to))return matchMarkedBrackets(D,w,O,G,Q,Y,W)}}return matchPlainBrackets(D,w,O,U,K.type,q,W)}function matchMarkedBrackets(D,w,O,F,q,W,U){let K=F.parent,G={from:q.from,to:q.to},Y=0,Q=K==null?void 0:K.cursor();if(Q&&(O<0?Q.childBefore(F.from):Q.childAfter(F.to)))do if(O<0?Q.to<=F.from:Q.from>=F.to){if(Y==0&&W.indexOf(Q.type.name)>-1&&Q.from<Q.to){let X=findHandle(Q);return{start:G,end:X?{from:X.from,to:X.to}:void 0,matched:!0}}else if(matchingNodes(Q.type,O,U))Y++;else if(matchingNodes(Q.type,-O,U)){if(Y==0){let X=findHandle(Q);return{start:G,end:X&&X.from<X.to?{from:X.from,to:X.to}:void 0,matched:!1}}Y--}}while(O<0?Q.prevSibling():Q.nextSibling());return{start:G,matched:!1}}function matchPlainBrackets(D,w,O,F,q,W,U){let K=O<0?D.sliceDoc(w-1,w):D.sliceDoc(w,w+1),G=U.indexOf(K);if(G<0||G%2==0!=O>0)return null;let Y={from:O<0?w-1:w,to:O>0?w+1:w},Q=D.doc.iterRange(w,O>0?D.doc.length:0),X=0;for(let J=0;!Q.next().done&&J<=W;){let Z=Q.value;O<0&&(J+=Z.length);let ee=w+J*O;for(let ne=O>0?0:Z.length-1,te=O>0?Z.length:-1;ne!=te;ne+=O){let re=U.indexOf(Z[ne]);if(!(re<0||F.resolveInner(ee+ne,1).type!=q))if(re%2==0==O>0)X++;else{if(X==1)return{start:Y,end:{from:ee+ne,to:ee+ne+1},matched:re>>1==G>>1};X--}}O>0&&(J+=Z.length)}return Q.done?{start:Y,matched:!1}:null}function countCol(D,w,O,F=0,q=0){w==null&&(w=D.search(/[^\s\u00a0]/),w==-1&&(w=D.length));let W=q;for(let U=F;U<w;U++)D.charCodeAt(U)==9?W+=O-W%O:W++;return W}class StringStream{constructor(w,O,F,q){this.string=w,this.tabSize=O,this.indentUnit=F,this.overrideIndent=q,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(w){let O=this.string.charAt(this.pos),F;if(typeof w=="string"?F=O==w:F=O&&(w instanceof RegExp?w.test(O):w(O)),F)return++this.pos,O}eatWhile(w){let O=this.pos;for(;this.eat(w););return this.pos>O}eatSpace(){let w=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>w}skipToEnd(){this.pos=this.string.length}skipTo(w){let O=this.string.indexOf(w,this.pos);if(O>-1)return this.pos=O,!0}backUp(w){this.pos-=w}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countCol(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var w;return(w=this.overrideIndent)!==null&&w!==void 0?w:countCol(this.string,null,this.tabSize)}match(w,O,F){if(typeof w=="string"){let q=U=>F?U.toLowerCase():U,W=this.string.substr(this.pos,w.length);return q(W)==q(w)?(O!==!1&&(this.pos+=w.length),!0):null}else{let q=this.string.slice(this.pos).match(w);return q&&q.index>0?null:(q&&O!==!1&&(this.pos+=q[0].length),q)}}current(){return this.string.slice(this.start,this.pos)}}function fullParser(D){return{name:D.name||"",token:D.token,blankLine:D.blankLine||(()=>{}),startState:D.startState||(()=>!0),copyState:D.copyState||defaultCopyState,indent:D.indent||(()=>null),languageData:D.languageData||{},tokenTable:D.tokenTable||noTokens}}function defaultCopyState(D){if(typeof D!="object")return D;let w={};for(let O in D){let F=D[O];w[O]=F instanceof Array?F.slice():F}return w}const IndentedFrom=new WeakMap;class StreamLanguage extends Language{constructor(w){let O=defineLanguageFacet(w.languageData),F=fullParser(w),q,W=new class extends Parser$1{createParse(U,K,G){return new Parse(q,U,K,G)}};super(O,W,[],w.name),this.topNode=docID(O,this),q=this,this.streamParser=F,this.stateAfter=new NodeProp({perNode:!0}),this.tokenTable=w.tokenTable?new TokenTable(F.tokenTable):defaultTokenTable}static define(w){return new StreamLanguage(w)}getIndent(w){let O,{overrideIndentation:F}=w.options;F&&(O=IndentedFrom.get(w.state),O!=null&&O<w.pos-1e4&&(O=void 0));let q=findState(this,w.node.tree,w.node.from,w.node.from,O??w.pos),W,U;if(q?(U=q.state,W=q.pos+1):(U=this.streamParser.startState(w.unit),W=w.node.from),w.pos-W>1e4)return null;for(;W<w.pos;){let G=w.state.doc.lineAt(W),Y=Math.min(w.pos,G.to);if(G.length){let Q=F?F(G.from):-1,X=new StringStream(G.text,w.state.tabSize,w.unit,Q<0?void 0:Q);for(;X.pos<Y-G.from;)readToken(this.streamParser.token,X,U)}else this.streamParser.blankLine(U,w.unit);if(Y==w.pos)break;W=G.to+1}let K=w.lineAt(w.pos);return F&&O==null&&IndentedFrom.set(w.state,K.from),this.streamParser.indent(U,/^\s*(.*)/.exec(K.text)[1],w)}get allowsNesting(){return!1}}function findState(D,w,O,F,q){let W=O>=F&&O+w.length<=q&&w.prop(D.stateAfter);if(W)return{state:D.streamParser.copyState(W),pos:O+w.length};for(let U=w.children.length-1;U>=0;U--){let K=w.children[U],G=O+w.positions[U],Y=K instanceof Tree&&G<q&&findState(D,K,G,F,q);if(Y)return Y}return null}function cutTree(D,w,O,F,q){if(q&&O<=0&&F>=w.length)return w;!q&&O==0&&w.type==D.topNode&&(q=!0);for(let W=w.children.length-1;W>=0;W--){let U=w.positions[W],K=w.children[W],G;if(U<F&&K instanceof Tree){if(!(G=cutTree(D,K,O-U,F-U,q)))break;return q?new Tree(w.type,w.children.slice(0,W).concat(G),w.positions.slice(0,W+1),U+G.length):G}}return null}function findStartInFragments(D,w,O,F,q){for(let W of w){let U=W.from+(W.openStart?25:0),K=W.to-(W.openEnd?25:0),G=U<=O&&K>O&&findState(D,W.tree,0-W.offset,O,K),Y;if(G&&G.pos<=F&&(Y=cutTree(D,W.tree,O+W.offset,G.pos+W.offset,!1)))return{state:G.state,tree:Y}}return{state:D.streamParser.startState(q?getIndentUnit(q):4),tree:Tree.empty}}class Parse{constructor(w,O,F,q){this.lang=w,this.input=O,this.fragments=F,this.ranges=q,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=q[q.length-1].to;let W=ParseContext.get(),U=q[0].from,{state:K,tree:G}=findStartInFragments(w,F,U,this.to,W==null?void 0:W.state);this.state=K,this.parsedPos=this.chunkStart=U+G.length;for(let Y=0;Y<G.children.length;Y++)this.chunks.push(G.children[Y]),this.chunkPos.push(G.positions[Y]);W&&this.parsedPos<W.viewport.from-1e5&&q.some(Y=>Y.from<=W.viewport.from&&Y.to>=W.viewport.from)&&(this.state=this.lang.streamParser.startState(getIndentUnit(W.state)),W.skipUntilInView(this.parsedPos,W.viewport.from),this.parsedPos=W.viewport.from),this.moveRangeIndex()}advance(){let w=ParseContext.get(),O=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),F=Math.min(O,this.chunkStart+2048);for(w&&(F=Math.min(F,w.viewport.to));this.parsedPos<F;)this.parseLine(w);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=O?this.finish():w&&this.parsedPos>=w.viewport.to?(w.skipUntilInView(this.parsedPos,O),this.finish()):null}stopAt(w){this.stoppedAt=w}lineAfter(w){let O=this.input.chunk(w);if(this.input.lineChunks)O==`
`&&(O="");else{let F=O.indexOf(`
`);F>-1&&(O=O.slice(0,F))}return w+O.length<=this.to?O:O.slice(0,this.to-w)}nextLine(){let w=this.parsedPos,O=this.lineAfter(w),F=w+O.length;for(let q=this.rangeIndex;;){let W=this.ranges[q].to;if(W>=F||(O=O.slice(0,W-(F-O.length)),q++,q==this.ranges.length))break;let U=this.ranges[q].from,K=this.lineAfter(U);O+=K,F=U+K.length}return{line:O,end:F}}skipGapsTo(w,O,F){for(;;){let q=this.ranges[this.rangeIndex].to,W=w+O;if(F>0?q>W:q>=W)break;let U=this.ranges[++this.rangeIndex].from;O+=U-q}return O}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(w,O,F,q){let W=4;if(this.ranges.length>1){q=this.skipGapsTo(O,q,1),O+=q;let K=this.chunk.length;q=this.skipGapsTo(F,q,-1),F+=q,W+=this.chunk.length-K}let U=this.chunk.length-4;return W==4&&U>=0&&this.chunk[U]==w&&this.chunk[U+2]==O?this.chunk[U+2]=F:this.chunk.push(w,O,F,W),q}parseLine(w){let{line:O,end:F}=this.nextLine(),q=0,{streamParser:W}=this.lang,U=new StringStream(O,w?w.state.tabSize:4,w?getIndentUnit(w.state):2);if(U.eol())W.blankLine(this.state,U.indentUnit);else for(;!U.eol();){let K=readToken(W.token,U,this.state);if(K&&(q=this.emitToken(this.lang.tokenTable.resolve(K),this.parsedPos+U.start,this.parsedPos+U.pos,q)),U.start>1e4)break}this.parsedPos=F,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let w=Tree.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet,topID:0,maxBufferLength:2048,reused:this.chunkReused});w=new Tree(w.type,w.children,w.positions,w.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(w),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new Tree(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function readToken(D,w,O){w.start=w.pos;for(let F=0;F<10;F++){let q=D(w,O);if(w.pos>w.start)return q}throw new Error("Stream parser failed to advance stream.")}const noTokens=Object.create(null),typeArray=[NodeType.none],nodeSet=new NodeSet(typeArray),warned=[],byTag=Object.create(null),defaultTable=Object.create(null);for(let[D,w]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[D]=createTokenType(noTokens,w);class TokenTable{constructor(w){this.extra=w,this.table=Object.assign(Object.create(null),defaultTable)}resolve(w){return w?this.table[w]||(this.table[w]=createTokenType(this.extra,w)):0}}const defaultTokenTable=new TokenTable(noTokens);function warnForPart(D,w){warned.indexOf(D)>-1||(warned.push(D),console.warn(w))}function createTokenType(D,w){let O=[];for(let K of w.split(" ")){let G=[];for(let Y of K.split(".")){let Q=D[Y]||tags[Y];Q?typeof Q=="function"?G.length?G=G.map(Q):warnForPart(Y,`Modifier ${Y} used at start of tag`):G.length?warnForPart(Y,`Tag ${Y} used as modifier`):G=Array.isArray(Q)?Q:[Q]:warnForPart(Y,`Unknown highlighting tag ${Y}`)}for(let Y of G)O.push(Y)}if(!O.length)return 0;let F=w.replace(/ /g,"_"),q=F+" "+O.map(K=>K.id),W=byTag[q];if(W)return W.id;let U=byTag[q]=NodeType.define({id:typeArray.length,name:F,props:[styleTags({[F]:O})]});return typeArray.push(U),U.id}function docID(D,w){let O=NodeType.define({id:typeArray.length,name:"Document",props:[languageDataProp.add(()=>D),indentNodeProp.add(()=>F=>w.getIndent(F))],top:!0});return typeArray.push(O),O}Direction.RTL,Direction.LTR;const toggleComment=D=>{let{state:w}=D,O=w.doc.lineAt(w.selection.main.from),F=getConfig(D.state,O.from);return F.line?toggleLineComment(D):F.block?toggleBlockCommentByLine(D):!1};function command(D,w){return({state:O,dispatch:F})=>{if(O.readOnly)return!1;let q=D(w,O);return q?(F(O.update(q)),!0):!1}}const toggleLineComment=command(changeLineComment,0),toggleBlockComment=command(changeBlockComment,0),toggleBlockCommentByLine=command((D,w)=>changeBlockComment(D,w,selectedLineRanges(w)),0);function getConfig(D,w){let O=D.languageDataAt("commentTokens",w);return O.length?O[0]:{}}const SearchMargin=50;function findBlockComment(D,{open:w,close:O},F,q){let W=D.sliceDoc(F-SearchMargin,F),U=D.sliceDoc(q,q+SearchMargin),K=/\s*$/.exec(W)[0].length,G=/^\s*/.exec(U)[0].length,Y=W.length-K;if(W.slice(Y-w.length,Y)==w&&U.slice(G,G+O.length)==O)return{open:{pos:F-K,margin:K&&1},close:{pos:q+G,margin:G&&1}};let Q,X;q-F<=2*SearchMargin?Q=X=D.sliceDoc(F,q):(Q=D.sliceDoc(F,F+SearchMargin),X=D.sliceDoc(q-SearchMargin,q));let J=/^\s*/.exec(Q)[0].length,Z=/\s*$/.exec(X)[0].length,ee=X.length-Z-O.length;return Q.slice(J,J+w.length)==w&&X.slice(ee,ee+O.length)==O?{open:{pos:F+J+w.length,margin:/\s/.test(Q.charAt(J+w.length))?1:0},close:{pos:q-Z-O.length,margin:/\s/.test(X.charAt(ee-1))?1:0}}:null}function selectedLineRanges(D){let w=[];for(let O of D.selection.ranges){let F=D.doc.lineAt(O.from),q=O.to<=F.to?F:D.doc.lineAt(O.to);q.from>F.from&&q.from==O.to&&(q=O.to==F.to+1?F:D.doc.lineAt(O.to-1));let W=w.length-1;W>=0&&w[W].to>F.from?w[W].to=q.to:w.push({from:F.from+/^\s*/.exec(F.text)[0].length,to:q.to})}return w}function changeBlockComment(D,w,O=w.selection.ranges){let F=O.map(W=>getConfig(w,W.from).block);if(!F.every(W=>W))return null;let q=O.map((W,U)=>findBlockComment(w,F[U],W.from,W.to));if(D!=2&&!q.every(W=>W))return{changes:w.changes(O.map((W,U)=>q[U]?[]:[{from:W.from,insert:F[U].open+" "},{from:W.to,insert:" "+F[U].close}]))};if(D!=1&&q.some(W=>W)){let W=[];for(let U=0,K;U<q.length;U++)if(K=q[U]){let G=F[U],{open:Y,close:Q}=K;W.push({from:Y.pos-G.open.length,to:Y.pos+Y.margin},{from:Q.pos-Q.margin,to:Q.pos+G.close.length})}return{changes:W}}return null}function changeLineComment(D,w,O=w.selection.ranges){let F=[],q=-1;for(let{from:W,to:U}of O){let K=F.length,G=1e9,Y=getConfig(w,W).line;if(Y){for(let Q=W;Q<=U;){let X=w.doc.lineAt(Q);if(X.from>q&&(W==U||U>X.from)){q=X.from;let J=/^\s*/.exec(X.text)[0].length,Z=J==X.length,ee=X.text.slice(J,J+Y.length)==Y?J:-1;J<X.text.length&&J<G&&(G=J),F.push({line:X,comment:ee,token:Y,indent:J,empty:Z,single:!1})}Q=X.to+1}if(G<1e9)for(let Q=K;Q<F.length;Q++)F[Q].indent<F[Q].line.text.length&&(F[Q].indent=G);F.length==K+1&&(F[K].single=!0)}}if(D!=2&&F.some(W=>W.comment<0&&(!W.empty||W.single))){let W=[];for(let{line:K,token:G,indent:Y,empty:Q,single:X}of F)(X||!Q)&&W.push({from:K.from+Y,insert:G+" "});let U=w.changes(W);return{changes:U,selection:w.selection.map(U,1)}}else if(D!=1&&F.some(W=>W.comment>=0)){let W=[];for(let{line:U,comment:K,token:G}of F)if(K>=0){let Y=U.from+K,Q=Y+G.length;U.text[Q-U.from]==" "&&Q++,W.push({from:Y,to:Q})}return{changes:W}}return null}const fromHistory=Annotation.define(),isolateHistory=Annotation.define(),invertedEffects=Facet.define(),historyConfig=Facet.define({combine(D){return combineConfig(D,{minDepth:100,newGroupDelay:500,joinToEvent:(w,O)=>O},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(w,O)=>(F,q)=>w(F,q)||O(F,q)})}}),historyField_=StateField.define({create(){return HistoryState.empty},update(D,w){let O=w.state.facet(historyConfig),F=w.annotation(fromHistory);if(F){let G=HistEvent.fromTransaction(w,F.selection),Y=F.side,Q=Y==0?D.undone:D.done;return G?Q=updateBranch(Q,Q.length,O.minDepth,G):Q=addSelection(Q,w.startState.selection),new HistoryState(Y==0?F.rest:Q,Y==0?Q:F.rest)}let q=w.annotation(isolateHistory);if((q=="full"||q=="before")&&(D=D.isolate()),w.annotation(Transaction.addToHistory)===!1)return w.changes.empty?D:D.addMapping(w.changes.desc);let W=HistEvent.fromTransaction(w),U=w.annotation(Transaction.time),K=w.annotation(Transaction.userEvent);return W?D=D.addChanges(W,U,K,O,w):w.selection&&(D=D.addSelection(w.startState.selection,U,K,O.newGroupDelay)),(q=="full"||q=="after")&&(D=D.isolate()),D},toJSON(D){return{done:D.done.map(w=>w.toJSON()),undone:D.undone.map(w=>w.toJSON())}},fromJSON(D){return new HistoryState(D.done.map(HistEvent.fromJSON),D.undone.map(HistEvent.fromJSON))}});function history(D={}){return[historyField_,historyConfig.of(D),EditorView.domEventHandlers({beforeinput(w,O){let F=w.inputType=="historyUndo"?undo:w.inputType=="historyRedo"?redo:null;return F?(w.preventDefault(),F(O)):!1}})]}function cmd(D,w){return function({state:O,dispatch:F}){if(!w&&O.readOnly)return!1;let q=O.field(historyField_,!1);if(!q)return!1;let W=q.pop(D,O,w);return W?(F(W),!0):!1}}const undo=cmd(0,!1),redo=cmd(1,!1),undoSelection=cmd(0,!0),redoSelection=cmd(1,!0);class HistEvent{constructor(w,O,F,q,W){this.changes=w,this.effects=O,this.mapped=F,this.startSelection=q,this.selectionsAfter=W}setSelAfter(w){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,w)}toJSON(){var w,O,F;return{changes:(w=this.changes)===null||w===void 0?void 0:w.toJSON(),mapped:(O=this.mapped)===null||O===void 0?void 0:O.toJSON(),startSelection:(F=this.startSelection)===null||F===void 0?void 0:F.toJSON(),selectionsAfter:this.selectionsAfter.map(q=>q.toJSON())}}static fromJSON(w){return new HistEvent(w.changes&&ChangeSet.fromJSON(w.changes),[],w.mapped&&ChangeDesc.fromJSON(w.mapped),w.startSelection&&EditorSelection.fromJSON(w.startSelection),w.selectionsAfter.map(EditorSelection.fromJSON))}static fromTransaction(w,O){let F=none$1;for(let q of w.startState.facet(invertedEffects)){let W=q(w);W.length&&(F=F.concat(W))}return!F.length&&w.changes.empty?null:new HistEvent(w.changes.invert(w.startState.doc),F,void 0,O||w.startState.selection,none$1)}static selection(w){return new HistEvent(void 0,none$1,void 0,void 0,w)}}function updateBranch(D,w,O,F){let q=w+1>O+20?w-O-1:0,W=D.slice(q,w);return W.push(F),W}function isAdjacent(D,w){let O=[],F=!1;return D.iterChangedRanges((q,W)=>O.push(q,W)),w.iterChangedRanges((q,W,U,K)=>{for(let G=0;G<O.length;){let Y=O[G++],Q=O[G++];K>=Y&&U<=Q&&(F=!0)}}),F}function eqSelectionShape(D,w){return D.ranges.length==w.ranges.length&&D.ranges.filter((O,F)=>O.empty!=w.ranges[F].empty).length===0}function conc(D,w){return D.length?w.length?D.concat(w):D:w}const none$1=[],MaxSelectionsPerEvent=200;function addSelection(D,w){if(D.length){let O=D[D.length-1],F=O.selectionsAfter.slice(Math.max(0,O.selectionsAfter.length-MaxSelectionsPerEvent));return F.length&&F[F.length-1].eq(w)?D:(F.push(w),updateBranch(D,D.length-1,1e9,O.setSelAfter(F)))}else return[HistEvent.selection([w])]}function popSelection(D){let w=D[D.length-1],O=D.slice();return O[D.length-1]=w.setSelAfter(w.selectionsAfter.slice(0,w.selectionsAfter.length-1)),O}function addMappingToBranch(D,w){if(!D.length)return D;let O=D.length,F=none$1;for(;O;){let q=mapEvent(D[O-1],w,F);if(q.changes&&!q.changes.empty||q.effects.length){let W=D.slice(0,O);return W[O-1]=q,W}else w=q.mapped,O--,F=q.selectionsAfter}return F.length?[HistEvent.selection(F)]:none$1}function mapEvent(D,w,O){let F=conc(D.selectionsAfter.length?D.selectionsAfter.map(K=>K.map(w)):none$1,O);if(!D.changes)return HistEvent.selection(F);let q=D.changes.map(w),W=w.mapDesc(D.changes,!0),U=D.mapped?D.mapped.composeDesc(W):W;return new HistEvent(q,StateEffect.mapEffects(D.effects,w),U,D.startSelection.map(W),F)}const joinableUserEvent=/^(input\.type|delete)($|\.)/;class HistoryState{constructor(w,O,F=0,q=void 0){this.done=w,this.undone=O,this.prevTime=F,this.prevUserEvent=q}isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this}addChanges(w,O,F,q,W){let U=this.done,K=U[U.length-1];return K&&K.changes&&!K.changes.empty&&w.changes&&(!F||joinableUserEvent.test(F))&&(!K.selectionsAfter.length&&O-this.prevTime<q.newGroupDelay&&q.joinToEvent(W,isAdjacent(K.changes,w.changes))||F=="input.type.compose")?U=updateBranch(U,U.length-1,q.minDepth,new HistEvent(w.changes.compose(K.changes),conc(StateEffect.mapEffects(w.effects,K.changes),K.effects),K.mapped,K.startSelection,none$1)):U=updateBranch(U,U.length,q.minDepth,w),new HistoryState(U,none$1,O,F)}addSelection(w,O,F,q){let W=this.done.length?this.done[this.done.length-1].selectionsAfter:none$1;return W.length>0&&O-this.prevTime<q&&F==this.prevUserEvent&&F&&/^select($|\.)/.test(F)&&eqSelectionShape(W[W.length-1],w)?this:new HistoryState(addSelection(this.done,w),this.undone,O,F)}addMapping(w){return new HistoryState(addMappingToBranch(this.done,w),addMappingToBranch(this.undone,w),this.prevTime,this.prevUserEvent)}pop(w,O,F){let q=w==0?this.done:this.undone;if(q.length==0)return null;let W=q[q.length-1],U=W.selectionsAfter[0]||O.selection;if(F&&W.selectionsAfter.length)return O.update({selection:W.selectionsAfter[W.selectionsAfter.length-1],annotations:fromHistory.of({side:w,rest:popSelection(q),selection:U}),userEvent:w==0?"select.undo":"select.redo",scrollIntoView:!0});if(W.changes){let K=q.length==1?none$1:q.slice(0,q.length-1);return W.mapped&&(K=addMappingToBranch(K,W.mapped)),O.update({changes:W.changes,selection:W.startSelection,effects:W.effects,annotations:fromHistory.of({side:w,rest:K,selection:U}),filter:!1,userEvent:w==0?"undo":"redo",scrollIntoView:!0})}else return null}}HistoryState.empty=new HistoryState(none$1,none$1);const historyKeymap=[{key:"Mod-z",run:undo,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:!0},{linux:"Ctrl-Shift-z",run:redo,preventDefault:!0},{key:"Mod-u",run:undoSelection,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:!0}];function updateSel(D,w){return EditorSelection.create(D.ranges.map(w),D.mainIndex)}function setSel(D,w){return D.update({selection:w,scrollIntoView:!0,userEvent:"select"})}function moveSel({state:D,dispatch:w},O){let F=updateSel(D.selection,O);return F.eq(D.selection,!0)?!1:(w(setSel(D,F)),!0)}function rangeEnd(D,w){return EditorSelection.cursor(w?D.to:D.from)}function cursorByChar(D,w){return moveSel(D,O=>O.empty?D.moveByChar(O,w):rangeEnd(O,w))}function ltrAtCursor(D){return D.textDirectionAt(D.state.selection.main.head)==Direction.LTR}const cursorCharLeft=D=>cursorByChar(D,!ltrAtCursor(D)),cursorCharRight=D=>cursorByChar(D,ltrAtCursor(D));function cursorByGroup(D,w){return moveSel(D,O=>O.empty?D.moveByGroup(O,w):rangeEnd(O,w))}const cursorGroupLeft=D=>cursorByGroup(D,!ltrAtCursor(D)),cursorGroupRight=D=>cursorByGroup(D,ltrAtCursor(D));function interestingNode(D,w,O){if(w.type.prop(O))return!0;let F=w.to-w.from;return F&&(F>2||/[^\s,.;:]/.test(D.sliceDoc(w.from,w.to)))||w.firstChild}function moveBySyntax(D,w,O){let F=syntaxTree(D).resolveInner(w.head),q=O?NodeProp.closedBy:NodeProp.openedBy;for(let G=w.head;;){let Y=O?F.childAfter(G):F.childBefore(G);if(!Y)break;interestingNode(D,Y,q)?F=Y:G=O?Y.to:Y.from}let W=F.type.prop(q),U,K;return W&&(U=O?matchBrackets(D,F.from,1):matchBrackets(D,F.to,-1))&&U.matched?K=O?U.end.to:U.end.from:K=O?F.to:F.from,EditorSelection.cursor(K,O?-1:1)}const cursorSyntaxLeft=D=>moveSel(D,w=>moveBySyntax(D.state,w,!ltrAtCursor(D))),cursorSyntaxRight=D=>moveSel(D,w=>moveBySyntax(D.state,w,ltrAtCursor(D)));function cursorByLine(D,w){return moveSel(D,O=>{if(!O.empty)return rangeEnd(O,w);let F=D.moveVertically(O,w);return F.head!=O.head?F:D.moveToLineBoundary(O,w)})}const cursorLineUp=D=>cursorByLine(D,!1),cursorLineDown=D=>cursorByLine(D,!0);function pageInfo(D){let w=D.scrollDOM.clientHeight<D.scrollDOM.scrollHeight-2,O=0,F=0,q;if(w){for(let W of D.state.facet(EditorView.scrollMargins)){let U=W(D);U!=null&&U.top&&(O=Math.max(U==null?void 0:U.top,O)),U!=null&&U.bottom&&(F=Math.max(U==null?void 0:U.bottom,F))}q=D.scrollDOM.clientHeight-O-F}else q=(D.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:O,marginBottom:F,selfScroll:w,height:Math.max(D.defaultLineHeight,q-5)}}function cursorByPage(D,w){let O=pageInfo(D),{state:F}=D,q=updateSel(F.selection,U=>U.empty?D.moveVertically(U,w,O.height):rangeEnd(U,w));if(q.eq(F.selection))return!1;let W;if(O.selfScroll){let U=D.coordsAtPos(F.selection.main.head),K=D.scrollDOM.getBoundingClientRect(),G=K.top+O.marginTop,Y=K.bottom-O.marginBottom;U&&U.top>G&&U.bottom<Y&&(W=EditorView.scrollIntoView(q.main.head,{y:"start",yMargin:U.top-G}))}return D.dispatch(setSel(F,q),{effects:W}),!0}const cursorPageUp=D=>cursorByPage(D,!1),cursorPageDown=D=>cursorByPage(D,!0);function moveByLineBoundary(D,w,O){let F=D.lineBlockAt(w.head),q=D.moveToLineBoundary(w,O);if(q.head==w.head&&q.head!=(O?F.to:F.from)&&(q=D.moveToLineBoundary(w,O,!1)),!O&&q.head==F.from&&F.length){let W=/^\s*/.exec(D.state.sliceDoc(F.from,Math.min(F.from+100,F.to)))[0].length;W&&w.head!=F.from+W&&(q=EditorSelection.cursor(F.from+W))}return q}const cursorLineBoundaryForward=D=>moveSel(D,w=>moveByLineBoundary(D,w,!0)),cursorLineBoundaryBackward=D=>moveSel(D,w=>moveByLineBoundary(D,w,!1)),cursorLineBoundaryLeft=D=>moveSel(D,w=>moveByLineBoundary(D,w,!ltrAtCursor(D))),cursorLineBoundaryRight=D=>moveSel(D,w=>moveByLineBoundary(D,w,ltrAtCursor(D))),cursorLineStart=D=>moveSel(D,w=>EditorSelection.cursor(D.lineBlockAt(w.head).from,1)),cursorLineEnd=D=>moveSel(D,w=>EditorSelection.cursor(D.lineBlockAt(w.head).to,-1));function toMatchingBracket(D,w,O){let F=!1,q=updateSel(D.selection,W=>{let U=matchBrackets(D,W.head,-1)||matchBrackets(D,W.head,1)||W.head>0&&matchBrackets(D,W.head-1,1)||W.head<D.doc.length&&matchBrackets(D,W.head+1,-1);if(!U||!U.end)return W;F=!0;let K=U.start.from==W.head?U.end.to:U.end.from;return EditorSelection.cursor(K)});return F?(w(setSel(D,q)),!0):!1}const cursorMatchingBracket=({state:D,dispatch:w})=>toMatchingBracket(D,w);function extendSel(D,w){let O=updateSel(D.state.selection,F=>{let q=w(F);return EditorSelection.range(F.anchor,q.head,q.goalColumn,q.bidiLevel||void 0)});return O.eq(D.state.selection)?!1:(D.dispatch(setSel(D.state,O)),!0)}function selectByChar(D,w){return extendSel(D,O=>D.moveByChar(O,w))}const selectCharLeft=D=>selectByChar(D,!ltrAtCursor(D)),selectCharRight=D=>selectByChar(D,ltrAtCursor(D));function selectByGroup(D,w){return extendSel(D,O=>D.moveByGroup(O,w))}const selectGroupLeft=D=>selectByGroup(D,!ltrAtCursor(D)),selectGroupRight=D=>selectByGroup(D,ltrAtCursor(D)),selectSyntaxLeft=D=>extendSel(D,w=>moveBySyntax(D.state,w,!ltrAtCursor(D))),selectSyntaxRight=D=>extendSel(D,w=>moveBySyntax(D.state,w,ltrAtCursor(D)));function selectByLine(D,w){return extendSel(D,O=>D.moveVertically(O,w))}const selectLineUp=D=>selectByLine(D,!1),selectLineDown=D=>selectByLine(D,!0);function selectByPage(D,w){return extendSel(D,O=>D.moveVertically(O,w,pageInfo(D).height))}const selectPageUp=D=>selectByPage(D,!1),selectPageDown=D=>selectByPage(D,!0),selectLineBoundaryForward=D=>extendSel(D,w=>moveByLineBoundary(D,w,!0)),selectLineBoundaryBackward=D=>extendSel(D,w=>moveByLineBoundary(D,w,!1)),selectLineBoundaryLeft=D=>extendSel(D,w=>moveByLineBoundary(D,w,!ltrAtCursor(D))),selectLineBoundaryRight=D=>extendSel(D,w=>moveByLineBoundary(D,w,ltrAtCursor(D))),selectLineStart=D=>extendSel(D,w=>EditorSelection.cursor(D.lineBlockAt(w.head).from)),selectLineEnd=D=>extendSel(D,w=>EditorSelection.cursor(D.lineBlockAt(w.head).to)),cursorDocStart=({state:D,dispatch:w})=>(w(setSel(D,{anchor:0})),!0),cursorDocEnd=({state:D,dispatch:w})=>(w(setSel(D,{anchor:D.doc.length})),!0),selectDocStart=({state:D,dispatch:w})=>(w(setSel(D,{anchor:D.selection.main.anchor,head:0})),!0),selectDocEnd=({state:D,dispatch:w})=>(w(setSel(D,{anchor:D.selection.main.anchor,head:D.doc.length})),!0),selectAll=({state:D,dispatch:w})=>(w(D.update({selection:{anchor:0,head:D.doc.length},userEvent:"select"})),!0),selectLine=({state:D,dispatch:w})=>{let O=selectedLineBlocks(D).map(({from:F,to:q})=>EditorSelection.range(F,Math.min(q+1,D.doc.length)));return w(D.update({selection:EditorSelection.create(O),userEvent:"select"})),!0},selectParentSyntax=({state:D,dispatch:w})=>{let O=updateSel(D.selection,F=>{let q=syntaxTree(D),W=q.resolveStack(F.from,1);if(F.empty){let U=q.resolveStack(F.from,-1);U.node.from>=W.node.from&&U.node.to<=W.node.to&&(W=U)}for(let U=W;U;U=U.next){let{node:K}=U;if((K.from<F.from&&K.to>=F.to||K.to>F.to&&K.from<=F.from)&&U.next)return EditorSelection.range(K.to,K.from)}return F});return O.eq(D.selection)?!1:(w(setSel(D,O)),!0)},simplifySelection=({state:D,dispatch:w})=>{let O=D.selection,F=null;return O.ranges.length>1?F=EditorSelection.create([O.main]):O.main.empty||(F=EditorSelection.create([EditorSelection.cursor(O.main.head)])),F?(w(setSel(D,F)),!0):!1};function deleteBy(D,w){if(D.state.readOnly)return!1;let O="delete.selection",{state:F}=D,q=F.changeByRange(W=>{let{from:U,to:K}=W;if(U==K){let G=w(W);G<U?(O="delete.backward",G=skipAtomic(D,G,!1)):G>U&&(O="delete.forward",G=skipAtomic(D,G,!0)),U=Math.min(U,G),K=Math.max(K,G)}else U=skipAtomic(D,U,!1),K=skipAtomic(D,K,!0);return U==K?{range:W}:{changes:{from:U,to:K},range:EditorSelection.cursor(U,U<W.head?-1:1)}});return q.changes.empty?!1:(D.dispatch(F.update(q,{scrollIntoView:!0,userEvent:O,effects:O=="delete.selection"?EditorView.announce.of(F.phrase("Selection deleted")):void 0})),!0)}function skipAtomic(D,w,O){if(D instanceof EditorView)for(let F of D.state.facet(EditorView.atomicRanges).map(q=>q(D)))F.between(w,w,(q,W)=>{q<w&&W>w&&(w=O?W:q)});return w}const deleteByChar=(D,w,O)=>deleteBy(D,F=>{let q=F.from,{state:W}=D,U=W.doc.lineAt(q),K,G;if(O&&!w&&q>U.from&&q<U.from+200&&!/[^ \t]/.test(K=U.text.slice(0,q-U.from))){if(K[K.length-1]=="	")return q-1;let Y=countColumn(K,W.tabSize),Q=Y%getIndentUnit(W)||getIndentUnit(W);for(let X=0;X<Q&&K[K.length-1-X]==" ";X++)q--;G=q}else G=findClusterBreak(U.text,q-U.from,w,w)+U.from,G==q&&U.number!=(w?W.doc.lines:1)?G+=w?1:-1:!w&&/[\ufe00-\ufe0f]/.test(U.text.slice(G-U.from,q-U.from))&&(G=findClusterBreak(U.text,G-U.from,!1,!1)+U.from);return G}),deleteCharBackward=D=>deleteByChar(D,!1,!0),deleteCharForward=D=>deleteByChar(D,!0,!1),deleteByGroup=(D,w)=>deleteBy(D,O=>{let F=O.head,{state:q}=D,W=q.doc.lineAt(F),U=q.charCategorizer(F);for(let K=null;;){if(F==(w?W.to:W.from)){F==O.head&&W.number!=(w?q.doc.lines:1)&&(F+=w?1:-1);break}let G=findClusterBreak(W.text,F-W.from,w)+W.from,Y=W.text.slice(Math.min(F,G)-W.from,Math.max(F,G)-W.from),Q=U(Y);if(K!=null&&Q!=K)break;(Y!=" "||F!=O.head)&&(K=Q),F=G}return F}),deleteGroupBackward=D=>deleteByGroup(D,!1),deleteGroupForward=D=>deleteByGroup(D,!0),deleteToLineEnd=D=>deleteBy(D,w=>{let O=D.lineBlockAt(w.head).to;return w.head<O?O:Math.min(D.state.doc.length,w.head+1)}),deleteLineBoundaryBackward=D=>deleteBy(D,w=>{let O=D.moveToLineBoundary(w,!1).head;return w.head>O?O:Math.max(0,w.head-1)}),deleteLineBoundaryForward=D=>deleteBy(D,w=>{let O=D.moveToLineBoundary(w,!0).head;return w.head<O?O:Math.min(D.state.doc.length,w.head+1)}),splitLine=({state:D,dispatch:w})=>{if(D.readOnly)return!1;let O=D.changeByRange(F=>({changes:{from:F.from,to:F.to,insert:Text.of(["",""])},range:EditorSelection.cursor(F.from)}));return w(D.update(O,{scrollIntoView:!0,userEvent:"input"})),!0},transposeChars=({state:D,dispatch:w})=>{if(D.readOnly)return!1;let O=D.changeByRange(F=>{if(!F.empty||F.from==0||F.from==D.doc.length)return{range:F};let q=F.from,W=D.doc.lineAt(q),U=q==W.from?q-1:findClusterBreak(W.text,q-W.from,!1)+W.from,K=q==W.to?q+1:findClusterBreak(W.text,q-W.from,!0)+W.from;return{changes:{from:U,to:K,insert:D.doc.slice(q,K).append(D.doc.slice(U,q))},range:EditorSelection.cursor(K)}});return O.changes.empty?!1:(w(D.update(O,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function selectedLineBlocks(D){let w=[],O=-1;for(let F of D.selection.ranges){let q=D.doc.lineAt(F.from),W=D.doc.lineAt(F.to);if(!F.empty&&F.to==W.from&&(W=D.doc.lineAt(F.to-1)),O>=q.number){let U=w[w.length-1];U.to=W.to,U.ranges.push(F)}else w.push({from:q.from,to:W.to,ranges:[F]});O=W.number+1}return w}function moveLine(D,w,O){if(D.readOnly)return!1;let F=[],q=[];for(let W of selectedLineBlocks(D)){if(O?W.to==D.doc.length:W.from==0)continue;let U=D.doc.lineAt(O?W.to+1:W.from-1),K=U.length+1;if(O){F.push({from:W.to,to:U.to},{from:W.from,insert:U.text+D.lineBreak});for(let G of W.ranges)q.push(EditorSelection.range(Math.min(D.doc.length,G.anchor+K),Math.min(D.doc.length,G.head+K)))}else{F.push({from:U.from,to:W.from},{from:W.to,insert:D.lineBreak+U.text});for(let G of W.ranges)q.push(EditorSelection.range(G.anchor-K,G.head-K))}}return F.length?(w(D.update({changes:F,scrollIntoView:!0,selection:EditorSelection.create(q,D.selection.mainIndex),userEvent:"move.line"})),!0):!1}const moveLineUp=({state:D,dispatch:w})=>moveLine(D,w,!1),moveLineDown=({state:D,dispatch:w})=>moveLine(D,w,!0);function copyLine(D,w,O){if(D.readOnly)return!1;let F=[];for(let q of selectedLineBlocks(D))O?F.push({from:q.from,insert:D.doc.slice(q.from,q.to)+D.lineBreak}):F.push({from:q.to,insert:D.lineBreak+D.doc.slice(q.from,q.to)});return w(D.update({changes:F,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const copyLineUp=({state:D,dispatch:w})=>copyLine(D,w,!1),copyLineDown=({state:D,dispatch:w})=>copyLine(D,w,!0),deleteLine=D=>{if(D.state.readOnly)return!1;let{state:w}=D,O=w.changes(selectedLineBlocks(w).map(({from:q,to:W})=>(q>0?q--:W<w.doc.length&&W++,{from:q,to:W}))),F=updateSel(w.selection,q=>{let W;if(D.lineWrapping){let U=D.lineBlockAt(q.head),K=D.coordsAtPos(q.head,q.assoc||1);K&&(W=U.bottom+D.documentTop-K.bottom+D.defaultLineHeight/2)}return D.moveVertically(q,!0,W)}).map(O);return D.dispatch({changes:O,selection:F,scrollIntoView:!0,userEvent:"delete.line"}),!0};function isBetweenBrackets(D,w){if(/\(\)|\[\]|\{\}/.test(D.sliceDoc(w-1,w+1)))return{from:w,to:w};let O=syntaxTree(D).resolveInner(w),F=O.childBefore(w),q=O.childAfter(w),W;return F&&q&&F.to<=w&&q.from>=w&&(W=F.type.prop(NodeProp.closedBy))&&W.indexOf(q.name)>-1&&D.doc.lineAt(F.to).from==D.doc.lineAt(q.from).from&&!/\S/.test(D.sliceDoc(F.to,q.from))?{from:F.to,to:q.from}:null}const insertNewlineAndIndent=newlineAndIndent(!1),insertBlankLine=newlineAndIndent(!0);function newlineAndIndent(D){return({state:w,dispatch:O})=>{if(w.readOnly)return!1;let F=w.changeByRange(q=>{let{from:W,to:U}=q,K=w.doc.lineAt(W),G=!D&&W==U&&isBetweenBrackets(w,W);D&&(W=U=(U<=K.to?K:w.doc.lineAt(U)).to);let Y=new IndentContext(w,{simulateBreak:W,simulateDoubleBreak:!!G}),Q=getIndentation(Y,W);for(Q==null&&(Q=countColumn(/^\s*/.exec(w.doc.lineAt(W).text)[0],w.tabSize));U<K.to&&/\s/.test(K.text[U-K.from]);)U++;G?{from:W,to:U}=G:W>K.from&&W<K.from+100&&!/\S/.test(K.text.slice(0,W))&&(W=K.from);let X=["",indentString(w,Q)];return G&&X.push(indentString(w,Y.lineIndent(K.from,-1))),{changes:{from:W,to:U,insert:Text.of(X)},range:EditorSelection.cursor(W+1+X[1].length)}});return O(w.update(F,{scrollIntoView:!0,userEvent:"input"})),!0}}function changeBySelectedLine(D,w){let O=-1;return D.changeByRange(F=>{let q=[];for(let U=F.from;U<=F.to;){let K=D.doc.lineAt(U);K.number>O&&(F.empty||F.to>K.from)&&(w(K,q,F),O=K.number),U=K.to+1}let W=D.changes(q);return{changes:q,range:EditorSelection.range(W.mapPos(F.anchor,1),W.mapPos(F.head,1))}})}const indentSelection=({state:D,dispatch:w})=>{if(D.readOnly)return!1;let O=Object.create(null),F=new IndentContext(D,{overrideIndentation:W=>{let U=O[W];return U??-1}}),q=changeBySelectedLine(D,(W,U,K)=>{let G=getIndentation(F,W.from);if(G==null)return;/\S/.test(W.text)||(G=0);let Y=/^\s*/.exec(W.text)[0],Q=indentString(D,G);(Y!=Q||K.from<W.from+Y.length)&&(O[W.from]=G,U.push({from:W.from,to:W.from+Y.length,insert:Q}))});return q.changes.empty||w(D.update(q,{userEvent:"indent"})),!0},indentMore=({state:D,dispatch:w})=>D.readOnly?!1:(w(D.update(changeBySelectedLine(D,(O,F)=>{F.push({from:O.from,insert:D.facet(indentUnit)})}),{userEvent:"input.indent"})),!0),indentLess=({state:D,dispatch:w})=>D.readOnly?!1:(w(D.update(changeBySelectedLine(D,(O,F)=>{let q=/^\s*/.exec(O.text)[0];if(!q)return;let W=countColumn(q,D.tabSize),U=0,K=indentString(D,Math.max(0,W-getIndentUnit(D)));for(;U<q.length&&U<K.length&&q.charCodeAt(U)==K.charCodeAt(U);)U++;F.push({from:O.from+U,to:O.from+q.length,insert:K.slice(U)})}),{userEvent:"delete.dedent"})),!0),toggleTabFocusMode=D=>(D.setTabFocusMode(),!0),emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}],standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:!0},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:!0},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:!0},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:!0},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:!0},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:!0},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:!0},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent,shift:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteLineBoundaryBackward},{mac:"Mod-Delete",run:deleteLineBoundaryForward}].concat(emacsStyleKeymap.map(D=>({mac:D.key,run:D.run,shift:D.shift}))),defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:!0},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment},{key:"Ctrl-m",mac:"Shift-Alt-m",run:toggleTabFocusMode}].concat(standardKeymap);function crelt(){var D=arguments[0];typeof D=="string"&&(D=document.createElement(D));var w=1,O=arguments[1];if(O&&typeof O=="object"&&O.nodeType==null&&!Array.isArray(O)){for(var F in O)if(Object.prototype.hasOwnProperty.call(O,F)){var q=O[F];typeof q=="string"?D.setAttribute(F,q):q!=null&&(D[F]=q)}w++}for(;w<arguments.length;w++)add(D,arguments[w]);return D}function add(D,w){if(typeof w=="string")D.appendChild(document.createTextNode(w));else if(w!=null)if(w.nodeType!=null)D.appendChild(w);else if(Array.isArray(w))for(var O=0;O<w.length;O++)add(D,w[O]);else throw new RangeError("Unsupported child node: "+w)}const basicNormalize=typeof String.prototype.normalize=="function"?D=>D.normalize("NFKD"):D=>D;class SearchCursor{constructor(w,O,F=0,q=w.length,W,U){this.test=U,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=w.iterRange(F,q),this.bufferStart=F,this.normalize=W?K=>W(basicNormalize(K)):basicNormalize,this.query=this.normalize(O)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return codePointAt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let w=this.peek();if(w<0)return this.done=!0,this;let O=fromCodePoint(w),F=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(w);let q=this.normalize(O);if(q.length)for(let W=0,U=F;;W++){let K=q.charCodeAt(W),G=this.match(K,U,this.bufferPos+this.bufferStart);if(W==q.length-1){if(G)return this.value=G,this;break}U==F&&W<O.length&&O.charCodeAt(W)==K&&U++}}}match(w,O,F){let q=null;for(let W=0;W<this.matches.length;W+=2){let U=this.matches[W],K=!1;this.query.charCodeAt(U)==w&&(U==this.query.length-1?q={from:this.matches[W+1],to:F}:(this.matches[W]++,K=!0)),K||(this.matches.splice(W,2),W-=2)}return this.query.charCodeAt(0)==w&&(this.query.length==1?q={from:O,to:F}:this.matches.push(1,O)),q&&this.test&&!this.test(q.from,q.to,this.buffer,this.bufferStart)&&(q=null),q}}typeof Symbol<"u"&&(SearchCursor.prototype[Symbol.iterator]=function(){return this});const empty={from:-1,to:-1,match:/.*/.exec("")},baseFlags="gm"+(/x/.unicode==null?"":"u");class RegExpCursor{constructor(w,O,F,q=0,W=w.length){if(this.text=w,this.to=W,this.curLine="",this.done=!1,this.value=empty,/\\[sWDnr]|\n|\r|\[\^/.test(O))return new MultilineRegExpCursor(w,O,F,q,W);this.re=new RegExp(O,baseFlags+(F!=null&&F.ignoreCase?"i":"")),this.test=F==null?void 0:F.test,this.iter=w.iter();let U=w.lineAt(q);this.curLineStart=U.from,this.matchPos=toCharEnd(w,q),this.getLine(this.curLineStart)}getLine(w){this.iter.next(w),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let w=this.matchPos-this.curLineStart;;){this.re.lastIndex=w;let O=this.matchPos<=this.to&&this.re.exec(this.curLine);if(O){let F=this.curLineStart+O.index,q=F+O[0].length;if(this.matchPos=toCharEnd(this.text,q+(F==q?1:0)),F==this.curLineStart+this.curLine.length&&this.nextLine(),(F<q||F>this.value.to)&&(!this.test||this.test(F,q,O)))return this.value={from:F,to:q,match:O},this;w=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),w=0;else return this.done=!0,this}}}const flattened=new WeakMap;class FlattenedDoc{constructor(w,O){this.from=w,this.text=O}get to(){return this.from+this.text.length}static get(w,O,F){let q=flattened.get(w);if(!q||q.from>=F||q.to<=O){let K=new FlattenedDoc(O,w.sliceString(O,F));return flattened.set(w,K),K}if(q.from==O&&q.to==F)return q;let{text:W,from:U}=q;return U>O&&(W=w.sliceString(O,U)+W,U=O),q.to<F&&(W+=w.sliceString(q.to,F)),flattened.set(w,new FlattenedDoc(U,W)),new FlattenedDoc(O,W.slice(O-U,F-U))}}class MultilineRegExpCursor{constructor(w,O,F,q,W){this.text=w,this.to=W,this.done=!1,this.value=empty,this.matchPos=toCharEnd(w,q),this.re=new RegExp(O,baseFlags+(F!=null&&F.ignoreCase?"i":"")),this.test=F==null?void 0:F.test,this.flat=FlattenedDoc.get(w,q,this.chunkEnd(q+5e3))}chunkEnd(w){return w>=this.to?this.to:this.text.lineAt(w).to}next(){for(;;){let w=this.re.lastIndex=this.matchPos-this.flat.from,O=this.re.exec(this.flat.text);if(O&&!O[0]&&O.index==w&&(this.re.lastIndex=w+1,O=this.re.exec(this.flat.text)),O){let F=this.flat.from+O.index,q=F+O[0].length;if((this.flat.to>=this.to||O.index+O[0].length<=this.flat.text.length-10)&&(!this.test||this.test(F,q,O)))return this.value={from:F,to:q,match:O},this.matchPos=toCharEnd(this.text,q+(F==q?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this});function validRegExp(D){try{return new RegExp(D,baseFlags),!0}catch{return!1}}function toCharEnd(D,w){if(w>=D.length)return w;let O=D.lineAt(w),F;for(;w<O.to&&(F=O.text.charCodeAt(w-O.from))>=56320&&F<57344;)w++;return w}function createLineDialog(D){let w=String(D.state.doc.lineAt(D.state.selection.main.head).number),O=crelt("input",{class:"cm-textfield",name:"line",value:w}),F=crelt("form",{class:"cm-gotoLine",onkeydown:W=>{W.keyCode==27?(W.preventDefault(),D.dispatch({effects:dialogEffect.of(!1)}),D.focus()):W.keyCode==13&&(W.preventDefault(),q())},onsubmit:W=>{W.preventDefault(),q()}},crelt("label",D.state.phrase("Go to line"),": ",O)," ",crelt("button",{class:"cm-button",type:"submit"},D.state.phrase("go")));function q(){let W=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(O.value);if(!W)return;let{state:U}=D,K=U.doc.lineAt(U.selection.main.head),[,G,Y,Q,X]=W,J=Q?+Q.slice(1):0,Z=Y?+Y:K.number;if(Y&&X){let te=Z/100;G&&(te=te*(G=="-"?-1:1)+K.number/U.doc.lines),Z=Math.round(U.doc.lines*te)}else Y&&G&&(Z=Z*(G=="-"?-1:1)+K.number);let ee=U.doc.line(Math.max(1,Math.min(U.doc.lines,Z))),ne=EditorSelection.cursor(ee.from+Math.max(0,Math.min(J,ee.length)));D.dispatch({effects:[dialogEffect.of(!1),EditorView.scrollIntoView(ne.from,{y:"center"})],selection:ne}),D.focus()}return{dom:F}}const dialogEffect=StateEffect.define(),dialogField=StateField.define({create(){return!0},update(D,w){for(let O of w.effects)O.is(dialogEffect)&&(D=O.value);return D},provide:D=>showPanel.from(D,w=>w?createLineDialog:null)}),gotoLine=D=>{let w=getPanel(D,createLineDialog);if(!w){let O=[dialogEffect.of(!0)];D.state.field(dialogField,!1)==null&&O.push(StateEffect.appendConfig.of([dialogField,baseTheme$1$1])),D.dispatch({effects:O}),w=getPanel(D,createLineDialog)}return w&&w.dom.querySelector("input").select(),!0},baseTheme$1$1=EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),defaultHighlightOptions={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},highlightConfig=Facet.define({combine(D){return combineConfig(D,defaultHighlightOptions,{highlightWordAroundCursor:(w,O)=>w||O,minSelectionLength:Math.min,maxMatches:Math.min})}});function highlightSelectionMatches(D){return[defaultTheme,matchHighlighter]}const matchDeco=Decoration.mark({class:"cm-selectionMatch"}),mainMatchDeco=Decoration.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function insideWordBoundaries(D,w,O,F){return(O==0||D(w.sliceDoc(O-1,O))!=CharCategory.Word)&&(F==w.doc.length||D(w.sliceDoc(F,F+1))!=CharCategory.Word)}function insideWord(D,w,O,F){return D(w.sliceDoc(O,O+1))==CharCategory.Word&&D(w.sliceDoc(F-1,F))==CharCategory.Word}const matchHighlighter=ViewPlugin.fromClass(class{constructor(D){this.decorations=this.getDeco(D)}update(D){(D.selectionSet||D.docChanged||D.viewportChanged)&&(this.decorations=this.getDeco(D.view))}getDeco(D){let w=D.state.facet(highlightConfig),{state:O}=D,F=O.selection;if(F.ranges.length>1)return Decoration.none;let q=F.main,W,U=null;if(q.empty){if(!w.highlightWordAroundCursor)return Decoration.none;let G=O.wordAt(q.head);if(!G)return Decoration.none;U=O.charCategorizer(q.head),W=O.sliceDoc(G.from,G.to)}else{let G=q.to-q.from;if(G<w.minSelectionLength||G>200)return Decoration.none;if(w.wholeWords){if(W=O.sliceDoc(q.from,q.to),U=O.charCategorizer(q.head),!(insideWordBoundaries(U,O,q.from,q.to)&&insideWord(U,O,q.from,q.to)))return Decoration.none}else if(W=O.sliceDoc(q.from,q.to),!W)return Decoration.none}let K=[];for(let G of D.visibleRanges){let Y=new SearchCursor(O.doc,W,G.from,G.to);for(;!Y.next().done;){let{from:Q,to:X}=Y.value;if((!U||insideWordBoundaries(U,O,Q,X))&&(q.empty&&Q<=q.from&&X>=q.to?K.push(mainMatchDeco.range(Q,X)):(Q>=q.to||X<=q.from)&&K.push(matchDeco.range(Q,X)),K.length>w.maxMatches))return Decoration.none}}return Decoration.set(K)}},{decorations:D=>D.decorations}),defaultTheme=EditorView.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),selectWord=({state:D,dispatch:w})=>{let{selection:O}=D,F=EditorSelection.create(O.ranges.map(q=>D.wordAt(q.head)||EditorSelection.cursor(q.head)),O.mainIndex);return F.eq(O)?!1:(w(D.update({selection:F})),!0)};function findNextOccurrence(D,w){let{main:O,ranges:F}=D.selection,q=D.wordAt(O.head),W=q&&q.from==O.from&&q.to==O.to;for(let U=!1,K=new SearchCursor(D.doc,w,F[F.length-1].to);;)if(K.next(),K.done){if(U)return null;K=new SearchCursor(D.doc,w,0,Math.max(0,F[F.length-1].from-1)),U=!0}else{if(U&&F.some(G=>G.from==K.value.from))continue;if(W){let G=D.wordAt(K.value.from);if(!G||G.from!=K.value.from||G.to!=K.value.to)continue}return K.value}}const selectNextOccurrence=({state:D,dispatch:w})=>{let{ranges:O}=D.selection;if(O.some(W=>W.from===W.to))return selectWord({state:D,dispatch:w});let F=D.sliceDoc(O[0].from,O[0].to);if(D.selection.ranges.some(W=>D.sliceDoc(W.from,W.to)!=F))return!1;let q=findNextOccurrence(D,F);return q?(w(D.update({selection:D.selection.addRange(EditorSelection.range(q.from,q.to),!1),effects:EditorView.scrollIntoView(q.to)})),!0):!1},searchConfigFacet=Facet.define({combine(D){return combineConfig(D,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:w=>new SearchPanel(w),scrollToMatch:w=>EditorView.scrollIntoView(w)})}});class SearchQuery{constructor(w){this.search=w.search,this.caseSensitive=!!w.caseSensitive,this.literal=!!w.literal,this.regexp=!!w.regexp,this.replace=w.replace||"",this.valid=!!this.search&&(!this.regexp||validRegExp(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!w.wholeWord}unquote(w){return this.literal?w:w.replace(/\\([nrt\\])/g,(O,F)=>F=="n"?`
`:F=="r"?"\r":F=="t"?"	":"\\")}eq(w){return this.search==w.search&&this.replace==w.replace&&this.caseSensitive==w.caseSensitive&&this.regexp==w.regexp&&this.wholeWord==w.wholeWord}create(){return this.regexp?new RegExpQuery(this):new StringQuery(this)}getCursor(w,O=0,F){let q=w.doc?w:EditorState.create({doc:w});return F==null&&(F=q.doc.length),this.regexp?regexpCursor(this,q,O,F):stringCursor(this,q,O,F)}}class QueryType{constructor(w){this.spec=w}}function stringCursor(D,w,O,F){return new SearchCursor(w.doc,D.unquoted,O,F,D.caseSensitive?void 0:q=>q.toLowerCase(),D.wholeWord?stringWordTest(w.doc,w.charCategorizer(w.selection.main.head)):void 0)}function stringWordTest(D,w){return(O,F,q,W)=>((W>O||W+q.length<F)&&(W=Math.max(0,O-2),q=D.sliceString(W,Math.min(D.length,F+2))),(w(charBefore(q,O-W))!=CharCategory.Word||w(charAfter(q,O-W))!=CharCategory.Word)&&(w(charAfter(q,F-W))!=CharCategory.Word||w(charBefore(q,F-W))!=CharCategory.Word))}class StringQuery extends QueryType{constructor(w){super(w)}nextMatch(w,O,F){let q=stringCursor(this.spec,w,F,w.doc.length).nextOverlapping();if(q.done){let W=Math.min(w.doc.length,O+this.spec.unquoted.length);q=stringCursor(this.spec,w,0,W).nextOverlapping()}return q.done||q.value.from==O&&q.value.to==F?null:q.value}prevMatchInRange(w,O,F){for(let q=F;;){let W=Math.max(O,q-1e4-this.spec.unquoted.length),U=stringCursor(this.spec,w,W,q),K=null;for(;!U.nextOverlapping().done;)K=U.value;if(K)return K;if(W==O)return null;q-=1e4}}prevMatch(w,O,F){let q=this.prevMatchInRange(w,0,O);return q||(q=this.prevMatchInRange(w,Math.max(0,F-this.spec.unquoted.length),w.doc.length)),q&&(q.from!=O||q.to!=F)?q:null}getReplacement(w){return this.spec.unquote(this.spec.replace)}matchAll(w,O){let F=stringCursor(this.spec,w,0,w.doc.length),q=[];for(;!F.next().done;){if(q.length>=O)return null;q.push(F.value)}return q}highlight(w,O,F,q){let W=stringCursor(this.spec,w,Math.max(0,O-this.spec.unquoted.length),Math.min(F+this.spec.unquoted.length,w.doc.length));for(;!W.next().done;)q(W.value.from,W.value.to)}}function regexpCursor(D,w,O,F){return new RegExpCursor(w.doc,D.search,{ignoreCase:!D.caseSensitive,test:D.wholeWord?regexpWordTest(w.charCategorizer(w.selection.main.head)):void 0},O,F)}function charBefore(D,w){return D.slice(findClusterBreak(D,w,!1),w)}function charAfter(D,w){return D.slice(w,findClusterBreak(D,w))}function regexpWordTest(D){return(w,O,F)=>!F[0].length||(D(charBefore(F.input,F.index))!=CharCategory.Word||D(charAfter(F.input,F.index))!=CharCategory.Word)&&(D(charAfter(F.input,F.index+F[0].length))!=CharCategory.Word||D(charBefore(F.input,F.index+F[0].length))!=CharCategory.Word)}class RegExpQuery extends QueryType{nextMatch(w,O,F){let q=regexpCursor(this.spec,w,F,w.doc.length).next();return q.done&&(q=regexpCursor(this.spec,w,0,O).next()),q.done?null:q.value}prevMatchInRange(w,O,F){for(let q=1;;q++){let W=Math.max(O,F-q*1e4),U=regexpCursor(this.spec,w,W,F),K=null;for(;!U.next().done;)K=U.value;if(K&&(W==O||K.from>W+10))return K;if(W==O)return null}}prevMatch(w,O,F){return this.prevMatchInRange(w,0,O)||this.prevMatchInRange(w,F,w.doc.length)}getReplacement(w){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(O,F)=>{if(F=="&")return w.match[0];if(F=="$")return"$";for(let q=F.length;q>0;q--){let W=+F.slice(0,q);if(W>0&&W<w.match.length)return w.match[W]+F.slice(q)}return O})}matchAll(w,O){let F=regexpCursor(this.spec,w,0,w.doc.length),q=[];for(;!F.next().done;){if(q.length>=O)return null;q.push(F.value)}return q}highlight(w,O,F,q){let W=regexpCursor(this.spec,w,Math.max(0,O-250),Math.min(F+250,w.doc.length));for(;!W.next().done;)q(W.value.from,W.value.to)}}const setSearchQuery=StateEffect.define(),togglePanel$1=StateEffect.define(),searchState=StateField.define({create(D){return new SearchState(defaultQuery(D).create(),null)},update(D,w){for(let O of w.effects)O.is(setSearchQuery)?D=new SearchState(O.value.create(),D.panel):O.is(togglePanel$1)&&(D=new SearchState(D.query,O.value?createSearchPanel:null));return D},provide:D=>showPanel.from(D,w=>w.panel)});class SearchState{constructor(w,O){this.query=w,this.panel=O}}const matchMark=Decoration.mark({class:"cm-searchMatch"}),selectedMatchMark=Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"}),searchHighlighter=ViewPlugin.fromClass(class{constructor(D){this.view=D,this.decorations=this.highlight(D.state.field(searchState))}update(D){let w=D.state.field(searchState);(w!=D.startState.field(searchState)||D.docChanged||D.selectionSet||D.viewportChanged)&&(this.decorations=this.highlight(w))}highlight({query:D,panel:w}){if(!w||!D.spec.valid)return Decoration.none;let{view:O}=this,F=new RangeSetBuilder;for(let q=0,W=O.visibleRanges,U=W.length;q<U;q++){let{from:K,to:G}=W[q];for(;q<U-1&&G>W[q+1].from-2*250;)G=W[++q].to;D.highlight(O.state,K,G,(Y,Q)=>{let X=O.state.selection.ranges.some(J=>J.from==Y&&J.to==Q);F.add(Y,Q,X?selectedMatchMark:matchMark)})}return F.finish()}},{decorations:D=>D.decorations});function searchCommand(D){return w=>{let O=w.state.field(searchState,!1);return O&&O.query.spec.valid?D(w,O):openSearchPanel(w)}}const findNext=searchCommand((D,{query:w})=>{let{to:O}=D.state.selection.main,F=w.nextMatch(D.state,O,O);if(!F)return!1;let q=EditorSelection.single(F.from,F.to),W=D.state.facet(searchConfigFacet);return D.dispatch({selection:q,effects:[announceMatch(D,F),W.scrollToMatch(q.main,D)],userEvent:"select.search"}),selectSearchInput(D),!0}),findPrevious=searchCommand((D,{query:w})=>{let{state:O}=D,{from:F}=O.selection.main,q=w.prevMatch(O,F,F);if(!q)return!1;let W=EditorSelection.single(q.from,q.to),U=D.state.facet(searchConfigFacet);return D.dispatch({selection:W,effects:[announceMatch(D,q),U.scrollToMatch(W.main,D)],userEvent:"select.search"}),selectSearchInput(D),!0}),selectMatches=searchCommand((D,{query:w})=>{let O=w.matchAll(D.state,1e3);return!O||!O.length?!1:(D.dispatch({selection:EditorSelection.create(O.map(F=>EditorSelection.range(F.from,F.to))),userEvent:"select.search.matches"}),!0)}),selectSelectionMatches=({state:D,dispatch:w})=>{let O=D.selection;if(O.ranges.length>1||O.main.empty)return!1;let{from:F,to:q}=O.main,W=[],U=0;for(let K=new SearchCursor(D.doc,D.sliceDoc(F,q));!K.next().done;){if(W.length>1e3)return!1;K.value.from==F&&(U=W.length),W.push(EditorSelection.range(K.value.from,K.value.to))}return w(D.update({selection:EditorSelection.create(W,U),userEvent:"select.search.matches"})),!0},replaceNext=searchCommand((D,{query:w})=>{let{state:O}=D,{from:F,to:q}=O.selection.main;if(O.readOnly)return!1;let W=w.nextMatch(O,F,F);if(!W)return!1;let U=W,K=[],G,Y,Q=[];if(U.from==F&&U.to==q&&(Y=O.toText(w.getReplacement(U)),K.push({from:U.from,to:U.to,insert:Y}),U=w.nextMatch(O,U.from,U.to),Q.push(EditorView.announce.of(O.phrase("replaced match on line $",O.doc.lineAt(F).number)+"."))),U){let X=K.length==0||K[0].from>=W.to?0:W.to-W.from-Y.length;G=EditorSelection.single(U.from-X,U.to-X),Q.push(announceMatch(D,U)),Q.push(O.facet(searchConfigFacet).scrollToMatch(G.main,D))}return D.dispatch({changes:K,selection:G,effects:Q,userEvent:"input.replace"}),!0}),replaceAll=searchCommand((D,{query:w})=>{if(D.state.readOnly)return!1;let O=w.matchAll(D.state,1e9).map(q=>{let{from:W,to:U}=q;return{from:W,to:U,insert:w.getReplacement(q)}});if(!O.length)return!1;let F=D.state.phrase("replaced $ matches",O.length)+".";return D.dispatch({changes:O,effects:EditorView.announce.of(F),userEvent:"input.replace.all"}),!0});function createSearchPanel(D){return D.state.facet(searchConfigFacet).createPanel(D)}function defaultQuery(D,w){var O,F,q,W,U;let K=D.selection.main,G=K.empty||K.to>K.from+100?"":D.sliceDoc(K.from,K.to);if(w&&!G)return w;let Y=D.facet(searchConfigFacet);return new SearchQuery({search:((O=w==null?void 0:w.literal)!==null&&O!==void 0?O:Y.literal)?G:G.replace(/\n/g,"\\n"),caseSensitive:(F=w==null?void 0:w.caseSensitive)!==null&&F!==void 0?F:Y.caseSensitive,literal:(q=w==null?void 0:w.literal)!==null&&q!==void 0?q:Y.literal,regexp:(W=w==null?void 0:w.regexp)!==null&&W!==void 0?W:Y.regexp,wholeWord:(U=w==null?void 0:w.wholeWord)!==null&&U!==void 0?U:Y.wholeWord})}function getSearchInput(D){let w=getPanel(D,createSearchPanel);return w&&w.dom.querySelector("[main-field]")}function selectSearchInput(D){let w=getSearchInput(D);w&&w==D.root.activeElement&&w.select()}const openSearchPanel=D=>{let w=D.state.field(searchState,!1);if(w&&w.panel){let O=getSearchInput(D);if(O&&O!=D.root.activeElement){let F=defaultQuery(D.state,w.query.spec);F.valid&&D.dispatch({effects:setSearchQuery.of(F)}),O.focus(),O.select()}}else D.dispatch({effects:[togglePanel$1.of(!0),w?setSearchQuery.of(defaultQuery(D.state,w.query.spec)):StateEffect.appendConfig.of(searchExtensions)]});return!0},closeSearchPanel=D=>{let w=D.state.field(searchState,!1);if(!w||!w.panel)return!1;let O=getPanel(D,createSearchPanel);return O&&O.dom.contains(D.root.activeElement)&&D.focus(),D.dispatch({effects:togglePanel$1.of(!1)}),!0},searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Mod-Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence,preventDefault:!0}];class SearchPanel{constructor(w){this.view=w;let O=this.query=w.state.field(searchState).query.spec;this.commit=this.commit.bind(this),this.searchField=crelt("input",{value:O.search,placeholder:phrase(w,"Find"),"aria-label":phrase(w,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=crelt("input",{value:O.replace,placeholder:phrase(w,"Replace"),"aria-label":phrase(w,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=crelt("input",{type:"checkbox",name:"case",form:"",checked:O.caseSensitive,onchange:this.commit}),this.reField=crelt("input",{type:"checkbox",name:"re",form:"",checked:O.regexp,onchange:this.commit}),this.wordField=crelt("input",{type:"checkbox",name:"word",form:"",checked:O.wholeWord,onchange:this.commit});function F(q,W,U){return crelt("button",{class:"cm-button",name:q,onclick:W,type:"button"},U)}this.dom=crelt("div",{onkeydown:q=>this.keydown(q),class:"cm-search"},[this.searchField,F("next",()=>findNext(w),[phrase(w,"next")]),F("prev",()=>findPrevious(w),[phrase(w,"previous")]),F("select",()=>selectMatches(w),[phrase(w,"all")]),crelt("label",null,[this.caseField,phrase(w,"match case")]),crelt("label",null,[this.reField,phrase(w,"regexp")]),crelt("label",null,[this.wordField,phrase(w,"by word")]),...w.state.readOnly?[]:[crelt("br"),this.replaceField,F("replace",()=>replaceNext(w),[phrase(w,"replace")]),F("replaceAll",()=>replaceAll(w),[phrase(w,"replace all")])],crelt("button",{name:"close",onclick:()=>closeSearchPanel(w),"aria-label":phrase(w,"close"),type:"button"},["×"])])}commit(){let w=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});w.eq(this.query)||(this.query=w,this.view.dispatch({effects:setSearchQuery.of(w)}))}keydown(w){runScopeHandlers(this.view,w,"search-panel")?w.preventDefault():w.keyCode==13&&w.target==this.searchField?(w.preventDefault(),(w.shiftKey?findPrevious:findNext)(this.view)):w.keyCode==13&&w.target==this.replaceField&&(w.preventDefault(),replaceNext(this.view))}update(w){for(let O of w.transactions)for(let F of O.effects)F.is(setSearchQuery)&&!F.value.eq(this.query)&&this.setQuery(F.value)}setQuery(w){this.query=w,this.searchField.value=w.search,this.replaceField.value=w.replace,this.caseField.checked=w.caseSensitive,this.reField.checked=w.regexp,this.wordField.checked=w.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(searchConfigFacet).top}}function phrase(D,w){return D.state.phrase(w)}const AnnounceMargin=30,Break=/[\s\.,:;?!]/;function announceMatch(D,{from:w,to:O}){let F=D.state.doc.lineAt(w),q=D.state.doc.lineAt(O).to,W=Math.max(F.from,w-AnnounceMargin),U=Math.min(q,O+AnnounceMargin),K=D.state.sliceDoc(W,U);if(W!=F.from){for(let G=0;G<AnnounceMargin;G++)if(!Break.test(K[G+1])&&Break.test(K[G])){K=K.slice(G);break}}if(U!=q){for(let G=K.length-1;G>K.length-AnnounceMargin;G--)if(!Break.test(K[G-1])&&Break.test(K[G])){K=K.slice(0,G);break}}return EditorView.announce.of(`${D.state.phrase("current match")}. ${K} ${D.state.phrase("on line")} ${F.number}.`)}const baseTheme$2=EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),searchExtensions=[searchState,Prec.low(searchHighlighter),baseTheme$2];class CompletionContext{constructor(w,O,F,q){this.state=w,this.pos=O,this.explicit=F,this.view=q,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(w){let O=syntaxTree(this.state).resolveInner(this.pos,-1);for(;O&&w.indexOf(O.name)<0;)O=O.parent;return O?{from:O.from,to:this.pos,text:this.state.sliceDoc(O.from,this.pos),type:O.type}:null}matchBefore(w){let O=this.state.doc.lineAt(this.pos),F=Math.max(O.from,this.pos-250),q=O.text.slice(F-O.from,this.pos-O.from),W=q.search(ensureAnchor(w,!1));return W<0?null:{from:F+W,to:this.pos,text:q.slice(W)}}get aborted(){return this.abortListeners==null}addEventListener(w,O,F){w=="abort"&&this.abortListeners&&(this.abortListeners.push(O),F&&F.onDocChange&&(this.abortOnDocChange=!0))}}function toSet(D){let w=Object.keys(D).join(""),O=/\w/.test(w);return O&&(w=w.replace(/\w/g,"")),`[${O?"\\w":""}${w.replace(/[^\w\s]/g,"\\$&")}]`}function prefixMatch(D){let w=Object.create(null),O=Object.create(null);for(let{label:q}of D){w[q[0]]=!0;for(let W=1;W<q.length;W++)O[q[W]]=!0}let F=toSet(w)+toSet(O)+"*$";return[new RegExp("^"+F),new RegExp(F)]}function completeFromList(D){let w=D.map(q=>typeof q=="string"?{label:q}:q),[O,F]=w.every(q=>/^\w+$/.test(q.label))?[/\w*$/,/\w+$/]:prefixMatch(w);return q=>{let W=q.matchBefore(F);return W||q.explicit?{from:W?W.from:q.pos,options:w,validFor:O}:null}}class Option{constructor(w,O,F,q){this.completion=w,this.source=O,this.match=F,this.score=q}}function cur(D){return D.selection.main.from}function ensureAnchor(D,w){var O;let{source:F}=D,q=w&&F[0]!="^",W=F[F.length-1]!="$";return!q&&!W?D:new RegExp(`${q?"^":""}(?:${F})${W?"$":""}`,(O=D.flags)!==null&&O!==void 0?O:D.ignoreCase?"i":"")}const pickedCompletion=Annotation.define();function insertCompletionText(D,w,O,F){let{main:q}=D.selection,W=O-q.from,U=F-q.from;return Object.assign(Object.assign({},D.changeByRange(K=>{if(K!=q&&O!=F&&D.sliceDoc(K.from+W,K.from+U)!=D.sliceDoc(O,F))return{range:K};let G=D.toText(w);return{changes:{from:K.from+W,to:F==q.from?K.to:K.from+U,insert:G},range:EditorSelection.cursor(K.from+W+G.length)}})),{scrollIntoView:!0,userEvent:"input.complete"})}const SourceCache=new WeakMap;function asSource(D){if(!Array.isArray(D))return D;let w=SourceCache.get(D);return w||SourceCache.set(D,w=completeFromList(D)),w}const startCompletionEffect=StateEffect.define(),closeCompletionEffect=StateEffect.define();class FuzzyMatcher{constructor(w){this.pattern=w,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let O=0;O<w.length;){let F=codePointAt(w,O),q=codePointSize(F);this.chars.push(F);let W=w.slice(O,O+q),U=W.toUpperCase();this.folded.push(codePointAt(U==W?W.toLowerCase():U,0)),O+=q}this.astral=w.length!=this.chars.length}ret(w,O){return this.score=w,this.matched=O,this}match(w){if(this.pattern.length==0)return this.ret(-100,[]);if(w.length<this.pattern.length)return null;let{chars:O,folded:F,any:q,precise:W,byWord:U}=this;if(O.length==1){let se=codePointAt(w,0),le=codePointSize(se),ue=le==w.length?0:-100;if(se!=O[0])if(se==F[0])ue+=-200;else return null;return this.ret(ue,[0,le])}let K=w.indexOf(this.pattern);if(K==0)return this.ret(w.length==this.pattern.length?0:-100,[0,this.pattern.length]);let G=O.length,Y=0;if(K<0){for(let se=0,le=Math.min(w.length,200);se<le&&Y<G;){let ue=codePointAt(w,se);(ue==O[Y]||ue==F[Y])&&(q[Y++]=se),se+=codePointSize(ue)}if(Y<G)return null}let Q=0,X=0,J=!1,Z=0,ee=-1,ne=-1,te=/[a-z]/.test(w),re=!0;for(let se=0,le=Math.min(w.length,200),ue=0;se<le&&X<G;){let oe=codePointAt(w,se);K<0&&(Q<G&&oe==O[Q]&&(W[Q++]=se),Z<G&&(oe==O[Z]||oe==F[Z]?(Z==0&&(ee=se),ne=se+1,Z++):Z=0));let ae,ce=oe<255?oe>=48&&oe<=57||oe>=97&&oe<=122?2:oe>=65&&oe<=90?1:0:(ae=fromCodePoint(oe))!=ae.toLowerCase()?1:ae!=ae.toUpperCase()?2:0;(!se||ce==1&&te||ue==0&&ce!=0)&&(O[X]==oe||F[X]==oe&&(J=!0)?U[X++]=se:U.length&&(re=!1)),ue=ce,se+=codePointSize(oe)}return X==G&&U[0]==0&&re?this.result(-100+(J?-200:0),U,w):Z==G&&ee==0?this.ret(-200-w.length+(ne==w.length?0:-100),[0,ne]):K>-1?this.ret(-700-w.length,[K,K+this.pattern.length]):Z==G?this.ret(-900-w.length,[ee,ne]):X==G?this.result(-100+(J?-200:0)+-700+(re?0:-1100),U,w):O.length==2?null:this.result((q[0]?-700:0)+-200+-1100,q,w)}result(w,O,F){let q=[],W=0;for(let U of O){let K=U+(this.astral?codePointSize(codePointAt(F,U)):1);W&&q[W-1]==U?q[W-1]=K:(q[W++]=U,q[W++]=K)}return this.ret(w-F.length,q)}}class StrictMatcher{constructor(w){this.pattern=w,this.matched=[],this.score=0,this.folded=w.toLowerCase()}match(w){if(w.length<this.pattern.length)return null;let O=w.slice(0,this.pattern.length),F=O==this.pattern?0:O.toLowerCase()==this.folded?-200:null;return F==null?null:(this.matched=[0,O.length],this.score=F+(w.length==this.pattern.length?0:-100),this)}}const completionConfig=Facet.define({combine(D){return combineConfig(D,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:defaultPositionInfo,filterStrict:!1,compareCompletions:(w,O)=>w.label.localeCompare(O.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(w,O)=>w&&O,closeOnBlur:(w,O)=>w&&O,icons:(w,O)=>w&&O,tooltipClass:(w,O)=>F=>joinClass(w(F),O(F)),optionClass:(w,O)=>F=>joinClass(w(F),O(F)),addToOptions:(w,O)=>w.concat(O),filterStrict:(w,O)=>w||O})}});function joinClass(D,w){return D?w?D+" "+w:D:w}function defaultPositionInfo(D,w,O,F,q,W){let U=D.textDirection==Direction.RTL,K=U,G=!1,Y="top",Q,X,J=w.left-q.left,Z=q.right-w.right,ee=F.right-F.left,ne=F.bottom-F.top;if(K&&J<Math.min(ee,Z)?K=!1:!K&&Z<Math.min(ee,J)&&(K=!0),ee<=(K?J:Z))Q=Math.max(q.top,Math.min(O.top,q.bottom-ne))-w.top,X=Math.min(400,K?J:Z);else{G=!0,X=Math.min(400,(U?w.right:q.right-w.left)-30);let se=q.bottom-w.bottom;se>=ne||se>w.top?Q=O.bottom-w.top:(Y="bottom",Q=w.bottom-O.top)}let te=(w.bottom-w.top)/W.offsetHeight,re=(w.right-w.left)/W.offsetWidth;return{style:`${Y}: ${Q/te}px; max-width: ${X/re}px`,class:"cm-completionInfo-"+(G?U?"left-narrow":"right-narrow":K?"left":"right")}}function optionContent(D){let w=D.addToOptions.slice();return D.icons&&w.push({render(O){let F=document.createElement("div");return F.classList.add("cm-completionIcon"),O.type&&F.classList.add(...O.type.split(/\s+/g).map(q=>"cm-completionIcon-"+q)),F.setAttribute("aria-hidden","true"),F},position:20}),w.push({render(O,F,q,W){let U=document.createElement("span");U.className="cm-completionLabel";let K=O.displayLabel||O.label,G=0;for(let Y=0;Y<W.length;){let Q=W[Y++],X=W[Y++];Q>G&&U.appendChild(document.createTextNode(K.slice(G,Q)));let J=U.appendChild(document.createElement("span"));J.appendChild(document.createTextNode(K.slice(Q,X))),J.className="cm-completionMatchedText",G=X}return G<K.length&&U.appendChild(document.createTextNode(K.slice(G))),U},position:50},{render(O){if(!O.detail)return null;let F=document.createElement("span");return F.className="cm-completionDetail",F.textContent=O.detail,F},position:80}),w.sort((O,F)=>O.position-F.position).map(O=>O.render)}function rangeAroundSelected(D,w,O){if(D<=O)return{from:0,to:D};if(w<0&&(w=0),w<=D>>1){let q=Math.floor(w/O);return{from:q*O,to:(q+1)*O}}let F=Math.floor((D-w)/O);return{from:D-(F+1)*O,to:D-F*O}}class CompletionTooltip{constructor(w,O,F){this.view=w,this.stateField=O,this.applyCompletion=F,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:G=>this.placeInfo(G),key:this},this.space=null,this.currentClass="";let q=w.state.field(O),{options:W,selected:U}=q.open,K=w.state.facet(completionConfig);this.optionContent=optionContent(K),this.optionClass=K.optionClass,this.tooltipClass=K.tooltipClass,this.range=rangeAroundSelected(W.length,U,K.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(w.state),this.dom.addEventListener("mousedown",G=>{let{options:Y}=w.state.field(O).open;for(let Q=G.target,X;Q&&Q!=this.dom;Q=Q.parentNode)if(Q.nodeName=="LI"&&(X=/-(\d+)$/.exec(Q.id))&&+X[1]<Y.length){this.applyCompletion(w,Y[+X[1]]),G.preventDefault();return}}),this.dom.addEventListener("focusout",G=>{let Y=w.state.field(this.stateField,!1);Y&&Y.tooltip&&w.state.facet(completionConfig).closeOnBlur&&G.relatedTarget!=w.contentDOM&&w.dispatch({effects:closeCompletionEffect.of(null)})}),this.showOptions(W,q.id)}mount(){this.updateSel()}showOptions(w,O){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(w,O,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(w){var O;let F=w.state.field(this.stateField),q=w.startState.field(this.stateField);if(this.updateTooltipClass(w.state),F!=q){let{options:W,selected:U,disabled:K}=F.open;(!q.open||q.open.options!=W)&&(this.range=rangeAroundSelected(W.length,U,w.state.facet(completionConfig).maxRenderedOptions),this.showOptions(W,F.id)),this.updateSel(),K!=((O=q.open)===null||O===void 0?void 0:O.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!K)}}updateTooltipClass(w){let O=this.tooltipClass(w);if(O!=this.currentClass){for(let F of this.currentClass.split(" "))F&&this.dom.classList.remove(F);for(let F of O.split(" "))F&&this.dom.classList.add(F);this.currentClass=O}}positioned(w){this.space=w,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let w=this.view.state.field(this.stateField),O=w.open;if((O.selected>-1&&O.selected<this.range.from||O.selected>=this.range.to)&&(this.range=rangeAroundSelected(O.options.length,O.selected,this.view.state.facet(completionConfig).maxRenderedOptions),this.showOptions(O.options,w.id)),this.updateSelectedOption(O.selected)){this.destroyInfo();let{completion:F}=O.options[O.selected],{info:q}=F;if(!q)return;let W=typeof q=="string"?document.createTextNode(q):q(F);if(!W)return;"then"in W?W.then(U=>{U&&this.view.state.field(this.stateField,!1)==w&&this.addInfoPane(U,F)}).catch(U=>logException(this.view.state,U,"completion info")):this.addInfoPane(W,F)}}addInfoPane(w,O){this.destroyInfo();let F=this.info=document.createElement("div");if(F.className="cm-tooltip cm-completionInfo",w.nodeType!=null)F.appendChild(w),this.infoDestroy=null;else{let{dom:q,destroy:W}=w;F.appendChild(q),this.infoDestroy=W||null}this.dom.appendChild(F),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(w){let O=null;for(let F=this.list.firstChild,q=this.range.from;F;F=F.nextSibling,q++)F.nodeName!="LI"||!F.id?q--:q==w?F.hasAttribute("aria-selected")||(F.setAttribute("aria-selected","true"),O=F):F.hasAttribute("aria-selected")&&F.removeAttribute("aria-selected");return O&&scrollIntoView(this.list,O),O}measureInfo(){let w=this.dom.querySelector("[aria-selected]");if(!w||!this.info)return null;let O=this.dom.getBoundingClientRect(),F=this.info.getBoundingClientRect(),q=w.getBoundingClientRect(),W=this.space;if(!W){let U=this.dom.ownerDocument.documentElement;W={left:0,top:0,right:U.clientWidth,bottom:U.clientHeight}}return q.top>Math.min(W.bottom,O.bottom)-10||q.bottom<Math.max(W.top,O.top)+10?null:this.view.state.facet(completionConfig).positionInfo(this.view,O,q,F,W,this.dom)}placeInfo(w){this.info&&(w?(w.style&&(this.info.style.cssText=w.style),this.info.className="cm-tooltip cm-completionInfo "+(w.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(w,O,F){const q=document.createElement("ul");q.id=O,q.setAttribute("role","listbox"),q.setAttribute("aria-expanded","true"),q.setAttribute("aria-label",this.view.state.phrase("Completions")),q.addEventListener("mousedown",U=>{U.target==q&&U.preventDefault()});let W=null;for(let U=F.from;U<F.to;U++){let{completion:K,match:G}=w[U],{section:Y}=K;if(Y){let J=typeof Y=="string"?Y:Y.name;if(J!=W&&(U>F.from||F.from==0))if(W=J,typeof Y!="string"&&Y.header)q.appendChild(Y.header(Y));else{let Z=q.appendChild(document.createElement("completion-section"));Z.textContent=J}}const Q=q.appendChild(document.createElement("li"));Q.id=O+"-"+U,Q.setAttribute("role","option");let X=this.optionClass(K);X&&(Q.className=X);for(let J of this.optionContent){let Z=J(K,this.view.state,this.view,G);Z&&Q.appendChild(Z)}}return F.from&&q.classList.add("cm-completionListIncompleteTop"),F.to<w.length&&q.classList.add("cm-completionListIncompleteBottom"),q}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function completionTooltip(D,w){return O=>new CompletionTooltip(O,D,w)}function scrollIntoView(D,w){let O=D.getBoundingClientRect(),F=w.getBoundingClientRect(),q=O.height/D.offsetHeight;F.top<O.top?D.scrollTop-=(O.top-F.top)/q:F.bottom>O.bottom&&(D.scrollTop+=(F.bottom-O.bottom)/q)}function score(D){return(D.boost||0)*100+(D.apply?10:0)+(D.info?5:0)+(D.type?1:0)}function sortOptions(D,w){let O=[],F=null,q=Y=>{O.push(Y);let{section:Q}=Y.completion;if(Q){F||(F=[]);let X=typeof Q=="string"?Q:Q.name;F.some(J=>J.name==X)||F.push(typeof Q=="string"?{name:X}:Q)}},W=w.facet(completionConfig);for(let Y of D)if(Y.hasResult()){let Q=Y.result.getMatch;if(Y.result.filter===!1)for(let X of Y.result.options)q(new Option(X,Y.source,Q?Q(X):[],1e9-O.length));else{let X=w.sliceDoc(Y.from,Y.to),J,Z=W.filterStrict?new StrictMatcher(X):new FuzzyMatcher(X);for(let ee of Y.result.options)if(J=Z.match(ee.label)){let ne=ee.displayLabel?Q?Q(ee,J.matched):[]:J.matched;q(new Option(ee,Y.source,ne,J.score+(ee.boost||0)))}}}if(F){let Y=Object.create(null),Q=0,X=(J,Z)=>{var ee,ne;return((ee=J.rank)!==null&&ee!==void 0?ee:1e9)-((ne=Z.rank)!==null&&ne!==void 0?ne:1e9)||(J.name<Z.name?-1:1)};for(let J of F.sort(X))Q-=1e5,Y[J.name]=Q;for(let J of O){let{section:Z}=J.completion;Z&&(J.score+=Y[typeof Z=="string"?Z:Z.name])}}let U=[],K=null,G=W.compareCompletions;for(let Y of O.sort((Q,X)=>X.score-Q.score||G(Q.completion,X.completion))){let Q=Y.completion;!K||K.label!=Q.label||K.detail!=Q.detail||K.type!=null&&Q.type!=null&&K.type!=Q.type||K.apply!=Q.apply||K.boost!=Q.boost?U.push(Y):score(Y.completion)>score(K)&&(U[U.length-1]=Y),K=Y.completion}return U}class CompletionDialog{constructor(w,O,F,q,W,U){this.options=w,this.attrs=O,this.tooltip=F,this.timestamp=q,this.selected=W,this.disabled=U}setSelected(w,O){return w==this.selected||w>=this.options.length?this:new CompletionDialog(this.options,makeAttrs(O,w),this.tooltip,this.timestamp,w,this.disabled)}static build(w,O,F,q,W,U){if(q&&!U&&w.some(Y=>Y.isPending))return q.setDisabled();let K=sortOptions(w,O);if(!K.length)return q&&w.some(Y=>Y.isPending)?q.setDisabled():null;let G=O.facet(completionConfig).selectOnOpen?0:-1;if(q&&q.selected!=G&&q.selected!=-1){let Y=q.options[q.selected].completion;for(let Q=0;Q<K.length;Q++)if(K[Q].completion==Y){G=Q;break}}return new CompletionDialog(K,makeAttrs(F,G),{pos:w.reduce((Y,Q)=>Q.hasResult()?Math.min(Y,Q.from):Y,1e8),create:createTooltip,above:W.aboveCursor},q?q.timestamp:Date.now(),G,!1)}map(w){return new CompletionDialog(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:w.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}setDisabled(){return new CompletionDialog(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class CompletionState{constructor(w,O,F){this.active=w,this.id=O,this.open=F}static start(){return new CompletionState(none,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(w){let{state:O}=w,F=O.facet(completionConfig),W=(F.override||O.languageDataAt("autocomplete",cur(O)).map(asSource)).map(G=>(this.active.find(Q=>Q.source==G)||new ActiveSource(G,this.active.some(Q=>Q.state!=0)?1:0)).update(w,F));W.length==this.active.length&&W.every((G,Y)=>G==this.active[Y])&&(W=this.active);let U=this.open,K=w.effects.some(G=>G.is(setActiveEffect));U&&w.docChanged&&(U=U.map(w.changes)),w.selection||W.some(G=>G.hasResult()&&w.changes.touchesRange(G.from,G.to))||!sameResults(W,this.active)||K?U=CompletionDialog.build(W,O,this.id,U,F,K):U&&U.disabled&&!W.some(G=>G.isPending)&&(U=null),!U&&W.every(G=>!G.isPending)&&W.some(G=>G.hasResult())&&(W=W.map(G=>G.hasResult()?new ActiveSource(G.source,0):G));for(let G of w.effects)G.is(setSelectedEffect)&&(U=U&&U.setSelected(G.value,this.id));return W==this.active&&U==this.open?this:new CompletionState(W,this.id,U)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?baseAttrs:noAttrs}}function sameResults(D,w){if(D==w)return!0;for(let O=0,F=0;;){for(;O<D.length&&!D[O].hasResult();)O++;for(;F<w.length&&!w[F].hasResult();)F++;let q=O==D.length,W=F==w.length;if(q||W)return q==W;if(D[O++].result!=w[F++].result)return!1}}const baseAttrs={"aria-autocomplete":"list"},noAttrs={};function makeAttrs(D,w){let O={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":D};return w>-1&&(O["aria-activedescendant"]=D+"-"+w),O}const none=[];function getUpdateType(D,w){if(D.isUserEvent("input.complete")){let F=D.annotation(pickedCompletion);if(F&&w.activateOnCompletion(F))return 12}let O=D.isUserEvent("input.type");return O&&w.activateOnTyping?5:O?1:D.isUserEvent("delete.backward")?2:D.selection?8:D.docChanged?16:0}class ActiveSource{constructor(w,O,F=!1){this.source=w,this.state=O,this.explicit=F}hasResult(){return!1}get isPending(){return this.state==1}update(w,O){let F=getUpdateType(w,O),q=this;(F&8||F&16&&this.touches(w))&&(q=new ActiveSource(q.source,0)),F&4&&q.state==0&&(q=new ActiveSource(this.source,1)),q=q.updateFor(w,F);for(let W of w.effects)if(W.is(startCompletionEffect))q=new ActiveSource(q.source,1,W.value);else if(W.is(closeCompletionEffect))q=new ActiveSource(q.source,0);else if(W.is(setActiveEffect))for(let U of W.value)U.source==q.source&&(q=U);return q}updateFor(w,O){return this.map(w.changes)}map(w){return this}touches(w){return w.changes.touchesRange(cur(w.state))}}class ActiveResult extends ActiveSource{constructor(w,O,F,q,W,U){super(w,3,O),this.limit=F,this.result=q,this.from=W,this.to=U}hasResult(){return!0}updateFor(w,O){var F;if(!(O&3))return this.map(w.changes);let q=this.result;q.map&&!w.changes.empty&&(q=q.map(q,w.changes));let W=w.changes.mapPos(this.from),U=w.changes.mapPos(this.to,1),K=cur(w.state);if(K>U||!q||O&2&&(cur(w.startState)==this.from||K<this.limit))return new ActiveSource(this.source,O&4?1:0);let G=w.changes.mapPos(this.limit);return checkValid(q.validFor,w.state,W,U)?new ActiveResult(this.source,this.explicit,G,q,W,U):q.update&&(q=q.update(q,W,U,new CompletionContext(w.state,K,!1)))?new ActiveResult(this.source,this.explicit,G,q,q.from,(F=q.to)!==null&&F!==void 0?F:cur(w.state)):new ActiveSource(this.source,1,this.explicit)}map(w){return w.empty?this:(this.result.map?this.result.map(this.result,w):this.result)?new ActiveResult(this.source,this.explicit,w.mapPos(this.limit),this.result,w.mapPos(this.from),w.mapPos(this.to,1)):new ActiveSource(this.source,0)}touches(w){return w.changes.touchesRange(this.from,this.to)}}function checkValid(D,w,O,F){if(!D)return!1;let q=w.sliceDoc(O,F);return typeof D=="function"?D(q,O,F,w):ensureAnchor(D,!0).test(q)}const setActiveEffect=StateEffect.define({map(D,w){return D.map(O=>O.map(w))}}),setSelectedEffect=StateEffect.define(),completionState=StateField.define({create(){return CompletionState.start()},update(D,w){return D.update(w)},provide:D=>[showTooltip.from(D,w=>w.tooltip),EditorView.contentAttributes.from(D,w=>w.attrs)]});function applyCompletion(D,w){const O=w.completion.apply||w.completion.label;let F=D.state.field(completionState).active.find(q=>q.source==w.source);return F instanceof ActiveResult?(typeof O=="string"?D.dispatch(Object.assign(Object.assign({},insertCompletionText(D.state,O,F.from,F.to)),{annotations:pickedCompletion.of(w.completion)})):O(D,w.completion,F.from,F.to),!0):!1}const createTooltip=completionTooltip(completionState,applyCompletion);function moveCompletionSelection(D,w="option"){return O=>{let F=O.state.field(completionState,!1);if(!F||!F.open||F.open.disabled||Date.now()-F.open.timestamp<O.state.facet(completionConfig).interactionDelay)return!1;let q=1,W;w=="page"&&(W=getTooltip(O,F.open.tooltip))&&(q=Math.max(2,Math.floor(W.dom.offsetHeight/W.dom.querySelector("li").offsetHeight)-1));let{length:U}=F.open.options,K=F.open.selected>-1?F.open.selected+q*(D?1:-1):D?0:U-1;return K<0?K=w=="page"?0:U-1:K>=U&&(K=w=="page"?U-1:0),O.dispatch({effects:setSelectedEffect.of(K)}),!0}}const acceptCompletion=D=>{let w=D.state.field(completionState,!1);return D.state.readOnly||!w||!w.open||w.open.selected<0||w.open.disabled||Date.now()-w.open.timestamp<D.state.facet(completionConfig).interactionDelay?!1:applyCompletion(D,w.open.options[w.open.selected])},startCompletion=D=>D.state.field(completionState,!1)?(D.dispatch({effects:startCompletionEffect.of(!0)}),!0):!1,closeCompletion=D=>{let w=D.state.field(completionState,!1);return!w||!w.active.some(O=>O.state!=0)?!1:(D.dispatch({effects:closeCompletionEffect.of(null)}),!0)};class RunningQuery{constructor(w,O){this.active=w,this.context=O,this.time=Date.now(),this.updates=[],this.done=void 0}}const MaxUpdateCount=50,MinAbortTime=1e3,completionPlugin=ViewPlugin.fromClass(class{constructor(D){this.view=D,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let w of D.state.field(completionState).active)w.isPending&&this.startQuery(w)}update(D){let w=D.state.field(completionState),O=D.state.facet(completionConfig);if(!D.selectionSet&&!D.docChanged&&D.startState.field(completionState)==w)return;let F=D.transactions.some(W=>{let U=getUpdateType(W,O);return U&8||(W.selection||W.docChanged)&&!(U&3)});for(let W=0;W<this.running.length;W++){let U=this.running[W];if(F||U.context.abortOnDocChange&&D.docChanged||U.updates.length+D.transactions.length>MaxUpdateCount&&Date.now()-U.time>MinAbortTime){for(let K of U.context.abortListeners)try{K()}catch(G){logException(this.view.state,G)}U.context.abortListeners=null,this.running.splice(W--,1)}else U.updates.push(...D.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),D.transactions.some(W=>W.effects.some(U=>U.is(startCompletionEffect)))&&(this.pendingStart=!0);let q=this.pendingStart?50:O.activateOnTypingDelay;if(this.debounceUpdate=w.active.some(W=>W.isPending&&!this.running.some(U=>U.active.source==W.source))?setTimeout(()=>this.startUpdate(),q):-1,this.composing!=0)for(let W of D.transactions)W.isUserEvent("input.type")?this.composing=2:this.composing==2&&W.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:D}=this.view,w=D.field(completionState);for(let O of w.active)O.isPending&&!this.running.some(F=>F.active.source==O.source)&&this.startQuery(O);this.running.length&&w.open&&w.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(completionConfig).updateSyncTime))}startQuery(D){let{state:w}=this.view,O=cur(w),F=new CompletionContext(w,O,D.explicit,this.view),q=new RunningQuery(D,F);this.running.push(q),Promise.resolve(D.source(F)).then(W=>{q.context.aborted||(q.done=W||null,this.scheduleAccept())},W=>{this.view.dispatch({effects:closeCompletionEffect.of(null)}),logException(this.view.state,W)})}scheduleAccept(){this.running.every(D=>D.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(completionConfig).updateSyncTime))}accept(){var D;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let w=[],O=this.view.state.facet(completionConfig),F=this.view.state.field(completionState);for(let q=0;q<this.running.length;q++){let W=this.running[q];if(W.done===void 0)continue;if(this.running.splice(q--,1),W.done){let K=cur(W.updates.length?W.updates[0].startState:this.view.state),G=Math.min(K,W.done.from+(W.active.explicit?0:1)),Y=new ActiveResult(W.active.source,W.active.explicit,G,W.done,W.done.from,(D=W.done.to)!==null&&D!==void 0?D:K);for(let Q of W.updates)Y=Y.update(Q,O);if(Y.hasResult()){w.push(Y);continue}}let U=F.active.find(K=>K.source==W.active.source);if(U&&U.isPending)if(W.done==null){let K=new ActiveSource(W.active.source,0);for(let G of W.updates)K=K.update(G,O);K.isPending||w.push(K)}else this.startQuery(U)}(w.length||F.open&&F.open.disabled)&&this.view.dispatch({effects:setActiveEffect.of(w)})}},{eventHandlers:{blur(D){let w=this.view.state.field(completionState,!1);if(w&&w.tooltip&&this.view.state.facet(completionConfig).closeOnBlur){let O=w.open&&getTooltip(this.view,w.open.tooltip);(!O||!O.dom.contains(D.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:closeCompletionEffect.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:startCompletionEffect.of(!1)}),20),this.composing=0}}}),windows=typeof navigator=="object"&&/Win/.test(navigator.platform),commitCharacters=Prec.highest(EditorView.domEventHandlers({keydown(D,w){let O=w.state.field(completionState,!1);if(!O||!O.open||O.open.disabled||O.open.selected<0||D.key.length>1||D.ctrlKey&&!(windows&&D.altKey)||D.metaKey)return!1;let F=O.open.options[O.open.selected],q=O.active.find(U=>U.source==F.source),W=F.completion.commitCharacters||q.result.commitCharacters;return W&&W.indexOf(D.key)>-1&&applyCompletion(w,F),!1}})),baseTheme$1=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),defaults={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},closeBracketEffect=StateEffect.define({map(D,w){let O=w.mapPos(D,-1,MapMode.TrackAfter);return O??void 0}}),closedBracket=new class extends RangeValue{};closedBracket.startSide=1;closedBracket.endSide=-1;const bracketState=StateField.define({create(){return RangeSet.empty},update(D,w){if(D=D.map(w.changes),w.selection){let O=w.state.doc.lineAt(w.selection.main.head);D=D.update({filter:F=>F>=O.from&&F<=O.to})}for(let O of w.effects)O.is(closeBracketEffect)&&(D=D.update({add:[closedBracket.range(O.value,O.value+1)]}));return D}});function closeBrackets(){return[inputHandler,bracketState]}const definedClosing="()[]{}<>«»»«［］｛｝";function closing(D){for(let w=0;w<definedClosing.length;w+=2)if(definedClosing.charCodeAt(w)==D)return definedClosing.charAt(w+1);return fromCodePoint(D<128?D:D+1)}function config(D,w){return D.languageDataAt("closeBrackets",w)[0]||defaults}const android=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),inputHandler=EditorView.inputHandler.of((D,w,O,F)=>{if((android?D.composing:D.compositionStarted)||D.state.readOnly)return!1;let q=D.state.selection.main;if(F.length>2||F.length==2&&codePointSize(codePointAt(F,0))==1||w!=q.from||O!=q.to)return!1;let W=insertBracket(D.state,F);return W?(D.dispatch(W),!0):!1}),deleteBracketPair=({state:D,dispatch:w})=>{if(D.readOnly)return!1;let F=config(D,D.selection.main.head).brackets||defaults.brackets,q=null,W=D.changeByRange(U=>{if(U.empty){let K=prevChar(D.doc,U.head);for(let G of F)if(G==K&&nextChar(D.doc,U.head)==closing(codePointAt(G,0)))return{changes:{from:U.head-G.length,to:U.head+G.length},range:EditorSelection.cursor(U.head-G.length)}}return{range:q=U}});return q||w(D.update(W,{scrollIntoView:!0,userEvent:"delete.backward"})),!q},closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(D,w){let O=config(D,D.selection.main.head),F=O.brackets||defaults.brackets;for(let q of F){let W=closing(codePointAt(q,0));if(w==q)return W==q?handleSame(D,q,F.indexOf(q+q+q)>-1,O):handleOpen(D,q,W,O.before||defaults.before);if(w==W&&closedBracketAt(D,D.selection.main.from))return handleClose(D,q,W)}return null}function closedBracketAt(D,w){let O=!1;return D.field(bracketState).between(0,D.doc.length,F=>{F==w&&(O=!0)}),O}function nextChar(D,w){let O=D.sliceString(w,w+2);return O.slice(0,codePointSize(codePointAt(O,0)))}function prevChar(D,w){let O=D.sliceString(w-2,w);return codePointSize(codePointAt(O,0))==O.length?O:O.slice(1)}function handleOpen(D,w,O,F){let q=null,W=D.changeByRange(U=>{if(!U.empty)return{changes:[{insert:w,from:U.from},{insert:O,from:U.to}],effects:closeBracketEffect.of(U.to+w.length),range:EditorSelection.range(U.anchor+w.length,U.head+w.length)};let K=nextChar(D.doc,U.head);return!K||/\s/.test(K)||F.indexOf(K)>-1?{changes:{insert:w+O,from:U.head},effects:closeBracketEffect.of(U.head+w.length),range:EditorSelection.cursor(U.head+w.length)}:{range:q=U}});return q?null:D.update(W,{scrollIntoView:!0,userEvent:"input.type"})}function handleClose(D,w,O){let F=null,q=D.changeByRange(W=>W.empty&&nextChar(D.doc,W.head)==O?{changes:{from:W.head,to:W.head+O.length,insert:O},range:EditorSelection.cursor(W.head+O.length)}:F={range:W});return F?null:D.update(q,{scrollIntoView:!0,userEvent:"input.type"})}function handleSame(D,w,O,F){let q=F.stringPrefixes||defaults.stringPrefixes,W=null,U=D.changeByRange(K=>{if(!K.empty)return{changes:[{insert:w,from:K.from},{insert:w,from:K.to}],effects:closeBracketEffect.of(K.to+w.length),range:EditorSelection.range(K.anchor+w.length,K.head+w.length)};let G=K.head,Y=nextChar(D.doc,G),Q;if(Y==w){if(nodeStart(D,G))return{changes:{insert:w+w,from:G},effects:closeBracketEffect.of(G+w.length),range:EditorSelection.cursor(G+w.length)};if(closedBracketAt(D,G)){let J=O&&D.sliceDoc(G,G+w.length*3)==w+w+w?w+w+w:w;return{changes:{from:G,to:G+J.length,insert:J},range:EditorSelection.cursor(G+J.length)}}}else{if(O&&D.sliceDoc(G-2*w.length,G)==w+w&&(Q=canStartStringAt(D,G-2*w.length,q))>-1&&nodeStart(D,Q))return{changes:{insert:w+w+w+w,from:G},effects:closeBracketEffect.of(G+w.length),range:EditorSelection.cursor(G+w.length)};if(D.charCategorizer(G)(Y)!=CharCategory.Word&&canStartStringAt(D,G,q)>-1&&!probablyInString(D,G,w,q))return{changes:{insert:w+w,from:G},effects:closeBracketEffect.of(G+w.length),range:EditorSelection.cursor(G+w.length)}}return{range:W=K}});return W?null:D.update(U,{scrollIntoView:!0,userEvent:"input.type"})}function nodeStart(D,w){let O=syntaxTree(D).resolveInner(w+1);return O.parent&&O.from==w}function probablyInString(D,w,O,F){let q=syntaxTree(D).resolveInner(w,-1),W=F.reduce((U,K)=>Math.max(U,K.length),0);for(let U=0;U<5;U++){let K=D.sliceDoc(q.from,Math.min(q.to,q.from+O.length+W)),G=K.indexOf(O);if(!G||G>-1&&F.indexOf(K.slice(0,G))>-1){let Q=q.firstChild;for(;Q&&Q.from==q.from&&Q.to-Q.from>O.length+G;){if(D.sliceDoc(Q.to-O.length,Q.to)==O)return!1;Q=Q.firstChild}return!0}let Y=q.to==w&&q.parent;if(!Y)break;q=Y}return!1}function canStartStringAt(D,w,O){let F=D.charCategorizer(w);if(F(D.sliceDoc(w-1,w))!=CharCategory.Word)return w;for(let q of O){let W=w-q.length;if(D.sliceDoc(W,w)==q&&F(D.sliceDoc(W-1,W))!=CharCategory.Word)return W}return-1}function autocompletion(D={}){return[commitCharacters,completionState,completionConfig.of(D),completionPlugin,completionKeymapExt,baseTheme$1]}const completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{mac:"Alt-`",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(!0)},{key:"ArrowUp",run:moveCompletionSelection(!1)},{key:"PageDown",run:moveCompletionSelection(!0,"page")},{key:"PageUp",run:moveCompletionSelection(!1,"page")},{key:"Enter",run:acceptCompletion}],completionKeymapExt=Prec.highest(keymap.computeN([completionConfig],D=>D.facet(completionConfig).defaultKeymap?[completionKeymap]:[]));class SelectedDiagnostic{constructor(w,O,F){this.from=w,this.to=O,this.diagnostic=F}}class LintState{constructor(w,O,F){this.diagnostics=w,this.panel=O,this.selected=F}static init(w,O,F){let q=w,W=F.facet(lintConfig).markerFilter;W&&(q=W(q,F));let U=w.slice().sort((X,J)=>X.from-J.from||X.to-J.to),K=new RangeSetBuilder,G=[],Y=0;for(let X=0;;){let J=X==U.length?null:U[X];if(!J&&!G.length)break;let Z,ee;for(G.length?(Z=Y,ee=G.reduce((te,re)=>Math.min(te,re.to),J&&J.from>Z?J.from:1e8)):(Z=J.from,ee=J.to,G.push(J),X++);X<U.length;){let te=U[X];if(te.from==Z&&(te.to>te.from||te.to==Z))G.push(te),X++,ee=Math.min(te.to,ee);else{ee=Math.min(te.from,ee);break}}let ne=maxSeverity(G);if(G.some(te=>te.from==te.to||te.from==te.to-1&&F.doc.lineAt(te.from).to==te.from))K.add(Z,Z,Decoration.widget({widget:new DiagnosticWidget(ne),diagnostics:G.slice()}));else{let te=G.reduce((re,se)=>se.markClass?re+" "+se.markClass:re,"");K.add(Z,ee,Decoration.mark({class:"cm-lintRange cm-lintRange-"+ne+te,diagnostics:G.slice(),inclusiveEnd:G.some(re=>re.to>ee)}))}Y=ee;for(let te=0;te<G.length;te++)G[te].to<=Y&&G.splice(te--,1)}let Q=K.finish();return new LintState(Q,O,findDiagnostic(Q))}}function findDiagnostic(D,w=null,O=0){let F=null;return D.between(O,1e9,(q,W,{spec:U})=>{if(!(w&&U.diagnostics.indexOf(w)<0))if(!F)F=new SelectedDiagnostic(q,W,w||U.diagnostics[0]);else{if(U.diagnostics.indexOf(F.diagnostic)<0)return!1;F=new SelectedDiagnostic(F.from,W,F.diagnostic)}}),F}function hideTooltip(D,w){let O=w.pos,F=w.end||O,q=D.state.facet(lintConfig).hideOn(D,O,F);if(q!=null)return q;let W=D.startState.doc.lineAt(w.pos);return!!(D.effects.some(U=>U.is(setDiagnosticsEffect))||D.changes.touchesRange(W.from,Math.max(W.to,F)))}function maybeEnableLint(D,w){return D.field(lintState,!1)?w:w.concat(StateEffect.appendConfig.of(lintExtensions))}const setDiagnosticsEffect=StateEffect.define(),togglePanel=StateEffect.define(),movePanelSelection=StateEffect.define(),lintState=StateField.define({create(){return new LintState(Decoration.none,null,null)},update(D,w){if(w.docChanged&&D.diagnostics.size){let O=D.diagnostics.map(w.changes),F=null,q=D.panel;if(D.selected){let W=w.changes.mapPos(D.selected.from,1);F=findDiagnostic(O,D.selected.diagnostic,W)||findDiagnostic(O,null,W)}!O.size&&q&&w.state.facet(lintConfig).autoPanel&&(q=null),D=new LintState(O,q,F)}for(let O of w.effects)if(O.is(setDiagnosticsEffect)){let F=w.state.facet(lintConfig).autoPanel?O.value.length?LintPanel.open:null:D.panel;D=LintState.init(O.value,F,w.state)}else O.is(togglePanel)?D=new LintState(D.diagnostics,O.value?LintPanel.open:null,D.selected):O.is(movePanelSelection)&&(D=new LintState(D.diagnostics,D.panel,O.value));return D},provide:D=>[showPanel.from(D,w=>w.panel),EditorView.decorations.from(D,w=>w.diagnostics)]}),activeMark=Decoration.mark({class:"cm-lintRange cm-lintRange-active"});function lintTooltip(D,w,O){let{diagnostics:F}=D.state.field(lintState),q,W=-1,U=-1;F.between(w-(O<0?1:0),w+(O>0?1:0),(G,Y,{spec:Q})=>{if(w>=G&&w<=Y&&(G==Y||(w>G||O>0)&&(w<Y||O<0)))return q=Q.diagnostics,W=G,U=Y,!1});let K=D.state.facet(lintConfig).tooltipFilter;return q&&K&&(q=K(q,D.state)),q?{pos:W,end:U,above:D.state.doc.lineAt(W).to<U,create(){return{dom:diagnosticsTooltip(D,q)}}}:null}function diagnosticsTooltip(D,w){return crelt("ul",{class:"cm-tooltip-lint"},w.map(O=>renderDiagnostic(D,O,!1)))}const openLintPanel=D=>{let w=D.state.field(lintState,!1);(!w||!w.panel)&&D.dispatch({effects:maybeEnableLint(D.state,[togglePanel.of(!0)])});let O=getPanel(D,LintPanel.open);return O&&O.dom.querySelector(".cm-panel-lint ul").focus(),!0},closeLintPanel=D=>{let w=D.state.field(lintState,!1);return!w||!w.panel?!1:(D.dispatch({effects:togglePanel.of(!1)}),!0)},nextDiagnostic=D=>{let w=D.state.field(lintState,!1);if(!w)return!1;let O=D.state.selection.main,F=w.diagnostics.iter(O.to+1);return!F.value&&(F=w.diagnostics.iter(0),!F.value||F.from==O.from&&F.to==O.to)?!1:(D.dispatch({selection:{anchor:F.from,head:F.to},scrollIntoView:!0}),!0)},lintKeymap=[{key:"Mod-Shift-m",run:openLintPanel,preventDefault:!0},{key:"F8",run:nextDiagnostic}],lintConfig=Facet.define({combine(D){return Object.assign({sources:D.map(w=>w.source).filter(w=>w!=null)},combineConfig(D.map(w=>w.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(w,O)=>w?O?F=>w(F)||O(F):w:O}))}});function assignKeys(D){let w=[];if(D)e:for(let{name:O}of D){for(let F=0;F<O.length;F++){let q=O[F];if(/[a-zA-Z]/.test(q)&&!w.some(W=>W.toLowerCase()==q.toLowerCase())){w.push(q);continue e}}w.push("")}return w}function renderDiagnostic(D,w,O){var F;let q=O?assignKeys(w.actions):[];return crelt("li",{class:"cm-diagnostic cm-diagnostic-"+w.severity},crelt("span",{class:"cm-diagnosticText"},w.renderMessage?w.renderMessage(D):w.message),(F=w.actions)===null||F===void 0?void 0:F.map((W,U)=>{let K=!1,G=J=>{if(J.preventDefault(),K)return;K=!0;let Z=findDiagnostic(D.state.field(lintState).diagnostics,w);Z&&W.apply(D,Z.from,Z.to)},{name:Y}=W,Q=q[U]?Y.indexOf(q[U]):-1,X=Q<0?Y:[Y.slice(0,Q),crelt("u",Y.slice(Q,Q+1)),Y.slice(Q+1)];return crelt("button",{type:"button",class:"cm-diagnosticAction",onclick:G,onmousedown:G,"aria-label":` Action: ${Y}${Q<0?"":` (access key "${q[U]})"`}.`},X)}),w.source&&crelt("div",{class:"cm-diagnosticSource"},w.source))}class DiagnosticWidget extends WidgetType{constructor(w){super(),this.sev=w}eq(w){return w.sev==this.sev}toDOM(){return crelt("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class PanelItem{constructor(w,O){this.diagnostic=O,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=renderDiagnostic(w,O,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class LintPanel{constructor(w){this.view=w,this.items=[];let O=q=>{if(q.keyCode==27)closeLintPanel(this.view),this.view.focus();else if(q.keyCode==38||q.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(q.keyCode==40||q.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(q.keyCode==36)this.moveSelection(0);else if(q.keyCode==35)this.moveSelection(this.items.length-1);else if(q.keyCode==13)this.view.focus();else if(q.keyCode>=65&&q.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:W}=this.items[this.selectedIndex],U=assignKeys(W.actions);for(let K=0;K<U.length;K++)if(U[K].toUpperCase().charCodeAt(0)==q.keyCode){let G=findDiagnostic(this.view.state.field(lintState).diagnostics,W);G&&W.actions[K].apply(w,G.from,G.to)}}else return;q.preventDefault()},F=q=>{for(let W=0;W<this.items.length;W++)this.items[W].dom.contains(q.target)&&this.moveSelection(W)};this.list=crelt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:O,onclick:F}),this.dom=crelt("div",{class:"cm-panel-lint"},this.list,crelt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>closeLintPanel(this.view)},"×")),this.update()}get selectedIndex(){let w=this.view.state.field(lintState).selected;if(!w)return-1;for(let O=0;O<this.items.length;O++)if(this.items[O].diagnostic==w.diagnostic)return O;return-1}update(){let{diagnostics:w,selected:O}=this.view.state.field(lintState),F=0,q=!1,W=null,U=new Set;for(w.between(0,this.view.state.doc.length,(K,G,{spec:Y})=>{for(let Q of Y.diagnostics){if(U.has(Q))continue;U.add(Q);let X=-1,J;for(let Z=F;Z<this.items.length;Z++)if(this.items[Z].diagnostic==Q){X=Z;break}X<0?(J=new PanelItem(this.view,Q),this.items.splice(F,0,J),q=!0):(J=this.items[X],X>F&&(this.items.splice(F,X-F),q=!0)),O&&J.diagnostic==O.diagnostic?J.dom.hasAttribute("aria-selected")||(J.dom.setAttribute("aria-selected","true"),W=J):J.dom.hasAttribute("aria-selected")&&J.dom.removeAttribute("aria-selected"),F++}});F<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)q=!0,this.items.pop();this.items.length==0&&(this.items.push(new PanelItem(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),q=!0),W?(this.list.setAttribute("aria-activedescendant",W.id),this.view.requestMeasure({key:this,read:()=>({sel:W.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:K,panel:G})=>{let Y=G.height/this.list.offsetHeight;K.top<G.top?this.list.scrollTop-=(G.top-K.top)/Y:K.bottom>G.bottom&&(this.list.scrollTop+=(K.bottom-G.bottom)/Y)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),q&&this.sync()}sync(){let w=this.list.firstChild;function O(){let F=w;w=F.nextSibling,F.remove()}for(let F of this.items)if(F.dom.parentNode==this.list){for(;w!=F.dom;)O();w=F.dom.nextSibling}else this.list.insertBefore(F.dom,w);for(;w;)O()}moveSelection(w){if(this.selectedIndex<0)return;let O=this.view.state.field(lintState),F=findDiagnostic(O.diagnostics,this.items[w].diagnostic);F&&this.view.dispatch({selection:{anchor:F.from,head:F.to},scrollIntoView:!0,effects:movePanelSelection.of(F)})}static open(w){return new LintPanel(w)}}function svg(D,w='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${w}>${encodeURIComponent(D)}</svg>')`}function underline(D){return svg(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${D}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const baseTheme=EditorView.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:underline("#d11")},".cm-lintRange-warning":{backgroundImage:underline("orange")},".cm-lintRange-info":{backgroundImage:underline("#999")},".cm-lintRange-hint":{backgroundImage:underline("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function severityWeight(D){return D=="error"?4:D=="warning"?3:D=="info"?2:1}function maxSeverity(D){let w="hint",O=1;for(let F of D){let q=severityWeight(F.severity);q>O&&(O=q,w=F.severity)}return w}const lintExtensions=[lintState,EditorView.decorations.compute([lintState],D=>{let{selected:w,panel:O}=D.field(lintState);return!w||!O||w.from==w.to?Decoration.none:Decoration.set([activeMark.range(w.from,w.to)])}),hoverTooltip(lintTooltip,{hideOn:hideTooltip}),baseTheme],basicSetup=[lineNumbers(),highlightActiveLineGutter(),highlightSpecialChars(),history(),foldGutter(),drawSelection(),dropCursor(),EditorState.allowMultipleSelections.of(!0),indentOnInput(),syntaxHighlighting(defaultHighlightStyle,{fallback:!0}),bracketMatching(),closeBrackets(),autocompletion(),rectangularSelection(),crosshairCursor(),highlightActiveLine(),highlightSelectionMatches(),keymap.of([...closeBracketsKeymap,...defaultKeymap,...searchKeymap,...historyKeymap,...foldKeymap,...completionKeymap,...lintKeymap])];var BUILTIN="builtin",COMMENT="comment",STRING="string",SYMBOL="symbol",ATOM="atom",NUMBER="number",BRACKET="bracket",INDENT_WORD_SKIP=2;function makeKeywords(D){for(var w={},O=D.split(" "),F=0;F<O.length;++F)w[O[F]]=!0;return w}var keywords=makeKeywords("λ case-lambda call/cc class cond-expand define-class define-values exit-handler field import inherit init-field interface let*-values let-values let/ec mixin opt-lambda override protect provide public rename require require-for-syntax syntax syntax-case syntax-error unit/sig unless when with-syntax and begin call-with-current-continuation call-with-input-file call-with-output-file case cond define define-syntax define-macro defmacro delay do dynamic-wind else for-each if lambda let let* let-syntax letrec letrec-syntax map or syntax-rules abs acos angle append apply asin assoc assq assv atan boolean? caar cadr call-with-input-file call-with-output-file call-with-values car cdddar cddddr cdr ceiling char->integer char-alphabetic? char-ci<=? char-ci<? char-ci=? char-ci>=? char-ci>? char-downcase char-lower-case? char-numeric? char-ready? char-upcase char-upper-case? char-whitespace? char<=? char<? char=? char>=? char>? char? close-input-port close-output-port complex? cons cos current-input-port current-output-port denominator display eof-object? eq? equal? eqv? eval even? exact->inexact exact? exp expt #f floor force gcd imag-part inexact->exact inexact? input-port? integer->char integer? interaction-environment lcm length list list->string list->vector list-ref list-tail list? load log magnitude make-polar make-rectangular make-string make-vector max member memq memv min modulo negative? newline not null-environment null? number->string number? numerator odd? open-input-file open-output-file output-port? pair? peek-char port? positive? procedure? quasiquote quote quotient rational? rationalize read read-char real-part real? remainder reverse round scheme-report-environment set! set-car! set-cdr! sin sqrt string string->list string->number string->symbol string-append string-ci<=? string-ci<? string-ci=? string-ci>=? string-ci>? string-copy string-fill! string-length string-ref string-set! string<=? string<? string=? string>=? string>? string? substring symbol->string symbol? #t tan transcript-off transcript-on truncate values vector vector->list vector-fill! vector-length vector-ref vector-set! with-input-from-file with-output-to-file write write-char zero?"),indentKeys=makeKeywords("define let letrec let* lambda define-macro defmacro let-syntax letrec-syntax let-values let*-values define-syntax syntax-rules define-values when unless");function stateStack(D,w,O){this.indent=D,this.type=w,this.prev=O}function pushStack(D,w,O){D.indentStack=new stateStack(w,O,D.indentStack)}function popStack(D){D.indentStack=D.indentStack.prev}var binaryMatcher=new RegExp(/^(?:[-+]i|[-+][01]+#*(?:\/[01]+#*)?i|[-+]?[01]+#*(?:\/[01]+#*)?@[-+]?[01]+#*(?:\/[01]+#*)?|[-+]?[01]+#*(?:\/[01]+#*)?[-+](?:[01]+#*(?:\/[01]+#*)?)?i|[-+]?[01]+#*(?:\/[01]+#*)?)(?=[()\s;"]|$)/i),octalMatcher=new RegExp(/^(?:[-+]i|[-+][0-7]+#*(?:\/[0-7]+#*)?i|[-+]?[0-7]+#*(?:\/[0-7]+#*)?@[-+]?[0-7]+#*(?:\/[0-7]+#*)?|[-+]?[0-7]+#*(?:\/[0-7]+#*)?[-+](?:[0-7]+#*(?:\/[0-7]+#*)?)?i|[-+]?[0-7]+#*(?:\/[0-7]+#*)?)(?=[()\s;"]|$)/i),hexMatcher=new RegExp(/^(?:[-+]i|[-+][\da-f]+#*(?:\/[\da-f]+#*)?i|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?@[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?[-+](?:[\da-f]+#*(?:\/[\da-f]+#*)?)?i|[-+]?[\da-f]+#*(?:\/[\da-f]+#*)?)(?=[()\s;"]|$)/i),decimalMatcher=new RegExp(/^(?:[-+]i|[-+](?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)i|[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)@[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)|[-+]?(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)[-+](?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*)?i|(?:(?:(?:\d+#+\.?#*|\d+\.\d*#*|\.\d+#*|\d+)(?:[esfdl][-+]?\d+)?)|\d+#*\/\d+#*))(?=[()\s;"]|$)/i);function isBinaryNumber(D){return D.match(binaryMatcher)}function isOctalNumber(D){return D.match(octalMatcher)}function isDecimalNumber(D,w){return w===!0&&D.backUp(1),D.match(decimalMatcher)}function isHexNumber(D){return D.match(hexMatcher)}function processEscapedSequence(D,w){for(var O,F=!1;(O=D.next())!=null;){if(O==w.token&&!F){w.state.mode=!1;break}F=!F&&O=="\\"}}const scheme={name:"scheme",startState:function(){return{indentStack:null,indentation:0,mode:!1,sExprComment:!1,sExprQuote:!1}},token:function(D,w){if(w.indentStack==null&&D.sol()&&(w.indentation=D.indentation()),D.eatSpace())return null;var O=null;switch(w.mode){case"string":processEscapedSequence(D,{token:'"',state:w}),O=STRING;break;case"symbol":processEscapedSequence(D,{token:"|",state:w}),O=SYMBOL;break;case"comment":for(var F,q=!1;(F=D.next())!=null;){if(F=="#"&&q){w.mode=!1;break}q=F=="|"}O=COMMENT;break;case"s-expr-comment":if(w.mode=!1,D.peek()=="("||D.peek()=="[")w.sExprComment=0;else{D.eatWhile(/[^\s\(\)\[\]]/),O=COMMENT;break}default:var W=D.next();if(W=='"')w.mode="string",O=STRING;else if(W=="'")D.peek()=="("||D.peek()=="["?(typeof w.sExprQuote!="number"&&(w.sExprQuote=0),O=ATOM):(D.eatWhile(/[\w_\-!$%&*+\.\/:<=>?@\^~]/),O=ATOM);else if(W=="|")w.mode="symbol",O=SYMBOL;else if(W=="#")if(D.eat("|"))w.mode="comment",O=COMMENT;else if(D.eat(/[tf]/i))O=ATOM;else if(D.eat(";"))w.mode="s-expr-comment",O=COMMENT;else{var U=null,K=!1,G=!0;D.eat(/[ei]/i)?K=!0:D.backUp(1),D.match(/^#b/i)?U=isBinaryNumber:D.match(/^#o/i)?U=isOctalNumber:D.match(/^#x/i)?U=isHexNumber:D.match(/^#d/i)?U=isDecimalNumber:D.match(/^[-+0-9.]/,!1)?(G=!1,U=isDecimalNumber):K||D.eat("#"),U!=null&&(G&&!K&&D.match(/^#[ei]/i),U(D)&&(O=NUMBER))}else if(/^[-+0-9.]/.test(W)&&isDecimalNumber(D,!0))O=NUMBER;else if(W==";")D.skipToEnd(),O=COMMENT;else if(W=="("||W=="["){for(var Y="",Q=D.column(),X;(X=D.eat(/[^\s\(\[\;\)\]]/))!=null;)Y+=X;Y.length>0&&indentKeys.propertyIsEnumerable(Y)?pushStack(w,Q+INDENT_WORD_SKIP,W):(D.eatSpace(),D.eol()||D.peek()==";"?pushStack(w,Q+1,W):pushStack(w,Q+D.current().length,W)),D.backUp(D.current().length-1),typeof w.sExprComment=="number"&&w.sExprComment++,typeof w.sExprQuote=="number"&&w.sExprQuote++,O=BRACKET}else W==")"||W=="]"?(O=BRACKET,w.indentStack!=null&&w.indentStack.type==(W==")"?"(":"[")&&(popStack(w),typeof w.sExprComment=="number"&&--w.sExprComment==0&&(O=COMMENT,w.sExprComment=!1),typeof w.sExprQuote=="number"&&--w.sExprQuote==0&&(O=ATOM,w.sExprQuote=!1))):(D.eatWhile(/[\w_\-!$%&*+\.\/:<=>?@\^~]/),keywords&&keywords.propertyIsEnumerable(D.current())?O=BUILTIN:O="variable")}return typeof w.sExprComment=="number"?COMMENT:typeof w.sExprQuote=="number"?ATOM:O},indent:function(D){return D.indentStack==null?D.indentation:D.indentStack.indent},languageData:{closeBrackets:{brackets:["(","[","{",'"']},commentTokens:{line:";;"}}},TopEnv={},CoreEnv={},nil={toString:function(){return"nil"},to_write:function(){return"()"},to_array:function(){return[]},length:function(){return 0}},undef=new Object;undef.toString=function(){return"#<undef>"};const max_trace_size=40,suppress_deprecation_warning=!1,VERSION="0.8.0",GitCommit="1a7b75fad71bb75b53a95c65336a18c5f1559fe9";var idCounter=0;function uniqueId(D){var w=++idCounter+"";return D?D+w:w}const escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function escape(D){return Object.entries(escapeMap).reduce((w,[O,F])=>w.replaceAll(O,F),D)}const Symbols={};class BiwaSymbol{constructor(w){this.name=w,Symbols[w]=this}inspect(){return"'"+this.name}toString(){return"'"+this.name}to_write(){return this.name}}const Sym=function(D,w){return Symbols[D]===void 0?new BiwaSymbol(D):Symbols[D]instanceof BiwaSymbol?Symbols[D]:new BiwaSymbol(D)},gensym=function(D="__gensym"){return Sym(uniqueId(D))};class Pause{constructor(w){this.on_pause=w}set_state(w,O,F,q,W){this.interpreter=w,this.x=O,this.f=F,this.c=q,this.s=W}ready(){this.on_pause(this)}resume(w){return this.interpreter.resume(!0,w,this.x,this.f,this.c,this.s)}}const eof=new Object;class Port{constructor(w,O){this.is_open=!0,this.is_binary=!1,this.is_input=w,this.is_output=O}close(){this.is_open=!1}inspect(){return"#<Port>"}to_write(){return"#<Port>"}}Port.StringOutput=class extends Port{constructor(){super(!1,!0),this.buffer=[]}put_string(D){this.buffer.push(D)}output_string(D){return this.buffer.join("")}};Port.StringInput=class extends Port{constructor(D){super(!0,!1),this.str=D}get_string(D){return D(this.str)}};Port.NullInput=class extends Port{constructor(){super(!0,!1)}get_string(D){return D("")}};Port.NullOutput=class extends Port{constructor(D){super(!1,!0),this.output_function=D}put_string(D){}};Port.CustomOutput=class extends Port{constructor(D){super(!1,!0),this.output_function=D}put_string(D){this.output_function(D)}};Port.CustomInput=class extends Port{constructor(D){super(!0,!1),this.input_function=D}get_string(D){var w=this.input_function;return new Pause(function(O){w(function(F){O.resume(D(F))})})}};Port.current_input=new Port.NullInput;Port.current_output=new Port.NullOutput;Port.current_error=new Port.NullOutput;class Closure{constructor(w,O,F,q){this.body=w,this.freevars=O,this.dotpos=F,this.expected_args=q}to_write(){return"#<Closure>"}}const isClosure=function(D){return D instanceof Closure},isNil=function(D){return D===nil},isUndef=function(D){return D===undef},isBoolean=D=>typeof D=="boolean",isString=D=>typeof D=="string",isFunction=D=>typeof D=="function",isSymbol=function(D){return D instanceof BiwaSymbol},isPort=function(D){return D instanceof Port},isVector=function(D){return D instanceof Array},isProcedure=function(D){return isClosure(D)||typeof D=="function"},lt=function(D,w){return typeof D!=typeof w?compareFn(typeof D,typeof w):D<w};class BiwaError extends Error{constructor(w,O=null){const F=O===null?"":`: ${to_write$1(O)}`,q=`${w}${F}`;super(q),this.form=O}toString(){return this.message}}class Bug extends BiwaError{constructor(w){super("[BUG] "+w)}}class UserError extends BiwaError{constructor(w){this.message=w}}class BiwaSet{constructor(){this.arr=[];var w;for(w=0;w<arguments.length;w++)this.arr[w]=arguments[w]}equals(w){if(this.arr.length!=w.arr.length)return!1;var O=[...this.arr],F=[...w.arr];O.sort(),F.sort();for(var q=0;q<this.arr.length;q++)if(O[q]!=F[q])return!1;return!0}set_cons(w){var O=new BiwaSet(w);return O.arr=[...this.arr],O.arr.push(w),O}set_union(){var w=new BiwaSet;w.arr=[...this.arr];for(var O=0;O<arguments.length;O++){var F=arguments[O];if(!(F instanceof BiwaSet))throw new BiwaError("set_union: arguments must be a set");for(var q=0;q<F.arr.length;q++)w.add(F.arr[q])}return w}set_intersect(w){if(!(w instanceof BiwaSet))throw new BiwaError("set_intersect: arguments must be a set");for(var O=new BiwaSet,F=0;F<this.arr.length;F++)w.member(this.arr[F])&&O.add(this.arr[F]);return O}set_minus(w){if(!(w instanceof BiwaSet))throw new BiwaError("set_minus: arguments must be a set");for(var O=new BiwaSet,F=0;F<this.arr.length;F++)w.member(this.arr[F])||O.add(this.arr[F]);return O}add(w){this.member(w)||this.arr.push(w)}member(w){for(var O=0;O<this.arr.length;O++)if(this.arr[O]==w)return!0;return!1}rindex(w){for(var O=this.arr.length-1;O>=0;O--)if(this.arr[O]==w)return this.arr.length-1-O;return null}index(w){for(var O=0;O<this.arr.length;O++)if(this.arr[O]==w)return O;return null}inspect(){return"Set("+this.arr.join(", ")+")"}toString(){return this.inspect()}size(){return this.arr.length}}class Pair{constructor(w,O){this.car=w,this.cdr=O}caar(w){return this._get(["car","car"],w)}cadr(w){return this._get(["cdr","car"],w)}cdar(w){return this._get(["car","cdr"],w)}cddr(w){return this._get(["cdr","cdr"],w)}_get(w,O="unexpected"){let F=this;for(const q of w)if(F.hasOwnProperty(q))F=F[q];else throw O;return F}first(){return this.car}second(){return this.cdr.car}third(){return this.cdr.cdr.car}fourth(){return this.cdr.cdr.cdr.car}fifth(){return this.cdr.cdr.cdr.cdr.car}to_array(){for(var w=[],O=this;O instanceof Pair;O=O.cdr)w.push(O.car);return w}length(){for(var w=0,O=this;O instanceof Pair;O=O.cdr)w++;return w}last_cdr(){var w;for(w=this;w instanceof Pair;w=w.cdr);return w}forEach(w){for(var O=this;O instanceof Pair;O=O.cdr)w(O.car);return O}foreach(w){for(var O=this;O instanceof Pair;O=O.cdr)w(O.car);return O}map(w){for(var O=[],F=this;isPair(F);F=F.cdr)O.push(w(F.car));return O}mapList(w){return array_to_list(this.map(w))}async mapAsync(w){const O=[];for(var F=this;isPair(F);F=F.cdr)O.push(await w(F.car));return array_to_list(O)}concat(w){for(var O=this;O instanceof Pair&&O.cdr!=nil;)O=O.cdr;return O.cdr=w,this}inspect(w){w||(w=inspect);var O=[],F=this.foreach(function(q){O.push(w(q))});return F!=nil&&(O.push("."),O.push(w(F))),"("+O.join(" ")+")"}toString(){return this.inspect()}to_display(w){return this.inspect(w)}to_write(){return this.inspect(to_write$1)}}const isPair=function(D){return D instanceof Pair},isList=function(D){if(D===nil)return!0;if(!(D instanceof Pair))return!1;for(var w=D,O=D.cdr;;){if(O===nil)return!0;if(O===w||!(O instanceof Pair))return!1;if(O.cdr===nil)return!0;if(!(O.cdr instanceof Pair))return!1;O=O.cdr.cdr,w=w.cdr}},array_to_list_=function(D,w){for(var O=nil,F=D.length-1;F>=0;F--){var q=D[F];w&&Array.isArray(q)&&!q.is_vector&&(q=array_to_list_(q,w)),O=new Pair(q,O)}return O},List=function(){var D=Array.from(arguments);return array_to_list_(D,!1)},array_to_list=function(D){return array_to_list_(D,!1)},deep_array_to_list=function(D){return array_to_list_(D,!0)},Cons=function(D,w){return new Pair(D,w)},js_obj_to_alist=function(D){if(D===void 0)return nil;var w=[];Object.keys(D).forEach(function(F){w.push(new Pair(F,D[F]))});var O=array_to_list(w);return O},alist_to_js_obj=function(D){if(D===nil)return{};var w={};return D.foreach(function(O){w[O.car]=O.cdr}),w},truncate=function(D,w){return D.length>w?D.slice(0,w)+"...":D},write_simple=function(D){if(D===void 0)return"undefined";if(D===null)return"null";if(typeof D=="function")return"#<Function "+(D.fname?D.fname:D.toSource?truncate(D.toSource(),40):"")+">";if(typeof D=="string")return'"'+D.replace(/\\|\"/g,function(w){return"\\"+w}).replace(/\x07/g,"\\a").replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\v/g,"\\v").replace(/\f/g,"\\f").replace(/\r/g,"\\r")+'"';if(Array.isArray(D))return"#("+D.map(function(w){return write_simple(w)}).join(" ")+")";if(typeof D.to_write=="function")return D.to_write();if(isNaN(D)&&typeof D=="number")return"+nan.0";switch(D){case!0:return"#t";case!1:return"#f";case 1/0:return"+inf.0";case-1/0:return"-inf.0"}return inspect(D)},to_display=function(D){return typeof D>"u"?"undefined":D===null?"null":D.to_display?D.to_display(to_display):typeof D.valueOf()=="string"?D:D instanceof BiwaSymbol?D.name:D instanceof Array?"#("+D.map(to_display).join(" ")+")":write_simple(D)},inspect=function(D,w){try{return typeof D>"u"?"undefined":D===null?"null":D===!0?"#t":D===!1?"#f":D.inspect?D.inspect():typeof D=="string"?'"'+D.replace(/"/g,'\\"')+'"':Array.isArray(D)?"["+D.map(inspect).join(", ")+"]":w&&w.fallback?w.fallback:D.toString()}catch(O){if(O instanceof RangeError)return"...";throw O}};function write(D){const w=_preprocess(D);return w.cyclic?_write_shared(D,w):write_simple(D)}function _preprocess(D){const w={objs:new Set,shared_objs:new Set,parents:new Set,cyclic:!1};_gather_information(D,w);const O=new Map;for(const q of w.shared_objs)O.set(q,null);return{ids:O,last_id:-1,cyclic:w.cyclic}}function _gather_information(D,w){if(w.parents.has(D)&&(w.cyclic=!0),!w.shared_objs.has(D)){if(w.objs.has(D)){w.shared_objs.add(D);return}w.objs.add(D),isPair(D)?(w.parents.add(D),_gather_information(D.car,w),_gather_information(D.cdr,w),w.parents.delete(D)):isVector(D)&&(w.parents.add(D),D.forEach(O=>{_gather_information(O,w)}),w.parents.delete(D))}}function write_shared(D){const w=_preprocess(D);return _write_shared(D,w)}function _write_shared(D,w){let O="";if(w.ids.has(D)){const F=w.ids.get(D);if(F===null){const q=w.last_id+1;w.ids.set(D,q),w.last_id=q,O+=`#${q}=`}else return`#${F}#`}if(isPair(D)){const F=[];F.push(_write_shared(D.car,w));for(let q=D.cdr;q!==nil;q=q.cdr){if(!isPair(q)||w.ids.has(q)){F.push("."),F.push(_write_shared(q,w));break}F.push(_write_shared(q.car,w))}O+="("+F.join(" ")+")"}else if(isVector(D)){const F=D.map(q=>_write_shared(q,w));O+="#("+F.join(" ")+")"}else O+=write_simple(D);return O}const to_write$1=write,eq=function(D,w){return D===w},eqv=function(D,w){return D==w&&typeof D==typeof w},equal=function(D,w){return to_write$1(D)==to_write$1(w)},Chars={};class Char{constructor(w){Chars[this.value=w]=this}to_write(){switch(this.value){case`
`:return"#\\newline";case" ":return"#\\space";case"	":return"#\\tab";default:return"#\\"+this.value}}to_display(){return this.value}inspect(){return this.to_write()}}Char.get=function(D){if(typeof D!="string")throw new Bug("Char.get: "+inspect(D)+" is not a string");return Chars[D]===void 0?new Char(D):Chars[D]};const isChar=function(D){return D instanceof Char};class Call{constructor(w,O,F){this.proc=w,this.args=O,this.after=F||function(q){return q[0]}}inspect(){return"#<Call args="+this.args.inspect()+">"}toString(){return"#<Call>"}to_write(){return"#<Call>"}}const Iterator={ForArray:class{constructor(D){this.arr=D,this.i=0}has_next(){return this.i<this.arr.length}next(){return this.arr[this.i++]}},ForString:class{constructor(D){this.str=D,this.i=0}has_next(){return this.i<this.str.length}next(){return Char.get(this.str.charAt(this.i++))}},ForList:class{constructor(D){this.ls=D}has_next(){return this.ls instanceof Pair&&this.ls!=nil}next(){var D=this.ls;return this.ls=this.ls.cdr,D}},ForMulti:class{constructor(D){this.objs=D,this.size=D.length,this.iterators=D.map(function(w){return Iterator.of(w)})}has_next(){for(var D=0;D<this.size;D++)if(!this.iterators[D].has_next())return!1;return!0}next(){return this.iterators.map(function(D){return D.next()})}},of:function(D){switch(!0){case D instanceof Array:return new this.ForArray(D);case typeof D=="string":return new this.ForString(D);case D instanceof Pair:case D===nil:return new this.ForList(D);default:throw new Bug("Iterator.of: unknown class: "+inspect(D))}}};Call.default_callbacks={call:function(D){return new Call(this.proc,[D])},result:function(){},finish:function(){}};Call.foreach=function(D,w,O){O||(O=!1),["call","result","finish"].forEach(function(U){w[U]||(w[U]=Call.default_callbacks[U])});var F=null,q=null,W=function(U){if(F){var K=w.result(U[0],q);if(K!==void 0)return K}else O?F=new Iterator.ForMulti(D):F=Iterator.of(D);if(F.has_next()){q=F.next();var G=w.call(q);return G.after=W,G}else return w.finish()};return W(null)};Call.multi_foreach=function(D,w){return Call.foreach(D,w,!0)};class Syntax{constructor(w,O){this.sname=w,this.func=O}transform(w){if(!this.func)throw new Bug("sorry, syntax "+this.sname+" is a pseudo syntax now");return this.func(w)}inspect(){return"#<Syntax "+this.sname+">"}}CoreEnv.define=new Syntax("define");CoreEnv.begin=new Syntax("begin");CoreEnv.quote=new Syntax("quote");CoreEnv.lambda=new Syntax("lambda");CoreEnv.if=new Syntax("if");CoreEnv["set!"]=new Syntax("set!");class VMCode{constructor(w){if(!isVector(w))throw console.error(w),"not array";this.il=w}to_write(){return"#<VMCode>"}}class Compiler{constructor(){}is_tail(w){return w[0]=="return"}collect_free(w,O,F){for(var q=w,W=F,U=q.arr,K=0;K<U.length;K++)W=this.compile_refer(U[K],O,["argument",W]);return W}compile_refer(w,O,F){return this.compile_lookup(w,O,function(q){return["refer-local",q,F]},function(q){return["refer-free",q,F]},function(q){return["refer-global",q,F]})}compile_lookup(w,O,F,q,W){var U=O[0],K=O[1],G;if((G=U.index(w))!=null)return F(G);if((G=K.index(w))!=null)return q(G);var Y=w.name;return W(Y)}make_boxes(w,q,F){for(var q=q,W=0,U=[];q instanceof Pair;)w.member(q.car)&&U.push(W),W++,q=q.cdr;for(var K=F,G=U.length-1;G>=0;G--)K=["box",U[G],K];return K}find_sets(w,O){var F=null;if(w instanceof BiwaSymbol)F=new BiwaSet;else if(w instanceof Pair)switch(w.first()){case Sym("define"):var X=w.third();F=this.find_sets(X,O);case Sym("begin"):F=this.find_sets(w.cdr,O);break;case Sym("quote"):F=new BiwaSet;break;case Sym("lambda"):var q=w.second(),W=w.cdr.cdr;q instanceof Pair?F=this.find_sets(W,O.set_minus(to_set(q))):F=this.find_sets(W,O.set_minus(new BiwaSet(q)));break;case Sym("if"):var U=w.second(),K=w.third(),G=w.fourth();F=this.find_sets(U,O).set_union(this.find_sets(K,O),this.find_sets(G,O));break;case Sym("set!"):var Y=w.second(),Q=w.third();O.member(Y)?F=this.find_sets(Q,O).set_cons(Y):F=this.find_sets(Q,O);break;case Sym("call/cc"):var X=w.second();F=this.find_sets(X,O);break;default:for(var J=new BiwaSet,Z=w;Z instanceof Pair;Z=Z.cdr)J=J.set_union(this.find_sets(Z.car,O));F=J;break}else F=new BiwaSet;if(F==null)throw new Bug("find_sets() exited in unusual way");return F}find_free(w,O,F){var q=null;if(w instanceof BiwaSymbol)F.member(w)?q=new BiwaSet(w):q=new BiwaSet;else if(w instanceof Pair)switch(w.first()){case Sym("define"):var X=w.third();q=this.find_free(X,O,F);break;case Sym("begin"):q=this.find_free(w.cdr,O,F);break;case Sym("quote"):q=new BiwaSet;break;case Sym("lambda"):var W=w.second(),U=w.cdr.cdr;W instanceof Pair?q=this.find_free(U,O.set_union(to_set(W)),F):q=this.find_free(U,O.set_cons(W),F);break;case Sym("if"):var K=w.second(),G=w.third(),Y=w.fourth();q=this.find_free(K,O,F).set_union(this.find_free(G,O,F),this.find_free(Y,O,F));break;case Sym("set!"):var Q=w.second(),X=w.third();F.member(Q)?q=this.find_free(X,O,F).set_cons(Q):q=this.find_free(X,O,F);break;case Sym("call/cc"):var X=w.second();q=this.find_free(X,O,F);break;default:for(var J=new BiwaSet,Z=w;Z instanceof Pair;Z=Z.cdr)J=J.set_union(this.find_free(Z.car,O,F));q=J;break}else q=new BiwaSet;if(q==null)throw new Bug("find_free() exited in unusual way");return q}find_dot_pos(w){for(var O=0;w instanceof Pair;w=w.cdr,++O);return w!=nil?O:-1}last_pair(w){if(w instanceof Pair)for(;w.cdr instanceof Pair;w=w.cdr);return w}dotted2proper(w){if(w===nil)return nil;var O=function(U){for(var K=nil;U instanceof Pair;){var G=U.cdr;U.cdr=K,K=U,U=G}return K},F=function(U){for(var K=nil;U instanceof Pair;U=U.cdr)K=new Pair(U.car,K);return O(K)};if(w instanceof Pair){var q=this.last_pair(w);if(q instanceof Pair&&q.cdr===nil)return w;var W=F(w);return this.last_pair(W).cdr=new Pair(q.cdr,nil),W}else return new Pair(w,nil)}compile(w,O,F,q,W){for(var U=null;;){if(w instanceof BiwaSymbol)return this.compile_refer(w,O,F.member(w)?["indirect",W]:W);if(w instanceof Pair)switch(w.first()){case Sym("define"):U=this._compile_define(w,W),w=U[0],W=U[1];break;case Sym("begin"):for(var K=[],G=w.cdr;G instanceof Pair;G=G.cdr)K.push(G.car);for(var le=W,Y=K.length-1;Y>=0;Y--)le=this.compile(K[Y],O,F,q,le);return le;case Sym("quote"):if(w.length()<2)throw new BiwaError("Invalid quote: "+w.to_write());var Q=w.second();return["constant",Q,W];case Sym("lambda"):return this._compile_lambda(w,O,F,q,W);case Sym("if"):if(w.length()<3||w.length()>4)throw new BiwaError("Invalid if: "+w.to_write());var X=w.second(),J=w.third(),Z=w.fourth(),J=this.compile(J,O,F,q,W),Z=this.compile(Z,O,F,q,W);w=X,W=["test",J,Z];break;case Sym("set!"):if(w.length()!=3)throw new BiwaError("Invalid set!: "+w.to_write());var ee=w.second(),w=w.third(),ne=this.compile_lookup(ee,O,function(oe){return["assign-local",oe,W]},function(oe){return["assign-free",oe,W]},function(oe){return["assign-global",oe,W]});W=ne;break;case Sym("call/cc"):var w=w.second(),te=1,le=["conti",this.is_tail(W)?O[0].size()+1:0,["argument",["constant",te,["argument",this.compile(w,O,F,q,this.is_tail(W)?["shift",te,["tco_hinted_apply"]]:["apply"])]]]];return this.is_tail(W)?le:["frame",le,W];default:var re=w.car,se=w.cdr,le=this.compile(re,O,F,q,this.is_tail(W)?["shift",se.length(),["tco_hinted_apply"]]:["apply"]);le=this.compile(se.length(),O,F,q,["argument",le]);for(var G=se;G instanceof Pair;G=G.cdr)le=this.compile(G.car,O,F,q,["argument",le]);return this.is_tail(W)?le:["frame",le,W]}else return["constant",w,W]}}_compile_define(w,O){if(w.length()==1)throw new BiwaError("Invalid `define': "+w.to_write());var F=w.cdr.car,q=w.cdr.cdr;if(F instanceof BiwaSymbol){if(q===nil)w=undef;else if(q.cdr===nil)w=q.car;else throw new BiwaError("Invalid `define': "+w.to_write());TopEnv.hasOwnProperty(F.name)||(TopEnv[F.name]=undef),O=["assign-global",F.name,O]}else if(F instanceof Pair){var W=F.car,U=F.cdr,K=new Pair(Sym("lambda"),new Pair(U,q));w=K,TopEnv.hasOwnProperty(F.name)||(TopEnv[W.name]=undef),O=["assign-global",W.name,O]}else throw new BiwaError("define: symbol or pair expected but got "+F);return[w,O]}_compile_lambda(w,O,F,q,W){if(w.length()<3)throw new BiwaError("Invalid lambda: "+w.to_write());var U=w.cdr.car,K=w.cdr.cdr,G=Compiler.transform_internal_define(K);if(isPair(G)&&isSymbol(G.car)&&G.car.name=="letrec*")var Y=Compiler.expand(G);else var Y=new Pair(Sym("begin"),w.cdr.cdr);var Q=this.find_dot_pos(U),X=this.dotted2proper(U),J=this.find_free(Y,to_set(X),q),Z=this.find_sets(Y,to_set(X)),ee=this.compile(Y,[to_set(X),J],Z.set_union(F.set_intersect(J)),q.set_union(to_set(X)),["return"]),ne=["close",U instanceof Pair?U.length():0,J.size(),this.make_boxes(Z,X,ee),W,Q];return this.collect_free(J,O,ne)}run(w){const O=this.compile(w,[new BiwaSet,new BiwaSet],new BiwaSet,new BiwaSet,["halt"]);return new VMCode(O)}}Compiler.compile=function(D,w){return D=Compiler.expand(D),new Compiler().run(D,w)};Compiler.expand=function(D,w){var O=Compiler.expand;w||(w={});var F=null;if(D instanceof Pair)switch(D.car){case Sym("define"):var q=D.cdr.car,W=D.cdr.cdr;F=new Pair(Sym("define"),new Pair(q,O(W,w)));break;case Sym("begin"):F=new Pair(Sym("begin"),O(D.cdr,w));break;case Sym("quote"):F=D;break;case Sym("lambda"):var U=D.cdr.car,K=D.cdr.cdr;F=new Pair(Sym("lambda"),new Pair(U,O(K,w)));break;case Sym("if"):var G=D.second(),Y=D.third(),Q=D.fourth();F=List(Sym("if"),O(G,w),O(Y,w),O(Q,w));break;case Sym("set!"):var X=D.second(),D=D.third();F=List(Sym("set!"),X,O(D,w));break;case Sym("call-with-current-continuation"):case Sym("call/cc"):var D=D.second();F=List(Sym("call/cc"),O(D,w));break;default:var J=null;if(isSymbol(D.car)&&(TopEnv[D.car.name]instanceof Syntax?J=TopEnv[D.car.name]:CoreEnv[D.car.name]instanceof Syntax&&(J=CoreEnv[D.car.name])),J){w.modified=!0,F=J.transform(D);for(var Z;F=O(F,Z={}),!!Z.modified;);}else{var ee=O(D.car,w),ne;if(!(D.cdr instanceof Pair)&&D.cdr!==nil)throw new BiwaError("proper list required for function application or macro use: "+to_write(D));ne=array_to_list(D.cdr.to_array().map(function(re){return O(re,w)})),F=new Pair(ee,ne)}}else F=D;return F};var is_definition=function(D){return isPair(D)&&Sym("define")===D.car},define_to_lambda_bind=function(D){var w=D.cdr.car,O=D.cdr.cdr;if(isSymbol(w)){var F=w;return new Pair(F,O)}else{var F=w.car,q=new Pair(Sym("lambda"),new Pair(w.cdr,O));return List(F,q)}};Compiler.transform_internal_define=function(D){for(var w=[],O=D;is_definition(O.car);)w.push(O.car),O=O.cdr;var F=O;if(w.length==0)return D;var q=List.apply(null,w.map(define_to_lambda_bind));return new Pair(Sym("letrec*"),new Pair(q,F))};function to_set(D){if(D===nil)return new BiwaSet;for(var w=new BiwaSet,O=D;O instanceof Pair;O=O.cdr)w.add(O.car);return w}const make_assert=function(D){return function(){D.apply(this,[""].concat(Array.from(arguments)))}},make_simple_assert=function(D,w,O){return make_assert(function(F,q,W){const U=W?"("+W+"): ":"";if(!w(q))throw new BiwaError(U+D+" required, but got "+to_write$1(q))})};class Hashtable{constructor(w,O,F){this.mutable=F===void 0?!0:!!F,this.hash_proc=w,this.equiv_proc=O,this.pairs_of={}}clear(){this.pairs_of={}}candidate_pairs(w){return this.pairs_of[w]}add_pair(w,O,F){var q=this.pairs_of[w];q?q.push([O,F]):this.pairs_of[w]=[[O,F]]}remove_pair(w,O){var F=this.pairs_of[w],q=F.indexOf(O);if(q==-1)throw new Bug("Hashtable#remove_pair: pair not found!");F.splice(q,1)}create_copy(w){var O=new Hashtable(this.hash_proc,this.equiv_proc,w);return Object.keys(this.pairs_of).forEach(F=>{let W=this.pairs_of[F].map(U=>[...U]);O.pairs_of[F]=W}),O}size(){var w=0;return this._apply_pair(function(O){w++}),w}keys(){return this._apply_pair(function(w){return w[0]})}values(){return this._apply_pair(function(w){return w[1]})}_apply_pair(w){var O=[];return Object.values(this.pairs_of).forEach(function(F){F.forEach(function(q){O.push(w(q))})}),O}to_write(){return"#<Hashtable size="+this.size()+">"}}const isHashtable=function(D){return D instanceof Hashtable},isMutableHashtable=function(D){return D instanceof Hashtable&&D.mutable};Hashtable.equal_hash=function(D){return to_write$1(D[0])};Hashtable.eq_hash=Hashtable.equal_hash;Hashtable.eqv_hash=Hashtable.equal_hash;Hashtable.string_hash=function(D){return D[0]};Hashtable.string_ci_hash=function(D){return typeof D[0]=="string"?D[0].toLowerCase():D[0]};Hashtable.symbol_hash=function(D){return D[0]instanceof BiwaSymbol?D[0].name:D[0]};Hashtable.eq_equiv=function(D){return eq(D[0],D[1])};Hashtable.eqv_equiv=function(D){return eqv(D[0],D[1])};class Complex{constructor(w,O){this.real=w,this.imag=O}magnitude(){return Math.sqrt(this.real*this.real+this.imag*this.imag)}angle(){return Math.atan2(this.imag,this.real)}isReal(){return this.imag==0}isRational(){return this.imag==0&&isRational(this.real)}isInteger(){return this.imag==0&&isInteger(this.real)}toString(w){if(this.real===0&&this.imag===0)return"0";var O="";if(this.imag!==0){switch(this.imag>0&&this.real!==0&&(O+="+"),this.imag){case 1:break;case-1:O+="-";break;default:O+=this.imag.toString(w)}O+="i"}var F="";return this.real!==0&&(F+=this.real.toString(w)),F+O}}Complex.from_polar=function(D,w){var O=D*Math.cos(w),F=D*Math.sin(w);return new Complex(O,F)};Complex.assure=function(D){return D instanceof Complex?D:new Complex(D,0)};class Rational$1{constructor(w,O){this.numerator=w,this.denominator=O}isInteger(){}}const isNumber=function(D){return D instanceof Complex||D instanceof Rational$1||typeof D=="number"},isComplex=isNumber,isReal=function(D){return D instanceof Complex||D instanceof Rational$1?D.isReal():typeof D=="number"},isRational=function(D){return D instanceof Complex?D.isRational():D instanceof Rational$1?!0:typeof D=="number"},isInteger=function(D){return D instanceof Complex||D instanceof Rational$1?D.isInteger():typeof D=="number"&&D%1==0};class Unterminated extends BiwaError{}const DIGITS={2:/^[01]+/,8:/^[0-7]+/,10:/^[0-9]+/,16:/^[0-9a-fA-F]+/},PAREN={"(":")","{":"}","[":"]"},NAMED_CHARS={alarm:"\x07",backspace:"\b",delete:"",escape:"\x1B",newline:`
`,null:"\0",return:"\r",space:" ",tab:"	"},NAMED_CHARS_REXP=new RegExp("^("+Object.keys(NAMED_CHARS).join("|")+")\\b"),ESCAPE_SEQUENCES={a:"\x07",b:"\b",t:"	",n:`
`,r:"\r"};class Parser{constructor(w){this.txt=w,this.i=0,this.foldCase=!1,this.labelledData=[]}insert(w){const O=this.txt;this.txt=O.slice(0,this.i)+w+O.slice(this.i)}inspect(){return`#<Parser (${this.i}/${this.txt.length})>`}getObject(){this._skipAtmosphere();let w;if(this.done())w=Parser.EOS;else switch(this.txt[this.i]){case"#":this.i++,w=this._parseSharp();break;case"(":case"[":case"{":w=this._parseList();break;case'"':w=this._parseString();break;case"|":w=this._parseEnclosedSymbol();break;case"'":this.i++,w=this._parseQuote("quote");break;case"`":this.i++,w=this._parseQuote("quasiquote");break;case",":this.i++,this.txt[this.i]=="@"?(this.i++,w=this._parseQuote("unquote-splicing")):w=this._parseQuote("unquote");break;default:w=this._parseDecimalNumberOrIdentifier();break}return w}_getObjectOrThrowUnterminated(w){const O=this.getObject();if(O===Parser.EOS)throw new Unterminated(w);return O}_skipWhitespace(){for(;this.i<this.txt.length;)switch(this.txt[i]){case" ":case"	":case`
`:i++;break;default:return}}_skipAtmosphere(){for(;this.i<this.txt.length;)switch(this.txt[this.i]){case" ":case"	":case`
`:this.i++;break;case";":const w=this.match(/^;[^\n]*(\n|$)/);this.i+=w[0].length;break;case"#":if(this.txt[this.i+1]==";")this.i+=2,this._skipAtmosphere(),this._getObjectOrThrowUnterminated("missing argument for `#;`");else if(this.txt[this.i+1]=="|")this.i+=2,this._skipBlockComment();else if(this.match(/^#!fold-case/))this.i+=11,this.foldCase=!0;else if(this.match(/^#!no-fold-case/))this.i+=14,this.foldCase=!1;else return;break;default:return}}_skipBlockComment(){let w=1;for(;this.i<this.txt.length;){const O=this.match(/\|#/);if(O===null)break;const F=/#\|/.exec(this.txt.slice(this.i,O.index));if(F){w++,this.i+=F.index+2;continue}else if(this.i+=O.index+2,w--,w==0)return}throw new Unterminated("unterminated block comment (`|#` not found)",this.rest())}_parseQuote(w){this._skipAtmosphere();const O=this._getObjectOrThrowUnterminated(`unterminated ${w}`);return List(Sym(w),O)}_parseSharp(){switch(this.txt[this.i]){case"t":return this.match(/^true/)?this.i+=4:this.i++,!0;case"f":return this.match(/^false/)?this.i+=5:this.i++,!1;case"\\":return this.i++,this._parseChar();case"(":return this.i++,this._parseVector();case"u":if(this.match(/^u8\(/))throw new BiwaError("bytevectors are not supported yet",this.rest(-1));break;case"e":case"i":case"b":case"o":case"d":case"x":return this.i--,this._parsePrefixedNumber();default:if(this.match(/^\d/))return this._parseDatumLabel();break}throw new BiwaError("unknown #-syntax",this.rest(-1))}_parseChar(){let w=this.match(NAMED_CHARS_REXP);if(w)return this.i+=w[0].length,Char.get(NAMED_CHARS[w[1]]);if(w=this.match(/^x([a-zA-Z0-9]+)/),w)return this.i+=w[0].length,Char.get(String.fromCharCode(parseInt(w[1],16)));if(this.done())throw new Unterminated("got EOS on char literal",this.rest(-2));{const O=this.txt[this.i];return this.i++,Char.get(O)}}_parseVector(){this.i;const w=[];e:for(;this.i<this.txt.length;)switch(this._skipAtmosphere(),this.txt[this.i]){case")":this.i++;break e;case"]":case"}":throw new BiwaError("extra close paren",this.rest());default:w.push(this.getObject());break}return w}_parsePrefixedNumber(){let w=10;return this.match(/^#[iIeE]/)&&(this.i+=2),this.match(/^#[bB]/)?(w=2,this.i+=2):this.match(/^#[oO]/)?(w=8,this.i+=2):this.match(/^#[dD]/)?(w=10,this.i+=2):this.match(/^#[xX]/)&&(w=16,this.i+=2),this.match(/^#[iIeE]/)&&(this.i+=2),this._parseComplexNumber(w)}_parseComplexNumber(w){const O=this._parseRealNumber(w),F=this.txt[this.i];return F=="@"?(this.i++,this._parsePolarComplexNumber(O,w)):F=="+"||F=="-"?(this.i--,this._parseOrthoComplexNumber(O,w)):O}_parsePolarComplexNumber(w,O){const F=this._parseRealNumber(O);return Complex.from_polar(w,F)}_parseOrthoComplexNumber(w,O){const F=this._parseRealNumber(O);if(this.match(/^[iI]/))return this.i++,new Complex(w,F);throw new BiwaError("invalid complex number format (missing `i`)",this.rest())}_parseRealNumber(w,O=!1){if(O&&w!=10)throw new Bug("base must be 10 if maybeSymbol");let F="";const q=this.match(/^(\+|-)(inf.0|nan.0)/);if(q)return this.i+=6,(q[2]=="inf.0"?1/0:NaN)*(q[1]=="+"?1:-1);let W=1;this.match(/^\+/)?(this.i++,F+="+"):this.match(/^\-/)&&(this.i++,F+="-",W=-1);let U=null;const K=this.match(DIGITS[w]);if(K)this.i+=K[0].length,F+=K[0],U=parseInt(K[0],w)*W;else if(!(w==10&&this.txt[this.i]==".")){if(!O)throw new BiwaError("invalid char in number literal",this.rest())}if(this.txt[this.i]=="/"){this.i++;const G=this.match(DIGITS[w]);if(G){this.i+=G[0].length;const Y=parseInt(G[0],w);return new Rational(U,Y)}else if(O)F+="/";else throw new BiwaError("invalid char in rational number literal",this.rest())}if(w==10){this.i-=F.length;const G=this.match(/^[+-]?(\d+\.\d*|\.?\d+)([eE][+-]?\d+)?/);if(G)return this.i+=G[0].length,parseFloat(G[0]);this.i+=F.length}if(O)return F;throw new BiwaError(`invalid chars in number literal (${F})`,this.rest())}_parseDatumLabel(){const w=this.match(/^(\d+)(=|#)/);if(w){this.i+=w[0].length;const O=parseInt(w[1]);if(w[2]=="="){const F=this._getObjectOrThrowUnterminated("got EOS for labelled datum");return this.labelledData[O]=F,F}else{if(this.labelledData.hasOwnProperty(O))return this.labelledData[O];throw new BiwaError("undefined datum reference",this.rest(-1))}}else throw new BiwaError("unknown #-syntax",this.rest(-1))}_parseList(){const w=this.i,O=this.txt[this.i];this.i++;const F=PAREN[O];let q=!1,W=nil,U=W;for(;this.i<this.txt.length;){this._skipAtmosphere();const K=this.txt[this.i];if(K==F)return this.i++,W;if(K==")"||K=="]"||K=="}")throw new BiwaError("extra close paren",this.rest());if(K=="."&&this.match(/^\.[\s]/)){if(W===nil)throw new BiwaError("no list element before `.`",this.from(w));q=!0,this.i++;const G=this.getObject();if(G===Parser.EOS)throw new Unterminated("found EOS after `.` in list",this.from(w));U.cdr=G}else{if(q)throw new BiwaError("more than one element after `.`",this.from(w));{const G=this.getObject();if(G===Parser.EOS)throw this.i=w,new Unterminated("found EOS in list",this.rest());const Y=new Pair(G,nil);W===nil?W=Y:U.cdr=Y,U=Y}}}throw this.i=w,new Unterminated("found EOS in list",this.rest())}_parseString(){const w=this.match(/^"((\\"|[^"])*)"/);if(w){this.i+=w[0].length;const O=w[1].replaceAll(/\\\s*\n\s*/g,"");return this._replaceEscapedChars(O)}else throw new Unterminated("invalid string literal",this.rest())}_parseEnclosedSymbol(){const w=this.match(/^\|((\\\||[^\|])*)\|/);if(w)return this.i+=w[0].length,Sym(this._replaceEscapedChars(w[1]));throw new Unterminated("invalid symbol literal",this.rest())}_replaceEscapedChars(w){return w.replaceAll(/\\x([0-9a-f]+);/gi,(O,F)=>String.fromCharCode(parseInt(F,16))).replaceAll(/\\(.)/g,(O,F)=>ESCAPE_SEQUENCES[F]||F)}_parseDecimalNumberOrIdentifier(){const w=this.txt[this.i];if(w=="#")throw new Bug("#-syntax must be parsed beforehand");if(w===void 0)throw new Bug("EOS must be handled beforehand");let O=this._parseRealNumber(10,!0);if(isString(O)){const F=this.match(/^[^\s)}\]]+/);return F&&(this.i+=F[0].length,O+=F[0]),this.foldCase&&(O=O.toLowerCase()),Sym(O)}else return O}rest(w=0){return this.txt.slice(this.i+w)}from(w){return this.txt.slice(w)}match(w,O=0){return w.exec(this.rest(O))}done(){return this.i>=this.txt.length}}Parser.EOS=new Object;Parser.EOS.toString=()=>"#<BiwaScheme.Parser.EOS>";Parser.parse=D=>{const w=new Parser(D),O=[];for(;;){var F=w.getObject();if(F===Parser.EOS)break;O.push(F)}return O};Parser.Unterminated=Unterminated;class Interpreter{constructor(){var w=null,O=null;arguments.length==2?(w=arguments[0],O=arguments[1]):arguments.length==1&&arguments[0]instanceof Interpreter?w=arguments[0]:arguments.length==1&&typeof arguments[0]=="function"&&(O=arguments[0]),this.stack=[],this.on_error=O||(w?w.on_error:function(F){}),this.after_evaluate=function(){},this.last_refer=w?w.last_refer:null,this.call_stack=w?[...w.call_stack]:[],this.tco_counter=[],this.max_trace_size=w?w.max_trace_size:max_trace_size,this.current_dynamic_winder=Interpreter.DynamicWind.ROOT}inspect(){return["#<Interpreter: stack size=>",this.stack.length," ","after_evaluate=",inspect(this.after_evaluate),">"].join("")}push(w,O){return this.stack[O]=w,O+1}save_stack(w){for(var O=[],F=0;F<w;F++)O[F]=this.stack[F];return{stack:O,last_refer:this.last_refer,call_stack:[...this.call_stack],tco_counter:[...this.tco_counter]}}restore_stack(w){const O=w.stack,F=O.length;for(var q=0;q<F;q++)this.stack[q]=O[q];return this.last_refer=w.last_refer,this.call_stack=[...w.call_stack],this.tco_counter=[...w.tco_counter],F}capture_continuation(w,O){var F=this.push(O,w);return this.closure(["nuate1",this.save_stack(F),this.current_dynamic_winder],1,0,null,-1)}shift_args(w,O,F){for(var q=w;q>=0;q--)this.index_set(F,q+O+1,this.index(F,q));return F-O-1}index(w,O){return this.stack[w-1-O]}index_set(w,O,F){this.stack[w-1-O]=F}closure(w,O,F,q,W){const U=[];for(var K=0;K<F;K++)U[K]=this.index(q,K);const G=W==-1?O:void 0;return new Closure(w,U,W,G)}run_dump_hook(w,O,F,q,W){var U,K;if(this.dumper)U=this.dumper;else if(Interpreter.dumper)U=Interpreter.dumper;else return;U&&(K={a:w,f:F,c:q,s:W,x:O,stack:this.stack},U.dump(K))}_execute(w,O,F,q,W){for(var U=null;;)switch(this.run_dump_hook(w,O,F,q,W),O[0]){case"halt":return w;case"refer-local":var ge=O[1],O=O[2];w=this.index(F,ge+1),this.last_refer="(anon)";break;case"refer-free":var ge=O[1],O=O[2];w=q.freevars[ge],this.last_refer="(anon)";break;case"refer-global":var K=O[1],O=O[2];if(TopEnv.hasOwnProperty(K))var G=TopEnv[K];else if(CoreEnv.hasOwnProperty(K))var G=CoreEnv[K];else throw new BiwaError("execute: unbound symbol: "+inspect(K));w=G,this.last_refer=K||"(anon)";break;case"indirect":var O=O[1];w=w[0];break;case"constant":var Y=O[1],O=O[2];w=Y,this.last_refer="(anon)";break;case"close":var Q=O,X=Q[1],ge=Q[2],J=Q[3],O=Q[4],Z=Q[5];w=this.closure(J,X,ge,W,Z),W-=ge;break;case"box":var ge=O[1],O=O[2];this.index_set(W,ge+1,[this.index(W,ge+1)]);break;case"test":var ee=O[1],ne=O[2];O=w!==!1?ee:ne;break;case"assign-global":var te=O[1],O=O[2];if(!TopEnv.hasOwnProperty(te)&&!CoreEnv.hasOwnProperty(te))throw new BiwaError("global variable '"+te+"' is not defined");TopEnv[te]=w,w=undef;break;case"assign-local":var ge=O[1],O=O[2],re=this.index(F,ge+1);re[0]=w,w=undef;break;case"assign-free":var ge=O[1],O=O[2],re=q.freevars[ge];re[0]=w,w=undef;break;case"conti":var ge=O[1],O=O[2];w=this.capture_continuation(W,ge);break;case"nuate1":var oe=O[1],se=O[2],le=this.current_dynamic_winder,ue=Interpreter.DynamicWind.listWinders(le,se);O=Interpreter.DynamicWind.joinWinders(ue,["refer-local",0,["nuate2",oe]]);break;case"nuate2":var oe=O[1],O=["return"];W=this.restore_stack(oe);break;case"frame":var U=O[2];O=O[1],W=this.push(U,this.push(F,this.push(q,W))),this.tco_counter[this.tco_counter.length]=0;break;case"argument":var O=O[1];W=this.push(w,W);break;case"shift":var ge=O[1],O=O[2],ce=this.index(W,ge+1);W=this.shift_args(ge,ce,W);break;case"tco_hinted_apply":this.tco_counter[this.tco_counter.length-1]++,O=["apply"].concat(O.slice(1));break;case"apply":var ae=w;this.call_stack.push(this.last_refer),this.call_stack.length>this.max_trace_size&&this.call_stack.shift();var ce=this.index(W,0);if(isClosure(ae)){w=ae,O=ae.body;const xe=ae.dotpos;if(xe>=0){for(var de=nil,fe=ce;--fe>=xe;)de=new Pair(this.index(W,fe+1),de);if(xe>=ce){for(var fe=0;fe<ce+1;fe++)this.index_set(W,fe-1,this.index(W,fe));W++,this.index_set(W,0,this.index(W,0)+1)}this.index_set(W,xe+1,de)}else if(ae.expected_args!==void 0&&ce!=ae.expected_args){var ye="Function call error: got "+ce+" but wanted "+ae.expected_args;throw new BiwaError(ye)}F=W,q=ae}else if(ae instanceof Function){for(var pe=[],fe=0;fe<ce;fe++)pe.push(this.index(W,fe+1));var he=ae(pe,this);if(he instanceof Pause){var be=he;return be.set_state(this,["return"],F,q,W),be.ready(),be}else if(he instanceof Call){var me=["frame",["argument",["constant",1,["argument",["constant",he.after,["apply"]]]]],["return"]],ve=["constant",he.args.length,["argument",["constant",he.proc,["apply",he.args.length]]]],_e=he.args.reduce(function(xe,ke){return["constant",ke,["argument",xe]]},ve);O=["frame",_e,me]}else w=he,O=["return"]}else throw new BiwaError(inspect(ae)+" is not a function");break;case"return":var ge=this.index(W,0),Se=W-ge;O=this.index(Se,1),F=this.index(Se,2),q=this.index(Se,3),W=Se-3-1;var we=1+this.tco_counter[this.tco_counter.length-1];this.call_stack.splice(-we),this.tco_counter.pop();break;default:throw new Bug("unknown opecode type: "+O[0])}return w}evaluate(w,O){this.call_stack=[],this.parser=new Parser(w),this.compiler=new Compiler,O&&(this.after_evaluate=O),this.is_top=!0,this.file_stack=[];try{return this.resume(!1)}catch(F){return F.message=F.message+" ["+this.call_stack.join(", ")+"]",this.on_error(F)}}resume(w,O,F,q,W,U){for(var K=undef;;){if(w)K=this._execute(O,F,q,W,U),w=!1;else{if(!this.parser)break;var G=this.parser.getObject();if(G===Parser.EOS)break;G=Compiler.expand(G);const Y=this.compiler.run(G);K=this._execute(G,Y.il,0,[],0)}if(K instanceof Pause)return K}return this.after_evaluate(K),K}evaluate_vmcode(w){this.call_stack=[],this.is_top=!0,this.file_stack=[];try{const O=this._execute(undef,w.il,0,[],0);return O instanceof Pause||this.after_evaluate(O),O}catch(O){return O.message=O.message+" ["+this.call_stack.join(", ")+"]",this.on_error(O)}}invoke_closure(w,O){O||(O=[]);for(var F=O.length,q=["constant",F,["argument",["constant",w,["apply"]]]],W=0;W<F;W++)q=["constant",O[W],["argument",q]];return this._execute(w,["frame",q,["halt"]],0,w,0)}compile(w){var O=Interpreter.read(w),F=Compiler.compile(O);return F}push_dynamic_winder(w,O){this.current_dynamic_winder=new Interpreter.DynamicWind(this.current_dynamic_winder,w,O)}pop_dynamic_winder(w,O){this.current_dynamic_winder=this.current_dynamic_winder.parent}}Interpreter.read=function(D){var w=new Parser(D),O=w.getObject();return O==Parser.EOS?eof:O};Interpreter.expand=function(){throw"Interpreter.expand is moved to Compiler.expand"};Interpreter.DynamicWind=class{constructor(D,w,O){this.parent=D,this.before=w,this.after=O}};Interpreter.DynamicWind.ROOT={_:"this is ROOT."};Interpreter.DynamicWind.listWinders=function(D,w){for(var O=[D];D!==Interpreter.DynamicWind.ROOT;)D=D.parent,O.push(D);for(var F=[],q;;){var W=O.find(function(G){return G===w});if(W){q=W;break}F.push(w),w=w.parent}for(var U=[],K=0;K<O.length&&O[K]!==q;K++)U.push(O[K].after);return F.reverse(),F.forEach(function(G){U.push(G.before)}),U};Interpreter.DynamicWind.joinWinders=function(D,w){return D.reduceRight(function(O,F){return["frame",["constant",0,["argument",["constant",F,["apply"]]]],O]},w)};class BiwaPromise{constructor(w,O){this.box=[w,O]}is_done(){return this.box[0]}value(){if(!this.is_done())throw new Bug("this promise is not calculated yet");return this.box[1]}thunk(){if(this.is_done())throw new Bug("this promise does not know the thunk");return this.box[1]}update_with(w){this.box[0]=w.box[0],this.box[1]=w.box[1],w.box=this.box}}const isPromise=function(D){return D instanceof BiwaPromise};BiwaPromise.fresh=function(D){return new BiwaPromise(!1,D)};BiwaPromise.done=function(D){return new BiwaPromise(!0,D)};const check_arity=function(D,w,O,F){if(w<O)throw F&&F==O?new BiwaError(D+": wrong number of arguments (expected: "+O+" got: "+w+")"):new BiwaError(D+": too few arguments (at least: "+O+" got: "+w+")");if(F&&F<w)throw new BiwaError(D+": too many arguments (at most: "+F+" got: "+w+")")},define_libfunc=function(D,w,O,F){var q=function(W,U){return check_arity(D,W.length,w,O),F(W,U)};F.fname=D,q.inspect=function(){return this.fname},CoreEnv[D]=q},alias_libfunc=function(D,w){CoreEnv[D]?Array.isArray(w)?w.map(function(O){alias_libfunc(D,O)}):typeof w=="string"?CoreEnv[w]=CoreEnv[D]:console.error("[BUG] bad alias for library function `"+D+"': "+w.toString()):console.error("[BUG] library function `"+D+"' does not exist, so can't alias it.")},define_syntax=function(D,w){var O=new Syntax(D,w);CoreEnv[D]=O},define_scmfunc=function(D,w,O,F){new Interpreter().evaluate("(define "+D+" "+F+`
)`)},assert_number=make_simple_assert("number",function(D){return typeof D=="number"||D instanceof Complex}),assert_integer=make_simple_assert("integer",function(D){return typeof D=="number"&&D%1==0}),assert_real=make_simple_assert("real number",function(D){return typeof D=="number"}),assert_between=make_assert(function(D,w,O,F){if(typeof w!="number"||w!=Math.round(w))throw new BiwaError(D+": number required, but got "+to_write$1(w));if(w<O||F<w)throw new BiwaError(D+": number must be between "+O+" and "+F+", but got "+to_write$1(w))}),assert_string=make_simple_assert("string",isString),assert_char=make_simple_assert("character",isChar),assert_symbol=make_simple_assert("symbol",isSymbol),assert_port=make_simple_assert("port",isPort),assert_pair=make_simple_assert("pair",isPair),assert_list=make_simple_assert("list",isList),assert_vector=make_simple_assert("vector",isVector),assert_hashtable=make_simple_assert("hashtable",isHashtable),assert_mutable_hashtable=make_simple_assert("mutable hashtable",isMutableHashtable),assert_promise=make_simple_assert("promise",isPromise),assert_function=make_simple_assert("JavaScript function",isFunction),assert_closure=make_simple_assert("scheme closure",isClosure),assert_procedure=make_simple_assert("scheme/js function",function(D){return isClosure(D)||isFunction(D)}),assert_date=make_simple_assert("date",function(D){return D instanceof Date}),assert=make_assert(function(D,w,O,F){if(!w)throw new BiwaError((F||D)+": "+O)}),deprecate=function(D,w,O){var F=D+" is deprecated and will be removed in BiwaScheme "+w+". Please use "+O+" instead";console.warn(F)},parse_fraction=function(D){assert_string(D);var w=D.split("/");if(w.length!==2)return!1;var O=w[0],F=w[1],q=parse_integer(O,10),W=parse_integer(F,10);return q===!1||W===!1||W<=0?!1:q/W},is_valid_integer_notation=function(D,w){if(assert_string(D),assert_integer(w),w<2||w>36)return!1;var O="0123456789abcdefghijklmnopqrstuvwxyz",F=O.slice(0,w),q=new RegExp("^[+-]?["+F+"]+$","ig");return q.test(D)},parse_integer=function(D,w){if(assert_string(D),assert_integer(w),w<2||w>36||!is_valid_integer_notation(D,w))return!1;var O=parseInt(D,w);return Number.isNaN(O)?!1:O},is_valid_float_notation=function(D){assert_string(D);var w=/^[+-]?[0-9]+[.]?[0-9]*e[+-]?[0-9]+$/i,O=/(^[+-]?[0-9]*[.][0-9]+$)|(^[+-]?[0-9]+[.][0-9]*$)/;return w.test(D)||O.test(D)?!0:is_valid_integer_notation(D,10)},parse_float=function(D){if(assert_string(D),!is_valid_float_notation(D))return!1;var w=new Number(D).valueOf();return Number.isNaN(w)||!Number.isFinite(w)?!1:w},Enumeration={};Enumeration.EnumType=class{constructor(D){this.members=[...new Set(D)]}universe(){return new Enumeration.EnumSet(this,this.members)}indexer(){return D=>{assert_symbol(D[0],"(enum-set indexer)");var w=this.members.indexOf(D[0]);return w===-1?!1:w}}constructor_(){return D=>{assert_list(D[0],"(enum-set constructor)");var w=D[0].to_array();return w.forEach(function(O){assert_symbol(O,"(enum-set constructor)")}),new Enumeration.EnumSet(this,w)}}};Enumeration.EnumSet=class{constructor(D,w){this.enum_type=D,this.symbols=D.members.filter(O=>w.includes(O))}symbol_list(){return array_to_list(this.symbols)}is_member(D){return this.symbols.includes(D)}is_subset(D){return this.symbols.some(w=>!D.symbols.includes(w))?!1:this.enum_type===D.enum_type?!0:this.enum_type.members.every(w=>D.enum_type.members.includes(w))}equal_to(D){return this.is_subset(D)&&D.is_subset(this)}union(D){var w=this.enum_type.members.filter(O=>this.symbols.includes(O)||D.symbols.includes(O));return new Enumeration.EnumSet(this.enum_type,w)}intersection(D){var w=this.symbols.filter(O=>D.symbols.includes(O));return new Enumeration.EnumSet(this.enum_type,w)}difference(D){var w=this.symbols.filter(O=>!D.symbols.includes(O));return new Enumeration.EnumSet(this.enum_type,w)}complement(){var D=this.enum_type.members.filter(w=>!this.symbols.includes(w));return new Enumeration.EnumSet(this.enum_type,D)}projection(D){var w=this.symbols.filter(O=>D.enum_type.members.includes(O));return new Enumeration.EnumSet(D.enum_type,w)}toString(){return"#<EnumSet "+inspect(this.symbols)+">"}};const isEnumSet=function(D){return D instanceof Enumeration.EnumSet},assert_enum_set=make_simple_assert("enum_set",isEnumSet),memoize=function(D,w){const O=D.prototype;w.forEach(F=>{O["compute_"+F]=O[F],O[F]=function(){return this.hasOwnProperty("cached_"+F)||(this["cached_"+F]=this["compute_"+F].apply(this,Array.from(arguments))),this["cached_"+F]}})};memoize(Enumeration.EnumSet,["symbol_list"]);memoize(Enumeration.EnumType,["universe","indexer","constructor_"]);class Record{constructor(w,O){assert_record_td(w,"new Record"),this.rtd=w,this.fields=O}get(w){return this.fields[w]}set(w,O){this.fields[w]=O}toString(){var w=to_write$1(this.fields);return"#<Record "+this.rtd.name+" "+w+">"}}const isRecord=function(D){return D instanceof Record};Record._DefinedTypes={};Record.define_type=function(D,w,O){return Record._DefinedTypes[D]={rtd:w,cd:O}};Record.get_type=function(D){return Record._DefinedTypes[D]};Record.RTD=class{constructor(D,w,O,F,q,W){this.name=D,this.parent_rtd=w,this.is_base_type=!w,O?(this.uid=O,this.generative=!1):(this.uid=this._generate_new_uid(),this.generative=!0),this.sealed=!!F,this.opaque=w.opaque||!!q,this.fields=W.map(function(U){return{name:U[0],mutable:!!U[1]}})}field_name(D){for(var w=this._field_names(),O=this.parent_rtd;O;O=O.parent_rtd)w=O._field_names()+w;return w[D]}_field_names(){return this.fields.map(function(D){return D.name})}_generate_new_uid(){return Sym(uniqueId("__record_td_uid"))}toString(){return"#<RecordTD "+name+">"}};Record.RTD.NongenerativeRecords={};const isRecordTD=function(D){return D instanceof Record.RTD};Record.CD=class{constructor(D,w,O){this._check(D,w,O),this.rtd=D,this.parent_cd=w,O?(this.has_custom_protocol=!0,this.protocol=O):(this.has_custom_protocol=!1,D.parent_rtd?this.protocol=this._default_protocol_for_derived_types():this.protocol=this._default_protocol_for_base_types())}_check(D,w,O){if(D.is_base_type&&w)throw new Error("Record.CD.new: cannot specify parent cd of a base type");if(w&&D.parent_rtd&&w.rtd!=D.parent_rtd)throw new Error("Record.CD.new: mismatched parents between rtd and parent_cd");if(D.parent_rtd&&!w&&O)throw new Error("Record.CD.new: protocol must be #f when parent_cd is not given");if(w&&w.has_custom_protocol&&!O)throw new Error("Record.CD.new: protocol must be specified when parent_cd has a custom protocol")}_default_protocol_for_base_types(){return function(D){var w=D[0];return assert_procedure(w,"_default_protocol/base"),w}}_default_protocol_for_derived_types(){var D=this.rtd;return function(w){var O=w[0];assert_procedure(O,"_default_protocol/n");var F=function(q){var W=D.fields.length,U=q.length-W,K=q.slice(0,U),G=q.slice(U);return new Call(O,K,function(Y){var Q=Y[0];return assert_procedure(Q,"_default_protocol/p"),new Call(Q,G,function(X){var J=X[0];return assert_record(J,"_default_protocol/result"),J})})};return F}}toString(){return"#<RecordCD "+this.rtd.name+">"}record_constructor(){var D=this.parent_cd?this._make_n([],this.rtd):this._make_p();return D=D.bind(this),new Call(this.protocol,[D],function(w){var O=w[0];return assert_procedure(O,"record_constructor"),O})}_make_p(){return function(D){return new Record(this.rtd,D)}}_make_n(D,w){var O=this.parent_cd;if(O){var F=function(q){var W=function(U){var K=[].concat(U[0]).concat(D),G=O._make_n(K,w);return new Call(O.protocol,[G],function(Y){var Q=Y[0];return assert_procedure(Q,"_make_n"),new Call(Q,q,function(X){var J=X[0];return assert_record(J),J})})};return W};return F}else{var F=function(W){var U=W.concat(D);return new Record(w,U)};return F}}};const isRecordCD=function(D){return D instanceof Record.CD},assert_record=make_simple_assert("record",isRecord),assert_record_td=make_simple_assert("record type descriptor",isRecordTD),assert_record_cd=make_simple_assert("record constructor descriptor",isRecordCD);class Values$1{constructor(w){this.content=w}to_write(){return"#<Values "+this.content.map(to_write$1).join(" ")+">"}}const Console={};define_libfunc("html-escape",1,1,function(D){return assert_string(D[0]),escape(D[0])});const inspect_objs=function(D){return D.map(inspect).join(", ")};define_libfunc("inspect",1,null,function(D){return inspect_objs(D)});define_libfunc("inspect!",1,null,function(D){return Console.puts(inspect_objs(D)),undef});const json2sexp=function(D){switch(!0){case(typeof D=="number"||typeof D=="string"||D===!0||D===!1):return D;case Array.isArray(D):return array_to_list(D.map(json2sexp));case typeof D=="object":var w=nil;for(key in D)w=new Pair(new Pair(key,json2sexp(D[key])),w);return w;default:throw new Error("json->sexp: detected invalid value for json: "+inspect(D))}};define_libfunc("json->sexp",1,1,function(D){return json2sexp(D[0])});define_libfunc("vector-push!",2,null,function(D){assert_vector(D[0]);for(var w=1;w<D.length;w++)D[0].push(D[w]);return D[0]});define_libfunc("identity",1,1,function(D){return D[0]});define_syntax("inc!",function(D){var w=D.cdr.car;return List(Sym("begin"),List(Sym("set!"),w,List(Sym("+"),w,1)),w)});define_syntax("dec!",function(D){var w=D.cdr.car;return List(Sym("begin"),List(Sym("set!"),w,List(Sym("-"),w,1)),w)});define_libfunc("string-concat",1,1,function(D){return assert_list(D[0]),D[0].to_array().join("")});define_libfunc("string-split",2,2,function(D){return assert_string(D[0]),assert_string(D[1]),array_to_list(D[0].split(D[1]))});define_libfunc("string-join",1,2,function(D){assert_list(D[0]);var w="";return D[1]&&(assert_string(D[1]),w=D[1]),D[0].to_array().join(w)});define_libfunc("intersperse",2,2,function(D){var w=D[0],O=D[1];assert_list(O);var F=[];return O.to_array().reverse().forEach(function(q){F.push(q),F.push(w)}),F.pop(),array_to_list(F)});define_libfunc("map-with-index",2,null,function(D){var w=D.shift(),O=D;O.forEach(assert_list);var F=[],q=0;return Call.multi_foreach(O,{call:function(W){var U=W.map(function(K){return K.car});return U.unshift(q),q++,new Call(w,U)},result:function(W){F.push(W)},finish:function(){return array_to_list(F)}})});define_syntax("dotimes",function(D){var w=D.cdr.car,O=D.cdr.cdr,F=w.car,q=w.cdr.car,W=w.cdr.cdr.car,U=gensym(),K=deep_array_to_list([[U,q],[F,0,[Sym("+"),F,1]]]),G=deep_array_to_list([[Sym(">="),F,U],W]);return new Pair(Sym("do"),new Pair(K,new Pair(G,O)))});var sort_with_comp=function(D,w,O){return D.sort(function(F,q){var W=new Interpreter(O);return W.invoke_closure(w,[F,q])})};define_libfunc("list-sort/comp",1,2,function(D,w){return assert_procedure(D[0]),assert_list(D[1]),array_to_list(sort_with_comp(D[1].to_array(),D[0],w))});define_libfunc("vector-sort/comp",1,2,function(D,w){return assert_procedure(D[0]),assert_vector(D[1]),sort_with_comp([...D[1]],D[0],w)});define_libfunc("vector-sort/comp!",1,2,function(D,w){return assert_procedure(D[0]),assert_vector(D[1]),sort_with_comp(D[1],D[0],w),undef});var rearrange_args=function(D,w){var O=[],F=new Compiler().find_dot_pos(D);if(F==-1)O=w;else{for(var q=0;q<F;q++)O[q]=w[q];O[q]=array_to_list(w.slice(q))}return O};define_syntax("define-macro",function(D){var w=D.cdr.car,O;if(w instanceof Pair){var F=w.car;O=w.cdr;var q=D.cdr.cdr,W=new Pair(Sym("lambda"),new Pair(O,q))}else{var F=w,W=D.cdr.cdr.car;O=W.cdr.car}var U=Compiler.compile(W).il;if(U[2]!=0)throw new Bug("you cannot use free variables in macro expander (or define-macro must be on toplevel)");var K=new Closure(U[3],[],-1,void 0);return TopEnv[F.name]=new Syntax(F.name,function(G){var Y=G.to_array();Y.shift();var Q=new Interpreter,X=rearrange_args(O,Y),J=Q.invoke_closure(K,X);return J}),undef});var macroexpand_1=function(D){if(D instanceof Pair)if(D.car instanceof BiwaSymbol&&TopEnv[D.car.name]instanceof Syntax){var w=TopEnv[D.car.name];D=w.transform(D)}else throw new Error("macroexpand-1: `"+to_write$1(D)+"' is not a macro");return D};define_syntax("%macroexpand",function(D){var w=Compiler.expand(D.cdr.car);return List(Sym("quote"),w)});define_syntax("%macroexpand-1",function(D){var w=macroexpand_1(D.cdr.car);return List(Sym("quote"),w)});define_libfunc("macroexpand",1,1,function(D){return Compiler.expand(D[0])});define_libfunc("macroexpand-1",1,1,function(D){return macroexpand_1(D[0])});define_libfunc("gensym",0,1,function(D){return D[0]==null?gensym():(assert_string(D[0]),gensym(D[0]))});define_libfunc("print",1,null,function(D){return D.map(function(w){Console.puts(to_display(w),!0)}),Console.puts(""),undef});define_libfunc("write-to-string",1,1,function(D){return to_write$1(D[0])});define_libfunc("read-from-string",1,1,function(D){return assert_string(D[0]),Interpreter.read(D[0])});define_libfunc("port-closed?",1,1,function(D){return assert_port(D[0]),!D[0].is_open});define_libfunc("with-output-to-port",2,2,function(D){var w=D[0],O=D[1];assert_port(w),assert_procedure(O);var F=Port.current_output;return Port.current_output=w,new Call(O,[w],function(q){return w.close(),Port.current_output=F,q[0]})});define_syntax("let1",function(D){var w=D.cdr.car,O=D.cdr.cdr.car,F=D.cdr.cdr.cdr;return new Pair(new Pair(Sym("lambda"),new Pair(new Pair(w,nil),F)),new Pair(O,nil))});var assert_regexp=function(D,w){if(!(D instanceof RegExp))throw new Error(w+": regexp required, but got "+to_write$1(D))};define_libfunc("string->regexp",1,1,function(D){return assert_string(D[0],"string->regexp"),new RegExp(D[0])});define_libfunc("regexp?",1,1,function(D){return D[0]instanceof RegExp});define_libfunc("regexp->string",1,1,function(D){return assert_regexp(D[0],"regexp->string"),D[0].toString().slice(1,-1)});define_libfunc("regexp-exec",2,2,function(D){var w=D[0];typeof D[0]=="string"&&(w=new RegExp(D[0])),assert_regexp(w,"regexp-exec"),assert_string(D[1],"regexp-exec");var O=w.exec(D[1]);return O===null?!1:array_to_list(O)});define_libfunc("regexp-replace-all",3,3,function(D){var w=D[0];if(typeof w=="string")var O=new RegExp(w,"g");else{assert_regexp(w);var O=new RegExp(w.source,"g")}return assert_string(D[1]),assert_string(D[2]),D[1].replace(O,D[2])});define_libfunc("js-eval",1,1,function(ar){return eval(ar[0])});define_libfunc("js-ref",2,2,function(D){return typeof D[1]=="string"||Number.isInteger(D[1])?D[0][D[1]]:(assert_symbol(D[1]),D[0][D[1].name])});define_libfunc("js-set!",3,3,function(D){return assert_string(D[1]),D[0][D[1]]=D[2],undef});define_libfunc("js-call",1,null,function(D){var w=D.shift();assert_function(w);var O=null;return w.apply(O,D)});define_libfunc("js-invoke",2,null,function(D){var w=D.shift(),O=D.shift();if(!1==="string"&&(assert_symbol(O),O=O.name),w[O])return w[O].apply(w,D);throw new Error("js-invoke: function "+O+" is not defined")});define_libfunc("js-invocation",2,null,function(ar,intp){var receiver=ar.shift();isSymbol(receiver)&&(receiver=eval(receiver.name));var v=receiver;return ar.forEach(function(D){if(isSymbol(D))v=v[D.name];else if(isList(D)){var w=D.to_array();assert_symbol(w[0]);var O=w.shift().name;if(w=w.map(function(F){if(isClosure(F))return js_closure(F,intp);if(isList(F)){var q={};return F.foreach(function(W){assert_symbol(W.car),q[W.car.name]=W.cdr}),q}else return F}),!typeof v[O]==="function")throw new BiwaError("js-invocation: the method `"+O+"' not found");v=v[O].apply(v,w)}else throw new BiwaError("js-invocation: expected list or symbol for callspec but got "+inspect(D))}),v});define_syntax("..",function(D){if(D.cdr==nil)throw new Error("malformed ..");return new Pair(Sym("js-invocation"),D.cdr)});define_libfunc("js-new",1,null,function(ar,intp){var array_to_obj=function(D){if(D.length%2!=0)throw new Error("js-new: odd number of key-value pair");for(var w={},O=0;O<D.length;O+=2){var F=D[O],q=D[O+1];assert_symbol(F),isClosure(q)&&(q=js_closure(q,intp)),w[F.name]=q}return w},ctor=ar.shift();if(typeof ctor=="string"&&(ctor=eval(ctor)),ar.length==0)return new ctor;for(var args=[],i=0;i<ar.length;i++)if(ar[i]instanceof BiwaSymbol){args.push(array_to_obj(ar.slice(i)));break}else args.push(ar[i]);return new(Function.prototype.bind.apply(ctor,[null].concat(args)))});define_libfunc("js-obj",0,null,function(D){if(D.length%2!=0)throw new Error("js-obj: number of arguments must be even");var w={};for(let O=0;O<D.length/2;O++)assert_string(D[O*2]),w[D[O*2]]=D[O*2+1];return w});const js_closure=function(D,w){var O=new Interpreter(w);return function(){return O.invoke_closure(D,Array.from(arguments))}};define_libfunc("js-closure",1,1,function(D,w){return assert_closure(D[0]),js_closure(D[0],w)});define_libfunc("js-null?",1,1,function(D){return D[0]===null});define_libfunc("js-undefined?",1,1,function(D){return D[0]===void 0});define_libfunc("js-function?",1,1,function(D){return typeof D[0]=="function"});define_libfunc("js-array-to-list",1,1,function(D){return deprecate("js-array-to-list","1.0","js-array->list"),array_to_list(D[0])});define_libfunc("js-array->list",1,1,function(D){return array_to_list(D[0])});define_libfunc("list-to-js-array",1,1,function(D){return deprecate("list-to-js-array","1.0","list->js-array"),D[0].to_array()});define_libfunc("list->js-array",1,1,function(D){return D[0].to_array()});define_libfunc("alist-to-js-obj",1,1,function(D){return deprecate("alist-to-js-obj","1.0","alist->js-obj"),alist_to_js_obj(D[0])});define_libfunc("alist->js-obj",1,1,function(D){return assert_list(D[0]),alist_to_js_obj(D[0])});define_libfunc("js-obj-to-alist",1,1,function(D){return deprecate("js-obj-to-alist","1.0","js-obj->alist"),js_obj_to_alist(D[0])});define_libfunc("js-obj->alist",1,1,function(D){return js_obj_to_alist(D[0])});define_libfunc("timer",2,2,function(D,w){var O=D[0],F=D[1];assert_closure(O),assert_real(F);var q=new Interpreter(w);return setTimeout(function(){q.invoke_closure(O)},F*1e3),undef});define_libfunc("set-timer!",2,2,function(D,w){var O=D[0],F=D[1];assert_closure(O),assert_real(F);var q=new Interpreter(w);return setInterval(function(){q.invoke_closure(O)},F*1e3)});define_libfunc("clear-timer!",1,1,function(D){var w=D[0];return clearInterval(w),undef});define_libfunc("sleep",1,1,function(D){var w=D[0];return assert_real(w),new Pause(function(O){setTimeout(function(){O.resume(nil)},w*1e3)})});var define_console_func=function(D){define_libfunc("console-"+D,1,null,function(w){var O=window.console;if(O){var F=w.map(function(q){return inspect(q,{fallback:q})});O[D].apply(O,F)}return w[0]})};define_console_func("debug");define_console_func("log");define_console_func("info");define_console_func("warn");define_console_func("error");define_syntax("cond",function(D){var w=D.cdr;if(!(w instanceof Pair)||w===nil)throw new BiwaError("malformed cond: cond needs list but got "+write_ss(w));var O=null;return w.to_array().reverse().forEach(function(F){if(!(F instanceof Pair))throw new BiwaError("bad clause in cond: "+write_ss(F));if(F.car===Sym("else")){if(O!==null)throw new BiwaError("'else' clause of cond followed by more clauses: "+write_ss(w));F.cdr===nil?O=!1:F.cdr.cdr===nil?O=F.cdr.car:O=new Pair(Sym("begin"),F.cdr)}else{var q=F.car;if(F.cdr===nil)O=List(Sym("or"),q,O);else if(F.cdr.cdr===nil)O=List(Sym("if"),q,F.cdr.car,O);else if(F.cdr.car===Sym("=>")){var q=F.car,W=F.cdr.cdr.car,U=gensym();O=List(Sym("let"),List(List(U,q)),List(Sym("if"),q,List(W,U),O))}else O=List(Sym("if"),q,new Pair(Sym("begin"),F.cdr),O)}}),O});define_syntax("case",function(D){var w=gensym();if(D.cdr===nil)throw new BiwaError("case: at least one clause is required");if(D.cdr instanceof Pair){var O=D.cdr.car,F=D.cdr.cdr,q=void 0;return F.to_array().reverse().forEach(function(W){if(W.car===Sym("else"))if(q===void 0)q=new Pair(Sym("begin"),W.cdr);else throw new BiwaError("case: 'else' clause followed by more clauses: "+write_ss(F));else q=List(Sym("if"),new Pair(Sym("or"),array_to_list(W.car.to_array().map(function(U){return List(Sym("eqv?"),w,List(Sym("quote"),U))}))),new Pair(Sym("begin"),W.cdr),q)}),new Pair(Sym("let1"),new Pair(w,new Pair(O,new Pair(q,nil))))}else throw new BiwaError("case: proper list is required")});define_syntax("and",function(D){if(D.cdr==nil)return!0;var w=D.cdr.to_array(),O=w.length-1,F=w[O];for(O=O-1;O>=0;O--)F=List(Sym("if"),w[O],F,!1);return F});define_syntax("or",function(D){for(var w=D.cdr.to_array(),O=!1,F=w.length-1;F>=0;F--)O=List(Sym("if"),w[F],w[F],O);return O});define_syntax("let",function(D){var w=null;D.cdr.car instanceof BiwaSymbol&&(w=D.cdr.car,D=D.cdr);var O=D.cdr.car,F=D.cdr.cdr;if(!(O instanceof Pair)&&O!=nil)throw new BiwaError("let: need a pair for bindings: got "+to_write$1(O));for(var q=nil,W=nil,U=O;U instanceof Pair;U=U.cdr){if(!(U.car instanceof Pair))throw new BiwaError("let: need a pair for bindings: got "+to_write$1(U.car));q=new Pair(U.car.car,q),W=new Pair(U.car.cdr.car,W)}var K=null;if(w){q=array_to_list(q.to_array().reverse()),W=array_to_list(W.to_array().reverse());var G=new Pair(Sym("lambda"),new Pair(q,F)),Y=new Pair(w,W);K=List(Sym("letrec"),new Pair(List(w,G),nil),Y)}else K=new Pair(new Pair(Sym("lambda"),new Pair(q,F)),W);return K});define_syntax("let*",function(D){var w=D.cdr.car,O=D.cdr.cdr;if(w===nil)return new Pair(Sym("let"),new Pair(nil,O));if(!(w instanceof Pair))throw new BiwaError("let*: need a pair for bindings: got "+to_write$1(w));var F=null;return w.to_array().reverse().forEach(function(q){F=new Pair(Sym("let"),new Pair(new Pair(q,nil),F==null?O:new Pair(F,nil)))}),F});var expand_letrec_star=function(D){var w=D.cdr.car,O=D.cdr.cdr;if(!(w instanceof Pair))throw new BiwaError("letrec*: need a pair for bindings: got "+to_write$1(w));var F=O;w.to_array().reverse().forEach(function(W){F=new Pair(new Pair(Sym("set!"),W),F)});var q=nil;return w.to_array().reverse().forEach(function(W){q=new Pair(new Pair(W.car,new Pair(undef,nil)),q)}),new Pair(Sym("let"),new Pair(q,F))};define_syntax("letrec",expand_letrec_star);define_syntax("letrec*",expand_letrec_star);define_syntax("let-values",function(D){var w=D.cdr.car,O=D.cdr.cdr,F=null,q=nil,W=nil;w.to_array().reverse().forEach(function(K){var G=K.cdr.car,Y=gensym(),Q=new Pair(Y,new Pair(new Pair(Sym("lambda"),new Pair(nil,new Pair(G,nil))),nil));q=new Pair(Q,q);var X=K.car;W=new Pair(new Pair(X,new Pair(new Pair(Y,nil),nil)),W)});var U=new Pair(Sym("let*-values"),new Pair(W,O));return F=new Pair(Sym("let"),new Pair(q,new Pair(U,nil))),F});define_syntax("let*-values",function(D){var w=D.cdr.car,O=D.cdr.cdr,F=null;return w.to_array().reverse().forEach(function(q){var W=q.car,U=q.cdr.car;F=new Pair(Sym("call-with-values"),new Pair(new Pair(Sym("lambda"),new Pair(nil,new Pair(U,nil))),new Pair(new Pair(Sym("lambda"),new Pair(W,F==null?O:new Pair(F,nil))),nil)))}),F});define_libfunc("eqv?",2,2,function(D){return eqv(D[0],D[1])});define_libfunc("eq?",2,2,function(D){return eq(D[0],D[1])});define_libfunc("equal?",2,2,function(D){return equal(D[0],D[1])});define_libfunc("procedure?",1,1,function(D){return isProcedure(D[0])});define_libfunc("number?",1,1,function(D){return isNumber(D[0])});define_libfunc("complex?",1,1,function(D){return isComplex(D[0])});define_libfunc("real?",1,1,function(D){return isReal(D[0])});define_libfunc("rational?",1,1,function(D){return isRational(D[0])});define_libfunc("integer?",1,1,function(D){return isInteger(D[0])});define_libfunc("=",2,null,function(D){var w=D[0];assert_number(D[0]);for(var O=1;O<D.length;O++)if(assert_number(D[O]),real_part(D[O])!=real_part(w)||imag_part(D[O])!=imag_part(w))return!1;return!0});define_libfunc("<",2,null,function(D){assert_number(D[0]);for(var w=1;w<D.length;w++)if(assert_number(D[w]),!(D[w-1]<D[w]))return!1;return!0});define_libfunc(">",2,null,function(D){assert_number(D[0]);for(var w=1;w<D.length;w++)if(assert_number(D[w]),!(D[w-1]>D[w]))return!1;return!0});define_libfunc("<=",2,null,function(D){assert_number(D[0]);for(var w=1;w<D.length;w++)if(assert_number(D[w]),!(D[w-1]<=D[w]))return!1;return!0});define_libfunc(">=",2,null,function(D){assert_number(D[0]);for(var w=1;w<D.length;w++)if(assert_number(D[w]),!(D[w-1]>=D[w]))return!1;return!0});define_libfunc("zero?",1,1,function(D){return assert_number(D[0]),D[0]===0});define_libfunc("positive?",1,1,function(D){return assert_number(D[0]),D[0]>0});define_libfunc("negative?",1,1,function(D){return assert_number(D[0]),D[0]<0});define_libfunc("odd?",1,1,function(D){return assert_number(D[0]),D[0]%2==1||D[0]%2==-1});define_libfunc("even?",1,1,function(D){return assert_number(D[0]),D[0]%2==0});define_libfunc("finite?",1,1,function(D){return assert_number(D[0]),D[0]!=1/0&&D[0]!=-1/0&&!isNaN(D[0])});define_libfunc("infinite?",1,1,function(D){return assert_number(D[0]),D[0]==1/0||D[0]==-1/0});define_libfunc("nan?",1,1,function(D){return assert_number(D[0]),isNaN(D[0])});define_libfunc("max",2,null,function(D){for(var w=0;w<D.length;w++)assert_number(D[w]);return Math.max.apply(null,D)});define_libfunc("min",2,null,function(D){for(var w=0;w<D.length;w++)assert_number(D[w]);return Math.min.apply(null,D)});var complex_or_real=function(D,w){return w===0?D:new Complex(D,w)},polar_or_real=function(D,w){return w===0?D:Complex.from_polar(D,w)};define_libfunc("+",0,null,function(D){for(var w=0,O=0,F=0;F<D.length;F++)assert_number(D[F]),w+=real_part(D[F]),O+=imag_part(D[F]);return complex_or_real(w,O)});var the_magnitude=function(D){return D instanceof Complex?D.magnitude():D},the_angle=function(D){return D instanceof Complex?D.angle():0};define_libfunc("*",0,null,function(D){for(var w=1,O=0,F=0;F<D.length;F++)assert_number(D[F]),w*=the_magnitude(D[F]),O+=the_angle(D[F]);return polar_or_real(w,O)});define_libfunc("-",1,null,function(D){var w=D.length;if(assert_number(D[0]),w==1)return D[0]instanceof Complex?new Complex(-real_part(D[0]),-imag_part(D[0])):-D[0];for(var O=real_part(D[0]),F=imag_part(D[0]),q=1;q<w;q++)assert_number(D[q]),O-=real_part(D[q]),F-=imag_part(D[q]);return complex_or_real(O,F)});define_libfunc("/",1,null,function(D){var w=D.length;if(assert_number(D[0]),w==1)return D[0]instanceof Complex?Complex.from_polar(1/the_magnitude(D[0]),-the_angle(D[0])):1/D[0];for(var O=the_magnitude(D[0]),F=the_angle(D[0]),q=1;q<w;q++)assert_number(D[q]),O/=the_magnitude(D[q]),F-=the_angle(D[q]);return polar_or_real(O,F)});define_libfunc("abs",1,1,function(D){return assert_number(D[0]),Math.abs(D[0])});var div=function(D,w){return Math.floor(D/w)},mod=function(D,w){return D-Math.floor(D/w)*w},div0=function(D,w){return D>0?Math.floor(D/w):Math.ceil(D/w)},mod0=function(D,w){return D>0?D-Math.floor(D/w)*w:D-Math.ceil(D/w)*w};define_libfunc("div-and-mod",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),new Values$1([div(D[0],D[1]),mod(D[0],D[1])])});define_libfunc("div",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),div(D[0],D[1])});define_libfunc("mod",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),mod(D[0],D[1])});define_libfunc("div0-and-mod0",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),new Values$1([div0(D[0],D[1]),mod0(D[0],D[1])])});define_libfunc("div0",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),div0(D[0],D[1])});define_libfunc("mod0",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),mod0(D[0],D[1])});alias_libfunc("div-and-mod","floor/");alias_libfunc("div","floor-quotient");alias_libfunc("mod","floor-remainder");var truncate_q=function(D,w){return Math.trunc(D/w)},truncate_r=function(D,w){return D-Math.trunc(D/w)*w};define_libfunc("truncate/",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),new Values$1([truncate_q(D[0],D[1]),truncate_r(D[0],D[1])])});define_libfunc("truncate-quotient",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),truncate_q(D[0],D[1])});define_libfunc("truncate-remainder",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),truncate_r(D[0],D[1])});alias_libfunc("truncate-quotient","quotient");alias_libfunc("truncate-remainder","remainder");alias_libfunc("floor-remainder","modulo");define_libfunc("numerator",1,1,function(D){if(assert_number(D[0]),D[0]instanceof Rational$1)return D[0].numerator;throw new Bug("todo")});define_libfunc("denominator",1,1,function(D){if(assert_number(D[0]),D[0]instanceof Rational$1)return D[0].denominator;throw new Bug("todo")});define_libfunc("floor",1,1,function(D){return assert_number(D[0]),Math.floor(D[0])});define_libfunc("ceiling",1,1,function(D){return assert_number(D[0]),Math.ceil(D[0])});define_libfunc("truncate",1,1,function(D){return assert_number(D[0]),D[0]<0?Math.ceil(D[0]):Math.floor(D[0])});define_libfunc("round",1,1,function(D){return assert_number(D[0]),Math.round(D[0])});define_libfunc("exp",1,1,function(D){return assert_number(D[0]),Math.exp(D[0])});define_libfunc("log",1,2,function(D){var w=D[0],O=D[1];return assert_number(w),O?(assert_number(O),Math.log(w)/Math.log(O)):Math.log(w)});define_libfunc("sin",1,1,function(D){return assert_number(D[0]),Math.sin(D[0])});define_libfunc("cos",1,1,function(D){return assert_number(D[0]),Math.cos(D[0])});define_libfunc("tan",1,1,function(D){return assert_number(D[0]),Math.tan(D[0])});define_libfunc("asin",1,1,function(D){return assert_number(D[0]),Math.asin(D[0])});define_libfunc("acos",1,1,function(D){return assert_number(D[0]),Math.acos(D[0])});define_libfunc("atan",1,2,function(D){return assert_number(D[0]),D.length==2?(assert_number(D[1]),Math.atan2(D[0],D[1])):Math.atan(D[0])});define_libfunc("sqrt",1,1,function(D){return assert_number(D[0]),Math.sqrt(D[0])});define_libfunc("exact-integer-sqrt",1,1,function(D){assert_number(D[0]);var w=Math.sqrt(D[0]),O=w-w%1,F=D[0]-O*O;return new Values$1([O,F])});define_libfunc("expt",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),Math.pow(D[0],D[1])});define_libfunc("make-rectangular",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),new Complex(D[0],D[1])});define_libfunc("make-polar",2,2,function(D){return assert_number(D[0]),assert_number(D[1]),Complex.from_polar(D[0],D[1])});var real_part=function(D){return Complex.assure(D).real},imag_part=function(D){return Complex.assure(D).imag};define_libfunc("real-part",1,1,function(D){return assert_number(D[0]),real_part(D[0])});define_libfunc("imag-part",1,1,function(D){return assert_number(D[0]),Complex.assure(D[0]).imag});define_libfunc("magnitude",1,1,function(D){return assert_number(D[0]),Complex.assure(D[0]).magnitude()});define_libfunc("angle",1,1,function(D){return assert_number(D[0]),Complex.assure(D[0]).angle()});define_libfunc("number->string",1,3,function(D){var w=D[0],O=D[1],F=D[2];if(F)throw new Bug("number->string: precision is not yet implemented");return O=O||10,w.toString(O)});define_libfunc("string->number",1,3,function(D){var w=D[0];if(w==="+inf.0")return 1/0;if(w==="-inf.0")return-1/0;if(w==="+nan.0")return NaN;var O=D[1],F=parse_integer(w,O===0?0:O||10);if(F!==!1)return F;if(O!==void 0&&O!==10)return!1;var q=parse_float(w);if(q!==!1)return q;var W=parse_fraction(w);return W!==!1?W:!1});define_libfunc("not",1,1,function(D){return D[0]===!1});define_libfunc("boolean?",1,1,function(D){return D[0]===!1||D[0]===!0});define_libfunc("boolean=?",2,null,function(D){for(var w=D.length,O=1;O<w;O++)if(D[O]!=D[0])return!1;return!0});define_libfunc("pair?",1,1,function(D){return D[0]instanceof Pair});define_libfunc("cons",2,2,function(D){return new Pair(D[0],D[1])});define_libfunc("car",1,1,function(D){if(!(D[0]instanceof Pair))throw new BiwaError("Attempt to apply car on "+D[0]);return D[0].car});define_libfunc("cdr",1,1,function(D){if(!(D[0]instanceof Pair))throw new BiwaError("Attempt to apply cdr on "+D[0]);return D[0].cdr});define_libfunc("set-car!",2,2,function(D){if(!(D[0]instanceof Pair))throw new BiwaError("Attempt to apply set-car! on "+D[0]);return D[0].car=D[1],undef});define_libfunc("set-cdr!",2,2,function(D){if(!(D[0]instanceof Pair))throw new BiwaError("Attempt to apply set-cdr! on "+D[0]);return D[0].cdr=D[1],undef});(function(){var D=function(w,O,F){var q=F;return O.forEach(function(W){if(q instanceof Pair)q=W?q.cdr:q.car;else throw new BiwaError(w+": attempt to get "+(W?"cdr":"car")+" of "+q)}),q};define_libfunc("caar",1,1,function(w){return D("caar",[0,0],w[0])}),define_libfunc("cadr",1,1,function(w){return D("cadr",[1,0],w[0])}),define_libfunc("cdar",1,1,function(w){return D("cadr",[0,1],w[0])}),define_libfunc("cddr",1,1,function(w){return D("cadr",[1,1],w[0])}),define_libfunc("caaar",1,1,function(w){return D("caaar",[0,0,0],w[0])}),define_libfunc("caadr",1,1,function(w){return D("caadr",[1,0,0],w[0])}),define_libfunc("cadar",1,1,function(w){return D("cadar",[0,1,0],w[0])}),define_libfunc("caddr",1,1,function(w){return D("caddr",[1,1,0],w[0])}),define_libfunc("cdaar",1,1,function(w){return D("cdaar",[0,0,1],w[0])}),define_libfunc("cdadr",1,1,function(w){return D("cdadr",[1,0,1],w[0])}),define_libfunc("cddar",1,1,function(w){return D("cddar",[0,1,1],w[0])}),define_libfunc("cdddr",1,1,function(w){return D("cdddr",[1,1,1],w[0])}),define_libfunc("caaaar",1,1,function(w){return D("caaaar",[0,0,0,0],w[0])}),define_libfunc("caaadr",1,1,function(w){return D("caaadr",[1,0,0,0],w[0])}),define_libfunc("caadar",1,1,function(w){return D("caadar",[0,1,0,0],w[0])}),define_libfunc("caaddr",1,1,function(w){return D("caaddr",[1,1,0,0],w[0])}),define_libfunc("cadaar",1,1,function(w){return D("cadaar",[0,0,1,0],w[0])}),define_libfunc("cadadr",1,1,function(w){return D("cadadr",[1,0,1,0],w[0])}),define_libfunc("caddar",1,1,function(w){return D("caddar",[0,1,1,0],w[0])}),define_libfunc("cadddr",1,1,function(w){return D("cadddr",[1,1,1,0],w[0])}),define_libfunc("cdaaar",1,1,function(w){return D("cdaaar",[0,0,0,1],w[0])}),define_libfunc("cdaadr",1,1,function(w){return D("cdaadr",[1,0,0,1],w[0])}),define_libfunc("cdadar",1,1,function(w){return D("cdadar",[0,1,0,1],w[0])}),define_libfunc("cdaddr",1,1,function(w){return D("cdaddr",[1,1,0,1],w[0])}),define_libfunc("cddaar",1,1,function(w){return D("cddaar",[0,0,1,1],w[0])}),define_libfunc("cddadr",1,1,function(w){return D("cddadr",[1,0,1,1],w[0])}),define_libfunc("cdddar",1,1,function(w){return D("cdddar",[0,1,1,1],w[0])}),define_libfunc("cddddr",1,1,function(w){return D("cddddr",[1,1,1,1],w[0])})})();define_libfunc("null?",1,1,function(D){return D[0]===nil});define_libfunc("list?",1,1,function(D){return isList(D[0])});define_libfunc("list",0,null,function(D){for(var w=nil,O=D.length-1;O>=0;O--)w=new Pair(D[O],w);return w});define_libfunc("length",1,1,function(D){assert_list(D[0]);for(var w=0,O=D[0];O!=nil;O=O.cdr)w++;return w});define_libfunc("append",1,null,function(D){for(var w=D.length,O=D[--w];w--;)D[w].to_array().reverse().forEach(function(F){O=new Pair(F,O)});return O});define_libfunc("reverse",1,1,function(D){if(D[0]==nil)return nil;assert_pair(D[0]);for(var w=nil,O=D[0];O!=nil;O=O.cdr)w=new Pair(O.car,w);return w});define_libfunc("list-tail",2,2,function(D){if(assert_pair(D[0]),assert_integer(D[1]),D[1]<0)throw new BiwaError("list-tail: index out of range ("+D[1]+")");for(var w=D[0],O=0;O<D[1];O++){if(!(w instanceof Pair))throw new BiwaError("list-tail: the list is shorter than "+D[1]);w=w.cdr}return w});define_libfunc("list-ref",2,2,function(D){if(assert_pair(D[0]),assert_integer(D[1]),D[1]<0)throw new BiwaError("list-tail: index out of range ("+D[1]+")");for(var w=D[0],O=0;O<D[1];O++){if(!(w instanceof Pair))throw new BiwaError("list-ref: the list is shorter than "+D[1]);w=w.cdr}return w.car});define_libfunc("map",2,null,function(D){var w=D.shift(),O=D;O.forEach(assert_list);var F=[];return Call.multi_foreach(O,{call:function(q){return new Call(w,q.map(function(W){return W.car}))},result:function(q){F.push(q)},finish:function(){return array_to_list(F)}})});define_libfunc("for-each",2,null,function(D){var w=D.shift(),O=D;return O.forEach(assert_list),Call.multi_foreach(O,{call:function(F){return new Call(w,F.map(function(q){return q.car}))},finish:function(){return undef}})});define_libfunc("symbol?",1,1,function(D){return D[0]instanceof BiwaSymbol});define_libfunc("symbol->string",1,1,function(D){return assert_symbol(D[0]),D[0].name});define_libfunc("symbol=?",2,null,function(D){assert_symbol(D[0]);for(var w=1;w<D.length;w++)if(assert_symbol(D[w]),D[w]!=D[0])return!1;return!0});define_libfunc("string->symbol",1,1,function(D){return assert_string(D[0]),Sym(D[0])});define_libfunc("char?",1,1,function(D){return D[0]instanceof Char});define_libfunc("char->integer",1,1,function(D){return assert_char(D[0]),D[0].value.charCodeAt(0)});define_libfunc("integer->char",1,1,function(D){return assert_integer(D[0]),Char.get(String.fromCharCode(D[0]))});var make_char_compare_func=function(D){return function(w){assert_char(w[0]);for(var O=1;O<w.length;O++)if(assert_char(w[O]),!D(w[O-1].value,w[O].value))return!1;return!0}};define_libfunc("char=?",2,null,make_char_compare_func(function(D,w){return D==w}));define_libfunc("char<?",2,null,make_char_compare_func(function(D,w){return D<w}));define_libfunc("char>?",2,null,make_char_compare_func(function(D,w){return D>w}));define_libfunc("char<=?",2,null,make_char_compare_func(function(D,w){return D<=w}));define_libfunc("char>=?",2,null,make_char_compare_func(function(D,w){return D>=w}));define_libfunc("string?",1,1,function(D){return typeof D[0]=="string"});define_libfunc("make-string",1,2,function(D){assert_integer(D[0]);var w=" ";D[1]&&(assert_char(D[1]),w=D[1].value);var O="";return Array(D[0]).fill().map(()=>{O+=w}),O});define_libfunc("string",0,null,function(D){if(D.length==0)return"";for(var w=0;w<D.length;w++)assert_char(D[w]);return D.map(function(O){return O.value}).join("")});define_libfunc("string-length",1,1,function(D){return assert_string(D[0]),D[0].length});define_libfunc("string-ref",2,2,function(D){return assert_string(D[0]),assert_between(D[1],0,D[0].length-1),Char.get(D[0].charAt([D[1]]))});define_libfunc("string=?",2,null,function(D){assert_string(D[0]);for(var w=1;w<D.length;w++)if(assert_string(D[w]),D[0]!=D[w])return!1;return!0});define_libfunc("string<?",2,null,function(D){assert_string(D[0]);for(var w=1;w<D.length;w++)if(assert_string(D[w]),!(D[w-1]<D[w]))return!1;return!0});define_libfunc("string>?",2,null,function(D){assert_string(D[0]);for(var w=1;w<D.length;w++)if(assert_string(D[w]),!(D[w-1]>D[w]))return!1;return!0});define_libfunc("string<=?",2,null,function(D){assert_string(D[0]);for(var w=1;w<D.length;w++)if(assert_string(D[w]),!(D[w-1]<=D[w]))return!1;return!0});define_libfunc("string>=?",2,null,function(D){assert_string(D[0]);for(var w=1;w<D.length;w++)if(assert_string(D[w]),!(D[w-1]>=D[w]))return!1;return!0});define_libfunc("substring",3,3,function(D){if(assert_string(D[0]),assert_integer(D[1]),assert_integer(D[2]),D[1]<0)throw new BiwaError("substring: start too small: "+D[1]);if(D[2]<0)throw new BiwaError("substring: end too small: "+D[2]);if(D[0].length+1<=D[1])throw new BiwaError("substring: start too big: "+D[1]);if(D[0].length+1<=D[2])throw new BiwaError("substring: end too big: "+D[2]);if(!(D[1]<=D[2]))throw new BiwaError("substring: not start <= end: "+D[1]+", "+D[2]);return D[0].substring(D[1],D[2])});define_libfunc("string-append",0,null,function(D){for(var w=0;w<D.length;w++)assert_string(D[w]);return D.join("")});define_libfunc("string->list",1,1,function(D){return assert_string(D[0]),array_to_list(D[0].split("").map(function(w){return Char.get(w[0])}))});define_libfunc("list->string",1,1,function(D){return assert_list(D[0]),D[0].to_array().map(function(w){return w.value}).join("")});define_libfunc("string-for-each",2,null,function(D){var w=D.shift(),O=D;return O.forEach(assert_string),Call.multi_foreach(O,{call:function(F){return new Call(w,F)},finish:function(){return undef}})});define_libfunc("string-copy",1,1,function(D){return assert_string(D[0]),D[0]});define_libfunc("vector?",1,1,function(D){return isVector(D[0])});define_libfunc("make-vector",1,2,function(D){assert_integer(D[0]);var w=new Array(D[0]);if(D.length==2)for(var O=0;O<D[0];O++)w[O]=D[1];return w});define_libfunc("vector",0,null,function(D){return D});define_libfunc("vector-length",1,1,function(D){return assert_vector(D[0]),D[0].length});define_libfunc("vector-ref",2,2,function(D){return assert_vector(D[0]),assert_integer(D[1]),assert_between(D[1],0,D[0].length-1),D[0][D[1]]});define_libfunc("vector-set!",3,3,function(D){return assert_vector(D[0]),assert_integer(D[1]),D[0][D[1]]=D[2],undef});define_libfunc("vector->list",1,1,function(D){return assert_vector(D[0]),array_to_list(D[0])});define_libfunc("list->vector",1,1,function(D){return assert_list(D[0]),D[0].to_array()});define_libfunc("vector-fill!",2,2,function(D){assert_vector(D[0]);for(var w=D[0],O=D[1],F=0;F<w.length;F++)w[F]=O;return w});define_libfunc("vector-map",2,null,function(D){var w=D.shift(),O=D;O.forEach(assert_vector);var F=[];return Call.multi_foreach(O,{call:function(q){return new Call(w,q)},result:function(q){F.push(q)},finish:function(){return F}})});define_libfunc("vector-for-each",2,null,function(D){var w=D.shift(),O=D;return O.forEach(assert_vector),Call.multi_foreach(O,{call:function(F){return new Call(w,F)},finish:function(){return undef}})});define_libfunc("apply",2,null,function(D){var w=D.shift(),O=D.pop(),F=D;return F=F.concat(O.to_array()),new Call(w,F)});define_syntax("call-with-current-continuation",function(D){return new Pair(Sym("call/cc"),D.cdr)});define_libfunc("values",0,null,function(D){return D.length==1?D[0]:new Values$1(D)});define_libfunc("call-with-values",2,2,function(D){var w=D[0],O=D[1];return assert_procedure(w),assert_procedure(O),new Call(w,[],function(F){var q=F[0];return q instanceof Values$1?new Call(O,q.content):new Call(O,[q])})});define_libfunc("dynamic-wind",3,3,function(D,w){var O=D[0],F=D[1],q=D[2];return new Call(O,[],function(){return w.push_dynamic_winder(O,q),new Call(F,[],function(W){var U=W[0];return w.pop_dynamic_winder(),new Call(q,[],function(){return U})})})});var expand_qq=function(D,w){if(D instanceof BiwaSymbol||D===nil)return List(Sym("quote"),D);if(D instanceof Pair){var O=D.car;return O instanceof Pair&&O.car===Sym("unquote-splicing")?w==1?D.cdr===nil?D.car.cdr.car:List(Sym("append"),D.car.cdr.car,expand_qq(D.cdr,w)):List(Sym("cons"),List(Sym("list"),List(Sym("quote"),Sym("unquote-splicing")),expand_qq(D.car.cdr.car,w-1)),expand_qq(D.cdr,w)):O===Sym("unquote")?w==1?D.cdr.car:List(Sym("list"),List(Sym("quote"),Sym("unquote")),expand_qq(D.cdr.car,w-1)):O===Sym("quasiquote")?List(Sym("list"),List(Sym("quote"),Sym("quasiquote")),expand_qq(D.cdr.car,w+1)):List(Sym("cons"),expand_qq(D.car,w),expand_qq(D.cdr,w))}else if(D instanceof Array){for(var F=[[]],q=0;q<D.length;q++)if(D[q]instanceof Pair&&D[q].car===Sym("unquote-splicing"))if(w==1){var W=List(Sym("list->vector"),D[q].cdr.car);W.splicing=!0,F.push(W),F.push([])}else{var W=List(Sym("cons"),List(Sym("list"),List(Sym("quote"),Sym("unquote-splicing")),expand_qq(D[q].car.cdr.car,w-1)),expand_qq(D[q].cdr,w));F[F.length-1].push(W)}else F[F.length-1].push(expand_qq(D[q],w));var U=F.map(function(K){return K.splicing?K:Cons(Sym("vector"),array_to_list(K))});return U.length==1?Cons(Sym("vector"),array_to_list(F[0])):Cons(Sym("vector-append"),array_to_list(U))}else return D};define_syntax("quasiquote",function(D){return expand_qq(D.cdr.car,1)});define_syntax("unquote",function(D){throw new BiwaError("unquote(,) must be inside quasiquote(`)")});define_syntax("unquote-splicing",function(D){throw new BiwaError("unquote-splicing(,@) must be inside quasiquote(`)")});define_libfunc("string-upcase",1,1,function(D){return assert_string(D[0]),D[0].toUpperCase()});define_libfunc("string-downcase",1,1,function(D){return assert_string(D[0]),D[0].toLowerCase()});const make_string_ci_function=function(D){return function(w){assert_string(w[0]);for(var O=w[0].toUpperCase(),F=1;F<w.length;F++)if(assert_string(w[F]),!D(O,w[F].toUpperCase()))return!1;return!0}};define_libfunc("string-ci=?",2,null,make_string_ci_function(function(D,w){return D==w}));define_libfunc("string-ci<?",2,null,make_string_ci_function(function(D,w){return D<w}));define_libfunc("string-ci>?",2,null,make_string_ci_function(function(D,w){return D>w}));define_libfunc("string-ci<=?",2,null,make_string_ci_function(function(D,w){return D<=w}));define_libfunc("string-ci>=?",2,null,make_string_ci_function(function(D,w){return D>=w}));define_libfunc("find",2,2,function(D){var w=D[0],O=D[1];return assert_list(O),Call.foreach(O,{call:function(F){return new Call(w,[F.car])},result:function(F,q){if(F)return q.car},finish:function(){return!1}})});define_libfunc("for-all",2,null,function(D){var w=D.shift(),O=D;O.forEach(assert_list);var F=!0;return Call.multi_foreach(O,{call:function(q){return new Call(w,q.map(function(W){return W.car}))},result:function(q,W){if(q===!1)return!1;F=q},finish:function(){return F}})});define_libfunc("exists",2,null,function(D){var w=D.shift(),O=D;return O.forEach(assert_list),Call.multi_foreach(O,{call:function(F){return new Call(w,F.map(function(q){return q.car}))},result:function(F,q){if(F!==!1)return F},finish:function(){return!1}})});define_libfunc("filter",2,2,function(D){var w=D[0],O=D[1];assert_list(O);var F=[];return Call.foreach(O,{call:function(q){return new Call(w,[q.car])},result:function(q,W){q&&F.push(W.car)},finish:function(){return array_to_list(F)}})});define_libfunc("partition",2,2,function(D){var w=D[0],O=D[1];assert_list(O);var F=[],q=[];return Call.foreach(O,{call:function(W){return new Call(w,[W.car])},result:function(W,U){W?F.push(U.car):q.push(U.car)},finish:function(){return new Values$1([array_to_list(F),array_to_list(q)])}})});define_libfunc("fold-left",3,null,function(D){var w=D.shift(),O=D.shift(),F=D;return F.forEach(assert_list),Call.multi_foreach(F,{call:function(q){var W=q.map(function(U){return U.car});return W.unshift(O),new Call(w,W)},result:function(q,W){O=q},finish:function(){return O}})});define_libfunc("fold-right",3,null,function(D){var w=D.shift(),O=D.shift(),F=D.map(function(q){return assert_list(q),array_to_list(q.to_array().reverse())});return Call.multi_foreach(F,{call:function(q){var W=q.map(function(U){return U.car});return W.push(O),new Call(w,W)},result:function(q,W){O=q},finish:function(){return O}})});define_libfunc("remp",2,2,function(D){var w=D[0],O=D[1];assert_list(O);var F=[];return Call.foreach(O,{call:function(q){return new Call(w,[q.car])},result:function(q,W){q||F.push(W.car)},finish:function(){return array_to_list(F)}})});var make_remover=function(D){return function(w){var O=w[0],F=w[1];assert_list(F);var q=[];return Call.foreach(F,{call:function(W){return new Call(TopEnv[D]||CoreEnv[D],[O,W.car])},result:function(W,U){W||q.push(U.car)},finish:function(){return array_to_list(q)}})}};define_libfunc("remove",2,2,make_remover("equal?"));define_libfunc("remv",2,2,make_remover("eqv?"));define_libfunc("remq",2,2,make_remover("eq?"));define_libfunc("memp",2,2,function(D){var w=D[0],O=D[1];return assert_list(O),Call.foreach(O,{call:function(F){return new Call(w,[F.car])},result:function(F,q){if(F)return q},finish:function(){return!1}})});var make_finder=function(D){return function(w){var O=w[0],F=w[1];return assert_list(F),Call.foreach(F,{call:function(q){return new Call(TopEnv[D]||CoreEnv[D],[O,q.car])},result:function(q,W){if(q)return W},finish:function(){return!1}})}};define_libfunc("member",2,2,make_finder("equal?"));define_libfunc("memv",2,2,make_finder("eqv?"));define_libfunc("memq",2,2,make_finder("eq?"));define_libfunc("assp",2,2,function(D){var w=D[0],O=D[1];return assert_list(O),Call.foreach(O,{call:function(F){if(F.car.car)return new Call(w,[F.car.car]);throw new BiwaError("ass*: pair required but got "+to_write$1(F.car))},result:function(F,q){if(F)return q.car},finish:function(){return!1}})});var make_assoc=function(D,w){return function(O){var F=O[0],q=O[1];return assert_list(q),Call.foreach(q,{call:function(W){if(!isPair(W.car))throw new BiwaError(D+": pair required but got "+to_write$1(W.car));var U=TopEnv[w]||CoreEnv[w];return new Call(U,[F,W.car.car])},result:function(W,U){if(W)return U.car},finish:function(){return!1}})}};define_libfunc("assoc",2,2,make_assoc("assoc","equal?"));define_libfunc("assv",2,2,make_assoc("assv","eqv?"));define_libfunc("assq",2,2,make_assoc("assq","eq?"));define_libfunc("cons*",1,null,function(D){if(D.length==1)return D[0];var w=null;return D.reverse().forEach(function(O){w?w=new Pair(O,w):w=O}),w});(function(){var D=function(q,W,U){return q.length<=1?U(q):w(q,W,U,[[0,q.length,!1]],!1)},w=function(q,W,U,K,G){for(;;){var Y=K[K.length-1][0],Q=K[K.length-1][1],X=K[K.length-1][2],J=Q-Y;if(J>=2&&!G){K.push([Y,Y+(J>>1),!0]);continue}else if(X){K.pop();var Z=K[K.length-1][1];K.push([Q,Z,!1]),G=!1;continue}else{K.pop();var ee=K[K.length-1][0],ne=q.slice(ee,Y),te=q.slice(Y,Q);return O(ne,te,W,[],0,0,function(re){for(var se=0;se<re.length;se++)q[ee+se]=re[se];return K.length==1?U(q):w(q,W,U,K,!0)})}}},O=function(q,W,U,K,G,Y,Q){var X=q.length,J=W.length;if(G<X&&Y<J)return new Call(U,[W[Y],q[G]],function(Z){return Z[0]?(K.push(W[Y]),Y+=1):(K.push(q[G]),G+=1),O(q,W,U,K,G,Y,Q)});for(;G<X;)K.push(q[G]),G+=1;for(;Y<J;)K.push(W[Y]),Y+=1;return Q(K)},F=function(q,W){return lt(q,W)?-1:lt(W,q)?1:0};define_libfunc("list-sort",1,2,function(q){return q[1]?(assert_procedure(q[0]),assert_list(q[1]),D(q[1].to_array(),q[0],function(W){return array_to_list(W)})):(assert_list(q[0]),array_to_list(q[0].to_array().sort(F)))}),define_libfunc("vector-sort",1,2,function(q){return q[1]?(assert_procedure(q[0]),assert_vector(q[1]),D([...q[1]],q[0],function(W){return W})):(assert_vector(q[0]),[...q[0]].sort(F))}),define_libfunc("vector-sort!",1,2,function(q){return q[1]?(assert_procedure(q[0]),assert_vector(q[1]),D(q[1],q[0],function(W){return undef})):(assert_vector(q[0]),q[0].sort(F),undef)})})();define_syntax("when",function(D){var w=D.cdr.car,O=D.cdr.cdr;return new Pair(Sym("if"),new Pair(w,new Pair(new Pair(Sym("begin"),O),new Pair(undef,nil))))});define_syntax("unless",function(D){var w=D.cdr.car,O=D.cdr.cdr;return new Pair(Sym("if"),new Pair(new Pair(Sym("not"),new Pair(w,nil)),new Pair(new Pair(Sym("begin"),O),new Pair(undef,nil))))});define_syntax("do",function(D){if(!isPair(D.cdr))throw new BiwaError("do: no variables of do");var w=D.cdr.car;if(!isPair(w))throw new BiwaError("do: variables must be given as a list");if(!isPair(D.cdr.cdr))throw new BiwaError("do: no resulting form of do");var O=D.cdr.cdr.car,F=D.cdr.cdr.cdr,q=gensym(),W=array_to_list(w.map(function(Q){var X=Q.to_array();return List(X[0],X[1])})),U=O.car,K=new Pair(Sym("begin"),O.cdr),G=new Pair(q,array_to_list(w.map(function(Q){var X=Q.to_array();return X[2]||X[0]}))),Y=new Pair(Sym("begin"),F).concat(List(G));return List(Sym("let"),q,W,List(Sym("if"),U,K,Y))});define_syntax("case-lambda",function(D){if(!isPair(D.cdr))throw new BiwaError("case-lambda: at least 1 clause required");var w=D.cdr.to_array(),O=gensym(),F=List(Sym("raise"),"case-lambda: no matching clause found");return w.reverse().forEach(function(q){if(!isPair(q))throw new BiwaError("case-lambda: clause must be a pair: "+to_write$1(q));var W=q.car,U=q.cdr;if(W===nil)F=List(Sym("if"),List(Sym("null?"),O),new Pair(Sym("begin"),U),F);else if(isPair(W)){var K=W.length(),G=W.last_cdr(),Y=Sym(G===nil?"=":">="),Q=new Pair(Sym("lambda"),new Pair(W,U));F=List(Sym("if"),List(Y,List(Sym("length"),O),K),List(Sym("apply"),Q,O),F)}else if(isSymbol(W))F=new Pair(Sym("let1"),new Pair(W,new Pair(O,U)));else throw new BiwaError("case-lambda: invalid formals: "+to_write$1(W))}),List(Sym("lambda"),O,F)});define_syntax("define-record-type",function(D){var w=D.cdr.car,O=D.cdr.cdr;if(isSymbol(w))var F=w,q=Sym("make-"+w.name),W=Sym(w.name+"?");else{assert_list(w);var F=w.car,q=w.cdr.car,W=w.cdr.cdr.car;assert_symbol(F),assert_symbol(q),assert_symbol(W)}var U=!1,K=!1,G=!1,Y,Q=!1,X=!1,J=!1,Z=[];O.to_array().forEach(function(ae){switch(ae.car){case Sym("fields"):Z=ae.cdr.to_array().map(function(ce,de){if(isSymbol(ce))return{name:ce,idx:de,mutable:!1,accessor_name:null,mutator_name:null};switch(assert_list(ce),assert_symbol(ce.car),ce.car){case Sym("immutable"):var fe=ce.cdr.car;return assert_symbol(fe),isNil(ce.cdr.cdr)?{name:fe,idx:de,mutable:!1}:{name:fe,idx:de,mutable:!1,accessor_name:ce.cdr.cdr.car};case Sym("mutable"):var fe=ce.cdr.car;return assert_symbol(fe),isNil(ce.cdr.cdr)?{name:fe,idx:de,mutable:!0}:{name:fe,idx:de,mutable:!0,accessor_name:ce.cdr.cdr.car,mutator_name:ce.cdr.cdr.cdr.car};default:throw new BiwaError("define-record-type: field definition must start with `immutable' or `mutable' but got "+inspect(ce.car))}});break;case Sym("parent"):Y=ae.cdr.car,assert_symbol(Y);break;case Sym("protocol"):J=ae.cdr.car;break;case Sym("sealed"):U=!!ae.cdr.car;break;case Sym("opaque"):K=!!ae.cdr.car;break;case Sym("nongenerative"):G=ae.cdr.car;break;case Sym("parent-rtd"):Q=ae.cdr.car,X=ae.cdr.cdr.car;break;default:throw new BiwaError("define-record-type: unknown clause `"+to_write$1(ae.car)+"'")}}),Y&&(Q=[Sym("record-type-descriptor"),Y],X=[Sym("record-constructor-descriptor"),Y]);var ee=[Sym("record-type-descriptor"),F],ne=[Sym("record-constructor-descriptor"),F],te=Z.map(function(ae){return List(Sym(ae.mutable?"mutable":"immutable"),ae.name)});te.is_vector=!0;var re=[Sym("make-record-type-descriptor"),[Sym("quote"),F],Q,G,U,K,te],se=[Sym("make-record-constructor-descriptor"),Sym("__rtd"),X,J],le=[Sym("let*"),[[Sym("__rtd"),re],[Sym("__cd"),se]],[Sym("_define-record-type"),[Sym("quote"),F],Sym("__rtd"),Sym("__cd")]],ue=Z.map(function(ae){var ce=ae.accessor_name||Sym(F.name+"-"+ae.name.name);return[Sym("define"),ce,[Sym("record-accessor"),ee,ae.idx]]}),oe=Z.filter(function(ae){return ae.mutable});return oe=oe.map(function(ae){var ce=ae.mutator_name||Sym(F.name+"-"+ae.name.name+"-set!");return[Sym("define"),ce,[Sym("record-mutator"),ee,ae.idx]]}),deep_array_to_list([Sym("begin"),le,[Sym("define"),q,[Sym("record-constructor"),ne]],[Sym("define"),W,[Sym("record-predicate"),ee]]].concat(ue).concat(oe))});define_libfunc("_define-record-type",3,3,function(D){return assert_symbol(D[0]),assert_record_td(D[1]),assert_record_cd(D[2]),Record.define_type(D[0].name,D[1],D[2]),undef});define_syntax("record-type-descriptor",function(D){return deep_array_to_list([Sym("_record-type-descriptor"),[Sym("quote"),D.cdr.car]])});define_libfunc("_record-type-descriptor",1,1,function(D){assert_symbol(D[0]);var w=Record.get_type(D[0].name);if(w)return w.rtd;throw new BiwaError("record-type-descriptor: unknown record type "+D[0].name)});define_syntax("record-constructor-descriptor",function(D){return deep_array_to_list([Sym("_record-constructor-descriptor"),[Sym("quote"),D.cdr.car]])});define_libfunc("_record-constructor-descriptor",1,1,function(D){assert_symbol(D[0]);var w=Record.get_type(D[0].name);if(w)return w.cd;throw new BiwaError("record-constructor-descriptor: unknown record type "+D[0].name)});define_libfunc("make-record-type-descriptor",6,6,function(D){var w=D[0],O=D[1],F=D[2],q=D[3],W=D[4],U=D[5];if(assert_symbol(w),O&&assert_record_td(O),F){assert_symbol(F);var K=Record.RTD.NongenerativeRecords[F.name];if(K)return K}q=!!q,W=!!W,assert_vector(U);for(var G=0;G<U.length;G++){var Y=U[G];assert_symbol(Y.car,"mutability"),assert_symbol(Y.cdr.car,"field name"),U[G]=[Y.cdr.car.name,Y.car==Sym("mutable")]}var Q=new Record.RTD(w,O,F,q,W,U);return F&&(Record.RTD.NongenerativeRecords[F.name]=Q),Q});define_libfunc("record-type-descriptor?",1,1,function(D){return D[0]instanceof Record.RTD});define_libfunc("make-record-constructor-descriptor",3,3,function(D){var w=D[0],O=D[1],F=D[2];return assert_record_td(w),O&&assert_record_cd(O),F&&assert_procedure(F),new Record.CD(w,O,F)});define_libfunc("record-constructor",1,1,function(D){var w=D[0];return assert_record_cd(w),w.record_constructor()});define_libfunc("record-predicate",1,1,function(D){var w=D[0];return assert_record_td(w),function(O){var F=O[0];if(F instanceof Record){if(F.rtd===w)return!0;for(let q=F.rtd;q;q=q.parent_rtd)if(q==w)return!0;return!1}else return!1}});define_libfunc("record-accessor",2,2,function(D){var w=D[0],O=D[1];assert_record_td(w),assert_integer(O);for(var F=w.parent_rtd;F;F=F.parent_rtd)O+=F.fields.length;return function(q){var W=q[0],U=w.name.name+"-"+w.field_name(O)+": "+to_write$1(W)+" is not a "+w.name.name;assert(isRecord(W),U);for(var K=!1,G=W.rtd;G;G=G.parent_rtd)G==w&&(K=!0);return assert(K,U),W.get(O)}});define_libfunc("record-mutator",2,2,function(D){var w=D[0],O=D[1];assert_record_td(w),assert_integer(O);for(var F=w.parent_rtd;F;F=F.parent_rtd)O+=F.fields.length;return function(q){var W=q[0],U=q[1],K=w.field_name(O);assert_record(W),assert(W.rtd===w,K+": "+to_write$1(W)+" is not a "+w.name.name),assert(!W.rtd.sealed,K+": "+w.name.name+" is sealed (can't mutate)"),W.set(O,U)}});define_libfunc("record?",1,1,function(D){var w=D[0];return isRecord(w)?!w.rtd.opaque:!1});define_libfunc("record-rtd",1,1,function(D){return assert_record(D[0]),D[0].rtd});define_libfunc("record-type-name",1,1,function(D){return assert_record_td(D[0]),D[0].name});define_libfunc("record-type-parent",1,1,function(D){return assert_record_td(D[0]),D[0].parent_rtd});define_libfunc("record-type-uid",1,1,function(D){return assert_record_td(D[0]),D[0].uid});define_libfunc("record-type-generative?",1,1,function(D){return assert_record_td(D[0]),D[0].generative});define_libfunc("record-type-sealed?",1,1,function(D){return assert_record_td(D[0]),D[0].sealed});define_libfunc("record-type-opaque?",1,1,function(D){return assert_record_td(D[0]),D[0].opaque});define_libfunc("record-type-field-names",1,1,function(D){return assert_record_td(D[0]),D[0].fields.map(function(w){return w.name})});define_libfunc("record-field-mutable?",2,2,function(D){var w=D[0],O=D[1];assert_record_td(D[0]),assert_integer(O);for(var F=w.parent_rtd;F;F=F.parent_rtd)O+=F.fields.length;return D[0].fields[O].mutable});define_libfunc("raise",1,1,function(D){throw new UserError(to_write$1(D[0]))});define_libfunc("port?",1,1,function(D){return D[0]instanceof Port});define_libfunc("textual-port?",1,1,function(D){return assert_port(D[0]),!D[0].is_binary});define_libfunc("binary-port?",1,1,function(D){return assert_port(D[0]),D[0].is_binary});define_libfunc("close-port",1,1,function(D){return assert_port(D[0]),D[0].close(),undef});define_libfunc("call-with-port",2,2,function(D){var w=D[0],O=D[1];return assert_port(w),assert_closure(O),new Call(O,[w],function(F){return w.close(),F[0]})});define_libfunc("call-with-string-output-port",1,1,function(D){var w=D[0];assert_procedure(w);var O=new Port.StringOutput;return new Call(w,[O],function(F){return O.close(),O.output_string()})});define_libfunc("put-char",2,2,function(D){return assert_port(D[0]),assert_char(D[1]),D[0].put_string(D[1].value),undef});define_libfunc("put-string",2,2,function(D){return assert_port(D[0]),assert_string(D[1]),D[0].put_string(D[1]),undef});define_libfunc("put-datum",2,2,function(D){return assert_port(D[0]),D[0].put_string(to_write$1(D[1])),undef});define_libfunc("eof-object",0,0,function(D){return eof});define_libfunc("eof-object?",1,1,function(D){return D[0]===eof});define_libfunc("input-port?",1,1,function(D){return assert_port(D[0]),D[0].is_input});define_libfunc("output-port?",1,1,function(D){return assert_port(D[0]),D[0].is_output});define_libfunc("current-input-port",0,0,function(D){return Port.current_input});define_libfunc("current-output-port",0,0,function(D){return Port.current_output});define_libfunc("current-error-port",0,0,function(D){return Port.current_error});define_libfunc("close-input-port",1,1,function(D){if(assert_port(D[0]),!D[0].is_input)throw new BiwaError("close-input-port: port is not input port");return D[0].close(),undef});define_libfunc("close-output-port",1,1,function(D){if(assert_port(D[0]),!D[0].is_output)throw new BiwaError("close-output-port: port is not output port");return D[0].close(),undef});define_libfunc("read",0,1,function(D){var w=D[0]||Port.current_input;return assert_port(w),w.get_string(function(O){return Interpreter.read(O)})});define_libfunc("write-char",1,2,function(D){var w=D[1]||Port.current_output;return assert_char(D[0]),w.put_string(D[0].value),undef});define_libfunc("newline",0,1,function(D){var w=D[0]||Port.current_output;return w.put_string(`
`),undef});define_libfunc("display",1,2,function(D){var w=D[1]||Port.current_output;return w.put_string(to_display(D[0])),undef});define_libfunc("write",1,2,function(D){var w=D[1]||Port.current_output;return assert_port(w),w.put_string(to_write$1(D[0])),undef});define_libfunc("write-shared",1,2,function(D){var w=D[1]||Port.current_output;return assert_port(w),w.put_string(write_shared(D[0])),undef});define_libfunc("write-simple",1,2,function(D){var w=D[1]||Port.current_output;return assert_port(w),w.put_string(write_simple(D[0])),undef});define_libfunc("bitwise-not",1,1,function(D){return~D[0]});define_libfunc("bitwise-and",1,null,function(D){return D.reduce(function(w,O){return w&O})});define_libfunc("bitwise-ior",1,null,function(D){return D.reduce(function(w,O){return w|O})});define_libfunc("bitwise-xor",1,null,function(D){return D.reduce(function(w,O){return w^O})});define_libfunc("bitwise-if",3,3,function(D){return D[0]&D[1]|~D[0]&D[2]});define_libfunc("bitwise-bit-count",1,1,function(D){for(var w=Math.abs(D[0]),O=0;w!=0;w>>=1)w&1&&O++;return O});define_libfunc("bitwise-length",1,1,function(D){for(var w=Math.abs(D[0]),O=0;w!=0;w>>=1)O++;return O});define_libfunc("bitwise-first-bit-set",1,1,function(D){var w=Math.abs(D[0]),O=0;if(w==0)return-1;for(;w!=0;w>>=1){if(w&1)return O;O++}});define_libfunc("bitwise-bit-set?",2,2,function(D){return!!(D[0]&1<<D[1])});define_libfunc("bitwise-copy-bit",3,3,function(D){var w=1<<D[1];return w&D[2]<<D[1]|~w&D[0]});define_libfunc("bitwise-bit-field",3,3,function(D){var w=~(-1<<D[2]);return(w&D[0])>>D[1]});define_libfunc("bitwise-copy-bit-field",4,4,function(D){var w=D[0],O=D[1],F=D[2],q=D[3],W=~(-1<<F)&-1<<O;return W&q<<O|~W&w});define_libfunc("bitwise-arithmetic-shift",2,2,function(D){return D[1]>=0?D[0]<<D[1]:D[0]>>-D[1]});define_libfunc("bitwise-arithmetic-shift-left",2,2,function(D){return D[0]<<D[1]});define_libfunc("bitwise-arithmetic-shift-right",2,2,function(D){return D[0]>>D[1]});define_libfunc("bitwise-rotate-bit-field",4,4,function(D){var w=D[0],O=D[1],F=D[2],q=D[3],W=F-O;if(W<=0)return w;q%=W;var U=(~(-1<<F)&w)>>O,K=U<<q|U>>W-q,G=~(-1<<F)&-1<<O;return G&K<<O|~G&w});define_libfunc("bitwise-reverse-bit-field",3,3,function(D){for(var w=D[0],O=D[0],F=D[1],q=D[2],W=(~(-1<<q)&O)>>F,U=0;U<q-F;U++,W>>=1){var K=W&1,G=q-1-U,Y=1<<G;w=Y&K<<G|~Y&w}return w});define_libfunc("make-eq-hashtable",0,1,function(D){return new Hashtable(Hashtable.eq_hash,Hashtable.eq_equiv)});define_libfunc("make-eqv-hashtable",0,1,function(D){return new Hashtable(Hashtable.eqv_hash,Hashtable.eqv_equiv)});define_libfunc("make-hashtable",2,3,function(D){return assert_procedure(D[0]),assert_procedure(D[1]),new Hashtable(D[0],D[1])});define_libfunc("hashtable?",1,1,function(D){return D[0]instanceof Hashtable});define_libfunc("hashtable-size",1,1,function(D){return assert_hashtable(D[0]),D[0].keys().length});const find_hash_pair=function(D,w,O){return new Call(D.hash_proc,[w],function(F){var q=F[0],W=D.candidate_pairs(q);return W?Call.foreach(W,{call:function(U){return new Call(D.equiv_proc,[w,U[0]])},result:function(U,K){if(U)return O.on_found(K,q)},finish:function(){return O.on_not_found(q)}}):O.on_not_found(q)})};define_libfunc("hashtable-ref",3,3,function(D){var w=D[0],O=D[1],F=D[2];return assert_hashtable(w),find_hash_pair(w,O,{on_found:function(q){return q[1]},on_not_found:function(q){return F}})});define_libfunc("hashtable-set!",3,3,function(D){var w=D[0],O=D[1],F=D[2];return assert_hashtable(w),assert(w.mutable,"hashtable is not mutable"),find_hash_pair(w,O,{on_found:function(q){return q[1]=F,undef},on_not_found:function(q){return w.add_pair(q,O,F),undef}})});define_libfunc("hashtable-delete!",2,2,function(D){var w=D[0],O=D[1];return assert_hashtable(w),assert(w.mutable,"hashtable is not mutable"),find_hash_pair(w,O,{on_found:function(F,q){return w.remove_pair(q,F),undef},on_not_found:function(F){return undef}})});define_libfunc("hashtable-contains?",2,2,function(D){var w=D[0],O=D[1];return assert_hashtable(w),find_hash_pair(w,O,{on_found:function(F){return!0},on_not_found:function(F){return!1}})});define_libfunc("hashtable-update!",4,4,function(D){var w=D[0],O=D[1],F=D[2],q=D[3];return assert_hashtable(w),assert(w.mutable,"hashtable is not mutable"),assert_procedure(F),find_hash_pair(w,O,{on_found:function(W,U){return new Call(F,[W[1]],function(K){return W[1]=K[0],undef})},on_not_found:function(W){return new Call(F,[q],function(U){return w.add_pair(W,O,U[0]),undef})}})});define_libfunc("hashtable-copy",1,2,function(D){var w=D[1]===void 0?!1:!!D[1];return assert_hashtable(D[0]),D[0].create_copy(w)});define_libfunc("hashtable-clear!",0,1,function(D){return assert_hashtable(D[0]),assert(D[0].mutable,"hashtable is not mutable"),D[0].clear(),undef});define_libfunc("hashtable-keys",1,1,function(D){return assert_hashtable(D[0]),D[0].keys()});define_libfunc("hashtable-entries",1,1,function(D){return assert_hashtable(D[0]),new Values$1([D[0].keys(),D[0].values()])});define_libfunc("hashtable-equivalence-function",1,1,function(D){return assert_hashtable(D[0]),D[0].equiv_proc});define_libfunc("hashtable-hash-function",1,1,function(D){return assert_hashtable(D[0]),D[0].hash_proc});define_libfunc("hashtable-mutable?",1,1,function(D){return assert_hashtable(D[0]),D[0].mutable});define_libfunc("equal-hash",0,0,function(D){return Hashtable.equal_hash});define_libfunc("string-hash",0,0,function(D){return Hashtable.string_hash});define_libfunc("string-ci-hash",0,0,function(D){return Hashtable.string_ci_hash});define_libfunc("symbol-hash",0,0,function(D){return Hashtable.symbol_hash});define_libfunc("make-enumeration",1,1,function(D){assert_list(D[0]);var w=D[0].to_array(),O=new Enumeration.EnumType(w);return O.universe()});define_libfunc("enum-set-universe",1,1,function(D){return assert_enum_set(D[0]),D[0].enum_type.universe()});define_libfunc("enum-set-indexer",1,1,function(D){return assert_enum_set(D[0]),D[0].enum_type.indexer()});define_libfunc("enum-set-constructor",1,1,function(D){return assert_enum_set(D[0]),D[0].enum_type.constructor_()});define_libfunc("enum-set->list",1,1,function(D){return assert_enum_set(D[0]),D[0].symbol_list()});define_libfunc("enum-set-member?",2,2,function(D){return assert_symbol(D[0]),assert_enum_set(D[1]),D[1].is_member(D[0])});define_libfunc("enum-set-subset?",2,2,function(D){return assert_enum_set(D[0]),assert_enum_set(D[1]),D[0].is_subset(D[1])});define_libfunc("enum-set=?",2,2,function(D){return assert_enum_set(D[0]),assert_enum_set(D[1]),D[0].equal_to(D[1])});define_libfunc("enum-set-union",2,2,function(D){return assert_enum_set(D[0]),assert_enum_set(D[1]),assert(D[0].enum_type===D[1].enum_type,"two enum-sets must be the same enum-type","enum-set-union"),D[0].union(D[1])});define_libfunc("enum-set-intersection",2,2,function(D){return assert_enum_set(D[0]),assert_enum_set(D[1]),D[0].intersection(D[1])});define_libfunc("enum-set-difference",2,2,function(D){return assert_enum_set(D[0]),assert_enum_set(D[1]),D[0].difference(D[1])});define_libfunc("enum-set-complement",1,1,function(D){return assert_enum_set(D[0]),D[0].complement()});define_libfunc("enum-set-projection",2,2,function(D){return assert_enum_set(D[0]),assert_enum_set(D[1]),D[0].projection(D[1])});define_syntax("define-enumeration",function(D){var w=D.cdr.car;assert(isSymbol(w),"expected symbol for type_name","define-enumeration"),w=w.name;var O=D.cdr.cdr.car;assert(isList(O),"expected list of symbol for members","define-enumeration"),O=O.to_array();var F=D.cdr.cdr.cdr.car;assert(isSymbol(F),"expected symbol for constructor_name","define-enumeration"),F=F.name;var q=new Enumeration.EnumType(O);define_syntax(w,function(W){assert(!isNil(W.cdr),"an argument is needed",w);var U=W.cdr.car;return assert_symbol(U,w),assert(q.members.includes(U),U.name+" is not included in the universe: "+to_write$1(q.members),w),List(Sym("quote"),U)}),define_syntax(F,function(W){assert_list(W.cdr,F);var U=W.cdr.to_array();return U.forEach(function(K){assert_symbol(K,F),assert(q.members.includes(K),K.name+" is not included in the universe: "+to_write$1(q.members),F)}),new Enumeration.EnumSet(q,U)})});define_libfunc("eval",1,1,function(D,w){var O=D[0],F=new Interpreter(w);return F.evaluate(to_write$1(O))});define_syntax("delay",function(D){if(D.cdr===nil)throw new BiwaError("malformed delay: no argument");if(D.cdr.cdr!==nil)throw new BiwaError("malformed delay: too many arguments: "+write_ss(D));var w=D.cdr.car;return new Pair(Sym(" procedure->promise"),new Pair(new Pair(Sym("lambda"),new Pair(nil,new Pair(new Pair(Sym("make-promise"),new Pair(w,nil)),nil)))))});define_syntax("delay-force",function(D){if(D.cdr===nil)throw new BiwaError("malformed delay-force: no argument");if(D.cdr.cdr!==nil)throw new BiwaError("malformed delay-force: too many arguments: "+write_ss(D));var w=D.cdr.car;return new Pair(Sym(" procedure->promise"),new Pair(new Pair(Sym("lambda"),new Pair(nil,new Pair(w,nil))),nil))});var force=function(D){return D.is_done()?D.value():new Call(D.thunk(),[],function(w){assert_promise(w[0]);var O=w[0];return D.is_done()?D.value():(D.update_with(O),force(O))})};define_libfunc("force",1,1,function(D,w){return assert_promise(D[0]),force(D[0])});define_libfunc("promise?",1,1,function(D,w){return D[0]instanceof BiwaPromise});define_libfunc("make-promise",1,1,function(D,w){var O=D[0];return O instanceof BiwaPromise?O:BiwaPromise.done(O)});define_libfunc(" procedure->promise",1,1,function(D,w){return assert_procedure(D[0]),BiwaPromise.fresh(D[0])});define_libfunc("make-parameter",1,2,function(D,w){let O;const F=D[1],q=function(W){if(W.length==0)return O;{const U=O;return F?new Call(F,[W[0]],K=>(O=K[0],U)):(O=W[0],U)}};return F?new Call(F,[D[0]],W=>(O=W,q)):(O=D[0],q)});define_syntax("parameterize",function(D){const w=D.cdr.car.to_array(),O=D.cdr.cdr,F=w.map(()=>gensym()),q=List(...w.map((Y,Q)=>List(F[Q],Y.cdr.car))),W=Cons(Sym("begin"),List(...w.map((Y,Q)=>List(Sym("set!"),F[Q],List(Y.car,F[Q]))))),U=List(Sym("lambda"),nil,W),K=Cons(Sym("lambda"),Cons(nil,O)),G=List(Sym("lambda"),nil,W);return List(Sym("let"),q,List(Sym("dynamic-wind"),U,K,G))});define_libfunc("iota",1,3,function(D){var w=D[0],O=D[1]||0,F=D[2]===void 0?1:D[2];assert_integer(w),assert_number(O),assert_number(F);for(var q=[],W=O,U=0;U<w;U++)q.push(W),W+=F;return array_to_list(q)});var copy_pair=function(D){var w=isPair(D.car)?copy_pair(D.car):D.car,O=isPair(D.cdr)?copy_pair(D.cdr):D.cdr;return new Pair(w,O)};define_libfunc("list-copy",1,1,function(D){return isPair(D[0])?copy_pair(D[0]):nil});define_libfunc("open-input-string",1,1,function(D){return assert_string(D[0]),new Port.StringInput(D[0])});define_libfunc("open-output-string",0,0,function(D){return new Port.StringOutput});define_libfunc("get-output-string",1,1,function(D){if(assert_port(D[0]),!(D[0]instanceof Port.StringOutput))throw new Error("get-output-string: port must be made by 'open-output-string'");return D[0].output_string()});define_syntax("receive",function(D){assert(isPair(D.cdr),"missing formals","receive");var w=D.cdr.car;assert(isPair(D.cdr.cdr),"missing expression","receive");var O=D.cdr.cdr.car,F=D.cdr.cdr.cdr;return deep_array_to_list([Sym("call-with-values"),[Sym("lambda"),nil,O],new Pair(Sym("lambda"),new Pair(w,F))])});define_libfunc("current-date",0,1,function(D){return new Date});define_libfunc("date?",1,1,function(D){return D[0]instanceof Date});define_libfunc("date-nanosecond",1,1,function(D){return assert_date(D[0]),D[0].getMilliseconds()*1e6});define_libfunc("date-millisecond",1,1,function(D){return assert_date(D[0]),D[0].getMilliseconds()});define_libfunc("date-second",1,1,function(D){return assert_date(D[0]),D[0].getSeconds()});define_libfunc("date-minute",1,1,function(D){return assert_date(D[0]),D[0].getMinutes()});define_libfunc("date-hour",1,1,function(D){return assert_date(D[0]),D[0].getHours()});define_libfunc("date-day",1,1,function(D){return assert_date(D[0]),D[0].getDate()});define_libfunc("date-month",1,1,function(D){return assert_date(D[0]),D[0].getMonth()+1});define_libfunc("date-year",1,1,function(D){return assert_date(D[0]),D[0].getFullYear()});define_libfunc("date-week-day",1,1,function(D){return assert_date(D[0]),D[0].getDay()});const date_names={weekday:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],full_weekday:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],full_month:["January","February","March","April","May","June","July","August","September","Octorber","November","December"]},date2string=function(D,w){var O=function(U){return U<10?"0"+U:""+U},F=function(U){return U<10?" "+U:""+U},q=function(U){var K=new Date(U.getFullYear(),0,4),G=new Date(U.getFullYear(),0,4);return K.getDay()>=date_names.weekday.indexOf("Thu")?G.setDate(K.getDate()-(K.getDay()+1)):G.setDate(K.getDate()+(7-K.getDay()+1)),Math.ceil((U-G)/864e5/7)},W={a:function(U){return date_names.weekday[U.getDay()]},A:function(U){return date_names.full_weekday[U.getDay()]},b:function(U){return date_names.month[U.getMonth()]},B:function(U){return date_names.full_month[U.getMonth()]},c:function(U){return U.toString()},d:function(U){return O(U.getDate())},D:function(U){return W.d(U)+W.m(U)+W.y(U)},e:function(U){return F(U.getDate())},f:function(U){return U.getSeconds()+U.getMilliseconds()/1e3},h:function(U){return date_names.month[U.getMonth()]},H:function(U){return O(U.getHours())},I:function(U){var K=U.getHours();return O(K<13?K:K-12)},j:function(U){throw new Bug("not implemented: day of year")},k:function(U){return F(U.getHours())},l:function(U){var K=U.getHours();return F(K<13?K:K-12)},m:function(U){return O(U.getMonth()+1)},M:function(U){return O(U.getMinutes())},n:function(U){return`
`},N:function(U){throw new Bug("not implemented: nanoseconds")},p:function(U){return U.getHours()<13?"AM":"PM"},r:function(U){return W.I(U)+":"+W.M(U)+":"+W.S(U)+" "+W.p(U)},s:function(U){return Math.floor(U.getTime()/1e3)},S:function(U){return O(U.getSeconds())},t:function(U){return"	"},T:function(U){return W.H(U)+":"+W.M(U)+":"+W.S(U)},U:function(U){throw new Bug("not implemented: weeknum(0~, Sun)")},V:function(U){return q(U)},w:function(U){return U.getDay()},W:function(U){throw new Bug("not implemented: weeknum(0~, Mon)")},x:function(U){throw new Bug("not implemented: weeknum(1~, Mon)")},X:function(U){return W.Y(U)+"/"+W.m(U)+"/"+W.d(U)},y:function(U){return U.getFullYear()%100},Y:function(U){return U.getFullYear()},z:function(U){throw new Bug("not implemented: time-zone")},Z:function(U){throw new Bug("not implemented: symbol time zone")},1:function(U){throw new Bug("not implemented: ISO-8601 year-month-day format")},2:function(U){throw new Bug("not implemented: ISO-8601 hour-minute-second-timezone format")},3:function(U){throw new Bug("not implemented: ISO-8601 hour-minute-second format")},4:function(U){throw new Bug("not implemented: ISO-8601 year-month-day-hour-minute-second-timezone format")},5:function(U){throw new Bug("not implemented: ISO-8601 year-month-day-hour-minute-second format")}};return w.replace(/~([\w1-5~])/g,function(U,K){var G=W[K];return G?G(D):K=="~"?"~":K})};define_libfunc("date->string",1,2,function(D){return assert_date(D[0]),D[1]?(assert_string(D[1]),date2string(D[0],D[1])):D[0].toString()});define_libfunc("parse-date",1,1,function(D){return assert_string(D[0]),new Date(Date.parse(D[0]))});define_libfunc("random-integer",1,1,function(D){var w=D[0];if(assert_integer(w),w<0)throw new Error("random-integer: the argument must be >= 0");return Math.floor(Math.random()*D[0])});define_libfunc("random-real",0,0,function(D){return Math.random()});define_libfunc("format",1,null,function(D){if(typeof D[0]=="string")var w=null,O=D.shift();else if(D[0]===!1){D.shift();var w=null,O=D.shift()}else if(D[0]===!0){D.shift();var w=Port.current_output,O=D.shift()}else{var w=D.shift(),O=D.shift();assert_port(w)}var F=O.replace(/~[as]/g,function(q){return assert(D.length>0,"insufficient number of arguments","format"),q=="~a"?to_display(D.shift()):to_write$1(D.shift())}).replace(/~%/,`
`).replace(/~~/,"~");return w?(w.put_string(F),undef):F});const user_write_ss=function(D){return Console.puts(write_shared(D[0]),!0),undef};define_libfunc("write/ss",1,2,user_write_ss);define_libfunc("write-with-shared-structure",1,2,user_write_ss);define_libfunc("write*",1,2,user_write_ss);define_libfunc("vector-append",2,null,function(D){var w=[];return w.concat.apply(w,D)});define_libfunc("vector-copy",1,1,function(D){return assert_vector(D[0]),[...D[0]]});var BiwaScheme$1={TopEnv,CoreEnv,nil,undef,max_trace_size,suppress_deprecation_warning,Version:VERSION,VERSION,GitCommit,eq,eqv,equal,isNil,isUndef,isBoolean,isString,isSymbol,isPort,isPair,isList,isVector,isHashtable,isMutableHashtable,isProcedure,lt,to_write:to_write$1,to_display,inspect,write_ss:write_shared,to_write_ss:write_shared,Call,Char,isChar,Closure,isClosure,Compiler,Enumeration,isEnumSet,Error:BiwaError,Bug,UserError,Hashtable,Interpreter,Complex,Rational:Rational$1,isNumber,isComplex,isReal,isRational,isInteger,Pair,List,array_to_list,deep_array_to_list,Cons,Parser,Pause,Port,eof,Promise:BiwaPromise,isPromise,Record,isRecord,isRecordTD,isRecordCD,Set:BiwaSet,Symbol:BiwaSymbol,Sym,gensym,Syntax,Values:Values$1,VMCode,define_libfunc,define_scmfunc,parse_fraction,is_valid_integer_notation,parse_integer,is_valid_float_notation,parse_float,assert_number,assert_integer,assert_real,assert_between,assert_string,assert_char,assert_symbol,assert_port,assert_pair,assert_list,assert_vector,assert_hashtable,assert_mutable_hashtable,assert_promise,assert_function,assert_closure,assert_procedure,assert_date,assert};Console.puts=function(D,w){Port.current_output.put_string(D+(w?"":`
`))};Console.p=function(){Port.current_output.put_string("p> "+Array.arrayFrom(arguments).map(inspect).join(" "))};const current_input=new Port.CustomInput(function(D){const w=document.querySelector("#bs-console"),O=document.createElement("form");O.innerHTML="<input id='webscheme-read-line' type='text'><input type='submit' value='ok'>",w.appendChild(O),O.addEventListener("submit",function(){const F=document.querySelector("#webscheme-read-line").value;return O.remove(),D(F),!1})}),current_output=new Port.CustomOutput(function(D){const w=document.querySelector("#bs-console");if(!w)return;const O=document.createElement("span");O.innerHTML=escape(D).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),w.appendChild(O)}),current_error=current_output,$$1=window.jQuery;define_libfunc("read-line",0,1,function(D){var w=D[0]||Port.current_input;return assert_port(w),w.get_string(O=>O)});define_libfunc("element-empty!",1,1,function(D){return $$1(D[0]).prop("value")?$$1(D[0]).val(""):$$1(D[0]).empty()});alias_libfunc("element-empty!","element-clear!");define_libfunc("element-visible?",1,1,function(D){return $$1(D[0]).is(":visible")});define_libfunc("element-toggle!",1,1,function(D){return $$1(D[0]).toggle()});define_libfunc("element-hide!",1,1,function(D){return $$1(D[0]).hide()});define_libfunc("element-show!",1,1,function(D){return $$1(D[0]).show()});define_libfunc("element-remove!",1,1,function(D){return $$1(D[0]).remove()});define_libfunc("element-update!",2,2,function(D){return $$1(D[0]).html(D[1])});define_libfunc("element-replace!",2,2,function(D){return $$1(D[0]).replaceWith(D[1])});define_libfunc("element-insert!",2,2,function(D){return $$1(D[0]).append(D[1])});define_libfunc("element-wrap!",3,3,function(D){throw new Bug("not yet implemented")});define_libfunc("element-ancestors",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-descendants",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-first-descendant",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-immediate-descendants",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-previous-sibling",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-next-sibling",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-siblings",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-match?",2,2,function(D){throw new Bug("not yet implemented")});define_libfunc("element-up",3,3,function(D){throw new Bug("not yet implemented")});define_libfunc("element-down",3,3,function(D){throw new Bug("not yet implemented")});define_libfunc("element-previous",3,3,function(D){throw new Bug("not yet implemented")});define_libfunc("element-next",3,3,function(D){throw new Bug("not yet implemented")});define_libfunc("element-select",1,1,function(D){$$1(D[0]).select()});define_libfunc("element-adjacent",0,0,function(D){throw new Bug("not yet implemented")});define_libfunc("element-identify",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-read-attribute",2,2,function(D){return assert_string(D[1]),D[1].startsWith("data-")?$$1(D[0]).attr(D[1]):$$1(D[0]).prop(D[1])});var element_write_attribute=function(D){return assert_string(D[1]),D[1].startsWith("data-")?$$1(D[0]).attr(D[1],D[2]):$$1(D[0]).prop(D[1],D[2])};define_libfunc("element-write-attribute",3,3,function(D){return deprecate("element-write-attribute","1.0","element-write-attribute!"),element_write_attribute(D)});define_libfunc("element-write-attribute!",3,3,element_write_attribute);define_libfunc("element-height",1,1,function(D){return $$1(D[0]).height()});define_libfunc("element-width",1,1,function(D){return $$1(D[0]).width()});define_libfunc("element-class-names",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-has-class-name?",2,2,function(D){return assert_string(D[1]),$$1(D[0]).hasClass(D[1])});var element_add_class_name=function(D){return assert_string(D[1]),$$1(D[0]).addClass(D[1])};define_libfunc("element-add-class-name",2,2,function(D){return deprecate("element-add-class-name","1.0","element-add-class-name!"),element_add_class_name(D)});define_libfunc("element-add-class-name!",2,2,element_add_class_name);var element_remove_class_name=function(D){return assert_string(D[1]),$$1(D[0]).removeClass(D[1])};define_libfunc("element-remove-class-name",2,2,function(D){return deprecate("element-remove-class-name","1.0","element-remove-class-name!"),element_remove_class_name(D)});define_libfunc("element-remove-class-name!",2,2,element_remove_class_name);var element_toggle_class_name=function(D){return assert_string(D[1]),$$1(D[0]).toggleClass(D[1])};define_libfunc("element-toggle-class-name",2,2,function(D){return deprecate("element-toggle-class-name","1.0","element-toggle-class-name!"),element_toggle_class_name(D)});define_libfunc("element-toggle-class-name!",2,2,element_toggle_class_name);define_libfunc("element-clean-whitespace!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-empty?",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-descendant-of!",2,2,function(D){throw new Bug("not yet implemented")});define_libfunc("scroll-to-element!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-style",2,2,function(D){throw new Bug("not yet implemented")});define_libfunc("element-opacity",2,2,function(D){throw new Bug("not yet implemented")});define_libfunc("element-style-set!",2,2,function(D){throw new Bug("not yet implemented")});define_libfunc("element-opacity-set!",2,2,function(D){throw new Bug("not yet implemented")});define_libfunc("element-dimensions",1,1,function(D){return new Values($$1(D[0]).width(),$$1(D[0]).height())});define_libfunc("element-make-positioned!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-undo-positioned!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-make-clipping!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-undo-clipping!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-cumulative-offset",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-positioned-offset",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-absolutize!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-relativize!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-cumulative-scroll-offset",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-offset-parent",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-viewport-offset",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-clone-position!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-absolutize!",1,1,function(D){throw new Bug("not yet implemented")});define_libfunc("element-focus!",1,1,function(D){return $$1(D[0]).focus()});const create_elements_by_string=function(D){D=D.to_array();var w=D.shift();w instanceof BiwaSymbol&&(w=w.name);var O=w.match(/(.*)\.(.*)/);O&&(w=O[1],D.unshift(Sym("class"),O[2])),O=w.match(/(.*)\#(.*)/),O&&(w=O[1],D.unshift(Sym("id"),O[2]));for(var F=[],q=["<"+w],W=0;W<D.length;W++)D[W]instanceof BiwaSymbol?(q.push(" "+D[W].name+'="'+D[W+1]+'"'),W++):D[W]instanceof Pair?F.push(create_elements_by_string(D[W])):F.push(D[W]);return q.push(">"),q.push(F.join("")),q.push("</"+w+">"),q.join("")},tree_all=function(D,w){return D===nil?!0:w(D.car)===!1?!1:tree_all(D.cdr,w)};define_libfunc("element-new",1,1,function(D){var w=function(O){return typeof O=="string"||O instanceof BiwaSymbol||O instanceof Pair};return tree_all(D[0],w)?$$1(create_elements_by_string(D[0]))[0]:nil});const element_content=function(D){return $$1(D).prop("value")?$$1(D).val():escape($$1(D).html())};define_libfunc("element-content",1,1,function(D){return element_content(D[0])});define_libfunc("load",1,1,function(D,w){var O=D[0];assert_string(O);var F=new Interpreter(w);return new Pause(function(q){$$1.ajax(O,{dataType:"text",mimeType:"text/plain; charset=UTF-8",success:function(W){F.evaluate(W,function(){return q.resume(undef)})},error:function(){throw new Error("load: network error: failed to load "+O)}})})});const _require=function(D,w,O){var F=$$1("<script/>",{src:D});$$1("body").append(F);var q=new Function("return !!("+w+")");q()?O():setTimeout(function(){q()?O():setTimeout(arguments.callee,10)},10)};define_libfunc("js-load",2,2,function(D){var w=D[0],O=D[1];return assert_string(w),assert_string(O),new Pause(function(F){_require(w,"window."+O,function(){F.resume(undef)})})});const getelem=function(D){D.length>1&&D[1]===!1&&(D[1]=[]);var w=$$1.apply(this,D);return w.length>0?w:!1};define_libfunc("$",1,2,getelem);define_libfunc("getelem",1,2,getelem);define_libfunc("dom-element",1,1,function(D){return $$1(D[0])[0]});define_libfunc("set-style!",3,3,function(D){return assert_string(D[1]),$$1(D[0]).css(D[1],D[2]),undef});define_libfunc("get-style",2,2,function(D){return assert_string(D[1]),$$1(D[0]).css(D[1])});define_libfunc("set-content!",2,2,function(D){assert_string(D[1]);var w=D[1].replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;");return $$1(D[0]).html(w),undef});define_libfunc("get-content",1,1,function(D){return element_content(D[0])});define_libfunc("set-handler!",3,3,function(D,w){throw new Error("set-handler! is obsolete, please use add-handler! instead")});define_libfunc("add-handler!",3,3,function(D,w){var O=D[0],F=D[1],q=D[2],W=function(U){return new Interpreter(w).invoke_closure(q,[U])};return $$1(O).on(F,W),W});define_libfunc("remove-handler!",3,3,function(D,w){var O=D[0],F=D[1],q=D[2];return $$1(O).off(F,q),undef});define_libfunc("wait-for",2,2,function(D){var w=D[0],O=D[1],F=$$1(w);F.biwascheme_wait_for=F.biwascheme_wait_for||{};var q=F.biwascheme_wait_for[O];return q&&F.off(O,q),new Pause(function(W){var U=function(K){return F.biwascheme_wait_for[O]=void 0,F.off(O,U),W.resume(K)};F.biwascheme_wait_for[O]=U,F.on(O,U)})});define_libfunc("domelem",1,null,function(D){throw new Error("obsolete")});define_libfunc("dom-remove-children!",1,1,function(D){return Console.puts("warning: dom-remove-children! is obsolete. use element-empty! instead"),$$1(D[0]).empty(),undef});define_libfunc("dom-create-element",1,1,function(D){throw new Error("obsolete")});define_libfunc("element-append-child!",2,2,function(D){return $$1(D[0]).append(D[1])});define_libfunc("dom-remove-child!",2,2,function(D){throw new Error("obsolete")});define_libfunc("http-request",1,1,function(D){var w=D[0];return assert_string(w),new Pause(function(O){$$1.get(w,function(F){O.resume(F)},"text")})});define_libfunc("http-post",2,2,function(D){var w=D[0];assert_string(w);var O=D[1];assert_list(O);var F=alist_to_js_obj(O);return new Pause(function(q){$$1.post(w,F,function(W){q.resume(W)},"text")})});const jsonp_receiver=[];define_libfunc("receive-jsonp",1,1,function(D){var w=D[0];assert_string(w);for(var O=jsonp_receiver,F=0;F<O.length&&O[F]!==null;F++);var q=F;return w+="?callback=BiwaScheme.jsonp_receiver["+q+"]",new Pause(function(W){O[q]=function(K){W.resume(K),O[q]=null};var U=$$1("<script/>",{src:w});$$1("body").append(U)})});define_libfunc("alert",1,1,function(D){return alert(D[0]),undef});define_libfunc("confirm",1,1,function(D){return confirm(D[0])});const DUMP_PAD="&nbsp;&nbsp;&nbsp;",FOLD_LIMIT=20,STACK_MAX_LEN=80;class Dumper{constructor(w){this.dumparea=w||$("#dumparea")[0]||null,this.reset()}reset(){this.dumparea&&$(this.dumparea).empty(),this.n_folds=0,this.closures=[],this.n_dumps=0,this.cur=-1,this.is_folded=!0}is_opc(w){return w instanceof Array&&typeof w[0]=="string"}dump_opc(w,K,G){var q="",W="",U="",K=K||0,G=G||!1;Array(K).fill().map(()=>{W+=DUMP_PAD}),Array(K+1).fill().map(()=>{U+=DUMP_PAD}),q+=W+'[<span class="dump_opecode">'+w[0]+"</span>";for(var Y=1;!(w[Y]instanceof Array)&&Y<w.length;)w[0]=="constant"?q+="&nbsp;<span class='dump_constant'>"+this.dump_obj(w[Y])+"</span>":q+="&nbsp;"+this.dump_obj(w[Y]),Y++;for(Y<w.length&&(q+=`<br>
`);Y<w.length;Y++)this.is_opc(w[Y])?q+=this.dump_opc(w[Y],Y==w.length-1?K:K+1,!0):(q+=Y==w.length-1?W:U,q+=this.dump_obj(w[Y])),Y!=w.length-1&&(q+=`<br>
`);return q+="]",G?q:this.add_fold(q)}add_fold(w){var O=w.split(/<br>/gim);if(O.length>FOLD_LIMIT){var F=" <span style='text-decoration:underline; color:blue; cursor:pointer;'onclick='BiwaScheme.Dumper.toggle_fold("+this.n_folds+")'>more</span>",q="<div style='display:none' class='fold"+this.n_folds+"'>",W="</div>";return this.n_folds++,[O.slice(0,FOLD_LIMIT).join("<br>"),F,q,O.slice(FOLD_LIMIT).join("<br>"),W].join("")}else return w}dump_stack(w,O){if(w==null)return inspect(w);var F="<table>";if(w.length==0)F+="<tr><td class='dump_dead'>(stack is empty)</td></tr>";else if(O<w.length){var q=w.length-1;F+="<tr><td class='dump_dead'>["+q+"]</td><td class='dump_dead'>"+truncate(this.dump_obj(w[q]),STACK_MAX_LEN)+"</td></tr>"}for(var W=O-1;W>=0;W--)F+="<tr><td class='dump_stknum'>["+W+"]</td><td>"+truncate(this.dump_obj(w[W]),STACK_MAX_LEN)+"</td></tr>";return F+"</table>"}dump_object(w){var O=[];for(var F in w)O.push(F.toString());return"#<Object{"+O.join(",")+"}>"}dump_closure(w){if(!w)return"**BROKEN**";if(w.length==0)return"[]";for(var O=null,F=0;F<this.closures.length;F++)this.closures[F]==w&&(O=F);O==null&&(O=this.closures.length,this.closures.push(w));var q=[...w],W=q.shift&&q.shift();return["c",O," <span class='dump_closure'>free vars :</span> ",this.dump_obj(q)," <span class='dump_closure'>body :</span> ",truncate(this.dump_obj(W),100)].join("")}dump_obj(w){if(w&&typeof w.to_html=="function")return w.to_html();var O=to_write$1(w);return O=="[object Object]"&&(O=this.dump_object(w)),escape(O)}dump(w){var O="";w instanceof Object?(O+="<table>",O+="<tr><td colspan='4'><a href='#' class='header'>#"+this.n_dumps+"</a></td></tr>",Object.keys(w).forEach((function(q){var W=w[q];q!="x"&&q!="stack"&&(W=q=="c"?this.dump_closure(W):this.dump_obj(W),O+="<tr><td>"+q+": </td><td colspan='3'>"+W+"</td></tr>")}).bind(this)),O+="<tr><td>x:</td><td>"+(this.is_opc(w.x)?this.dump_opc(w.x):this.dump_obj(w.x))+"</td>",O+="<td style='border-left: 1px solid black'>stack:</td><td>"+this.dump_stack(w.stack,w.s)+"</td></tr>",O+="</table>"):O=escape(inspect(w))+`<br>
`;var F=$("<div/>",{class:"dump"+this.n_dumps});F.html(O),$(this.dumparea).append(F),(function(q){$(".header",this.dump_el(this.n_dumps)).click((function(){this.dump_move_to(q),this.dump_fold()}).bind(this))}).bind(this)(this.n_dumps),F.hide(),this.n_dumps++}dump_el(w){return $(".dump"+w,this.dumparea)}dump_move_to(w){w<0&&(w=this.n_dumps+w),0<=w&&w<=this.n_dumps&&(this.dump_el(this.cur).hide(),this.cur=w,this.dump_el(this.cur).show())}dump_move(w){0<=this.cur&&this.cur<this.n_dumps&&this.dump_el(this.cur).hide(),0<=this.cur+w&&this.cur+w<this.n_dumps&&(this.cur+=w),this.dump_el(this.cur).show()}dump_fold(){for(var w=0;w<this.n_dumps;w++)w!=this.cur&&this.dump_el(w).hide();this.is_folded=!0}dump_unfold(){for(var w=0;w<this.n_dumps;w++)this.dump_el(w).show();this.is_folded=!1}dump_toggle_fold(){this.is_folded?this.dump_unfold():this.dump_fold()}}Dumper.toggle_fold=function(D){$(".fold"+D,this.dumparea).toggle()};const execute_user_program=function(){let D=null;const w=document.querySelector("#biwascheme-debugger");w&&(D=new Dumper(w));const O=function(W,U){if(BiwaScheme.Port.current_error.put_string(W.message+`
`),D)D.dump(U),D.dump_move(1);else if(typeof console<"u"&&console.error)console.error(W.message);else throw W},F=function(W){const U=new BiwaScheme.Interpreter(O);try{U.evaluate(W,function(){})}catch(K){O(K)}};let q="";for(const W of document.querySelectorAll("script[src$='biwascheme.js']"))q+=W.innerHTML;for(const W of document.querySelectorAll("script[src$='biwascheme-min.js']"))q+=W.innerHTML;q.length>0&&F(q),window.addEventListener("DOMContentLoaded",function(){for(const W of document.querySelectorAll("script[type='text/biwascheme']"))F(W.innerHTML)})};BiwaScheme$1.on_node=!1;BiwaScheme$1.Console=Console;BiwaScheme$1.Port.current_input=current_input;BiwaScheme$1.Port.current_output=current_output;BiwaScheme$1.Port.current_error=current_error;BiwaScheme$1.jsonp_receiver=jsonp_receiver;BiwaScheme$1.Dumper=Dumper;window.BiwaScheme=window.BiwaScheme||{};Object.assign(window.BiwaScheme,BiwaScheme$1);execute_user_program();var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(D,w,O,F)=>{for(var q=F>1?void 0:F?__getOwnPropDesc$2(w,O):w,W=D.length-1,U;W>=0;W--)(U=D[W])&&(q=(F?U(w,O,q):U(q))||q);return F&&q&&__defProp$2(w,O,q),q};let LispDemo=class extends r$4{constructor(){super(...arguments),this.code=`(define (fact n)
  (if (< n 2)
      1
      (* n (fact (- n 1)))))

(fact 5)`,this.result="",this.error=""}firstUpdated(){const D=EditorState.create({doc:this.code,extensions:[basicSetup,StreamLanguage.define(scheme)]}),w=this.shadowRoot.querySelector("#editor");this.editorView=new EditorView({state:D,parent:w})}evaluateCode(){if(this.result="",this.error="",this.editorView){const D=this.editorView.state.doc.toString();new BiwaScheme$1.Interpreter().evaluate(D,O=>{this.result=O===BiwaScheme$1.undef?"No result":O.toString(),this.requestUpdate()})}}render(){return x`
      <h2>Lisp Demo</h2>
      <p>
        Enter your Scheme (Lisp) code below and click "Evaluate" to run it.
      </p>
      <div id="editor"></div>
      <button @click=${this.evaluateCode}>Evaluate</button>
      ${this.result?x`<div class="result"><strong>Result:</strong> ${this.result}</div>`:""}
      ${this.error?x`<div class="error"><strong>Error:</strong> ${this.error}</div>`:""}
    `}};LispDemo.styles=i$8`
    :host {
      display: block;
      padding: 20px;
      background: #f9f9f9;
      font-family: Arial, sans-serif;
    }
    h2 {
      color: #333;
    }

    button {
      padding: 8px 16px;
      margin-top: 10px;
      font-size: 16px;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .result, .error {
      margin-top: 20px;
      padding: 10px;
      border-radius: 4px;
    }
    .result {
      background: #e0ffe0;
      color: #006600;
    }
    .error {
      background: #ffe0e0;
      color: #990000;
    }
  `;__decorateClass$2([n$3({type:String})],LispDemo.prototype,"code",2);__decorateClass$2([n$3({type:String})],LispDemo.prototype,"result",2);__decorateClass$2([n$3({type:String})],LispDemo.prototype,"error",2);LispDemo=__decorateClass$2([t$2("lisp-demo")],LispDemo);const $e=class $e extends r$4{constructor(){super(),this.closureResult="",this.identityResult="",this.associativityResult="",this.inverseResult=""}isEven(w){return w%2===0}checkClosure(){const w=this.renderRoot.querySelector("#closure-a"),O=this.renderRoot.querySelector("#closure-b"),F=parseInt(w.value,10),q=parseInt(O.value,10);if(isNaN(F)||isNaN(q)){this.closureResult="Please enter valid integers for a and b.";return}if(!this.isEven(F)||!this.isEven(q)){this.closureResult="Both a and b must be even numbers.";return}const W=F+q;this.closureResult=`Result: ${F} + ${q} = ${W}. Closure holds because the sum is even.`}checkIdentity(){const w=this.renderRoot.querySelector("#identity-a"),O=parseInt(w.value,10);if(isNaN(O)){this.identityResult="Please enter a valid integer for a.";return}if(!this.isEven(O)){this.identityResult="Please enter an even number for a.";return}const F=O+0;this.identityResult=`Result: ${O} + 0 = ${F}. The identity element is 0, which is even.`}checkAssociativity(){const w=this.renderRoot.querySelector("#assoc-a"),O=this.renderRoot.querySelector("#assoc-b"),F=this.renderRoot.querySelector("#assoc-c"),q=parseInt(w.value,10),W=parseInt(O.value,10),U=parseInt(F.value,10);if(isNaN(q)||isNaN(W)||isNaN(U)){this.associativityResult="Please enter valid integers for a, b, and c.";return}if(!this.isEven(q)||!this.isEven(W)||!this.isEven(U)){this.associativityResult="All of a, b, and c must be even numbers.";return}const K=q+W+U,G=q+(W+U);let Y=`Result: ( ${q} + ${W} ) + ${U} = ${K} and ${q} + ( ${W} + ${U} ) = ${G}. `;Y+=K===G?"Associativity holds.":"Associativity does not hold!",this.associativityResult=Y}checkInverse(){const w=this.renderRoot.querySelector("#inverse-a"),O=parseInt(w.value,10);if(isNaN(O)){this.inverseResult="Please enter a valid integer for a.";return}if(!this.isEven(O)){this.inverseResult="Please enter an even number for a.";return}const F=-O,q=O+F;this.inverseResult=`Result: ${O} + (${F}) = ${q}. Every even number a has an inverse (-a) such that a + (-a) = 0.`}render(){return x`
      <h1>Even Numbers Group Demonstration</h1>
      <p>
        This demonstration shows the group properties of the set of even numbers 
        <math xmlns="http://www.w3.org/1998/Math/MathML">
          <mn>2</mn>
          <mi>&#x2124;</mi>
        </math>
        under addition.
      </p>
      
      <section id="closure">
        <h2>Closure</h2>
        <p>
          Enter two even numbers to demonstrate closure:
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <mi>a</mi>
            <mo>+</mo>
            <mi>b</mi>
            <mo>=</mo>
            <mrow>
              <mn>2</mn>
              <mi>&#x2124;</mi>
            </mrow>
          </math>
        </p>
        <label for="closure-a">a:</label>
        <input id="closure-a" type="number" step="1" />
        <label for="closure-b">b:</label>
        <input id="closure-b" type="number" step="1" />
        <button @click=${this.checkClosure} id="check-closure">Check Closure</button>
        <div class="result" id="closure-result">${this.closureResult}</div>
      </section>
      
      <section id="identity">
        <h2>Identity</h2>
        <p>
          Enter an even number to demonstrate the identity property:
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <mi>a</mi>
            <mo>+</mo>
            <mn>0</mn>
            <mo>=</mo>
            <mi>a</mi>
          </math>
        </p>
        <label for="identity-a">a:</label>
        <input id="identity-a" type="number" step="1" />
        <button @click=${this.checkIdentity} id="check-identity">Check Identity</button>
        <div class="result" id="identity-result">${this.identityResult}</div>
      </section>
      
      <section id="associativity">
        <h2>Associativity</h2>
        <p>
          Enter three even numbers to demonstrate associativity:
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <mo>(</mo>
            <mi>a</mi>
            <mo>+</mo>
            <mi>b</mi>
            <mo>)</mo>
            <mo>+</mo>
            <mi>c</mi>
            <mo>=</mo>
            <mi>a</mi>
            <mo>+</mo>
            <mo>(</mo>
            <mi>b</mi>
            <mo>+</mo>
            <mi>c</mi>
            <mo>)</mo>
          </math>
        </p>
        <label for="assoc-a">a:</label>
        <input id="assoc-a" type="number" step="1" />
        <label for="assoc-b">b:</label>
        <input id="assoc-b" type="number" step="1" />
        <label for="assoc-c">c:</label>
        <input id="assoc-c" type="number" step="1" />
        <button @click=${this.checkAssociativity} id="check-associativity">Check Associativity</button>
        <div class="result" id="associativity-result">${this.associativityResult}</div>
      </section>
      
      <section id="inverse">
        <h2>Inverse</h2>
        <p>
          Enter an even number to demonstrate the inverse property:
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <mi>a</mi>
            <mo>+</mo>
            <mrow>
              <mo>(</mo>
              <mo>&#x2212;</mo>
              <mi>a</mi>
              <mo>)</mo>
            </mrow>
            <mo>=</mo>
            <mn>0</mn>
          </math>
        </p>
        <label for="inverse-a">a:</label>
        <input id="inverse-a" type="number" step="1" />
        <button @click=${this.checkInverse} id="check-inverse">Check Inverse</button>
        <div class="result" id="inverse-result">${this.inverseResult}</div>
      </section>
    `}};$e.properties={closureResult:{type:String},identityResult:{type:String},associativityResult:{type:String},inverseResult:{type:String}},$e.styles=i$8`
    :host {
      display: block;
      font-family: Arial, sans-serif;
      background-color: #eef;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    section {
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      margin: 20px 0;
      border-radius: 8px;
    }
    label {
      margin-right: 10px;
    }
    input {
      margin: 5px;
      padding: 5px;
      width: 60px;
    }
    button {
      padding: 8px 16px;
      font-size: 14px;
      margin-top: 10px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background-color: #007BFF;
      color: #fff;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    .result {
      margin-top: 10px;
      font-weight: bold;
    }
  `;let EvenGroupDemo=$e;customElements.define("even-group-demo",EvenGroupDemo);var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(D,w,O,F)=>{for(var q=F>1?void 0:F?__getOwnPropDesc$1(w,O):w,W=D.length-1,U;W>=0;W--)(U=D[W])&&(q=(F?U(w,O,q):U(q))||q);return F&&q&&__defProp$1(w,O,q),q};const elementToObj={1:{k:0,d:0},r:{k:1,d:0},r2:{k:2,d:0},f:{k:0,d:1},rf:{k:1,d:1},r2f:{k:2,d:1}};function composeD3(D,w){const O=elementToObj[D],F=elementToObj[w];let q=O.k+(O.d===0?F.k:-F.k);q=(q%3+3)%3;const W=(O.d+F.d)%2;for(const[U,K]of Object.entries(elementToObj))if(K.k===q&&K.d===W)return U;throw new Error(`composeD3: No matching element for k=${q}, d=${W}`)}function inverseD3(D){for(const w in elementToObj)if(composeD3(D,w)==="1")return w;throw new Error(`inverseD3: No inverse found for element ${D}`)}function displayD3(D){switch(D){case"1":return x`1`;case"r":return x`r`;case"r2":return x`r<sup>2</sup>`;case"f":return x`f`;case"rf":return x`r&middot;f`;case"r2f":return x`r<sup>2</sup>&middot;f`;default:return x`${D}`}}const vertexMapping={1:{top:"1",right:"2",left:"3"},r:{top:"3",right:"1",left:"2"},r2:{top:"2",right:"3",left:"1"},f:{top:"1",right:"3",left:"2"},rf:{top:"2",right:"1",left:"3"},r2f:{top:"3",right:"2",left:"1"}};let TriangleGroupDemo=class extends r$4{constructor(){super(...arguments),this.currentElement="1",this.animating=!1,this.formula=x`
      Result: <span class="left-highlight">${displayD3("1")}</span> &middot; 
      <span class="right-highlight">${displayD3("1")}</span> = 
      <span class="product-highlight">${displayD3("1")}</span>
  `}clearTableHighlights(){this.renderRoot.querySelectorAll("#multiplication-table td, #multiplication-table th").forEach(w=>{w.classList.remove("table-left-highlight","table-right-highlight","table-product-highlight")})}resetDemo(){this.currentElement!=="1"&&(this.currentElement="1"),this.formula=x`
      Result: <span class="left-highlight">${displayD3("1")}</span> &middot; 
      <span class="right-highlight">${displayD3("1")}</span> = 
      <span class="product-highlight">${displayD3("1")}</span>
    `,this.updateVertices(),this.clearTableHighlights(),this.highlightMultiplicationCell("1","1");const D=this.renderRoot.querySelector("#triangle-group");D&&D.setAttribute("transform","")}updateFormulaDisplay(D,w,O){this.formula=x`
      Result: <span class="left-highlight">${displayD3(D)}</span> &middot; 
      <span class="right-highlight">${displayD3(w)}</span> = 
      <span class="product-highlight">${displayD3(O)}</span>
    `}updateVertices(){const D=vertexMapping[this.currentElement],w=this.renderRoot.querySelector("#vertex-top"),O=this.renderRoot.querySelector("#vertex-right"),F=this.renderRoot.querySelector("#vertex-left");w&&(w.textContent=D.top),O&&(O.textContent=D.right),F&&(F.textContent=D.left)}highlightMultiplicationCell(D,w){this.clearTableHighlights(),this.renderRoot.querySelectorAll(`#multiplication-table [data-left="${D}"]`).forEach(W=>W.classList.add("table-left-highlight")),this.renderRoot.querySelectorAll(`#multiplication-table [data-right="${w}"]`).forEach(W=>W.classList.add("table-right-highlight"));const q=this.renderRoot.querySelector(`#multiplication-table td[data-left="${D}"][data-right="${w}"]`);q&&(q.classList.remove("table-left-highlight","table-right-highlight"),q.classList.add("table-product-highlight"))}async handleIdentityClick(){if(this.animating)return;this.animating=!0;const D="1",w=this.currentElement,O=composeD3(D,w);this.highlightMultiplicationCell(D,w),this.updateFormulaDisplay(D,w,O);const F=this.renderRoot.querySelector("#triangle-group");if(F){const q=F.animate([{transform:"scale(1)"},{transform:"scale(1.2)"},{transform:"scale(1)"}],{duration:300,easing:"ease-out",fill:"forwards"});await q.finished,q.cancel(),F.setAttribute("transform","")}this.currentElement=O,this.updateVertices(),this.animating=!1}async animateRotation(D,w,O){const F=this.renderRoot.querySelector("#triangle-group");if(!F)return;const q=performance.now();await new Promise(W=>{const U=K=>{const G=K-q,Y=Math.min(G/w,1);F.setAttribute("transform",`rotate(${D*Y})`),Y<1?requestAnimationFrame(U):W()};requestAnimationFrame(U)}),F.setAttribute("transform",""),this.currentElement=O,this.updateVertices(),this.animating=!1}async handleRotate120Click(){if(this.animating)return;this.animating=!0;const D="r",w=this.currentElement,O=composeD3(D,w);this.highlightMultiplicationCell(D,w),this.updateFormulaDisplay(D,w,O),await this.animateRotation(120,500,O)}async handleRotate240Click(){if(this.animating)return;this.animating=!0;const D="r2",w=this.currentElement,O=composeD3(D,w);this.highlightMultiplicationCell(D,w),this.updateFormulaDisplay(D,w,O),await this.animateRotation(240,1e3,O)}async animateReflection(D,w){const O=this.renderRoot.querySelector("#triangle-group");if(!O)return;const F=performance.now();await new Promise(q=>{const W=U=>{const K=U-F,G=Math.min(K/D,1),Y=1-2*G;O.setAttribute("transform",`scale(${Y}, 1)`),G<1?requestAnimationFrame(W):q()};requestAnimationFrame(W)}),O.setAttribute("transform",""),this.currentElement=w,this.updateVertices(),this.animating=!1}async handleReflectClick(){if(this.animating)return;this.animating=!0;const D="f",w=this.currentElement,O=composeD3(D,w);this.highlightMultiplicationCell(D,w),this.updateFormulaDisplay(D,w,O),await this.animateReflection(500,O)}async animateFlipThenRotation(D,w,O,F){const q=this.renderRoot.querySelector("#triangle-group");if(!q)return;const W=performance.now();await new Promise(K=>{const G=Y=>{const Q=Y-W,X=Math.min(Q/w,1),J=1-2*X;q.setAttribute("transform",`scale(${J}, 1)`),X<1?requestAnimationFrame(G):K()};requestAnimationFrame(G)});const U=performance.now();await new Promise(K=>{const G=Y=>{const Q=Y-U,X=Math.min(Q/O,1);q.setAttribute("transform",`rotate(${D*X}) scale(-1,1)`),X<1?requestAnimationFrame(G):K()};requestAnimationFrame(G)}),q.setAttribute("transform",""),this.currentElement=F,this.updateVertices(),this.animating=!1}async handleRFClick(){if(this.animating)return;this.animating=!0;const D="rf",w=this.currentElement,O=composeD3(D,w);this.highlightMultiplicationCell(D,w),this.updateFormulaDisplay(D,w,O),await this.animateFlipThenRotation(120,500,500,O)}async handleR2FClick(){if(this.animating)return;this.animating=!0;const D="r2f",w=this.currentElement,O=composeD3(D,w);this.highlightMultiplicationCell(D,w),this.updateFormulaDisplay(D,w,O),await this.animateFlipThenRotation(240,500,1e3,O)}handleInteractiveClosure(){const D=this.renderRoot.querySelector("#closure-a"),w=this.renderRoot.querySelector("#closure-b");if(!D||!w)return;const O=D.value,F=w.value,q=composeD3(O,F),W=x`
      Result: ${displayD3(O)} &middot; ${displayD3(F)} = ${displayD3(q)}. Closure holds because the result is in D₃.
    `;B(W,this.renderRoot.querySelector("#closure-result"))}handleInteractiveIdentityProp(){const D=this.renderRoot.querySelector("#identity-element");if(!D)return;const w=D.value,O=composeD3("1",w),F=x`
      Result: ${displayD3("1")} &middot; ${displayD3(w)} = ${displayD3(O)}. The identity element is 1.
    `;B(F,this.renderRoot.querySelector("#identity-result-prop"))}handleInteractiveAssociativityProp(){const D=this.renderRoot.querySelector("#assoc-a"),w=this.renderRoot.querySelector("#assoc-b"),O=this.renderRoot.querySelector("#assoc-c");if(!D||!w||!O)return;const F=D.value,q=w.value,W=O.value,U=composeD3(composeD3(F,q),W),K=composeD3(F,composeD3(q,W)),G=x`
      Result: ( ${displayD3(F)} &middot; ${displayD3(q)} ) &middot; ${displayD3(W)} = ${displayD3(U)}
      and ${displayD3(F)} &middot; ( ${displayD3(q)} &middot; ${displayD3(W)} ) = ${displayD3(K)}.
      ${U===K?"Associativity holds.":"Associativity fails!"}
    `;B(G,this.renderRoot.querySelector("#associativity-result-prop"))}handleInteractiveInverseProp(){const D=this.renderRoot.querySelector("#inverse-element");if(!D)return;const w=D.value,O=inverseD3(w),F=x`
      Result: ${displayD3(w)} &middot; ${displayD3(O)} = 1. Inverse holds.
    `;B(F,this.renderRoot.querySelector("#inverse-result-prop"))}render(){const D=["1","r","r2","f","rf","r2f"];return x`
      <h1>Triangle Group Demonstration (Dihedral Group D₃)</h1>
      
      <div id="formula-display" data-test-id="formula-display">${this.formula}</div>
      
      <div class="demo-container">
        <svg id="triangle-svg" width="300" height="300" viewBox="-150 -150 300 300" aria-label="Triangle group demonstration">
          <g id="triangle-group">
            <polygon points="0,-100 86.6,50 -86.6,50" fill="#007BFF" stroke="#0056b3" stroke-width="3"></polygon>
            <text id="vertex-top" class="vertex-label" x="0" y="-60" font-size="20" text-anchor="middle" fill="white" dominant-baseline="middle">1</text>
            <text id="vertex-right" class="vertex-label" x="50" y="30" font-size="20" text-anchor="middle" fill="white" dominant-baseline="middle">2</text>
            <text id="vertex-left" class="vertex-label" x="-50" y="30" font-size="20" text-anchor="middle" fill="white" dominant-baseline="middle">3</text>
          </g>
        </svg>
        
        <div id="multiplication-table">
          <table>
            <thead>
              <tr>
                <th>*</th>
                ${D.map(w=>x`<th data-right="${w}">${displayD3(w)}</th>`)}
              </tr>
            </thead>
            <tbody>
              ${D.map(w=>x`
                <tr>
                  <th data-left="${w}">${displayD3(w)}</th>
                  ${D.map(O=>x`
                    <td data-left="${w}" data-right="${O}">
                      ${displayD3(composeD3(w,O))}
                    </td>
                  `)}
                </tr>
              `)}
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="buttons">
        <button id="identity-button" 
          aria-label="Apply identity transformation"
          data-test-id="identity-button"
          ?disabled="${this.animating}"
          @click="${this.handleIdentityClick}">
          1 (Identity)
        </button>
        <button id="rotate-120-button" 
          aria-label="Rotate triangle 120 degrees"
          data-test-id="rotate-120-button"
          ?disabled="${this.animating}"
          @click="${this.handleRotate120Click}">
          r (Rotate 120°)
        </button>
        <button id="rotate-240-button" 
          aria-label="Rotate triangle 240 degrees"
          data-test-id="rotate-240-button"
          ?disabled="${this.animating}"
          @click="${this.handleRotate240Click}">
          r<sup>2</sup> (Rotate 240°)
        </button>
        <button id="reflect-button" 
          aria-label="Reflect triangle"
          data-test-id="reflect-button"
          ?disabled="${this.animating}"
          @click="${this.handleReflectClick}">
          f (Reflect)
        </button>
        <button id="rf-button" 
          aria-label="Reflect then rotate 120 degrees"
          data-test-id="rf-button"
          ?disabled="${this.animating}"
          @click="${this.handleRFClick}">
          r&middot;f
        </button>
        <button id="r2f-button" 
          aria-label="Reflect then rotate 240 degrees"
          data-test-id="r2f-button"
          ?disabled="${this.animating}"
          @click="${this.handleR2FClick}">
          r<sup>2</sup>&middot;f
        </button>
        <button id="reset-button" 
          aria-label="Reset demonstration"
          data-test-id="reset-button"
          ?disabled="${this.animating}"
          @click="${this.resetDemo}">
          Reset
        </button>
      </div>
      
      <div class="interactive">
        <section id="closure-section" aria-labelledby="closure-heading" data-test-id="closure-section">
          <h2 id="closure-heading">Closure</h2>
          <p>Select two elements to check closure under composition:</p>
          <label for="closure-a">a:</label>
          <select id="closure-a" data-test-id="closure-a-select">
            <option value="1">1</option>
            <option value="r">r</option>
            <option value="r2">r²</option>
            <option value="f">f</option>
            <option value="rf">r·f</option>
            <option value="r2f">r²·f</option>
          </select>
          <label for="closure-b">b:</label>
          <select id="closure-b" data-test-id="closure-b-select">
            <option value="1">1</option>
            <option value="r">r</option>
            <option value="r2">r²</option>
            <option value="f">f</option>
            <option value="rf">r·f</option>
            <option value="r2f">r²·f</option>
          </select>
          <button id="check-closure" 
            aria-label="Check closure property"
            data-test-id="check-closure-button"
            @click="${this.handleInteractiveClosure}">
            Check Closure
          </button>
          <div id="closure-result" class="result" data-test-id="closure-result"></div>
        </section>
        
        <section id="identity-prop-section" aria-labelledby="identity-prop-heading" data-test-id="identity-prop-section">
          <h2 id="identity-prop-heading">Identity</h2>
          <p>Select an element to see that composing with the identity yields the same element:</p>
          <label for="identity-element">a:</label>
          <select id="identity-element" data-test-id="identity-element-select">
            <option value="1">1</option>
            <option value="r">r</option>
            <option value="r2">r²</option>
            <option value="f">f</option>
            <option value="rf">r·f</option>
            <option value="r2f">r²·f</option>
          </select>
          <button id="check-identity-prop" 
            aria-label="Check identity property"
            data-test-id="identity-result-prop-button"
            @click="${this.handleInteractiveIdentityProp}">
            Check Identity
          </button>
          <div id="identity-result-prop" class="result" data-test-id="identity-result-prop"></div>
        </section>
        
        <section id="associativity-prop-section" aria-labelledby="associativity-prop-heading" data-test-id="associativity-prop-section">
          <h2 id="associativity-prop-heading">Associativity</h2>
          <p>Select three elements to verify associativity: (a·b)·c = a·(b·c)</p>
          <label for="assoc-a">a:</label>
          <select id="assoc-a" data-test-id="assoc-a-select">
            <option value="1">1</option>
            <option value="r">r</option>
            <option value="r2">r²</option>
            <option value="f">f</option>
            <option value="rf">r·f</option>
            <option value="r2f">r²·f</option>
          </select>
          <label for="assoc-b">b:</label>
          <select id="assoc-b" data-test-id="assoc-b-select">
            <option value="1">1</option>
            <option value="r">r</option>
            <option value="r2">r²</option>
            <option value="f">f</option>
            <option value="rf">r·f</option>
            <option value="r2f">r²·f</option>
          </select>
          <label for="assoc-c">c:</label>
          <select id="assoc-c" data-test-id="assoc-c-select">
            <option value="1">1</option>
            <option value="r">r</option>
            <option value="r2">r²</option>
            <option value="f">f</option>
            <option value="rf">r·f</option>
            <option value="r2f">r²·f</option>
          </select>
          <button id="check-associativity-prop" 
            aria-label="Check associativity property"
            data-test-id="check-associativity-prop-button"
            @click="${this.handleInteractiveAssociativityProp}">
            Check Associativity
          </button>
          <div id="associativity-result-prop" class="result" data-test-id="associativity-result-prop"></div>
        </section>
        
        <section id="inverse-prop-section" aria-labelledby="inverse-prop-heading" data-test-id="inverse-prop-section">
          <h2 id="inverse-prop-heading">Inverse</h2>
          <p>Select an element to find its inverse (b such that a·b = 1):</p>
          <label for="inverse-element">a:</label>
          <select id="inverse-element" data-test-id="inverse-element-select">
            <option value="1">1</option>
            <option value="r">r</option>
            <option value="r2">r²</option>
            <option value="f">f</option>
            <option value="rf">r·f</option>
            <option value="r2f">r²·f</option>
          </select>
          <button id="check-inverse-prop" 
            aria-label="Check inverse property"
            data-test-id="inverse-result-prop-button"
            @click="${this.handleInteractiveInverseProp}">
            Check Inverse
          </button>
          <div id="inverse-result-prop" class="result" data-test-id="inverse-result-prop"></div>
        </section>
      </div>
    `}};TriangleGroupDemo.styles=i$8`
    :host {
      display: block;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #eef;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .demo-container {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    svg {
      overflow: visible;
    }
    #multiplication-table {
      font-family: monospace;
      font-size: 16px;
    }
    #multiplication-table table {
      border-collapse: collapse;
    }
    #multiplication-table th,
    #multiplication-table td {
      border: 1px solid #ccc;
      padding: 5px 10px;
      text-align: center;
    }
    .table-left-highlight {
      background-color: rgba(255, 200, 200, 0.3);
    }
    .table-right-highlight {
      background-color: rgba(200, 200, 255, 0.3);
    }
    .table-product-highlight {
      background-color: rgba(200, 255, 200, 0.8);
    }
    #formula-display {
      text-align: center;
      font-size: 24px;
      margin-bottom: 20px;
    }
    .left-highlight {
      background-color: rgba(255, 200, 200, 0.8);
      padding: 0 4px;
    }
    .right-highlight {
      background-color: rgba(200, 200, 255, 0.8);
      padding: 0 4px;
    }
    .product-highlight {
      background-color: rgba(200, 255, 200, 0.8);
      padding: 0 4px;
    }
    .buttons, .interactive {
      text-align: center;
      margin-top: 20px;
    }
    button {
      padding: 8px 16px;
      margin: 5px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background-color: #007bff;
      color: #fff;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    section {
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      margin: 20px auto;
      max-width: 600px;
      border-radius: 8px;
      text-align: left;
    }
    section h2 {
      margin-top: 0;
      text-align: center;
    }
    section label {
      margin-right: 10px;
    }
    section select, section input {
      margin: 5px;
      padding: 5px;
      width: 80px;
    }
    section div.result {
      margin-top: 10px;
      font-weight: bold;
      text-align: center;
    }
  `;__decorateClass$1([n$3({type:String})],TriangleGroupDemo.prototype,"currentElement",2);__decorateClass$1([n$3({type:Boolean})],TriangleGroupDemo.prototype,"animating",2);__decorateClass$1([n$3({type:Object})],TriangleGroupDemo.prototype,"formula",2);TriangleGroupDemo=__decorateClass$1([t$2("triangle-group-demo")],TriangleGroupDemo);var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(D,w,O,F)=>{for(var q=F>1?void 0:F?__getOwnPropDesc(w,O):w,W=D.length-1,U;W>=0;W--)(U=D[W])&&(q=(F?U(w,O,q):U(q))||q);return F&&q&&__defProp(w,O,q),q};const andDeco=Decoration.mark({class:"cm-and-highlight"}),xorDeco=Decoration.mark({class:"cm-xor-highlight"}),keywordHighlighter=ViewPlugin.fromClass(class{constructor(D){this.decorations=this.buildDecorations(D)}update(D){(D.docChanged||D.viewportChanged)&&(this.decorations=this.buildDecorations(D.view))}buildDecorations(D){const w=new RangeSetBuilder,O=/\b(and|xor)\b/g;for(let{from:F,to:q}of D.visibleRanges){const W=D.state.doc.sliceString(F,q);let U;for(;(U=O.exec(W))!==null;){const K=U[1],G=F+U.index,Y=G+K.length,Q=D.state.doc.lineAt(G);if(Q.text.slice(0,G-Q.from).indexOf(";")!==-1)continue;const J=K==="and"?andDeco:xorDeco;w.add(G,Y,J)}}return w.finish()}},{decorations:D=>D.decorations});let AdderDemo=class extends r$4{constructor(){super(...arguments),this.result="",this.error="",this.demoType="half-adder",this.hiddenCode=`(define (my-and a b)
  (if (and (= a 1) (= b 1))
      1
      0))
(define and my-and)
(define (xor a b)
  (if (= (+ a b) 1)
      1
      0))
(define (my-or a b)
  (if (and (= a 0) (= b 0))
      0
      1))
(define or my-or)`,this.demoTemplates={"half-adder":{name:"Half-Adder Demo",code:`(define (half-adder a b)
  (cons (and a b) (xor a b)))

; Test the half-adder with inputs: 1 and 0
(half-adder 1 0)
`},"full-adder":{name:"Full-Adder Demo",code:`(define (full-adder a b c)
  (let ((sum (xor (xor a b) c))
        (carry (or (and a b) (and (xor a b) c))))
    (cons carry sum)))

; Test the full adder with inputs: 1, 1, 0
(full-adder 1 1 0)
`},"chained-full-adder":{name:"Chained Full-Adder Demo",code:`(define (full-adder a b c)
  (let ((sum (xor (xor a b) c))
        (carry (or (and a b) (and (xor a b) c))))
    (cons carry sum)))

; Chaining two full adders for two-bit addition
(let* ((fa1 (full-adder 1 0 0)) ; first bit addition, carry in 0
       (carry1 (car fa1))
       (sum1 (cdr fa1))
       (fa2 (full-adder 1 1 carry1))
       (carry2 (car fa2))
       (sum2 (cdr fa2)))
  (list carry2 sum2 sum1))
`}},this.code=this.demoTemplates[this.demoType].code}firstUpdated(){var O;const D=EditorState.create({doc:this.code,extensions:[basicSetup,StreamLanguage.define(scheme),keywordHighlighter]}),w=(O=this.shadowRoot)==null?void 0:O.querySelector("#editor");w&&(this.editorView=new EditorView({state:D,parent:w}))}handleDemoTypeChange(D){const w=D.target;this.demoType=w.value;const O=this.demoTemplates[this.demoType].code;this.code=O,this.editorView&&this.editorView.dispatch({changes:{from:0,to:this.editorView.state.doc.length,insert:O}}),this.result="",this.error=""}evaluateCode(){if(this.result="",this.error="",this.editorView){const D=this.editorView.state.doc.toString(),w=`${this.hiddenCode}
${D}`,O=new BiwaScheme$1.Interpreter;try{O.evaluate(w,F=>{this.result=F!==BiwaScheme$1.undef?F.toString():"No result",this.requestUpdate()})}catch(F){this.error=F.message}}}render(){return x`
      <h2>${this.demoTemplates[this.demoType].name}</h2>
      <p>
        The definitions for <strong>and</strong>, <strong>xor</strong>, and <strong>or</strong> are hidden.
        Edit the code below and click "Evaluate" to simulate the selected adder.
      </p>
      <label for="demo-select">Select Demo:</label>
      <select id="demo-select" @change=${this.handleDemoTypeChange}>
        <option value="half-adder" ?selected=${this.demoType==="half-adder"}>Half Adder</option>
        <option value="full-adder" ?selected=${this.demoType==="full-adder"}>Full Adder</option>
        <option value="chained-full-adder" ?selected=${this.demoType==="chained-full-adder"}>Chained Full Adder</option>
      </select>
      <div id="editor"></div>
      <br />
      <button @click=${this.evaluateCode}>Evaluate</button>
      ${this.result?x`<div class="result"><strong>Result:</strong> ${this.result}</div>`:""}
      ${this.error?x`<div class="error"><strong>Error:</strong> ${this.error}</div>`:""}
    `}};AdderDemo.styles=i$8`
    :host {
      display: block;
      padding: 20px;
      background: #f9f9f9;
      font-family: Arial, sans-serif;
    }
    h2 {
      color: #333;
    }
    /* CodeMirror editor container */
    #editor {
      border: 1px solid #ccc;
      border-radius: 4px;
      height: 150px;
      overflow: auto;
    }
    button {
      padding: 8px 16px;
      margin-top: 10px;
      font-size: 16px;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    select {
      margin-bottom: 10px;
      padding: 5px;
      font-size: 16px;
    }
    .result,
    .error {
      margin-top: 20px;
      padding: 10px;
      border-radius: 4px;
    }
    .result {
      background: #e0ffe0;
      color: #006600;
    }
    .error {
      background: #ffe0e0;
      color: #990000;
    }
    /* Special highlighting for the keywords "and" and "xor" */
    .cm-and-highlight {
      background-color: #a0d8ef; /* Light blue */
    }
    .cm-xor-highlight {
      background-color: #ffcc80; /* Light orange */
    }
  `;__decorateClass([n$3({type:String})],AdderDemo.prototype,"result",2);__decorateClass([n$3({type:String})],AdderDemo.prototype,"error",2);__decorateClass([n$3({type:String})],AdderDemo.prototype,"demoType",2);AdderDemo=__decorateClass([t$2("adder-demo")],AdderDemo);const De=class De extends r$4{constructor(){super(),this.activeView="";const w=["Ecclesiastes 1:13 – 'And I applied my mind to seek and to search out by wisdom all that is done under heaven; it is an unhappy business that God has given to the sons of men to be busy with.'","Romans 1:20 – 'Ever since the creation of the world his invisible nature, namely, his eternal power and deity, has been clearly perceived in the things that have been made. So they are without excuse;'","Psalm 19:1 – 'The heavens are telling the glory of God; and the firmament proclaims his handiwork.'","Colossians 1:16–17 – 'For in him all things were created, in heaven and on earth, visible and invisible, whether thrones or dominions or principalities or authorities—all things were created through him and for him. He is before all things, and in him all things hold together.'","Proverbs 1:5 – 'The wise man also may hear and increase in learning, and the man of understanding acquire skill,'"];this.randomVerse=w[Math.floor(Math.random()*w.length)]}render(){return x`
      <header>
        <h1>Museum of Mathematics</h1>
        <p>Explore our exhibits by selecting one from the menu below.</p>
      </header>
      <nav class="menu">
        <!-- Dropdown for Exhibits -->
        <sl-dropdown>
          <sl-button slot="trigger" variant="primary">Exhibits</sl-button>
          <sl-menu>
            <sl-menu-item @click=${()=>this.handleMenuClick("group")}>
              Group Theory Exhibit
            </sl-menu-item>
            <sl-menu-item @click=${()=>this.handleMenuClick("even")}>
              Even Numbers Exhibit
            </sl-menu-item>
            <sl-menu-item @click=${()=>this.handleMenuClick("other")}>
              Triangle Groups Exhibit
            </sl-menu-item>
          </sl-menu>
        </sl-dropdown>

        <!-- Dropdown for Demos -->
        <sl-dropdown>
          <sl-button slot="trigger" variant="primary">Demos</sl-button>
          <sl-menu>
            <sl-menu-item @click=${()=>this.handleMenuClick("lisp")}>
              Lisp Demo
            </sl-menu-item>
            <sl-menu-item @click=${()=>this.handleMenuClick("adder-demo")}>
              Adder Demo
            </sl-menu-item>
          </sl-menu>
        </sl-dropdown>
      </nav>
      <main class="content">
        ${this.activeView==="group"?x`<z-group-demo></z-group-demo>`:this.activeView==="even"?x`<even-group-demo></even-group-demo>`:this.activeView==="other"?x`<triangle-group-demo></triangle-group-demo>`:this.activeView==="lisp"?x`<lisp-demo></lisp-demo>`:this.activeView==="adder-demo"?x`<adder-demo></adder-demo>`:x`<p>Welcome to the Museum of Mathematics. Please select an exhibit from the menu above.</p>`}
      </main>
      <footer>
        <p>${this.randomVerse}</p>
      </footer>
    `}handleMenuClick(w){this.activeView=w}};De.styles=i$8`
    header {
      text-align: center;
      margin-bottom: 2rem;
    }
    nav.menu {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    main.content {
      border: none;
    }
    footer {
      text-align: center;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      color: #fff;
      padding: 1.5rem;
      margin-top: 2rem;
      font-size: 1rem;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.15);
    }
  `,De.properties={activeView:{type:String},randomVerse:{type:String}};let MyApp=De;customElements.define("my-app",MyApp);
//# sourceMappingURL=index-RISMTxWm.js.map
